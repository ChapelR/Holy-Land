<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>G_Combine</title>
<meta name="description" content="Holy Land is am interactive fiction narrative game featuring RPG-like customization, turn-based combat, and a gripping, professionally written and edited story, as well as original art, music, and sound.

IFID: 2E6EE76E-E31A-4AD3-B730-FFCC2FAA304D">
<meta name="identity" content="Narrative Game">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.24.0): A free (gratis and libre) story format.

Copyright © 2013–2018 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<!--

Build Info:
  * Built on 19 Mar 2018 at 05:08:40, -0500
  * Made in Twine 1.4.2 (running on Windows 7)

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
if("document" in self){if(!("classList" in document.createElement("_"))){(function(j){"use strict";if(!("Element" in j)){return}var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===""){throw new n("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(o)){throw new n("INVALID_CHARACTER_ERR","String contains an invalid character")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+="";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+"";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false,q;do{r=t[s]+"";q=g(this,r);while(q!==-1){this.splice(q,1);o=true;q=g(this,r)}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==true&&"remove":q!==false&&"add";if(r){this[r](p)}if(q===true||q===false){return q}else{return !o}};e.toString=function(){return this.join(" ")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))}else{(function(){var b=document.createElement("_");b.classList.add("c1","c2");if(!b.classList.contains("c2")){var c=function(e){var d=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(h){var g,f=arguments.length;for(g=0;g<f;g++){h=arguments[g];d.call(this,h)}}};c("add");c("remove")}b.classList.toggle("c3",false);if(b.classList.contains("c3")){var a=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(d,e){if(1 in arguments&&!this.contains(d)===!e){return e}else{return a.call(this,d)}}}b=null}())}};
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.9/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},j=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},E="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return j(t)}if(O(t)){return false}var r=T.call(t);return r===E||r===I};var M;var U=RegExp.prototype.exec,F=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},N="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?F(t):T.call(t)===N};var C;var k=String.prototype.valueOf,A=function tryStringObject(t){try{k.call(t);return true}catch(r){return false}},R="[object String]";C=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?A(t):T.call(t)===R};var P=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var $=function(t){var r;if(P){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var Z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var z=function Empty(){};$(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){z.prototype=r.prototype;a.prototype=new z;z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var B=d.bind(n.toString);var H=d.bind(s);var W=g.bind(s);var L=d.bind(f.slice);var X=d.bind(f.split);var q=d.bind(f.indexOf);var K=d.bind(v);var Q=d.bind(n.propertyIsEnumerable);var V=d.bind(r.sort);var _=t.isArray||function isArray(t){return B(t)==="[object Array]"};var tt=[].unshift(0)!==1;$(r,{unshift:function(){h.apply(this,arguments);return this.length}},tt);$(t,{isArray:_});var rt=e("a");var et=rt[0]!=="a"||!(0 in rt);var nt=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};$(r,{forEach:function forEach(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=-1;var i=Z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!nt(r.forEach));$(r,{map:function map(r){var e=Z.ToObject(this);var n=et&&C(this)?X(this,""):e;var i=Z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!nt(r.map));$(r,{filter:function filter(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){K(i,a)}}}return i}},!nt(r.filter));$(r,{every:function every(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!nt(r.every));$(r,{some:function some(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!nt(r.some));var it=false;if(r.reduce){it=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}$(r,{reduce:function reduce(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!it);var at=false;if(r.reduceRight){at=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}$(r,{reduceRight:function reduceRight(t){var r=Z.ToObject(this);var e=et&&C(this)?X(this,""):r;var n=Z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!at);var ot=r.indexOf&&[0,1].indexOf(1,2)!==-1;$(r,{indexOf:function indexOf(t){var r=et&&C(this)?X(this,""):Z.ToObject(this);var e=Z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=Z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},ot);var ft=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;$(r,{lastIndexOf:function lastIndexOf(t){var r=et&&C(this)?X(this,""):Z.ToObject(this);var e=Z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,Z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},ft);var ut=function(){var t=[1,2];var r=t.splice();return t.length===2&&_(r)&&r.length===0}();$(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ut);var lt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();$(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(Z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=H(arguments);if(e.length<2){K(e,this.length-t)}else{e[1]=Z.ToInteger(r)}}return c.apply(this,e)}},!lt);var st=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var ct=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();$(r,{splice:function splice(t,r){var e=Z.ToObject(this);var n=[];var i=Z.ToUint32(e.length);var a=Z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=b(w(Z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=H(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!st||!ct);var vt=r.join;var ht;try{ht=Array.prototype.join.call("123",",")!=="1,2,3"}catch(pt){ht=true}if(ht){$(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return vt.call(C(this)?X(this,""):this,r)}},ht)}var yt=[1,2].join(undefined)!=="1,2";if(yt){$(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return vt.call(this,r)}},yt)}var dt=function push(t){var r=Z.ToObject(this);var e=Z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var gt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();$(r,{push:function push(t){if(_(this)){return v.apply(this,arguments)}return dt.apply(this,arguments)}},gt);var wt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();$(r,{push:dt},wt);$(r,{slice:function(t,r){var e=C(this)?X(this,""):this;return W(e,arguments)}},et);var bt=function(){try{[1,2].sort(null);[1,2].sort({});return true}catch(t){}return false}();var Tt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var mt=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();$(r,{sort:function sort(t){if(typeof t==="undefined"){return V(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return V(this,t)}},bt||!mt||!Tt);var Dt=!Q({toString:null},"toString");var St=Q(function(){},"prototype");var xt=!G("x","0");var Ot=function(t){var r=t.constructor;return r&&r.prototype===t};var jt={$window:true,$console:true,$parent:true,$self:true,$frame:true,$frames:true,$frameElement:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$external:true};var Et=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!jt["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){Ot(window[t])}}catch(r){return true}}return false}();var It=function(t){if(typeof window==="undefined"||!Et){return Ot(t)}try{return Ot(t)}catch(r){return false}};var Mt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ut=Mt.length;var Ft=function isArguments(t){return B(t)==="[object Arguments]"};var Nt=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!_(t)&&D(t.callee)};var Ct=Ft(arguments)?Ft:Nt;$(e,{keys:function keys(t){var r=D(t);var e=Ct(t);var n=t!==null&&typeof t==="object";var i=n&&C(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=St&&r;if(i&&xt||e){for(var u=0;u<t.length;++u){K(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){K(a,o(l))}}}if(Dt){var s=It(t);for(var c=0;c<Ut;c++){var v=Mt[c];if(!(s&&v==="constructor")&&G(t,v)){K(a,v)}}}return a}});var kt=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var At=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Rt=e.keys;$(e,{keys:function keys(t){if(Ct(t)){return Rt(H(t))}else{return Rt(t)}}},!kt||At);var Pt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var $t=new Date(-0x55d318d56a724);var Jt=new Date(14496624e5);var Yt=$t.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Zt;var zt;var Gt=$t.getTimezoneOffset();if(Gt<-720){Zt=$t.toDateString()!=="Tue Jan 02 -45875";zt=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(Jt.toString())}else{Zt=$t.toDateString()!=="Mon Jan 01 -45875";zt=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(Jt.toString())}var Bt=d.bind(Date.prototype.getFullYear);var Ht=d.bind(Date.prototype.getMonth);var Wt=d.bind(Date.prototype.getDate);var Lt=d.bind(Date.prototype.getUTCFullYear);var Xt=d.bind(Date.prototype.getUTCMonth);var qt=d.bind(Date.prototype.getUTCDate);var Kt=d.bind(Date.prototype.getUTCDay);var Qt=d.bind(Date.prototype.getUTCHours);var Vt=d.bind(Date.prototype.getUTCMinutes);var _t=d.bind(Date.prototype.getUTCSeconds);var tr=d.bind(Date.prototype.getUTCMilliseconds);var rr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var er=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var nr=function daysInMonth(t,r){return Wt(new Date(r,t,0))};$(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Ht(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Ht(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Ht(this);var e=Wt(this);if(t<0&&r>11){if(r===12){return e}var n=nr(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Lt(this);if(t<0&&Xt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Lt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Lt(this);var r=Xt(this);var e=qt(this);if(t<0&&r>11){if(r===12){return e}var n=nr(0,t+1);return n-e+1}return e}},Pt);$(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Kt(this);var r=qt(this);var e=Xt(this);var n=Lt(this);var i=Qt(this);var a=Vt(this);var o=_t(this);return rr[t]+", "+(r<10?"0"+r:r)+" "+er[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Pt||Yt);$(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return rr[t]+" "+er[e]+" "+(r<10?"0"+r:r)+" "+n}},Pt||Zt);if(Pt||zt){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return rr[t]+" "+er[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(P){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var ir=-621987552e5;var ar="-000001";var or=Date.prototype.toISOString&&new Date(ir).toISOString().indexOf(ar)===-1;var fr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var ur=d.bind(Date.prototype.getTime);$(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(ur(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=Lt(this);var r=Xt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,qt(this),Qt(this),Vt(this),_t(this)];t=(t<0?"-":t>9999?"+":"")+L("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=L("00"+e[n],-2)}return t+"-"+H(e,0,2).join("-")+"T"+H(e,2).join(":")+"."+L("000"+tr(this),-3)+"Z"}},or||fr);var lr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(ir).toJSON().indexOf(ar)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!lr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=Z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var sr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var cr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var vr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(vr||cr||!sr){var hr=Math.pow(2,31)-1;var pr=Y(new Date(1970,0,1,0,0,0,hr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(pr&&s>=7&&l>hr){var p=Math.floor(l/hr)*hr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){$(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(pr&&n>hr){var i=Math.floor(n/hr)*hr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}$(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;$(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};$(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var yr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128");var dr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<dr.size){n+=t*dr.data[e];dr.data[e]=n%dr.base;n=Math.floor(n/dr.base)}},divide:function divide(t){var r=dr.size;var e=0;while(--r>=0){e+=dr.data[r];dr.data[r]=Math.floor(e/t);e=e%t*dr.base}},numToString:function numToString(){var t=dr.size;var r="";while(--t>=0){if(r!==""||t===0||dr.data[t]!==0){var e=o(dr.data[t]);if(r===""){r=e}else{r+=L("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var gr=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=dr.log(e*dr.pow(2,69,1))-69;f=a<0?e*dr.pow(2,-a,1):e/dr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){dr.multiply(0,f);l=r;while(l>=7){dr.multiply(1e7,0);l-=7}dr.multiply(dr.pow(10,l,1),0);l=a-1;while(l>=23){dr.divide(1<<23);l-=23}dr.divide(1<<l);dr.multiply(1,1);dr.divide(2);i=dr.numToString()}else{dr.multiply(0,f);dr.multiply(1<<-a,0);i=dr.numToString()+L("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+L("0.0000000000000000000",0,r-s+2)+i}else{i=n+L(i,0,s-r)+"."+L(i,s-r)}}else{i=n+i}return i};$(l,{toFixed:gr},yr);var wr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var br=l.toPrecision;$(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?br.call(this):br.call(this,t)}},wr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return X(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:Z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){K(a,L(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,H(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){K(a,"")}}else{K(a,L(i,f))}return a.length>p?H(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return X(this,t,r)}}var Tr=f.replace;var mr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){K(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!mr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Tr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;K(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Tr.call(this,t,i)}}}var Dr=f.substr;var Sr="".substr&&"0b".substr(-1)!=="b";$(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return Dr.call(this,e,r)}},Sr);var xr="	\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var Or="\u200b";var jr="["+xr+"]";var Er=new RegExp("^"+jr+jr+"*");var Ir=new RegExp(jr+jr+"*$");var Mr=f.trim&&(xr.trim()||!Or.trim());$(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Er,"").replace(Ir,"")}},Mr);var Ur=d.bind(String.prototype.trim);var Fr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;$(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:Z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=q(L(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Fr);var Nr=f.lastIndexOf;$(f,{lastIndexOf:function lastIndexOf(t){return Nr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(xr+"08")!==8||parseInt(xr+"0x16")!==22){parseInt=function(t){var r=/^[\-+]?0[xX]/;return function parseInt(e,n){var i=Ur(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Ur(String(r));var n=t(e);return n===0&&L(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var Cr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=Cr}if(P){var kr=function(t,r){if(Q(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};kr(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}kr(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Ar=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Ar}});
//# sourceMappingURL=es5-shim.map
/*!
  * https://github.com/paulmillr/es6-shim
  * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
  *   and contributors,  MIT License
  * es6-shim: v0.35.3
  * see https://github.com/paulmillr/es6-shim/blob/0.35.1/LICENSE
  * Details and documentation:
  * https://github.com/paulmillr/es6-shim/
  */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(e){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(e){return false}};var u=o(i);var f=function(){return!i(function(){Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var F=Math.exp;var L=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function isArguments(e){return g(e)==="[object Arguments]"};var Q=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var ee=Y(arguments)?Y:Q;var te={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var re=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var ne=typeof $==="function"&&typeof $["for"]==="function"&&te.symbol($());var oe=te.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){oe="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ie=S.Reflect;var ae=String;var ue=typeof document==="undefined"||!document?null:document.all;var fe=ue==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==ue};var se={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!se.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(fe(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===ue},ToObject:function(e,t){return Object(se.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return se.IsCallable(e)},ToInt32:function(e){return se.ToNumber(e)>>0},ToUint32:function(e){return se.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=se.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=se.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return se.TypeIsObject(e)&&(typeof e[oe]!=="undefined"||ee(e))},GetIterator:function(e){if(ee(e)){return new q(e,"value")}var t=se.GetMethod(e,oe);if(!se.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=se.Call(t,e);if(!se.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=se.ToObject(e)[t];if(fe(r)){return void 0}if(!se.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=se.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=se.Call(r,e)}catch(e){o=e}if(t){return}if(o){throw o}if(!se.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!se.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=se.IteratorNext(e);var r=se.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ie.construct){return ie.construct(e,t,o)}var i=o.prototype;if(!se.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=se.Call(e,a,t);return se.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!se.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(fe(n)){return t}if(!se.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=se.ToString(e);var i="<"+t;if(r!==""){var a=se.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!se.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return te.regex(e)},ToString:function ToString(e){return ae(e)}};if(s&&ne){var ce=function defineWellKnownSymbol(e){if(te.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!te.symbol($.search)){var le=ce("search");var pe=String.prototype.search;h(RegExp.prototype,le,function search(e){return se.Call(pe,e,[this])});var ve=function search(e){var t=se.RequireObjectCoercible(this);if(!fe(e)){var r=se.GetMethod(e,le);if(typeof r!=="undefined"){return se.Call(r,e,[t])}}return se.Call(pe,t,[se.ToString(e)])};re(String.prototype,"search",ve)}if(!te.symbol($.replace)){var ye=ce("replace");var he=String.prototype.replace;h(RegExp.prototype,ye,function replace(e,t){return se.Call(he,e,[this,t])});var be=function replace(e,t){var r=se.RequireObjectCoercible(this);if(!fe(e)){var n=se.GetMethod(e,ye);if(typeof n!=="undefined"){return se.Call(n,e,[r,t])}}return se.Call(he,r,[se.ToString(e),t])};re(String.prototype,"replace",be)}if(!te.symbol($.split)){var ge=ce("split");var de=String.prototype.split;h(RegExp.prototype,ge,function split(e,t){return se.Call(de,e,[this,t])});var me=function split(e,t){var r=se.RequireObjectCoercible(this);if(!fe(e)){var n=se.GetMethod(e,ge);if(typeof n!=="undefined"){return se.Call(n,e,[r,t])}}return se.Call(de,r,[se.ToString(e),t])};re(String.prototype,"split",me)}var Oe=te.symbol($.match);var we=Oe&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!Oe||we){var je=ce("match");var Se=String.prototype.match;h(RegExp.prototype,je,function match(e){return se.Call(Se,e,[this])});var Te=function match(e){var t=se.RequireObjectCoercible(this);if(!fe(e)){var r=se.GetMethod(e,je);if(typeof r!=="undefined"){return se.Call(r,e,[t])}}return se.Call(Se,t,[se.ToString(e)])};re(String.prototype,"match",Te)}}var Ie=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Ee=function(){return this};var Pe=function(e){if(s&&!z(e,J)){m.getter(e,J,Ee)}};var Ce=function(e,t){var r=t||function iterator(){return this};h(e,oe,r);if(!e[oe]&&te.symbol(oe)){e[oe]=r}};var Me=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var xe=function createDataPropertyOrThrow(e,t,r){Me(e,t,r);if(!se.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ne=function(e,t,r,n){if(!se.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!se.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Ae=String.fromCodePoint;re(String,"fromCodePoint",function fromCodePoint(e){return se.Call(Ae,this,arguments)})}var Re={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!se.SameValue(r,se.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=se.ToObject(e,"bad callSite");var r=se.ToObject(t.raw,"bad raw value");var n=r.length;var o=se.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=se.ToString(a);s=se.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=se.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){re(String,"raw",Re.raw)}b(String,Re);var _e=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var ke=Infinity;var Fe={repeat:function repeat(e){var t=se.ToString(se.RequireObjectCoercible(this));var r=se.ToInteger(e);if(r<0||r>=ke){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return _e(t,r)},startsWith:function startsWith(e){var t=se.ToString(se.RequireObjectCoercible(this));if(se.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=se.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(se.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=se.ToString(se.RequireObjectCoercible(this));if(se.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=se.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:se.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(se.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=se.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=se.ToString(se.RequireObjectCoercible(this));var r=se.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){re(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var Le=i(function(){"/a/".startsWith(/a/)});var De=a(function(){return"abc".startsWith("a",Infinity)===false});if(!Le||!De){re(String.prototype,"startsWith",Fe.startsWith);re(String.prototype,"endsWith",Fe.endsWith)}}if(ne){var ze=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!ze){re(String.prototype,"startsWith",Fe.startsWith)}var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!qe){re(String.prototype,"endsWith",Fe.endsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!We){re(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var Ge=["\t\n\v\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var He=new RegExp("(^["+Ge+"]+)|(["+Ge+"]+$)","g");var Ve=function trim(){return se.ToString(se.RequireObjectCoercible(this)).replace(He,"")};var Be=["\x85","\u200b","\ufffe"].join("");var Ue=new RegExp("["+Be+"]","g");var $e=/^[-+]0x[0-9a-f]+$/i;var Je=Be.trim().length!==Be.length;h(String.prototype,"trim",Ve,Je);var Xe=function(e){return{value:e,done:arguments.length===0}};var Ke=function(e){se.RequireObjectCoercible(e);this._s=se.ToString(e);this._i=0};Ke.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Xe()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Xe(e.substr(t,o))};Ce(Ke.prototype);Ce(String.prototype,function(){return new Ke(this)});var Ze={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!se.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(ee(e)||se.GetMethod(e,oe))!=="undefined";var u,f,s;if(a){f=se.IsConstructor(r)?Object(new r):[];var c=se.GetIterator(e);var l,p;s=0;while(true){l=se.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(e){se.IteratorClose(c,true);throw e}s+=1}u=s}else{var v=se.ToObject(e);u=se.ToLength(v.length);f=se.IsConstructor(r)?Object(new r(u)):new Array(u);var y;for(s=0;s<u;++s){y=v[s];if(o){y=typeof i==="undefined"?n(y,s):t(n,i,y,s)}xe(f,s,y)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!se.IsCallable(t)?new Array(e):se.Construct(t,[e]);for(var o=0;o<e;++o){xe(n,o,arguments[o])}n.length=e;return n}};b(Array,Ze);Pe(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=se.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Xe(o)}}this.array=void 0;return Xe()}});Ce(q.prototype);var Ye=Array.of===Ze.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Ye){re(Array,"of",Ze.of)}var Qe={copyWithin:function copyWithin(e,t){var r=se.ToObject(this);var n=se.ToLength(r.length);var o=se.ToInteger(e);var i=se.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:se.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=se.ToObject(this);var o=se.ToLength(n.length);t=se.ToInteger(typeof t==="undefined"?0:t);r=se.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=se.ToObject(this);var n=se.ToLength(r.length);if(!se.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=se.ToObject(this);var n=se.ToLength(r.length);if(!se.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!se.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!se.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[oe]){b(Array.prototype,{values:Array.prototype[oe]});if(te.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var et=Array.prototype.values;re(Array.prototype,"values",function values(){return se.Call(et,this,arguments)});h(Array.prototype,oe,Array.prototype.values,true)}b(Array.prototype,Qe);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Ce(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Ce(Object.getPrototypeOf([].values()))}var tt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var rt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!tt||!rt){re(Array,"from",Ze.from)}var nt=function(){return a(function(){return Array.from([0],void 0)})}();if(!nt){var ot=Array.from;re(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return se.Call(ot,this,arguments)}else{return t(ot,this,e)}})}var it=-(Math.pow(2,32)-1);var at=function(e,r){var n={length:it};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!at(Array.prototype.forEach)){var ut=Array.prototype.forEach;re(Array.prototype,"forEach",function forEach(e){return se.Call(ut,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.map)){var ft=Array.prototype.map;re(Array.prototype,"map",function map(e){return se.Call(ft,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.filter)){var st=Array.prototype.filter;re(Array.prototype,"filter",function filter(e){return se.Call(st,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.some)){var ct=Array.prototype.some;re(Array.prototype,"some",function some(e){return se.Call(ct,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.every)){var lt=Array.prototype.every;re(Array.prototype,"every",function every(e){return se.Call(lt,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.reduce)){var pt=Array.prototype.reduce;re(Array.prototype,"reduce",function reduce(e){return se.Call(pt,this.length>=0?this:[],arguments)},true)}if(!at(Array.prototype.reduceRight,true)){var vt=Array.prototype.reduceRight;re(Array.prototype,"reduceRight",function reduceRight(e){return se.Call(vt,this.length>=0?this:[],arguments)},true)}var yt=Number("0o10")!==8;var ht=Number("0b10")!==2;var bt=y(Be,function(e){return Number(e+0+e)===0});if(yt||ht||bt){var gt=Number;var dt=/^0b[01]+$/i;var mt=/^0o[0-7]+$/i;var Ot=dt.test.bind(dt);var wt=mt.test.bind(mt);var jt=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(te.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(te.primitive(t)){return t}}throw new TypeError("No default value")};var St=Ue.test.bind(Ue);var Tt=$e.test.bind($e);var It=function(){var e=function Number(t){var r;if(arguments.length>0){r=te.primitive(t)?t:jt(t,"number")}else{r=0}if(typeof r==="string"){r=se.Call(Ve,r);if(Ot(r)){r=parseInt(C(r,2),2)}else if(wt(r)){r=parseInt(C(r,2),8)}else if(St(r)||Tt(r)){r=NaN}}var n=this;var o=a(function(){gt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new gt(r)}return gt(r)};return e}();Ie(gt,It,{});b(It,{NaN:gt.NaN,MAX_VALUE:gt.MAX_VALUE,MIN_VALUE:gt.MIN_VALUE,NEGATIVE_INFINITY:gt.NEGATIVE_INFINITY,POSITIVE_INFINITY:gt.POSITIVE_INFINITY});Number=It;m.redefine(S,"Number",It)}var Et=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Et,MIN_SAFE_INTEGER:-Et,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&se.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){re(Array.prototype,"find",Qe.find)}if([,1].findIndex(function(){return true})!==0){re(Array.prototype,"findIndex",Qe.findIndex)}var Pt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Ct=function ensureEnumerable(e,t){if(s&&Pt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var Mt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var xt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var Nt=function(e,t){var r=n(Object(t));var o;if(se.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Pt(t))}return p(P(r,o||[]),xt(t),e)};var At={assign:function(e,t){var r=se.ToObject(e,"Cannot convert undefined or null to object");return p(se.Call(Mt,1,arguments),Nt,r)},is:function is(e,t){return se.SameValue(e,t)}};var Rt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(Rt){re(Object,"assign",At.assign)}b(Object,At);if(s){var _t={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!se.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||se.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(t){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,_t)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var kt=!i(function(){Object.keys("foo")});if(!kt){var Ft=Object.keys;re(Object,"keys",function keys(e){return Ft(se.ToObject(e))});n=Object.keys}var Lt=i(function(){Object.keys(/a/g)});if(Lt){var Dt=Object.keys;re(Object,"keys",function keys(e){if(te.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return Dt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var zt=!i(function(){Object.getOwnPropertyNames("foo")});if(!zt){var qt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Wt=Object.getOwnPropertyNames;re(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=se.ToObject(e);if(g(t)==="[object Window]"){try{return Wt(t)}catch(e){return P([],qt)}}return Wt(t)})}}if(Object.getOwnPropertyDescriptor){var Gt=!i(function(){Object.getOwnPropertyDescriptor("foo","bar")});if(!Gt){var Ht=Object.getOwnPropertyDescriptor;re(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Ht(se.ToObject(e),t)})}}if(Object.seal){var Vt=!i(function(){Object.seal("foo")});if(!Vt){var Bt=Object.seal;re(Object,"seal",function seal(e){if(!se.TypeIsObject(e)){return e}return Bt(e)})}}if(Object.isSealed){var Ut=!i(function(){Object.isSealed("foo")});if(!Ut){var $t=Object.isSealed;re(Object,"isSealed",function isSealed(e){if(!se.TypeIsObject(e)){return true}return $t(e)})}}if(Object.freeze){var Jt=!i(function(){Object.freeze("foo")});if(!Jt){var Xt=Object.freeze;re(Object,"freeze",function freeze(e){if(!se.TypeIsObject(e)){return e}return Xt(e)})}}if(Object.isFrozen){var Kt=!i(function(){Object.isFrozen("foo")});if(!Kt){var Zt=Object.isFrozen;re(Object,"isFrozen",function isFrozen(e){if(!se.TypeIsObject(e)){return true}return Zt(e)})}}if(Object.preventExtensions){var Yt=!i(function(){Object.preventExtensions("foo")});if(!Yt){var Qt=Object.preventExtensions;re(Object,"preventExtensions",function preventExtensions(e){if(!se.TypeIsObject(e)){return e}return Qt(e)})}}if(Object.isExtensible){var er=!i(function(){Object.isExtensible("foo")});if(!er){var tr=Object.isExtensible;re(Object,"isExtensible",function isExtensible(e){if(!se.TypeIsObject(e)){return false}return tr(e)})}}if(Object.getPrototypeOf){var rr=!i(function(){Object.getPrototypeOf("foo")});if(!rr){var nr=Object.getPrototypeOf;re(Object,"getPrototypeOf",function getPrototypeOf(e){return nr(se.ToObject(e))})}}var or=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&se.IsCallable(e.get)}();if(s&&!or){var ir=function flags(){if(!se.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ir)}var ar=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var ur=ne&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var fr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var sr=fr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!fr||!sr){var cr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=se.RequireObjectCoercible(this);if(te.regex(e)){return t(cr,e)}var r=ae(e.source);var n=ae(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,cr)}if(s&&(!ar||ur)){var lr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var vr=function(){return this.source};var yr=se.IsCallable(pr.get)?pr.get:vr;var hr=RegExp;var br=function(){return function RegExp(e,t){var r=se.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(te.regex(e)){o=se.Call(yr,e);i=typeof t==="undefined"?se.Call(lr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new hr(e,t)}}();Ie(hr,br,{$input:true});RegExp=br;m.redefine(S,"RegExp",br)}if(s){var gr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(gr),function(e){if(e in RegExp&&!(gr[e]in RegExp)){m.getter(RegExp,gr[e],function get(){return RegExp[e]})}})}Pe(RegExp);var dr=1/Number.EPSILON;var mr=function roundTiesToEven(e){return e+dr-dr};var Or=Math.pow(2,-23);var wr=Math.pow(2,127)*(2-Or);var jr=Math.pow(2,-126);var Sr=Math.E;var Tr=Math.LOG2E;var Ir=Math.LOG10E;var Er=Number.prototype.clz;delete Number.prototype.clz;var Pr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}return L(t/Sr+D(t+1)*D(t-1)/Sr)+1},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}return t<0?-asinh(-t):L(t+D(t*t+1))},atanh:function atanh(e){var t=Number(e);if(X(t)||t<-1||t>1){return NaN}if(t===-1){return-Infinity}if(t===1){return Infinity}if(t===0){return t}return.5*L((1+t)/(1-t))},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=F(L(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=se.ToUint32(t);if(r===0){return 32}return Er?se.Call(Er,r):31-_(L(r+.5)*Tr)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}if(t<0){t=-t}if(t>21){return F(t)/2}return(F(t)+F(-t))/2},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return F(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return L(e)*Tr},log10:function log10(e){return L(e)*Ir},log1p:function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(L(1+t)/(1+t-1))},sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}if(k(t)<1){return(Math.expm1(t)-Math.expm1(-t))/2}return(F(t-1)-F(-t-1))*Sr/2},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=se.ToUint32(e);var n=se.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<jr){return r*mr(n/jr/Or)*jr*Or}var o=(1+Or/Number.EPSILON)*n;var i=o-(o-n);if(i>wr||X(i)){return r*Infinity}return r*i}};b(Math,Pr);h(Math,"log1p",Pr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Pr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"tanh",Pr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,"acosh",Pr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"cbrt",Pr.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8);h(Math,"sinh",Pr.sinh,Math.sinh(-2e-17)!==-2e-17);var Cr=Math.expm1(10);h(Math,"expm1",Pr.expm1,Cr>22025.465794806718||Cr<22025.465794806718);var Mr=Math.round;var xr=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Nr=dr+1;var Ar=2*dr-1;var Rr=[Nr,Ar].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;
return e-t<.5?t:r},!xr||!Rr);m.preserveToString(Math.round,Mr);var _r=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Pr.imul;m.preserveToString(Math.imul,_r)}if(Math.imul.length!==2){re(Math,"imul",function imul(e,t){return se.Call(_r,Math,arguments)})}var kr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}se.IsPromise=function(e){if(!se.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!se.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(se.IsCallable(t.resolve)&&se.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&se.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=se.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(se.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(e){n=e;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!se.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(t){return m(e,t)}if(!se.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(e){i(e)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!se.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ne(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(e){o(e)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=se.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(t){e.done=true;throw t}o[f]=void 0;var s=t.resolve(u);var c=P(f,o,r,i);i.count+=1;w(s.then,s,c,r.reject);f+=1}if(--i.count===0){var l=r.resolve;l(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=se.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(t){e.done=true;throw t}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=se.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(e){var a=e;if(i&&!i.done){try{se.IteratorClose(o,true)}catch(e){a=e}}var u=n.reject;u(a);return n.promise}},race:function race(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=se.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(e){var a=e;if(i&&!i.done){try{se.IteratorClose(o,true)}catch(e){a=e}}var u=n.reject;u(a);return n.promise}},reject:function reject(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!se.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(se.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{catch:function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!se.IsPromise(n)){throw new TypeError("not a promise")}var o=se.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=se.IsCallable(e)?e:a;var d=se.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof kr==="function"){b(S,{Promise:kr});var Fr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Lr=!i(function(){S.Promise.reject(42).then(null,5).then(null,W)});var Dr=i(function(){S.Promise.call(3,W)});var zr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(e){return true}return t===r}(S.Promise);var qr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Wr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Wr.prototype=Promise.prototype;Wr.all=Promise.all;var Gr=a(function(){return!!Wr.all([1,2])});if(!Fr||!Lr||!Dr||zr||!qr||Gr){Promise=kr;re(S,"Promise",kr)}if(Promise.all.length!==1){var Hr=Promise.all;re(Promise,"all",function all(e){return se.Call(Hr,this,arguments)})}if(Promise.race.length!==1){var Vr=Promise.race;re(Promise,"race",function race(e){return se.Call(Vr,this,arguments)})}if(Promise.resolve.length!==1){var Br=Promise.resolve;re(Promise,"resolve",function resolve(e){return se.Call(Br,this,arguments)})}if(Promise.reject.length!==1){var Ur=Promise.reject;re(Promise,"reject",function reject(e){return se.Call(Ur,this,arguments)})}Ct(Promise,"all");Ct(Promise,"race");Ct(Promise,"resolve");Ct(Promise,"reject");Pe(Promise)}var $r=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Jr=$r(["z","a","bb"]);var Xr=$r(["z",1,"a","3",2]);if(s){var Kr=function fastkey(e,t){if(!t&&!Jr){return null}if(fe(e)){return"^"+se.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Xr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Zr=function emptyObject(){return Object.create?Object.create(null):{}};var Yr=function addIterableToMap(e,n,o){if(r(o)||te.string(o)){l(o,function(e){if(!se.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!fe(o)){a=n.set;if(!se.IsCallable(a)){throw new TypeError("bad map")}i=se.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=se.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!se.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(e){se.IteratorClose(i,true);throw e}}}}};var Qr=function addIterableToSet(e,n,o){if(r(o)||te.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!fe(o)){a=n.add;if(!se.IsCallable(a)){throw new TypeError("bad set")}i=se.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=se.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(e){se.IteratorClose(i,true);throw e}}}}};var en={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!se.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+se.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={next:function next(){var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Xe()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Xe(n)}}this.i=void 0;return Xe()}};Ce(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ne(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Zr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){Yr(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Kr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(se.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Kr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(se.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Kr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(se.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(se.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},delete:function(t){o(this,"delete");var r=this._head;var n=r;var i=Kr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(se.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Zr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Ce(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!se.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+se.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ne(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Zr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){Qr(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new en.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Kr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Kr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},delete:function(e){r(this,"delete");var t;if(this._storage&&(t=Kr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Zr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return this["[[SetData]]"].values()},entries:function entries(){r(this,"entries");u(this);return this["[[SetData]]"].entries()},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Ce(i.prototype,i.prototype.values);return i}()};if(S.Map||S.Set){var tn=a(function(){return new Map([[1,2]]).get(1)===2});if(!tn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){Yr(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var rn=new Map;var nn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var on=rn.set(1,2)===rn;if(!nn||!on){re(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!nn){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var an=new Set;var un=function(e){e["delete"](0);e.add(-0);return!e.has(0)}(an);var fn=an.add(1)===an;if(!un||!fn){var sn=Set.prototype.add;Set.prototype.add=function add(e){t(sn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,sn)}if(!un){var cn=Set.prototype.has;Set.prototype.has=function has(e){return t(cn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,cn);var ln=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(ln,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],ln)}var pn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var vn=Object.setPrototypeOf&&!pn;var yn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||vn||!yn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){Yr(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var hn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||bn||!gn){var dn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new dn;if(arguments.length>0){Qr(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=dn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,dn)}var mn=new S.Map;var On=!a(function(){return mn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||mn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof mn.keys().next!=="function"||On||!pn){b(S,{Map:en.Map,Set:en.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Ce(Object.getPrototypeOf((new S.Map).keys()));Ce(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var wn=S.Set.prototype.has;re(S.Set.prototype,"has",function has(e){return t(wn,this,e)})}}b(S,en);Pe(S.Map);Pe(S.Set)}var jn=function throwUnlessTargetIsObject(e){if(!se.TypeIsObject(e)){throw new TypeError("target must be an object")}};var Sn={apply:function apply(){return se.Call(se.Call,null,arguments)},construct:function construct(e,t){if(!se.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!se.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return se.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){jn(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){jn(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(Sn,{ownKeys:function ownKeys(e){jn(e);var t=Object.getOwnPropertyNames(e);if(se.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Tn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(Sn,{isExtensible:function isExtensible(e){jn(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){jn(e);return Tn(function(){Object.preventExtensions(e)})}})}if(s){var In=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return In(o,t,r)}if("value"in n){return n.value}if(n.get){return se.Call(n.get,r)}return void 0};var En=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return En(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!se.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ie.defineProperty(o,r,{value:n})}else{return ie.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(Sn,{defineProperty:function defineProperty(e,t,r){jn(e);return Tn(function(){Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){jn(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){jn(e);var r=arguments.length>2?arguments[2]:e;return In(e,t,r)},set:function set(e,t,r){jn(e);var n=arguments.length>3?arguments[3]:e;return En(e,t,r,n)}})}if(Object.getPrototypeOf){var Pn=Object.getPrototypeOf;Sn.getPrototypeOf=function getPrototypeOf(e){jn(e);return Pn(e)}}if(Object.setPrototypeOf&&Sn.getPrototypeOf){var Cn=function(e,t){var r=t;while(r){if(e===r){return true}r=Sn.getPrototypeOf(r)}return false};Object.assign(Sn,{setPrototypeOf:function setPrototypeOf(e,t){jn(e);if(t!==null&&!se.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ie.getPrototypeOf(e)){return true}if(ie.isExtensible&&!ie.isExtensible(e)){return false}if(Cn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var Mn=function(e,t){if(!se.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){re(S.Reflect,e,t)}}};Object.keys(Sn).forEach(function(e){Mn(e,Sn[e])});var xn=S.Reflect.getPrototypeOf;if(c&&xn&&xn.name!=="getPrototypeOf"){re(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(xn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){re(S.Reflect,"setPrototypeOf",Sn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){re(S.Reflect,"defineProperty",Sn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){re(S.Reflect,"construct",Sn.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var Nn=Date.prototype.toString;var An=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return se.Call(Nn,this)};re(Date.prototype,"toString",An)}var Rn={anchor:function anchor(e){return se.CreateHTML(this,"a","name",e)},big:function big(){return se.CreateHTML(this,"big","","")},blink:function blink(){return se.CreateHTML(this,"blink","","")},bold:function bold(){return se.CreateHTML(this,"b","","")},fixed:function fixed(){return se.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return se.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return se.CreateHTML(this,"font","size",e)},italics:function italics(){return se.CreateHTML(this,"i","","")},link:function link(e){return se.CreateHTML(this,"a","href",e)},small:function small(){return se.CreateHTML(this,"small","","")},strike:function strike(){return se.CreateHTML(this,"strike","","")},sub:function sub(){return se.CreateHTML(this,"sub","","")},sup:function sub(){return se.CreateHTML(this,"sup","","")}};l(Object.keys(Rn),function(e){var r=String.prototype[e];var n=false;if(se.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){re(String.prototype,e,Rn[e])}});var _n=function(){if(!ne){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var kn=a(function(){if(!ne){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(_n||!kn){var Fn=JSON.stringify;re(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=se.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(te.symbol(n)){return xt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Fn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c=[],d=a.document,e=Object.getPrototypeOf,f=c.slice,g=c.concat,h=c.push,i=c.indexOf,j={},k=j.toString,l=j.hasOwnProperty,m=l.toString,n=m.call(Object),o={};function p(a,b){b=b||d;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}var q="3.1.1",r=function(a,b){return new r.fn.init(a,b)},s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/^-ms-/,u=/-([a-z])/g,v=function(a,b){return b.toUpperCase()};r.fn=r.prototype={jquery:q,constructor:r,length:0,toArray:function(){return f.call(this)},get:function(a){return null==a?f.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var b=r.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return r.each(this,a)},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:c.sort,splice:c.splice},r.extend=r.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||r.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(r.isPlainObject(d)||(e=r.isArray(d)))?(e?(e=!1,f=c&&r.isArray(c)?c:[]):f=c&&r.isPlainObject(c)?c:{},g[b]=r.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},r.extend({expando:"jQuery"+(q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===r.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=r.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==k.call(a))&&(!(b=e(a))||(c=l.call(b,"constructor")&&b.constructor,"function"==typeof c&&m.call(c)===n))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?j[k.call(a)]||"object":typeof a},globalEval:function(a){p(a)},camelCase:function(a){return a.replace(t,"ms-").replace(u,v)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(w(a)){for(c=a.length;d<c;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(s,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(w(Object(a))?r.merge(c,"string"==typeof a?[a]:a):h.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:i.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;f<g;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,f=0,h=[];if(w(a))for(d=a.length;f<d;f++)e=b(a[f],f,c),null!=e&&h.push(e);else for(f in a)e=b(a[f],f,c),null!=e&&h.push(e);return g.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),r.isFunction(a))return d=f.call(arguments,2),e=function(){return a.apply(b||this,d.concat(f.call(arguments)))},e.guid=a.guid=a.guid||r.guid++,e},now:Date.now,support:o}),"function"==typeof Symbol&&(r.fn[Symbol.iterator]=c[Symbol.iterator]),r.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){j["[object "+b+"]"]=b.toLowerCase()});function w(a){var b=!!a&&"length"in a&&a.length,c=r.type(a);return"function"!==c&&!r.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}var x=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+K+"*("+L+")(?:"+K+"*([*^$|!~]?=)"+K+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+L+"))|)"+K+"*\\]",N=":("+L+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",O=new RegExp(K+"+","g"),P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(N),U=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),aa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ba=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ca=function(a,b){return b?"\0"===a?"\ufffd":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},da=function(){m()},ea=ta(function(a){return a.disabled===!0&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{G.apply(D=H.call(v.childNodes),v.childNodes),D[v.childNodes.length].nodeType}catch(fa){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s=b&&b.ownerDocument,w=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==w&&9!==w&&11!==w)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==w&&(l=Z.exec(a)))if(f=l[1]){if(9===w){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(s&&(j=s.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(l[2])return G.apply(d,b.getElementsByTagName(a)),d;if((f=l[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==w)s=b,r=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(ba,ca):b.setAttribute("id",k=u),o=g(a),h=o.length;while(h--)o[h]="#"+k+" "+sa(o[h]);r=o.join(","),s=$.test(a)&&qa(b.parentNode)||b}if(r)try{return G.apply(d,s.querySelectorAll(r)),d}catch(x){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(P,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return function(b){return"form"in b?b.parentNode&&b.disabled===!1?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ea(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function pa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function qa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),v!==n&&(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(n.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){return a.getAttribute("id")===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}}):(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c,d,e,f=b.getElementById(a);if(f){if(c=f.getAttributeNode("id"),c&&c.value===a)return[f];e=b.getElementsByName(a),d=0;while(f=e[d++])if(c=f.getAttributeNode("id"),c&&c.value===a)return[f]}return[]}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){if("undefined"!=typeof b.getElementsByClassName&&p)return b.getElementsByClassName(a)},r=[],q=[],(c.qsa=Y.test(n.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+K+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&q.push(":enabled",":disabled"),o.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Y.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"*"),s.call(a,"[s!='']:x"),r.push("!=",N)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Y.test(o.compareDocumentPosition),t=b||Y.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?I(k,a)-I(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?I(k,a)-I(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?la(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(S,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.escape=function(a){return(a+"").replace(ba,ca)},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(_,aa),a[3]=(a[3]||a[4]||a[5]||"").replace(_,aa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return V.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&T.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(_,aa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(O," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(P,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(_,aa),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return U.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(_,aa).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:oa(!1),disabled:oa(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:pa(function(){return[0]}),last:pa(function(a,b){return[b-1]}),eq:pa(function(a,b,c){return[c<0?c+b:c]}),even:pa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:pa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:pa(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:pa(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function ra(){}ra.prototype=d.filters=d.pseudos,d.setFilters=new ra,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=Q.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function sa(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function ta(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=x++;return b.first?function(b,c,e){while(b=b[d])if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[w,h];if(i){while(b=b[d])if((1===b.nodeType||g)&&a(b,c,i))return!0}else while(b=b[d])if(1===b.nodeType||g)if(l=b[u]||(b[u]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===w&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}return!1}}function ua(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function va(a,b,c){for(var d=0,e=b.length;d<e;d++)ga(a,b[d],c);return c}function wa(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function xa(a,b,c,d,e,f){return d&&!d[u]&&(d=xa(d)),e&&!e[u]&&(e=xa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||va(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:wa(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=wa(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=wa(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ya(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ta(function(a){return a===b},h,!0),l=ta(function(a){return I(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];i<f;i++)if(c=d.relative[a[i].type])m=[ta(ua(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;e<f;e++)if(d.relative[a[e].type])break;return xa(i>1&&ua(m),i>1&&sa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(P,"$1"),c,i<e&&ya(a.slice(i,e)),e<f&&ya(a=a.slice(e)),e<f&&sa(a))}m.push(c)}return ua(m)}function za(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=E.call(i));u=wa(u)}G.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&ga.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=ya(b[c]),f[u]?d.push(f):e.push(f);f=A(a,za(e,d)),f.selector=a}return f},i=ga.select=function(a,b,c,e){var f,i,j,k,l,m="function"==typeof a&&a,n=!e&&g(a=m.selector||a);if(c=c||[],1===n.length){if(i=n[0]=n[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&9===b.nodeType&&p&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(_,aa),b)||[])[0],!b)return c;m&&(b=b.parentNode),a=a.slice(i.shift().value.length)}f=V.needsContext.test(a)?0:i.length;while(f--){if(j=i[f],d.relative[k=j.type])break;if((l=d.find[k])&&(e=l(j.matches[0].replace(_,aa),$.test(i[0].type)&&qa(b.parentNode)||b))){if(i.splice(f,1),a=e.length&&sa(i),!a)return G.apply(c,e),c;break}}}return(m||h(a,n))(e,b,!p,c,!b||$.test(a)&&qa(b.parentNode)||b),c},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("fieldset"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(J,function(a,b,c){var d;if(!c)return a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);r.find=x,r.expr=x.selectors,r.expr[":"]=r.expr.pseudos,r.uniqueSort=r.unique=x.uniqueSort,r.text=x.getText,r.isXMLDoc=x.isXML,r.contains=x.contains,r.escapeSelector=x.escape;var y=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&r(a).is(c))break;d.push(a)}return d},z=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},A=r.expr.match.needsContext,B=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,C=/^.[^:#\[\.,]*$/;function D(a,b,c){return r.isFunction(b)?r.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?r.grep(a,function(a){return a===b!==c}):"string"!=typeof b?r.grep(a,function(a){return i.call(b,a)>-1!==c}):C.test(b)?r.filter(b,a,c):(b=r.filter(b,a),r.grep(a,function(a){return i.call(b,a)>-1!==c&&1===a.nodeType}))}r.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},r.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<d;b++)if(r.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)r.find(a,e[b],c);return d>1?r.uniqueSort(c):c},filter:function(a){return this.pushStack(D(this,a||[],!1))},not:function(a){return this.pushStack(D(this,a||[],!0))},is:function(a){return!!D(this,"string"==typeof a&&A.test(a)?r(a):a||[],!1).length}});var E,F=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,G=r.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||E,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:F.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof r?b[0]:b,r.merge(this,r.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),B.test(e[1])&&r.isPlainObject(b))for(e in b)r.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):r.isFunction(a)?void 0!==c.ready?c.ready(a):a(r):r.makeArray(a,this)};G.prototype=r.fn,E=r(d);var H=/^(?:parents|prev(?:Until|All))/,I={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({has:function(a){var b=r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&r(a);if(!A.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?r.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?i.call(r(a),this[0]):i.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(r.uniqueSort(r.merge(this.get(),r(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function J(a,b){while((a=a[b])&&1!==a.nodeType);return a}r.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return y(a,"parentNode")},parentsUntil:function(a,b,c){return y(a,"parentNode",c)},next:function(a){return J(a,"nextSibling")},prev:function(a){return J(a,"previousSibling")},nextAll:function(a){return y(a,"nextSibling")},prevAll:function(a){return y(a,"previousSibling")},nextUntil:function(a,b,c){return y(a,"nextSibling",c)},prevUntil:function(a,b,c){return y(a,"previousSibling",c)},siblings:function(a){return z((a.parentNode||{}).firstChild,a)},children:function(a){return z(a.firstChild)},contents:function(a){return a.contentDocument||r.merge([],a.childNodes)}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),this.length>1&&(I[a]||r.uniqueSort(e),H.test(a)&&e.reverse()),this.pushStack(e)}});var K=/[^\x20\t\r\n\f]+/g;function L(a){var b={};return r.each(a.match(K)||[],function(a,c){b[c]=!0}),b}r.Callbacks=function(a){a="string"==typeof a?L(a):r.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){r.each(b,function(b,c){r.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==r.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return r.each(arguments,function(a,b){var c;while((c=r.inArray(b,f,c))>-1)f.splice(c,1),c<=h&&h--}),this},has:function(a){return a?r.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j};function M(a){return a}function N(a){throw a}function O(a,b,c){var d;try{a&&r.isFunction(d=a.promise)?d.call(a).done(b).fail(c):a&&r.isFunction(d=a.then)?d.call(a,b,c):b.call(void 0,a)}catch(a){c.call(void 0,a)}}r.extend({Deferred:function(b){var c=[["notify","progress",r.Callbacks("memory"),r.Callbacks("memory"),2],["resolve","done",r.Callbacks("once memory"),r.Callbacks("once memory"),0,"resolved"],["reject","fail",r.Callbacks("once memory"),r.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},"catch":function(a){return e.then(null,a)},pipe:function(){var a=arguments;return r.Deferred(function(b){r.each(c,function(c,d){var e=r.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){var f=0;function g(b,c,d,e){return function(){var h=this,i=arguments,j=function(){var a,j;if(!(b<f)){if(a=d.apply(h,i),a===c.promise())throw new TypeError("Thenable self-resolution");j=a&&("object"==typeof a||"function"==typeof a)&&a.then,r.isFunction(j)?e?j.call(a,g(f,c,M,e),g(f,c,N,e)):(f++,j.call(a,g(f,c,M,e),g(f,c,N,e),g(f,c,M,c.notifyWith))):(d!==M&&(h=void 0,i=[a]),(e||c.resolveWith)(h,i))}},k=e?j:function(){try{j()}catch(a){r.Deferred.exceptionHook&&r.Deferred.exceptionHook(a,k.stackTrace),b+1>=f&&(d!==N&&(h=void 0,i=[a]),c.rejectWith(h,i))}};b?k():(r.Deferred.getStackHook&&(k.stackTrace=r.Deferred.getStackHook()),a.setTimeout(k))}}return r.Deferred(function(a){c[0][3].add(g(0,a,r.isFunction(e)?e:M,a.notifyWith)),c[1][3].add(g(0,a,r.isFunction(b)?b:M)),c[2][3].add(g(0,a,r.isFunction(d)?d:N))}).promise()},promise:function(a){return null!=a?r.extend(a,e):e}},f={};return r.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=f.call(arguments),g=r.Deferred(),h=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?f.call(arguments):c,--b||g.resolveWith(d,e)}};if(b<=1&&(O(a,g.done(h(c)).resolve,g.reject),"pending"===g.state()||r.isFunction(e[c]&&e[c].then)))return g.then();while(c--)O(e[c],h(c),g.reject);return g.promise()}});var P=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;r.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&P.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},r.readyException=function(b){a.setTimeout(function(){throw b})};var Q=r.Deferred();r.fn.ready=function(a){return Q.then(a)["catch"](function(a){r.readyException(a)}),this},r.extend({isReady:!1,readyWait:1,holdReady:function(a){a?r.readyWait++:r.ready(!0)},ready:function(a){(a===!0?--r.readyWait:r.isReady)||(r.isReady=!0,a!==!0&&--r.readyWait>0||Q.resolveWith(d,[r]))}}),r.ready.then=Q.then;function R(){d.removeEventListener("DOMContentLoaded",R),
a.removeEventListener("load",R),r.ready()}"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(r.ready):(d.addEventListener("DOMContentLoaded",R),a.addEventListener("load",R));var S=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===r.type(c)){e=!0;for(h in c)S(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,r.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(r(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},T=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function U(){this.expando=r.expando+U.uid++}U.uid=1,U.prototype={cache:function(a){var b=a[this.expando];return b||(b={},T(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[r.camelCase(b)]=c;else for(d in b)e[r.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][r.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){r.isArray(b)?b=b.map(r.camelCase):(b=r.camelCase(b),b=b in d?[b]:b.match(K)||[]),c=b.length;while(c--)delete d[b[c]]}(void 0===b||r.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!r.isEmptyObject(b)}};var V=new U,W=new U,X=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Y=/[A-Z]/g;function Z(a){return"true"===a||"false"!==a&&("null"===a?null:a===+a+""?+a:X.test(a)?JSON.parse(a):a)}function $(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Y,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c=Z(c)}catch(e){}W.set(a,b,c)}else c=void 0;return c}r.extend({hasData:function(a){return W.hasData(a)||V.hasData(a)},data:function(a,b,c){return W.access(a,b,c)},removeData:function(a,b){W.remove(a,b)},_data:function(a,b,c){return V.access(a,b,c)},_removeData:function(a,b){V.remove(a,b)}}),r.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=W.get(f),1===f.nodeType&&!V.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=r.camelCase(d.slice(5)),$(f,d,e[d])));V.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){W.set(this,a)}):S(this,function(b){var c;if(f&&void 0===b){if(c=W.get(f,a),void 0!==c)return c;if(c=$(f,a),void 0!==c)return c}else this.each(function(){W.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){W.remove(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=V.get(a,b),c&&(!d||r.isArray(c)?d=V.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return V.get(a,c)||V.access(a,c,{empty:r.Callbacks("once memory").add(function(){V.remove(a,[b+"queue",c])})})}}),r.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?r.queue(this[0],a):void 0===b?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=r.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=V.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var _=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,aa=new RegExp("^(?:([+-])=|)("+_+")([a-z%]*)$","i"),ba=["Top","Right","Bottom","Left"],ca=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&r.contains(a.ownerDocument,a)&&"none"===r.css(a,"display")},da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};function ea(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return r.css(a,b,"")},i=h(),j=c&&c[3]||(r.cssNumber[b]?"":"px"),k=(r.cssNumber[b]||"px"!==j&&+i)&&aa.exec(r.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,r.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var fa={};function ga(a){var b,c=a.ownerDocument,d=a.nodeName,e=fa[d];return e?e:(b=c.body.appendChild(c.createElement(d)),e=r.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),fa[d]=e,e)}function ha(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=V.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&ca(d)&&(e[f]=ga(d))):"none"!==c&&(e[f]="none",V.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}r.fn.extend({show:function(){return ha(this,!0)},hide:function(){return ha(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){ca(this)?r(this).show():r(this).hide()})}});var ia=/^(?:checkbox|radio)$/i,ja=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,ka=/^$|\/(?:java|ecma)script/i,la={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};la.optgroup=la.option,la.tbody=la.tfoot=la.colgroup=la.caption=la.thead,la.th=la.td;function ma(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&r.nodeName(a,b)?r.merge([a],c):c}function na(a,b){for(var c=0,d=a.length;c<d;c++)V.set(a[c],"globalEval",!b||V.get(b[c],"globalEval"))}var oa=/<|&#?\w+;/;function pa(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if(f=a[n],f||0===f)if("object"===r.type(f))r.merge(m,f.nodeType?[f]:f);else if(oa.test(f)){g=g||l.appendChild(b.createElement("div")),h=(ja.exec(f)||["",""])[1].toLowerCase(),i=la[h]||la._default,g.innerHTML=i[1]+r.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;r.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",n=0;while(f=m[n++])if(d&&r.inArray(f,d)>-1)e&&e.push(f);else if(j=r.contains(f.ownerDocument,f),g=ma(l.appendChild(f),"script"),j&&na(g),c){k=0;while(f=g[k++])ka.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),o.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",o.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var qa=d.documentElement,ra=/^key/,sa=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ta=/^([^.]*)(?:\.(.+)|)/;function ua(){return!0}function va(){return!1}function wa(){try{return d.activeElement}catch(a){}}function xa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)xa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=va;else if(!e)return a;return 1===f&&(g=e,e=function(a){return r().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++)),a.each(function(){r.event.add(this,b,e,d,c)})}r.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=V.get(a);if(q){c.handler&&(f=c,c=f.handler,e=f.selector),e&&r.find.matchesSelector(qa,e),c.guid||(c.guid=r.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof r&&r.event.triggered!==b.type?r.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(K)||[""],j=b.length;while(j--)h=ta.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=r.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=r.event.special[n]||{},k=r.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&r.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),r.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=V.hasData(a)&&V.get(a);if(q&&(i=q.events)){b=(b||"").match(K)||[""],j=b.length;while(j--)if(h=ta.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){l=r.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||r.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)r.event.remove(a,n+b[j],c,d,!0);r.isEmptyObject(i)&&V.remove(a,"handle events")}},dispatch:function(a){var b=r.event.fix(a),c,d,e,f,g,h,i=new Array(arguments.length),j=(V.get(this,"events")||{})[b.type]||[],k=r.event.special[b.type]||{};for(i[0]=b,c=1;c<arguments.length;c++)i[c]=arguments[c];if(b.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,b)!==!1){h=r.event.handlers.call(this,b,j),c=0;while((f=h[c++])&&!b.isPropagationStopped()){b.currentTarget=f.elem,d=0;while((g=f.handlers[d++])&&!b.isImmediatePropagationStopped())b.rnamespace&&!b.rnamespace.test(g.namespace)||(b.handleObj=g,b.data=g.data,e=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(b.result=e)===!1&&(b.preventDefault(),b.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&a.button>=1))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||j.disabled!==!0)){for(f=[],g={},c=0;c<i;c++)d=b[c],e=d.selector+" ",void 0===g[e]&&(g[e]=d.needsContext?r(e,this).index(j)>-1:r.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(r.Event.prototype,a,{enumerable:!0,configurable:!0,get:r.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[r.expando]?a:new r.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==wa()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===wa()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&r.nodeName(this,"input"))return this.click(),!1},_default:function(a){return r.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},r.Event=function(a,b){return this instanceof r.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ua:va,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),void(this[r.expando]=!0)):new r.Event(a,b)},r.Event.prototype={constructor:r.Event,isDefaultPrevented:va,isPropagationStopped:va,isImmediatePropagationStopped:va,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ua,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ua,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ua,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},r.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&ra.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&sa.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},r.event.addProp),r.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||r.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),r.fn.extend({on:function(a,b,c,d){return xa(this,a,b,c,d)},one:function(a,b,c,d){return xa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,r(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=va),this.each(function(){r.event.remove(this,a,c,b)})}});var ya=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,za=/<script|<style|<link/i,Aa=/checked\s*(?:[^=]|=\s*.checked.)/i,Ba=/^true\/(.*)/,Ca=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Da(a,b){return r.nodeName(a,"table")&&r.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a:a}function Ea(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function Fa(a){var b=Ba.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ga(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(V.hasData(a)&&(f=V.access(a),g=V.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)r.event.add(b,e,j[e][c])}W.hasData(a)&&(h=W.access(a),i=r.extend({},h),W.set(b,i))}}function Ha(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ia.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function Ia(a,b,c,d){b=g.apply([],b);var e,f,h,i,j,k,l=0,m=a.length,n=m-1,q=b[0],s=r.isFunction(q);if(s||m>1&&"string"==typeof q&&!o.checkClone&&Aa.test(q))return a.each(function(e){var f=a.eq(e);s&&(b[0]=q.call(this,e,f.html())),Ia(f,b,c,d)});if(m&&(e=pa(b,a[0].ownerDocument,!1,a,d),f=e.firstChild,1===e.childNodes.length&&(e=f),f||d)){for(h=r.map(ma(e,"script"),Ea),i=h.length;l<m;l++)j=e,l!==n&&(j=r.clone(j,!0,!0),i&&r.merge(h,ma(j,"script"))),c.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,r.map(h,Fa),l=0;l<i;l++)j=h[l],ka.test(j.type||"")&&!V.access(j,"globalEval")&&r.contains(k,j)&&(j.src?r._evalUrl&&r._evalUrl(j.src):p(j.textContent.replace(Ca,""),k))}return a}function Ja(a,b,c){for(var d,e=b?r.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||r.cleanData(ma(d)),d.parentNode&&(c&&r.contains(d.ownerDocument,d)&&na(ma(d,"script")),d.parentNode.removeChild(d));return a}r.extend({htmlPrefilter:function(a){return a.replace(ya,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=r.contains(a.ownerDocument,a);if(!(o.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=ma(h),f=ma(a),d=0,e=f.length;d<e;d++)Ha(f[d],g[d]);if(b)if(c)for(f=f||ma(a),g=g||ma(h),d=0,e=f.length;d<e;d++)Ga(f[d],g[d]);else Ga(a,h);return g=ma(h,"script"),g.length>0&&na(g,!i&&ma(a,"script")),h},cleanData:function(a){for(var b,c,d,e=r.event.special,f=0;void 0!==(c=a[f]);f++)if(T(c)){if(b=c[V.expando]){if(b.events)for(d in b.events)e[d]?r.event.remove(c,d):r.removeEvent(c,d,b.handle);c[V.expando]=void 0}c[W.expando]&&(c[W.expando]=void 0)}}}),r.fn.extend({detach:function(a){return Ja(this,a,!0)},remove:function(a){return Ja(this,a)},text:function(a){return S(this,function(a){return void 0===a?r.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return Ia(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Da(this,a);b.appendChild(a)}})},prepend:function(){return Ia(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Da(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ia(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ia(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(ma(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return S(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!za.test(a)&&!la[(ja.exec(a)||["",""])[1].toLowerCase()]){a=r.htmlPrefilter(a);try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(r.cleanData(ma(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ia(this,arguments,function(b){var c=this.parentNode;r.inArray(this,a)<0&&(r.cleanData(ma(this)),c&&c.replaceChild(b,this))},a)}}),r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c,d=[],e=r(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),r(e[g])[b](c),h.apply(d,c.get());return this.pushStack(d)}});var Ka=/^margin/,La=new RegExp("^("+_+")(?!px)[a-z%]+$","i"),Ma=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",qa.appendChild(h);var b=a.getComputedStyle(i);c="1%"!==b.top,g="2px"===b.marginLeft,e="4px"===b.width,i.style.marginRight="50%",f="4px"===b.marginRight,qa.removeChild(h),i=null}}var c,e,f,g,h=d.createElement("div"),i=d.createElement("div");i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===i.style.backgroundClip,h.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",h.appendChild(i),r.extend(o,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),e},pixelMarginRight:function(){return b(),f},reliableMarginLeft:function(){return b(),g}}))}();function Na(a,b,c){var d,e,f,g,h=a.style;return c=c||Ma(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||r.contains(a.ownerDocument,a)||(g=r.style(a,b)),!o.pixelMarginRight()&&La.test(g)&&Ka.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function Oa(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Pa=/^(none|table(?!-c[ea]).+)/,Qa={position:"absolute",visibility:"hidden",display:"block"},Ra={letterSpacing:"0",fontWeight:"400"},Sa=["Webkit","Moz","ms"],Ta=d.createElement("div").style;function Ua(a){if(a in Ta)return a;var b=a[0].toUpperCase()+a.slice(1),c=Sa.length;while(c--)if(a=Sa[c]+b,a in Ta)return a}function Va(a,b,c){var d=aa.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Wa(a,b,c,d,e){var f,g=0;for(f=c===(d?"border":"content")?4:"width"===b?1:0;f<4;f+=2)"margin"===c&&(g+=r.css(a,c+ba[f],!0,e)),d?("content"===c&&(g-=r.css(a,"padding"+ba[f],!0,e)),"margin"!==c&&(g-=r.css(a,"border"+ba[f]+"Width",!0,e))):(g+=r.css(a,"padding"+ba[f],!0,e),"padding"!==c&&(g+=r.css(a,"border"+ba[f]+"Width",!0,e)));return g}function Xa(a,b,c){var d,e=!0,f=Ma(a),g="border-box"===r.css(a,"boxSizing",!1,f);if(a.getClientRects().length&&(d=a.getBoundingClientRect()[b]),d<=0||null==d){if(d=Na(a,b,f),(d<0||null==d)&&(d=a.style[b]),La.test(d))return d;e=g&&(o.boxSizingReliable()||d===a.style[b]),d=parseFloat(d)||0}return d+Wa(a,b,c||(g?"border":"content"),e,f)+"px"}r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Na(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=r.camelCase(b),i=a.style;return b=r.cssProps[h]||(r.cssProps[h]=Ua(h)||h),g=r.cssHooks[b]||r.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=aa.exec(c))&&e[1]&&(c=ea(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(r.cssNumber[h]?"":"px")),o.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=r.camelCase(b);return b=r.cssProps[h]||(r.cssProps[h]=Ua(h)||h),g=r.cssHooks[b]||r.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Na(a,b,d)),"normal"===e&&b in Ra&&(e=Ra[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return!Pa.test(r.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?Xa(a,b,d):da(a,Qa,function(){return Xa(a,b,d)})},set:function(a,c,d){var e,f=d&&Ma(a),g=d&&Wa(a,b,d,"border-box"===r.css(a,"boxSizing",!1,f),f);return g&&(e=aa.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=r.css(a,b)),Va(a,c,g)}}}),r.cssHooks.marginLeft=Oa(o.reliableMarginLeft,function(a,b){if(b)return(parseFloat(Na(a,"marginLeft"))||a.getBoundingClientRect().left-da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+ba[d]+b]=f[d]||f[d-2]||f[0];return e}},Ka.test(a)||(r.cssHooks[a+b].set=Va)}),r.fn.extend({css:function(a,b){return S(this,function(a,b,c){var d,e,f={},g=0;if(r.isArray(b)){for(d=Ma(a),e=b.length;g<e;g++)f[b[g]]=r.css(a,b[g],!1,d);return f}return void 0!==c?r.style(a,b,c):r.css(a,b)},a,b,arguments.length>1)}});function Ya(a,b,c,d,e){return new Ya.prototype.init(a,b,c,d,e)}r.Tween=Ya,Ya.prototype={constructor:Ya,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||r.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=Ya.propHooks[this.prop];return a&&a.get?a.get(this):Ya.propHooks._default.get(this)},run:function(a){var b,c=Ya.propHooks[this.prop];return this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ya.propHooks._default.set(this),this}},Ya.prototype.init.prototype=Ya.prototype,Ya.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=r.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[r.cssProps[a.prop]]&&!r.cssHooks[a.prop]?a.elem[a.prop]=a.now:r.style(a.elem,a.prop,a.now+a.unit)}}},Ya.propHooks.scrollTop=Ya.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},r.fx=Ya.prototype.init,r.fx.step={};var Za,$a,_a=/^(?:toggle|show|hide)$/,ab=/queueHooks$/;function bb(){$a&&(a.requestAnimationFrame(bb),r.fx.tick())}function cb(){return a.setTimeout(function(){Za=void 0}),Za=r.now()}function db(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=ba[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function eb(a,b,c){for(var d,e=(hb.tweeners[b]||[]).concat(hb.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function fb(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&ca(a),q=V.get(a,"fxshow");c.queue||(g=r._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,r.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],_a.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||r.style(a,d)}if(i=!r.isEmptyObject(b),i||!r.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=q&&q.display,null==j&&(j=V.get(a,"display")),k=r.css(a,"display"),"none"===k&&(j?k=j:(ha([a],!0),j=a.style.display||j,k=r.css(a,"display"),ha([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===r.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(q?"hidden"in q&&(p=q.hidden):q=V.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&ha([a],!0),m.done(function(){p||ha([a]),V.remove(a,"fxshow");for(d in n)r.style(a,d,n[d])})),i=eb(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}}function gb(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],r.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=r.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function hb(a,b,c){var d,e,f=0,g=hb.prefilters.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Za||cb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{},easing:r.easing._default},c),originalProperties:b,originalOptions:c,startTime:Za||cb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(gb(k,j.opts.specialEasing);f<g;f++)if(d=hb.prefilters[f].call(j,a,k,j.opts))return r.isFunction(d.stop)&&(r._queueHooks(j.elem,j.opts.queue).stop=r.proxy(d.stop,d)),d;return r.map(k,eb,j),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),r.fx.timer(r.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}r.Animation=r.extend(hb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return ea(c.elem,a,aa.exec(b),c),c}]},tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.match(K);for(var c,d=0,e=a.length;d<e;d++)c=a[d],hb.tweeners[c]=hb.tweeners[c]||[],hb.tweeners[c].unshift(b)},prefilters:[fb],prefilter:function(a,b){b?hb.prefilters.unshift(a):hb.prefilters.push(a)}}),r.speed=function(a,b,c){var e=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};return r.fx.off||d.hidden?e.duration=0:"number"!=typeof e.duration&&(e.duration in r.fx.speeds?e.duration=r.fx.speeds[e.duration]:e.duration=r.fx.speeds._default),null!=e.queue&&e.queue!==!0||(e.queue="fx"),e.old=e.complete,e.complete=function(){r.isFunction(e.old)&&e.old.call(this),e.queue&&r.dequeue(this,e.queue)},e},r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(ca).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=hb(this,r.extend({},a),f);(e||V.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=r.timers,g=V.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ab.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||r.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=V.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=r.timers,g=d?d.length:0;for(c.finish=!0,r.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(db(b,!0),a,d,e)}}),r.each({slideDown:db("show"),slideUp:db("hide"),slideToggle:db("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.timers=[],r.fx.tick=function(){var a,b=0,c=r.timers;for(Za=r.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||r.fx.stop(),Za=void 0},r.fx.timer=function(a){r.timers.push(a),a()?r.fx.start():r.timers.pop()},r.fx.interval=13,r.fx.start=function(){$a||($a=a.requestAnimationFrame?a.requestAnimationFrame(bb):a.setInterval(r.fx.tick,r.fx.interval))},r.fx.stop=function(){a.cancelAnimationFrame?a.cancelAnimationFrame($a):a.clearInterval($a),$a=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fn.delay=function(b,c){return b=r.fx?r.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",o.checkOn=""!==a.value,o.optSelected=c.selected,a=d.createElement("input"),a.value="t",a.type="radio",o.radioValue="t"===a.value}();var ib,jb=r.expr.attrHandle;r.fn.extend({attr:function(a,b){return S(this,r.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})}}),r.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?r.prop(a,b,c):(1===f&&r.isXMLDoc(a)||(e=r.attrHooks[b.toLowerCase()]||(r.expr.match.bool.test(b)?ib:void 0)),
void 0!==c?null===c?void r.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=r.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!o.radioValue&&"radio"===b&&r.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(K);if(e&&1===a.nodeType)while(c=e[d++])a.removeAttribute(c)}}),ib={set:function(a,b,c){return b===!1?r.removeAttr(a,c):a.setAttribute(c,c),c}},r.each(r.expr.match.bool.source.match(/\w+/g),function(a,b){var c=jb[b]||r.find.attr;jb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=jb[g],jb[g]=e,e=null!=c(a,b,d)?g:null,jb[g]=f),e}});var kb=/^(?:input|select|textarea|button)$/i,lb=/^(?:a|area)$/i;r.fn.extend({prop:function(a,b){return S(this,r.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})}}),r.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&r.isXMLDoc(a)||(b=r.propFix[b]||b,e=r.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=r.find.attr(a,"tabindex");return b?parseInt(b,10):kb.test(a.nodeName)||lb.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),o.optSelected||(r.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),r.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){r.propFix[this.toLowerCase()]=this});function mb(a){var b=a.match(K)||[];return b.join(" ")}function nb(a){return a.getAttribute&&a.getAttribute("class")||""}r.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,nb(this)))});if("string"==typeof a&&a){b=a.match(K)||[];while(c=this[i++])if(e=nb(c),d=1===c.nodeType&&" "+mb(e)+" "){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=mb(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,nb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(K)||[];while(c=this[i++])if(e=nb(c),d=1===c.nodeType&&" "+mb(e)+" "){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=mb(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,nb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=r(this),f=a.match(K)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=nb(this),b&&V.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":V.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+mb(nb(c))+" ").indexOf(b)>-1)return!0;return!1}});var ob=/\r/g;r.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=r.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,r(this).val()):a,null==e?e="":"number"==typeof e?e+="":r.isArray(e)&&(e=r.map(e,function(a){return null==a?"":a+""})),b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=r.valHooks[e.type]||r.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ob,""):null==c?"":c)}}}),r.extend({valHooks:{option:{get:function(a){var b=r.find.attr(a,"value");return null!=b?b:mb(r.text(a))}},select:{get:function(a){var b,c,d,e=a.options,f=a.selectedIndex,g="select-one"===a.type,h=g?null:[],i=g?f+1:e.length;for(d=f<0?i:g?f:0;d<i;d++)if(c=e[d],(c.selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!r.nodeName(c.parentNode,"optgroup"))){if(b=r(c).val(),g)return b;h.push(b)}return h},set:function(a,b){var c,d,e=a.options,f=r.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=r.inArray(r.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(r.isArray(b))return a.checked=r.inArray(r(a).val(),b)>-1}},o.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var pb=/^(?:focusinfocus|focusoutblur)$/;r.extend(r.event,{trigger:function(b,c,e,f){var g,h,i,j,k,m,n,o=[e||d],p=l.call(b,"type")?b.type:b,q=l.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!pb.test(p+r.event.triggered)&&(p.indexOf(".")>-1&&(q=p.split("."),p=q.shift(),q.sort()),k=p.indexOf(":")<0&&"on"+p,b=b[r.expando]?b:new r.Event(p,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=q.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:r.makeArray(c,[b]),n=r.event.special[p]||{},f||!n.trigger||n.trigger.apply(e,c)!==!1)){if(!f&&!n.noBubble&&!r.isWindow(e)){for(j=n.delegateType||p,pb.test(j+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),i=h;i===(e.ownerDocument||d)&&o.push(i.defaultView||i.parentWindow||a)}g=0;while((h=o[g++])&&!b.isPropagationStopped())b.type=g>1?j:n.bindType||p,m=(V.get(h,"events")||{})[b.type]&&V.get(h,"handle"),m&&m.apply(h,c),m=k&&h[k],m&&m.apply&&T(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=p,f||b.isDefaultPrevented()||n._default&&n._default.apply(o.pop(),c)!==!1||!T(e)||k&&r.isFunction(e[p])&&!r.isWindow(e)&&(i=e[k],i&&(e[k]=null),r.event.triggered=p,e[p](),r.event.triggered=void 0,i&&(e[k]=i)),b.result}},simulate:function(a,b,c){var d=r.extend(new r.Event,c,{type:a,isSimulated:!0});r.event.trigger(d,null,b)}}),r.fn.extend({trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}}),r.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),o.focusin="onfocusin"in a,o.focusin||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){r.event.simulate(b,a.target,r.event.fix(a))};r.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=V.access(d,b);e||d.addEventListener(a,c,!0),V.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=V.access(d,b)-1;e?V.access(d,b,e):(d.removeEventListener(a,c,!0),V.remove(d,b))}}});var qb=a.location,rb=r.now(),sb=/\?/;r.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+b),c};var tb=/\[\]$/,ub=/\r?\n/g,vb=/^(?:submit|button|image|reset|file)$/i,wb=/^(?:input|select|textarea|keygen)/i;function xb(a,b,c,d){var e;if(r.isArray(b))r.each(b,function(b,e){c||tb.test(a)?d(a,e):xb(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)xb(a+"["+e+"]",b[e],c,d)}r.param=function(a,b){var c,d=[],e=function(a,b){var c=r.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(r.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){e(this.name,this.value)});else for(c in a)xb(c,a[c],b,e);return d.join("&")},r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&wb.test(this.nodeName)&&!vb.test(a)&&(this.checked||!ia.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:r.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(ub,"\r\n")}}):{name:b.name,value:c.replace(ub,"\r\n")}}).get()}});var yb=/%20/g,zb=/#.*$/,Ab=/([?&])_=[^&]*/,Bb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Cb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Db=/^(?:GET|HEAD)$/,Eb=/^\/\//,Fb={},Gb={},Hb="*/".concat("*"),Ib=d.createElement("a");Ib.href=qb.href;function Jb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(K)||[];if(r.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Kb(a,b,c,d){var e={},f=a===Gb;function g(h){var i;return e[h]=!0,r.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Lb(a,b){var c,d,e=r.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&r.extend(!0,a,d),a}function Mb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function Nb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:qb.href,type:"GET",isLocal:Cb.test(qb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Hb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Lb(Lb(a,r.ajaxSettings),b):Lb(r.ajaxSettings,a)},ajaxPrefilter:Jb(Fb),ajaxTransport:Jb(Gb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=r.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?r(p):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),u=o.statusCode||{},v={},w={},x="canceled",y={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h){h={};while(b=Bb.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=w[a.toLowerCase()]=w[a.toLowerCase()]||a,v[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)y.always(a[y.status]);else for(b in a)u[b]=[u[b],a[b]];return this},abort:function(a){var b=a||x;return e&&e.abort(b),A(0,b),this}};if(s.promise(y),o.url=((b||o.url||qb.href)+"").replace(Eb,qb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(K)||[""],null==o.crossDomain){j=d.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Ib.protocol+"//"+Ib.host!=j.protocol+"//"+j.host}catch(z){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=r.param(o.data,o.traditional)),Kb(Fb,o,c,y),k)return y;l=r.event&&o.global,l&&0===r.active++&&r.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Db.test(o.type),f=o.url.replace(zb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(yb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(sb.test(f)?"&":"?")+o.data,delete o.data),o.cache===!1&&(f=f.replace(Ab,"$1"),n=(sb.test(f)?"&":"?")+"_="+rb++ +n),o.url=f+n),o.ifModified&&(r.lastModified[f]&&y.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&y.setRequestHeader("If-None-Match",r.etag[f])),(o.data&&o.hasContent&&o.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",o.contentType),y.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Hb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)y.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(o.beforeSend.call(p,y,o)===!1||k))return y.abort();if(x="abort",t.add(o.complete),y.done(o.success),y.fail(o.error),e=Kb(Gb,o,c,y)){if(y.readyState=1,l&&q.trigger("ajaxSend",[y,o]),k)return y;o.async&&o.timeout>0&&(i=a.setTimeout(function(){y.abort("timeout")},o.timeout));try{k=!1,e.send(v,A)}catch(z){if(k)throw z;A(-1,z)}}else A(-1,"No Transport");function A(b,c,d,h){var j,m,n,v,w,x=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",y.readyState=b>0?4:0,j=b>=200&&b<300||304===b,d&&(v=Mb(o,y,d)),v=Nb(o,v,y,j),j?(o.ifModified&&(w=y.getResponseHeader("Last-Modified"),w&&(r.lastModified[f]=w),w=y.getResponseHeader("etag"),w&&(r.etag[f]=w)),204===b||"HEAD"===o.type?x="nocontent":304===b?x="notmodified":(x=v.state,m=v.data,n=v.error,j=!n)):(n=x,!b&&x||(x="error",b<0&&(b=0))),y.status=b,y.statusText=(c||x)+"",j?s.resolveWith(p,[m,x,y]):s.rejectWith(p,[y,x,n]),y.statusCode(u),u=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[y,o,j?m:n]),t.fireWith(p,[y,x]),l&&(q.trigger("ajaxComplete",[y,o]),--r.active||r.event.trigger("ajaxStop")))}return y},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,b){return r.get(a,void 0,b,"script")}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,d,e){return r.isFunction(c)&&(e=e||d,d=c,c=void 0),r.ajax(r.extend({url:a,type:b,dataType:e,data:c,success:d},r.isPlainObject(a)&&a))}}),r._evalUrl=function(a){return r.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},r.fn.extend({wrapAll:function(a){var b;return this[0]&&(r.isFunction(a)&&(a=a.call(this[0])),b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){r(this).replaceWith(this.childNodes)}),this}}),r.expr.pseudos.hidden=function(a){return!r.expr.pseudos.visible(a)},r.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},r.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Ob={0:200,1223:204},Pb=r.ajaxSettings.xhr();o.cors=!!Pb&&"withCredentials"in Pb,o.ajax=Pb=!!Pb,r.ajaxTransport(function(b){var c,d;if(o.cors||Pb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Ob[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}}),r.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return r.globalEval(a),a}}}),r.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=r("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Qb=[],Rb=/(=)\?(?=&|$)|\?\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Qb.pop()||r.expando+"_"+rb++;return this[a]=!0,a}}),r.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Rb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Rb.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=r.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Rb,"$1"+e):b.jsonp!==!1&&(b.url+=(sb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||r.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?r(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Qb.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),o.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),r.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,g;return b||(o.createHTMLDocument?(b=d.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=d.location.href,b.head.appendChild(e)):b=d),f=B.exec(a),g=!c&&[],f?[b.createElement(f[1])]:(f=pa([a],b,g),g&&g.length&&r(g).remove(),r.merge([],f.childNodes))},r.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=mb(a.slice(h)),a=a.slice(0,h)),r.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&r.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?r("<div>").append(r.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},r.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.expr.pseudos.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length};function Sb(a){return r.isWindow(a)?a:9===a.nodeType&&a.defaultView}r.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=r.css(a,"position"),l=r(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=r.css(a,"top"),i=r.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),r.isFunction(b)&&(b=b.call(a,c,r.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},r.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),d.width||d.height?(e=f.ownerDocument,c=Sb(e),b=e.documentElement,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):d):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),r.nodeName(a[0],"html")||(d=a.offset()),d={top:d.top+r.css(a[0],"borderTopWidth",!0),left:d.left+r.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-r.css(c,"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===r.css(a,"position"))a=a.offsetParent;return a||qa})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;r.fn[a]=function(d){return S(this,function(a,d,e){var f=Sb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),r.each(["top","left"],function(a,b){r.cssHooks[b]=Oa(o.pixelPosition,function(a,c){if(c)return c=Na(a,b),La.test(c)?r(a).position()[b]+"px":c})}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){r.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(e===!0||f===!0?"margin":"border");return S(this,function(b,c,e){var f;return r.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?r.css(b,c,h):r.style(b,c,e,h)},b,g?e:void 0,g)}})}),r.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),r.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return r});var Tb=a.jQuery,Ub=a.$;return r.noConflict=function(b){return a.$===r&&(a.$=Ub),b&&a.jQuery===r&&(a.jQuery=Tb),r},b||(a.jQuery=a.$=r),r});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.0
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}(this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{},n=i[t]=i[t]||[];return n[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=0,o=i[n];e=e||[];for(var r=this._onceEvents&&this._onceEvents[t];o;){var s=r&&r[o];s&&(this.off(t,o),delete r[o]),o.apply(this,e),n+=s?0:1,o=i[n]}return this}},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}(window,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function n(t){var e=[];if(Array.isArray(t))e=t;else if("number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e}function o(t,e,r){return this instanceof o?("string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=n(t),this.options=i({},this.options),"function"==typeof e?r=e:i(this.options,e),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(function(){this.check()}.bind(this))):new o(t,e,r)}function r(t){this.img=t}function s(t,e){this.url=t,this.element=e,this.img=new Image}var h=t.jQuery,a=t.console;o.prototype=Object.create(e.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),this.options.background===!0&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&d[e]){for(var i=t.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var d={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(e.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,t),n=i.exec(e.backgroundImage)}},o.prototype.addImage=function(t){var e=new r(t);this.images.push(e)},o.prototype.addBackground=function(t,e){var i=new s(t,e);this.images.push(i)},o.prototype.check=function(){function t(t,i,n){setTimeout(function(){e.progress(t,i,n)})}var e=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once("progress",t),e.check()}):void this.complete()},o.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,t,e)},o.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},r.prototype=Object.create(e.prototype),r.prototype.check=function(){var t=this.getIsImageComplete();return t?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},r.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var t=this.getIsImageComplete();t&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},o.makeJQueryPlugin=function(e){e=e||t.jQuery,e&&(h=e,h.fn.imagesLoaded=function(t,e){var i=new o(this,t,e);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,o=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",true,false,e,0,0,0,0,0,false,false,false,false,0,null);n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];if(typeof t==="string"){r.revokeObjectURL(t)}else{t.remove()}}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i==="function"){try{i.call(e,n||e)}catch(s){f(s)}}}},v=function(t,r){var f=this,p=t.type,v=false,m,g,y=function(){var e=n().createObjectURL(t);h.push(e);return e},b=function(){d(f,"writestart progress write writeend".split(" "))},w=function(){if(v||!m){m=y(t)}if(g){g.location.href=m}else{window.open(m,"_blank")}f.readyState=f.DONE;b()},E=function(e){return function(){if(f.readyState!==f.DONE){return e.apply(this,arguments)}}},S={create:true,exclusive:false},x;f.readyState=f.INIT;if(!r){r="download"}if(s){m=y(t);i.href=m;i.download=r;o(i);f.readyState=f.DONE;b();return}if(e.chrome&&p&&p!==l){x=t.slice||t.webkitSlice;t=x.call(t,0,t.size,l);v=true}if(u&&r!=="download"){r+=".download"}if(p===l||u){g=e}if(!a){w();return}c+=t.size;a(e.TEMPORARY,c,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL();h.push(e);f.readyState=f.DONE;d(f,"writeend",t)};n.onerror=function(){var e=n.error;if(e.code!==e.ABORT_ERR){w()}};"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=f["on"+e]});n.write(t);f.abort=function(){n.abort();f.readyState=f.DONE};f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:false},E(function(e){e.remove();n()}),E(function(e){if(e.code===e.NOT_FOUND_ERR){n()}else{w()}}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};m.abort=function(){var e=this;e.readyState=e.DONE;d(e,"abort")};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;e.addEventListener("unload",p,false);return g}(self)
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
/* User Lib */
"USER_LIB"
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:100000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url(data:application/octet-stream;base64,d09GRgABAAAAACWoAA4AAAAAQhQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABRAAAAEQAAABWPihI/2NtYXAAAAGIAAAAOgAAAUrQXRm3Y3Z0IAAAAcQAAAAKAAAACgAAAABmcGdtAAAB0AAABZQAAAtwiJCQWWdhc3AAAAdkAAAACAAAAAgAAAAQZ2x5ZgAAB2wAABjCAAAq+uJ4WNtoZWFkAAAgMAAAADQAAAA2BZlJs2hoZWEAACBkAAAAIAAAACQIJwQZaG10eAAAIIQAAABuAAABOPTeAABsb2NhAAAg9AAAAJ4AAACeojKW6m1heHAAACGUAAAAIAAAACAA6gvwbmFtZQAAIbQAAAGPAAAC/eLsyKlwb3N0AAAjRAAAAfwAAAM0412SIHByZXAAACVAAAAAZQAAAHvdawOFeJxjYGRWYZzAwMrAwVTFtIeBgaEHQjM+YDBkZGJgYGJgZWbACgLSXFMYHF4wvPBhDvqfxRDFHMQwDSjMCJIDANLeC6V4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZgYGF74/P8PUvCCAURLMELVAwEjG8OIBwC4Ywb6AAAAAAAAAAAAAAAAAAB4nK1WaXMTRxCd1WHLNj6CDxI2gVnGcox2VpjLCBDG7EoW4BzylexCjl1Ldu6LT/wG/ZpekVSRb/y0vB4d2GAnVVQoSv2m9+1M9+ueXpPQksReWI+k3HwpprY2aWTnSUg3bFqO4kPZ2QspU0z+LoiCaLXUvu04JCISgap1hSWC2PfI0iTjQ48yWrYlvWpSbulJd9kaD+qt+vbT0FGO3QklNZuhQ+uRLanCqBJFMu2RkjYtw9VfSVrh5yvMfNUMJYLoJJLGm2EMj+Rn44xWGa3GdhxFkU2WG0WKRDM8iCKPslpin1wxQUD5oBlSXvk0onyEH5EVe5TTCnHJdprf9yU/6R3OvyTieouyJQf+QHZkB3unK/ki0toK46adbEehivB0fSfEI5uT6p/sUV7TaOB2RaYnzQiWyleQWPkJZfYPyWrhfMqXPBrVkoOcCFovc2Jf8g60HkdMiWsmyILujk6IoO6XnKHYY/q4+OO9XSwXIQTIOJb1jkq4EEYpYbOaJG0EOYiSskWV1HpHTJzyOi3iLWG/Tu3oS2e0Sag7MZ6th46tnKjkeDSp00ymTu2k5tGUBlFKOhM85tcBlB/RJK+2sZrEyqNpbDNjJJFQoIVzaSqIZSeWNAXRPJrRm7thmmvXokWaPFDPPXpPb26Fmzs9p+3AP2v8Z3UqpoO9MJ2eDshKfJp2uUnRun56hn8m8UPWAiqRLTbDlMVDtn4H5eVjS47CawNs957zK+h99kTIpIH4G/AeL9UpBUyFmFVQC9201rUsy9RqVotUZOq7IU0rX9ZpAk05Dn1jX8Y4/q+ZGUtMCd/vxOnZEZeeufYlyDSH3GZdj+Z1arFdgM5sz+k0y/Z9nebYfqDTPNvzOh1ha+t0lO2HOi2w/UinY2wvaEGT7jsEchGBXMAGEoGwdRAI20sIhK1CIGwXEQjbIgJhu4RA2H6MQNguIxC2l7Wsmn4qaRw7E8sARYgDoznuyGVuKldTyaUSrotGpzbkKXKrpKJ4Vv0rA/3ikTesgbVAukTW/IpJrnxUleOPrmh508S5Ao5Vf3tzXJ8TD2W/WPhT8L/amqqkV6x5ZHIVeSPQk+NE1yYVj67p8rmqR9f/i4oOa4F+A6UQC0VZlg2+mZDwUafTUA1c5RAzGzMP1/W6Zc3P4fybGCEL6H78NxQaC9yDTllJWe1gr9XXj2W5twflsCdYkmK+zOtb4YuMzEr7RWYpez7yecAVMCqVYasNXK3gzXsS85DpTfJMELcVZYOkjceZILGBYx4wb76TICRMXbWB2imcsIG8YMwp2O+EQ1RvlOVwe6F9Ho2Uf2tX7MgZFU0Q+G32Rtjrs1DyW6yBhCe/1NdAVSFNxbipgEsj5YZq8GFcrdtGMk6gr6jYDcuyig8fR9x3So5lIPlIEatHRz+tvUKd1Ln9yihu3zv9CIJBaWL+9r6Z4qCUd7WSZVZtA1O3GpVT15rDxasO3c2j7nvH2Sdy1jTddE/c9L6mVbeDg7lZEO3bHJSlTC6o68MOG6jLzaXQ6mVckt52DzAsMKDfoRUb/1f3cfg8V6oKo+NIvZ2oH6PPYgzyDzh/R/UF6OcxTLmGlOd7lxOfbtzD2TJdxV2sn+LfwKy15mbpGnBD0w2Yh6xaHbrKDXynBjo90tyO9BDwse4K8QBgE8Bi8InuWsbzKYDxfMYcH+Bz5jBoMofBFnMYbDNnDWCHOQx2mcNgjzkMvmDOOsCXzGEQModBxBwGT5gTADxlDoOvmMPga+Yw+IY59wG+ZQ6DmDkMEuYw2Nd0ayhzixd0F6htUBXowPQTFvewONRUGbK/44Vhf28Qs38wiKk/aro9pP7EC0P92SCm/mIQU3/VdGdI/Y0Xhvq7QUz9wyCmPtMvxnKZwV9GvkuFA8ouNp/z98T7B8IaQLYAAQAB//8AD3icrToNcBzVefe9/b3dvd29u909/dyd7ke6k86yLEunOyHJsrCxJWyJGmEcLMDYxBhHNsZQBzOAkjQmFDrGIq5gHEIcCILOAGZq3IQO04RkIGkgaUMKMbQznSlJW0wgJtOQHxRr1e+93TvJwq7JTD3y2/f//bzvfX/vAhAIzL3KPcYNBFIB8UR9EJYuAcuAqGNbOiwDSczkuorlaJ6WTeVSRwMIDveY8aN20GztjzMhW4P2H+kNUPM5NaVNQE0K3tWM77vv8rJqgnT33VJE4WWIfd/QbKHZjcXcZiFAqjCDgUJA/mZTWOIIwi0vAwNiUjkW9THIZs6DAbnj6ffGP/P+0y2vv+5SXGLKuXHJPJH92c+yT7x3883wnI9W/DxI4T9+bm7uOL+MUwNywAg0BJYFQgNKa2NDzFBEjqeM0SFXLHU4YKe7yjFoSmdEKWw5nemOUj5czMXCliilM7lyuFgqp3HaDf1j/fhH+s6cfm4MEpA8c0BSQBO5CUkD5fJi05kDjSUoNnETTUUSXtpPVm0aGHDdmV0nNkPiMUWeHZMVRSZPSlp0dqypCKVG8iT9IK5AEeamyZGAjecW5tm5SSBm8ojiSqBsYoXDTRtuymw13V8axjB+p2EPlsMGcRzTTRkGOLRpmk/AzSZ+A97ecx+QN8g9gUbc26F7N+GJiN5pLGMA8hUo7EQcHI455A0PwrS3I37N+bZhTE8bex1aeeIJ4+MTjTY6gcH+iIvgGWQRdh2TR9sS81kspCzytguLfBcyuBOLXuhwYnZnh8NFUs6plLPLScGpWBKwkYztwsop7Hie9r7rYK/9brWXTg9U+RiBX+GJiyc0rgIv7UNJe3vPjrFdyZOV/byNUkyW/0AuIi/h+h6U5a64SmW5ieGcya2AYimG+EUtnZN08ImgveV+KOYykiiJVMrbkI+dHUkC9+nyPUFdD94j639r1uTq7FiSNrR1hXS8uLbGapYUSbpaJvzmp5aODbU9iJNBU1gJa5LFTCqihNpDigmWWtc2GjUy7Y2m3hHk14qmPJXp2cTInZudO85dhzw2AuXAJQHl+Yt7l0RVjkO8u4q5JZARE2A5yNxStNgGWcQSj7izA1HucCgJOsRsb7xYWgn9XAwvRqaN4HAS4ENF3kXFFovJ/muW3zsYDK3jxaCQbOouOPXZPmBDNZG4krS0N2/9wakf7hHv+IcPX/jcaGWZAp9fvrFtv66UeSlXn4zYdZo5kLNwIJJRTbEu3jz62Zf37Xv5l7RAeugZfAQ7kJ5koA3PoJB1eP8MpHRVWqpygyITpiKz4DCoHMENlun+wrDA0bNZ9jmJZdZwhhx9UnewMKztg2yAlie9j6O7Lzrks7tYdRdOO4u/FJ9e5G93RyFTJ1f5G17IZDs7z25uEfuFBYwlvYpUUuTnKJO6umg5IymD88yGGxbycjN2JOkIVk6wUoEzm/0O5T/Owb92Jg8NyL/6qFrl30IZ5nSgMp3nch7DkvOMCaMeoQ1U4JZxQncenmAMmcAei/S7V9CvAccW8mczwtMCceSQ8nwhXWuKAeQPJbRCc9RnhoSyhvBL+WgxTzsk0Y567IFj+35wa4Xq7ykS5YIm7UIdq4iCfKcsiIoSvFFWONUnFovZoXHKhXE69R9hTOIEgZPcJ0VZRrx+i3j9hhtFPqQDnYjX8uaEpS2+F4twiVkOylSJAwfvBZO3XBnoTaEHtltSWAGKIEl3SJIQ1CRESIRnLFtJRc88GckEbQuOBTO5zBXziL0JIPKiyMtzggwiMc+czmbDEbDMbJaLhC3LPzPuFOKaD6zEM+tt15gNxTPLIg5dvglCfGmbmakYmqmKsEfRVOWWAXjqvEzVeamT6botq9321Vu2rIb7KOrufmZ24LWmoiI3yspJJ65e704JprBSFGH3pxXLhAQe9fBzbM1rq7YAm1dsctvZSiqu8G94rxwS/LQ7JYorRR0XXq/GmSh4dJADKAsSk70ajQ8gHdE0MhzVjOCbVDSvKINd1PhKVN+fgMTG2zYCvIaq+V2mmsNTP36IRLD6xO7ejWTDisfc7zCVD6tQW+/eMTW1Y3fSt20foe+hBZpQ3zfGfH3vyzmCZNvHFoJFVPrRjj7m6I26M3r7KHQxgD5c2H/4tQdIeJLJ+yQDvTsZOwv4jYfJQxVaxxmtKtNTTVaQnRmS6kkWvfBoNvCeIT55jt41PJZwpg3YYeJYGK+dppgK/sF+R/8ggZIOBlnyNoK/qpwokLZ6uCFRKCTKV8HeGaYksPg2Xj/3fyQZb6dhGWv2QLLQU4DW7lZwf77Hw+vb3AjzexKIVywkEXoGlB1JUqr4FW3A7BZlDzgzhZ5W0tyfI1da7mmn13JvsZOFxLuJIRsmLXJVskByA41iu/uvSds9bWOnPZQ4lSgANm+xqQ6gMPlGH2YR79rSDIXLXQBujHZSxkCpSIeynwCdNxEFJ2HVmSDaFPxQYoIN2BfCM8E6zTCu66VDSQ97KkPfIa8i7nGUITNAZagDhYFJjeg5rXh+bcBuYamT/JWmRVE8Iopeb/3ud1ZdSIs4TkQLcaogJ63Z5dGUxEfefz8qSKko+Qm2PB/ZgyEEMngmjkjovYB0GBog+n9COzD7MiQ73pfOA5S8NLseIst+QWbPC9y/J8dRv7QFliCNWcnzAYlI3fE8hdNVbBPY1WEeZxm8m5mKOdypQRG1qhiRgQBnZbr7N20qT1ipoPsLVYWEGq8hE3BoLPn2tV8PhWVe0WTB4nIN3WMD7cmIiDZEhaSSROulWMbk2+sX4LIs0Iq4NNdUfV3mDeqCbaEOligmbYSFCaU0VRVULrhTKoKlIMubNvV3ZyyOByWMilXkBpNjcIjihTjBrwzF/bmKF1iMJNsHxrobcnxElDVF0C3u69fevP5txIsEcUrVZyR96DPqiI/C+zGTp0uZGkXVP6PG1RncET7Ey/eKjnX885QeWw83krsCIVyvMp8TD9P3rEvMFUkFZxS6Rw25ytWQJ/52/tqLyQSDrc7Dpiq/H2XDgYsVBgjnK7BF95EwLKLNKLh0bg5x74VXPNwJO1fq7raB588j7pbhat78pDKjPE1td1Jl6Hhn8Q73LdISsCrrgwuijljQ28Tinnavx+Xu9ap6jYqn2QzNaly7RoVJ99MoBl/DvmtU1X0Lu3FCnO37XXKEW832Nai8BYnDKKvIF92W3F9dotK94ahCNyJPuW+5b2L1WrQ2X6fSc1TBejLg77uvsm8FX2b1ghWk6cbjuB1FUIVm9y0f6aMKfMbdhjshNGihFKgIgE7044ZvkbXz+zbh3chXN/f35Z6mOyF2b/m7H6V7HVV3XYOYtiDOig/J25bh+xPuAPMdxRPRc8V1YU8Z2mEv9OIO2O6DTg8Wtt2C3+lCcjBRmEaNVbDhi0nLnUK1ttvqdVpsexruQ93WGnf3T9s47N+te7nN5FeohRGeChUfIvZx5htAPYTNjQl/ea/tTlkW7LZ7nIK3dyNsGUwWpq0+a4k/ALvozB5nurkCqwthUdrq5mnzBD/tu5rpfPVYuC6L0VZwnMfd/YnGxgTc97jjFNjGFvRQ6iyrYPfZjyPVyQJM233YRF5YVb1xgLzjwVMX3NOwZ/K7wtJZx4W8pGRNNzf4ZOBeCKgPCxuKcUYmxQNycbjP5wGlEJGk8OZc369tR3gtaZ+X6CbmVkIONRVJcugpluk1TQL1Fqmfy1ELVi4hYy1zJhYNj4zu7RkfbuebN17fv+q2Fj4sDgtE7Hv2uk89uneIH7j9yNWjR1YMmUvJSzO6s9QcGWkbHt83PtzW0yWCMMLr4roNcMm+o88e3XdJ/0VDkWiFDxSv5YhXq8d3nVAryjjtoDXp7Ojn2gg6ijGHIUxDpQZ0Y2lQym2+5NZHN219to8XhsUw33Lb6p6dG9DVGN598/bmkXA0NoPeR2t4qO/h0U8d3bcKtmB5yeilos6PCCB29fgINjeNmEsdfaYmGhm6qB9RrPhEx7mrEbfGwCDauZXNJo09wLJ1oAhSe1NxWkUDKKJofMqeE+szt8S4K9JYmjbLXRRtylOU1vWN//mVy4/0DVGNqM9QJT7SvL287ot5MSZoGC/oyHTWO7p3vdd5s6RB439/5fKH6aIaEDh46AVkpMqWo1YdaWpe1690hzT4e79jxGuLvD+R0iUwuiJ+TLUM4+yrA8aAdsVAsX1JFgMsTkCF4ceBdtgLZ8oXaENnPpfPipLA6A57nn4+XI1hUbCoYmig1KP5pH44Kybnq4cUyatKivvTmXpeOC7y8J4il3yHncWVz+SDrc5zTqucPyYro3Af7XP30/I8ddJxsQAgXIFbz37QdsmqNhJl0K6145C0rkWzExAX8aM3sDpwYyA8oF83PNBXWu7xRPQMIT1E6syw7M4F2tFwOmyhVKQ7+uH/lz9DribLBF4jsuze94lYBc+7LzLOXMw4c+66u52EZz/QLEWxyA0XZFuA9+OVUfSTwyzWCw0o3a0Jx9BYTrKp2AZiEi9qGSs6OFhZkPboRDXesZKpbcd3UOjV8dMgNNQhr1pJh0Qy5petVIQ48Zq1KefMj7zIhluf3pQeBs5JfUuJMGcgHFRik16gP1mzHX2EmroaYhmVysETLOo54aSGU/gHzbEwdRvCMXuGhUczHj3HkZ42Rk9LYIDS07c8YRuqSBg91Pmnwo8VghFR2Y9oKTmxziSwi0HTN2I1cMvT3E7Fezk/Pae1UnYyUwqdRnqCNZPoXSJSk6hxGWmRBKqBSMqyTP97/wmaJcQCGpqbG5Iw6vhEtHpEVWihepULpFG3rqG0rOha2qTxJIC0YOSYFjrxEtP8nlSlIxvu7PLcRKmS76mk04Sq0HoTqJ04CcfcK+DDIU34mhCX/dByaAiDy58ibicVeRdNJrNyezI2G/ESlUKsZDxiOtLJk/ChXCc9Imp+1nO2xL6QZIkkWiizM7SHIF9q9K8ZpQDx8zOjgWaMzORvdrSGPJ2sEzRYZer9O2gmWD4zSTr6sSuH8Uc/IGjmyLIMOHUV0G48840967ixy2v6zIhcU+pr3bDj9u0bc1xfqUbO9sUuH3O/iqEbFPqaPbOBZuFTO57rx7mxvnDL7avRFLah/ei55LZCpKddjqz4OxhyH6YRLuzA0rcfY5yC8rQTcb08JdLYleZW8TZ0lGgSCyVfQoQtRDiPV6BqKLryzL7kqRmkuoGdE5UzlKWy39mJQlU1OChf1KrEHOYcsdMhvaO3j5JN+zZBXJZ2Kmq0WRSMDSFJGqmtC0q8eZesmfWxPxNNca3DC3KzYsg7MBBXhJ2yHmvy5sojNXVBmQvfhUdoxJ0NgiENWTzfqwd3SOjC927ceNvGjbfTUTNp13eIumhvAKEvJA/HTUW6Maj1CeJAUtBFrcOI1xugSWxubV1qqaRJ1gZvqiHLbKqwOo5TR9hELw7/iBsjL/t6WXl+SWN9VOO5RfnTtJcwreTFY35bWthGB+bMB+yOcGEDg4bztxbkUR0wh1h2kJWgV0awMR+Hjvn5mlrmu9BMCMpYsZynmQC8KR2xco4maZIg5jN5CU86ViJ/s27nzqlxgFc6167fuXP92s5XYOdDO8j4pYNYw16IjR8eH79U0ra3Y6V9uyat20l2P7AbsKpjJ81Tzs39nt9PXgqYeL9LNB+Yi9uMN1BEZ0knnvijDiZLEDg6dJ30NuA9oQEVh9U0uk/kgO8A+R94pvWy8YveWn0ZWbfmLepJXdqz5Z5B94qhu7d2k75r7l0Lx2gVtvTMr6FXgDY7p56d6qSNS+/e0ke6r//CQ1/YXiTdW++u+FK/529HfC3klvzNhK3Te4txIUFlkuQ8tIjguXrUG6WAPWgMsIcDF664d3v3DHXwhQ07YMul2I9QDvtQXz+bokoej3uUo5mt1Qi7f/m58pGoIAyavsnnFiUl8cbhKTpRmI+CKw9Y1oKc5GvZZJCT6kWJcCHNzzDS3KTQKEocr/6Fe1GoUf+1rq/QG/W/hs9goz8E649Xc5M6HxXjAnDV9OT9spBFuwOC26Prv2bzQ3RhCHfwaYpW8+LxqOzlYOZR7/Kf/RbmXMktCzAr3jWP/Kqt5KUqZDq4uTqyBbYGfL17HcuL19KcjykyePSoAP2bNgILH1qOXXFwA9l471P3bOIvOwRXL8j+k0OjB6cPjrLCfe2sXP/824QcsAMZlOmGWiMo0rwb4K1qo+mH/LkBVlXdA+cFXFFWvz0//AXvbZ6+ac3GoyzHHvXfzCqvNILfLi9qV7KBJ/03OPbql/A+XlcDa3g9C1/rnPPU/XzkR4E3q/4p6kHES6V3vVx1M7x3EG4RnpwfhuT9B8mTF4BG6w/vZp7SbtoL4oJBkCuYe2+LL3GT6CtdzGKjNas6FGaHETyqOIeljCSdy4azYTwkLxFIL08OHSKaM+7sonl9vERpGguhHaS5bUgz24xu3ETTPsVKqntkIZfpqR1MdBfQKd6hmiFHviU1QZ260MQ2FSOcbfDmVoyFeHkb9rq/db9KFWsP6uutqz6LgZW6R+JrIjp86Gp6jSXL+7RoUv38yjEracH0NiVpKdu2ISBl27QDRdTKAT9WHoc/IL/p7w4sptcdmtpFR6IcZRnNXDnaT909x7Ykjj6PwmlFdP9FMuWgQvb8nAiKpHB7iS4/r+pk678LRCWOGpq9QwfOlOGlbpDkEPwThngKL7puibAY5LvMl+ZQQ8Yx4mxF/wZjkGJ7a3NjKl5jyjiJ/hAhLzVVExN+9qMpZsAyWImhu/eF2NlfcmS6bxq6lNlO9CZvxpjon/G7R5k1SqVwuFwOv3HTTZn0TTelSQs2wtjpPkNH8D/RH++b3mkosx0KLkzSlfi92qSrzPKX2arMTe692ChjJ7T5I75t3I487EIe5jXKQ6pg6Q83qs/lEn3noSFynmb4aOrBF9sEoBuHhKFYcL11up41emofLCQGE60wVdeDClSvn5qqM41Go7t+iuWUHqzrNrOGWTsFst5TtwLXXPk0Syc9fSX2rsBFmzadY6C/Fge8d+e5uXHkfyiQRc6vwTu2Ylkhz95Fq2/8+YVv/CxSqb7xxyqhDjDBRxFBxcQnSYzeBfrYNqGJjej4TLDfWEywII42hqZ+/BB/6I2DkCn0WS9uv3PD4Z0DpG/3oemDe7u5NS/aMOWtol60t2qCusYTSi19uHn1iHiQOpz2i2v6xx/4xqE9PfyqHQ+N3Ln9RftsmoxADcYAyvMt9Y73lr7wdwTUmb8g/u53GOaw6pPizJC9MJrEj7noG9sG1CNhmWN2BcF2dpRzGBfz5XrojEWZRxuj6aCYY0tiLJOTMmK2uJJQjxj/8hjKEB1iGHCj4JTpxczQzEtehAevG+5pUO12twtCjfG4I979yJB4a7RlZbDdVGV1OMgDQPZQY+ERm1wqiVyYJwJHMrGaP+o9YKbUlE2ApL6YEiyylNT9ESff74qtvCgqNSZcBVOa+2Hr9q9E70rVikGTcxRJ4BSQa6ImzpQIEXk+OFbqhvQRQ4souDWotqAiL2Xqm+AZ/Yz0kXcCOnvfqg1779vzOXtqtvPMii9Ig5+dwj87Kf4bQ6EJfdRt4PyQZYFY0/NXERbE5vPzi+As2njhToFqfp7h6ufXYTFiZ6MCryyG/xQX5qIBFddLfr6b+SYsHc3P1ocikRD5rxCMuNslxeBKuiZjzQpUY6kFvwNgPtyioHRxkEr9fv+HE5AwHFc9q0neOXOa/kiAi9ByQX3et1fZb2+q7yCL914QN5y1GVt/DOVaR29JPCECXV9iGaI84A7sQ9W3Y4dLZe4vVR1Mxd3Hc7rq7lNVOKjqHM9xqmiceVWXNTgoiO6fswpN0R/EfnefyHtnMvcsdw1nzMOJiSzGpQ+SPmclxmVRqlVM0HG5wNFSQYAIRhjE3ZDTsobwJbifVegTxj7sx7mCRwvp5XSWh6/QYs/TwjyMahKsVCYZVaeECMTR56MplPyzCfrSPO/dL0m8RwvpQ1oS56aF7i/58Mpn0eOHaKxcTNGd84cLd4oCvXPu3B+4a8kPUA7rmSzJ7E3Zy7OzuJEm/Mt+7Eh/pyDPMx7xF7luuh/CY9hDe4WZYLqvW+YhFlJiWX1PO0aOB6L0t3AVOUK7V/XSqP8Dx/CavHCY8erwC3jhyKHZR2nu9wXvpz4vKN4dwOIA22sZ/S1RTbhyBxbvF/XeXzEQpfEUTa0hLTTE+RigN9vzQhBp0RzT5OUaKazwlhEU8u0fx8D9XmGdwVmmZmpavDGuichhJJUz1nn5pp9yj5H3GG7DgZtovmnn5YNFiiT/JyIZqw6Uvd+i0TRIFwumFw7SVEg/TYvQDM/8hE9O4uTWEVlECuyU2tLW1oKK3jIk+bItDxy6TZKw36mttdZgKDxo1fIRzrFMSbrt0J/Cl8KVh1OcozuqGUyO7RxLBk3UrA6XfmDTF97qwAErpOl655GnjnTqOidyIQsHO08G/hcLt/j/AAB4nGNgZGBgAOLaW41M8fw2Xxm4mV8ARRguss1QhNC5H/9//Z/FUsEcBORyMDCBRAFTFwxveJxjYGRgYA76n8UQxVLGwPD/FUsFA1AEBfgBAHyYBUh4nGN+wcDAvACCWfSBNIgviMBM1kA6koGBMRWVBqsDYqYmiF4wHQkxg+kUBMPVWEP0gTDYvBdoahZAzYxEY0ciuWUBFjkoZimDYLC8IKpehmsQccYvSGYgYZB7YBhFL5o8cxTQjDUI/wIArpclrwAAAAAAAAA6AIYA3AEKAUgBgAGgAfoCYgKqAwIDOgOGA9wEQAR4BLYFAgU8BZoFzAYMBlIGmga6BtgG+AcYB0QHcAecB8gIAAg2CG4IpgjyCUAJrAo0CtALOAueDAoMYA0ADVANjg3mDiQOjg7GDvgPOA+ED84QPBB2EN4RNhGgEfISchKoEsgS6BMGEz4TXhOSE8QT+BQsFGIUiBTWFX0AAAABAAAATgBuAAYAAAAAAAIAAAAQAHMAAAAiC3AAAAAAeJx1kctOGzEUhn9DoIKgLloJdcdZIRDK5CKhSqyoogJrhLJDwgyeSzpjRx4HlGfgLcoz8Dp9j+76Z2KhqFJmZM93Ph/bxx4AX/AHCqvnnG3FCgeMVryFT/gReZv+JnKHfBd5B108RN6l/xV5H2d4idzFV/zmCqqzx2iK98gK39RR5C18Vt8jb9P/jNwh30fewaGaR96lf428j4l6i9zFsfo7drOFL/MiyMn4VEaD4bk8LsRRlVZXouehcL6RS8mcDaaqXJK6OtSml+lemTrb3Jp8Xmm/rtZ5YnxTOivDZLCur401XgfztNytec5HIWSSeVfLVdxHZt5NTRqSIoTZRb+/vj/GcJhhAY8SOQoECE5oT/kdYYAhf4zgkRnCzFVWCQuNikZjzhlFO9IwvmTLGFlaw4yKnCBlX9PUdD2Oa/Zlay1n3dLmXKei9xuzNvkJ7XLvso2F9SaselP2Na1tZ+i2wqePszV4ZhUj2sBZy1P4tmrB1X/nEd7XcmxKk9In7a0F2gv0+W44/z/KQo7lAHicbZLnlpswEIW5Bgy4bLLpvfeE9N57z76DLARWEJKOEEucpw8CO/kTncOdT6PhnlHxRt4wJt7/x47nYQQfAUKMESFGggmmmGGOLezBXmxjH/bjAA7iEA7jCI7iGI7jBE7iFE7jDM7iHM7jAi7iEi7jCq7iGq7jBlLcxC3cxh3cxT3cxwM8xCM8xhM8xTM8xwu8xCu8xhu8xTu8xwd8xCd8xhd8xTd8xw/sBLUlZuIkZZW2q0hzahvDRqocUyIpE4EWTR1WXDZ1sGRCz5yklBsqWBZwmauZk01mTqxl0nIlUyLs9r/Zej35m4kFl2XKftlAKFomTlKlmfQ1l74lRdB9dbxQqqyIKbc2MPQZGqbFKsqVaYnJ4ky1Ms24iQXLrYPE8GLZ07jRfaIvcf5JX+NoMhQ5jLoqFwenBS8Gpw7WTh05py6MaOtT2ibEGNXWKW1Da0i9nPY6dNe7CEWy7pc+5EJpvfJVnvtUFUHFZBPWS2LYxKqiECztVpINypAuGS2nvQ6Gs+H0hsk0U3ZznDETguua1/MNpLvMWH/RFGEuuobCihScxqS2zPC6jH4rVaVcxn1UjQ1yJW1QK2MTJ6nrPOqp0d3Vk1WoSVOz7p0oHeWdTbpoh5i3sVWpezp23AGTWch+Mmonu0o0Vb+l6RqdabLmRnveH9ru7j54nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjIwaEFoDhR6JwMDAycyi5nBZaMKY0dgxAaHjoiNzCkuG9VAvF0cDQyMLA4dySERICWRQLCRgUdrB+P/1g0svRuZGFwAB9MiuAAAAA==) format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-o-transition:none!important;transition:none!important}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111}a{cursor:pointer;color:#68d;text-decoration:none;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}span.link-disabled{color:#aaa}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}textarea{resize:vertical}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.875em}.error-view>.error{display:inline-block;margin-left:1.75em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){display:block;margin:0 0 .25em;padding:.25em;background-color:rgba(0,0,0,.2)}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0"}[data-icon-after]:after{content:"\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}</style>
<style id="style-core-macro" type="text/css">.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-repeat-insert,.macro-timed-insert{-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-repeat-in,.macro-timed-in{opacity:0}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:0;left:0;height:100%;width:100%}#ui-dialog.open{display:block;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:90%;height:calc(100% - 2.1em - 34px)}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0;min-width:140px}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;min-width:340px;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999}#ui-dialog-body.saves .datestamp{font-size:75%}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-label]{font-size:87.5%}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:.5em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.share{min-width:140px}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:600%;max-height:60vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript is required. Please enable it to continue.</noscript></div>
		<div id="init-lacking">Your browser lacks required capabilities. Please upgrade it or switch to another to continue.</div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<div id="store-area" data-size="778" hidden><div tiddler="Longsword" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;lswd_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;long&quot;]]\n[[No|weaponswap]]</div><div tiddler="bal-adjust" tags="nobr" created="201704272344" modifier="twee">&lt;&lt;set $atk to Math.trunc($atk * setup.bal.patk)&gt;&gt;\n&lt;&lt;set $def to Math.trunc($def * setup.bal.pdef)&gt;&gt;\n&lt;&lt;set $mov to Math.trunc($mov * setup.bal.pmov)&gt;&gt;\n\n&lt;&lt;set $critmult to Math.trunc($critmult * setup.bal.critOdds)&gt;&gt;\n&lt;&lt;set $critdam to Math.trunc($critdam * setup.bal.critical)&gt;&gt;\n&lt;&lt;set $dodge to Math.trunc($dodge * setup.bal.ddgOdds)&gt;&gt;\n&lt;&lt;set $dispel to Math.trunc($dispel * setup.bal.dispOdds)&gt;&gt;\n\n&lt;&lt;set $maxgrit to Math.trunc($maxgrit * setup.bal.pgrit)&gt;&gt;\n&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\n&lt;&lt;set $rageBuild to Math.trunc($rageBuild * setup.bal.rageB)&gt;&gt;\n&lt;&lt;set $rageDecay to Math.trunc($rageDecay * setup.bal.rageD)&gt;&gt;</div><div tiddler="atk_comUI" tags="dock" created="201702020321" modifier="twee">''Attack''\n\nAttack the enemy to deal damage.  Your current Attack Rating is &lt;&lt;print $atk&gt;&gt;.  You can continue attacking until you don't have enough stamina left.\n\n[img[setup.ui.icons.ui_crit]] Your critical rating is: &lt;&lt;print Math.trunc($critchance)&gt;&gt;\n\n[img[setup.ui.icons.ui_crit]] Your critical bonus damage is: &lt;&lt;print Math.trunc($critdam - $atk)&gt;&gt;\n</div><div tiddler="tut_onDodge" tags="hook tutorial" created="201707101337" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has dodged an enemy attack.\n\nDodging causes an enemy attack to have no effect.  &lt;&lt;name&gt;&gt;'s change to dodge an attack is based on her Agility and equipment.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onDodge'&gt;&gt;</div><div tiddler="helpautosaves" tags="help" created="201701110806" modifier="twee">While you can save the game yourself outside of combat and menus, the game will automatically save your progress at certain points.</div><div tiddler="ripley18_stats" tags="nobr" created="201612132321" modifier="twee">&lt;&lt;set $allyname to &quot;Ripley&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 3.1&gt;&gt;\n\n&lt;&lt;set $allylvl to 18&gt;&gt;\n&lt;&lt;set $allymaxhealth to 4&gt;&gt;\n&lt;&lt;set $allymaxgrit to 245&gt;&gt;\n&lt;&lt;set $allyatk to 126&gt;&gt;\n&lt;&lt;set $allydef to 110&gt;&gt;\n&lt;&lt;set $allymov to 113&gt;&gt;\n&lt;&lt;set $allymagic to 103&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;chain&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Co-op Attack&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 2&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;\n</div><div tiddler="1arRip" tags="dock" created="201708281823" modifier="twee">Elesun can't hear what they're saying from here, but they both seem animated enough.  She decides not to snoop, but does wave at Ripley, and she waves back before becoming lost in her conversation again.</div><div tiddler="spell_focus" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Focus&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Natural&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Focus&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;focus_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 10&gt;&gt;\n\n&lt;&lt;set $satk to 1.1&gt;&gt;\n&lt;&lt;set $sdef to 1.1&gt;&gt;\n&lt;&lt;set $smov to 1.1&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $naturaltraining is 1&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n&lt;&lt;elseif $naturaltraining is 2&gt;&gt;\n\t&lt;&lt;set $sdef to 1.2&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n&lt;&lt;elseif $naturaltraining is 3&gt;&gt;\n\t&lt;&lt;set $sdef to 1.2&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n\t&lt;&lt;set $smov to 1.2&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="spell_shadow" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Shadow Veil&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Dark&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Shadow Veil&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;shad_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 20&gt;&gt;\n&lt;&lt;set $spellgrit to -20&gt;&gt;\n\n&lt;&lt;set $satk to 0.8&gt;&gt;\n&lt;&lt;set $sdef to 0.8&gt;&gt;\n&lt;&lt;set $smov to 1.1&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 20&gt;&gt;\n\n&lt;&lt;if $darktraining is 1&gt;&gt;\n\t&lt;&lt;set $spellgrit to -10&gt;&gt;\n&lt;&lt;elseif $darktraining is 2&gt;&gt;\n\t&lt;&lt;set $sdef to 0.9&gt;&gt;\n\t&lt;&lt;set $spellgrit to -10&gt;&gt;\n&lt;&lt;elseif $darktraining is 3&gt;&gt;\n\t&lt;&lt;set $satk to 0.9&gt;&gt;\n\t&lt;&lt;set $sdef to 0.9&gt;&gt;\n\t&lt;&lt;set $spellgrit to -10&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="list of titles" tags="annotation" created="201707102351" modifier="twee">{{{MAXIMIZE WINDOW TO VIEW TABLE!\n---------------------------------------------------------------------------------\n##::NAME..............HOW TO GET......................EFFECT/HOOK DESCRIPTION\n---------------------------------------------------------------------------------\n01::Demonkin..........Start...........................No effect.  No hook.\n02::Unyielding One....Kill Aesil in Ch 1?.............Bonus chance to dispel.\n03::Dargon Slayer.....Defeat Alva (dragon)............Better move bonus.\n04::Dungeon Master....Play a game with the mercs......Chance to +grit on crit.\n05::Village Hero......Protect the village.............Chance to +grit on dodge.\n06::Gracious Host.....Help Harlaus with guests........Chance to +heart on desp.\n07::Chosen One........Defeat Akatosh..................Devil form.  No hook.\n08::Dragonkin.........Call forth Arkan................Arkan. No hook.\n09::Apostate..........Learn hellish magic.............Hellish magic. No hook.\n10::True Druid........Help druids for free............Chance to +heart on dodge.\n11::True Neutral......Help druids for a price.........+DESP ATK\n12::Treasure Hunter...Help find the hidden treasure...Chance to +heart on dispel.\n13::Pilgrim...........Help the priests reach safety...Light magic.  No hook.\n14::Vampire-Touched....Defeat Vampire Lord.............Chance to +heart on crit.\n15::Diplomat..........Get egg without fight...........+DODGE when unarmed\n16::Angel Slayer......Defeat the Elysian Beast........+REGEN\n17::Protector.........Save Irelith....................+CRIT DAMAGE\n18::Trickster.........Trick a god.....................Effects ending.  No hook.\n19::Druid Queen.......Convince the druids to help.....Improved bangles.  No hook.\n20::Lady of Pain......Learn to control your power.....Final form.  No hook.\n21::Promised One......Save the world, again...........No effect.  No hook.\n---------------------------------------------------------------------------------\n##::NAME..............HOW TO GET......................EFFECT/HOOK DESCRIPTION\n---------------------------------------------------------------------------------\n21 total titles.}}}</div><div tiddler="go" tags="test" created="201701121110" modifier="twee" twine-position="1970,710">&lt;&lt;print $bugcode&gt;&gt;\n\nGo to [&lt;&lt;print $go&gt;&gt;]?\n\n[[Yes.|$go][$gamestart to 1]]\n\n[[Yes, with debug on.|$go][$gamestart to 1, $debug to 1]]\n\n[[Cancel.|debug_features]]\n\n\n</div><div tiddler="1IreTrainer" tags="trainer" created="201702120817" modifier="twee">&lt;&lt;set $exitpassage to &quot;1IreTrainerDone&quot;&gt;&gt;&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;You ready then?&quot; Irelith asks, drawing her sword.\n\nIn only a few moments, the nearby soldiers have gathered around to see what's sure to be the fight of the century.\n\n&lt;&lt;message &quot;Help: Training&quot;&gt;&gt;&lt;&lt;display &quot;helpTraining&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;combat_trainer&quot;&gt;&gt;</div><div tiddler="scyt_ui" tags="" created="201702020414" modifier="twee">A wooden-handled scythe.\n\nAs a farm tool repurposed for battle, this weapon is difficult to wield.  However, it hits a little harder than an ordinary spear.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Moderate|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|High|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Very Low|\n*__Finesse__: Very Low\n*__Stamina__: Moderate</div><div tiddler="playeractions" tags="" created="201612172121" modifier="twee">&lt;&lt;if $playerturn is 1&gt;&gt;&lt;&lt;if $sta gt 0&gt;&gt;&lt;span id=&quot;defOpt&quot;&gt;[[2. Defend|highway2][$playeraction to 2]]&lt;/span&gt;: End turn and focus on defense.\n&lt;span id=&quot;movOpt&quot;&gt;[[3. Move|highway2][$playeraction to 3]]&lt;/span&gt;: End turn and try to get an advantage for next time.&lt;&lt;else&gt;&gt;&lt;span id=&quot;endOpt&quot;&gt;[[4. End Turn|highway2]]&lt;/span&gt;: Not enough stamina to defend or move.&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;&lt;span id=&quot;conOpt&quot;&gt;[[Ctrl: Continue|$combatnext]]&lt;/span&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="hold" tags="nobr" created="201701241635" modifier="twee">/%  9  %/\n&lt;&lt;set $specialMult to 0.6&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;Held&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,1,1)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 0.5&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 0.9&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 0.8&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 9&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Black Tendrils&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="spell_protect" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Protect&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Neutral&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Protect&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;prot_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 5&gt;&gt;\n&lt;&lt;set $spellgrit to 10&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.1&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 10&gt;&gt;\n\n&lt;&lt;if $neutraltraining is 1&gt;&gt;\n\t&lt;&lt;set $sdef to 1.2&gt;&gt;\n&lt;&lt;elseif $neutraltraining is 2&gt;&gt;\n\t&lt;&lt;set $spellgrit to 15&gt;&gt;\n\t&lt;&lt;set $sdef to 1.2&gt;&gt;\n&lt;&lt;elseif $neutraltraining is 3&gt;&gt;\n\t&lt;&lt;set $spelldodge to 10&gt;&gt;\n\t&lt;&lt;set $spellgrit to 15&gt;&gt;\n\t&lt;&lt;set $sdef to 1.2&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="mobilesettings" tags="" created="201701120455" modifier="twee">&lt;&lt;if $mobile is 0&gt;&gt;* &lt;&lt;radiobutton &quot;$mobile&quot; 0 checked&gt;&gt; Off:  Recommended for playing on a computer or tablet screen.\n* &lt;&lt;radiobutton &quot;$mobile&quot; 1&gt;&gt; On:  This option will remove some features, images, and text to improve appearance and performance on mobile devices.&lt;&lt;else&gt;&gt;* &lt;&lt;radiobutton &quot;$mobile&quot; 0&gt;&gt; Off:  Recommended for playing on a computer or tablet screen.\n* &lt;&lt;radiobutton &quot;$mobile&quot; 1 checked&gt;&gt; On:  This option will remove some features, images, and text to improve appearance and performance on mobile devices.&lt;&lt;endif&gt;&gt;</div><div tiddler="0choice2motherly" tags="scene" created="201701242355" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Elesun sits down beside Ripley and puts an arm around her.  &quot;Now, now,&quot; she says.  &quot;We're going to end all this, I promise.  But until we do, we need to keep fighting.&quot;\n\nRipley throws her arms around Elesun and has herself a good cry.  A minute or two later she calms down and looks up.  &quot;Your scarf smells good.&quot;\n\n&quot;It's spice.  Cinnamon mostly.&quot;\n\n&quot;I like it.&quot;  Ripley dries her eyes.  &quot;I know we can't stay here.&quot;\n\n&quot;Let's go then.&quot;  Elesun stands and helps Ripley up.  &quot;We'll get through this.  I need you to believe that.&quot;\n\n&quot;I'll try.&quot;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0wall3&quot;&gt;&gt;</div><div tiddler="0choice1assassin" tags="dock" created="201701140610" modifier="twee">This assassin, on his own, shouldn’t be anything Ripley can’t handle.  However, a poisoned blade or a bit of clever bound magic and Ripley could be dead in an instant.\n\nSure, she knows how to handle herself, but this is a bit dangerous for training.</div><div tiddler="1atcamp1" tags="scene save" created="201701281956" modifier="twee">&quot;Where did they go?&quot; Elesun shouts.\n\n&quot;Aesil had Ripley wrapped up in that magic of his,&quot; one of the guards says.  &quot;She was trying to dispel it and Aesil just grabbed her and left.  I think they went that way.&quot;\n\nThe other guard is bending down, over his fallen friend, and shuts his eyes with a wave of his hand.  The driver is trying to calm the horses.\n\n&quot;I'll go after them on horseback,&quot; Elesun says.  &quot;One of you needs to get back to the castle and get reinforcments.  Ride hard.  Kill the horse if you have to.&quot;\n\n&quot;I can do that,&quot; the driver says.\n\n&quot;Take some supplies and go now, then.  Godspeed.&quot;\n\nThe driver nods and leaves.\n\n&quot;This doesn't look good for the Druids,&quot; one of the guards says.  &quot;You'll be faster on your own; we'll check for survivors and follow.  Don't worry about supplies, we'll catch up to you soon.&quot;\n\n//Journal updated.//&lt;&lt;set $storystage to 4&gt;&gt;\n\n&lt;&lt;ctrlCon '1druidcamp'&gt;&gt;</div><div tiddler="bugreport" tags="script" created="201612151922" modifier="twee" twine-position="290,290">/*! &lt;&lt;bugreport&gt;&gt; macro for SugarCube 2.x */\n!function(){&quot;use strict&quot;;if(&quot;undefined&quot;==typeof version||&quot;undefined&quot;==typeof version.title||&quot;SugarCube&quot;!==version.title||&quot;undefined&quot;==typeof version.major||version.major&lt;2)throw new Error(&quot;&lt;&lt;bugreport&gt;&gt; macro requires SugarCube 2.0 or greater, aborting load&quot;);Macro.add(&quot;bugreport&quot;,{handler:function(){function serializeVariables(varObj,diffObj,doSort){function renderDiff(diff,orig){for(var keys=Object.keys(diff||{}),render=orig?clone(orig):{},i=0,klen=keys.length;klen&gt;i;i++){var p=keys[i],diffP=diff[p];if(diffP===Util.DiffOp.Delete)delete render[p];else if(Array.isArray(diffP))switch(diffP[0]){case Util.DiffOp.SpliceArray:try{render.splice(diffP[1],1+(diffP[2]-diffP[1]))}catch(e){}break;case Util.DiffOp.Copy:render[p]=clone(diffP[1]);break;case Util.DiffOp.CopyDate:render[p]=new Date(diffP[1])}else{var recurse=renderDiff(diffP,render[p]);0!==Object.keys(recurse).length&amp;&amp;(render[p]=recurse)}}return render}var varList=[],diff=renderDiff(Util.diff(varObj,diffObj));for(var p in diff){var sName=&quot;$&quot;+(-1===p.search(/[^\sw]/)?p:'&quot;'+p+'&quot;');varList.push(sName+&quot;=&quot;+JSON.stringify(diff[p]))}return doSort&amp;&amp;(&quot;function&quot;==typeof doSort?varList.sort(doSort):varList.sort()),0!==varList.length?varList.join(&quot;, &quot;):&quot;&quot;}var srcMatch,passages,varsPre,varsPost,dialog,dataEl,info=null!=this.args[0]&amp;&amp;Story.has(this.args[0])?Story.get(this.args[0]):null,last=State.length-1,source=unescape(window.location);null!==(srcMatch=/\s/([^\s/]+)$/.exec(source))&amp;&amp;(source=srcMatch[1]),passages=[];for(var i=0;last&gt;=i;i++)passages.push('&quot;'+State.index(i).title+'&quot;');passages=passages.join(&quot;, &quot;),varsPre=serializeVariables(State.index(0).variables,State.index(last).variables),varsPost=serializeVariables(State.index(last).variables,State.variables),dialog=UI.setup(&quot;Report&quot;,&quot;bugreport&quot;),dialog.innerHTML=(null!==info?'&lt;div id=&quot;bugreport-info&quot;&gt;&lt;/div&gt;':&quot;&quot;)+'&lt;div&gt;&lt;b&gt;Current Information:&lt;/b&gt; &lt;a id=&quot;bugreport-data-select&quot; class=&quot;link-internal macro-bugreport&quot;&gt;[Select]&lt;/a&gt;&lt;/div&gt;&lt;code id=&quot;bugreport-data&quot; tabindex=&quot;0&quot;&gt;&lt;/code&gt;'+(/applewebkit|chrome/.test(Browser.userAgent)?&quot;&quot;:'&lt;div class=&quot;scroll-pad&quot;&gt;&amp;nbsp;&lt;/div&gt;'),dataEl=dialog.querySelector(&quot;#bugreport-data&quot;),null!==info&amp;&amp;new Wikifier(dialog.querySelector(&quot;#bugreport-info&quot;),info.processText()),addAccessibleClickHandler(&quot;#bugreport-data-select&quot;,function(self){return function(){jQuery(dataEl).focus(),self.selectData(dataEl)}}(this.self)),insertText(dataEl,&quot;[spoiler][code]&quot;),insertElement(dataEl,&quot;br&quot;),insertText(dataEl,&quot;SOURCE: &quot;+source),insertElement(dataEl,&quot;br&quot;),insertElement(dataEl,&quot;br&quot;),insertText(dataEl,&quot;PASSAGES:&quot;),insertElement(dataEl,&quot;br&quot;),insertText(dataEl,passages),insertElement(dataEl,&quot;br&quot;),insertElement(dataEl,&quot;br&quot;),insertText(dataEl,&quot;VARIABLES (PRE-EXECUTION):&quot;),insertElement(dataEl,&quot;br&quot;),varsPre&amp;&amp;(insertText(dataEl,varsPre),insertElement(dataEl,&quot;br&quot;)),insertElement(dataEl,&quot;br&quot;),insertText(dataEl,&quot;VARIABLES (POST-EXECUTION):&quot;),insertElement(dataEl,&quot;br&quot;),varsPost&amp;&amp;(insertText(dataEl,varsPost),insertElement(dataEl,&quot;br&quot;)),insertText(dataEl,&quot;[/code][/spoiler]&quot;),UI.open()},selectData:function(e){if(window.getSelection){var s=window.getSelection();if(s.setBaseAndExtent)s.setBaseAndExtent(e,0,e,e.innerText.length-1);else{window.opera&amp;&amp;&quot;&lt;br&gt;&quot;===e.innerHTML.substring(e.innerHTML.length-4)&amp;&amp;(e.innerHTML+=&quot;&amp;nbsp;&quot;);var r=document.createRange();r.selectNodeContents(e),s.removeAllRanges(),s.addRange(r)}}else if(document.getSelection){var s=document.getSelection(),r=document.createRange();r.selectNodeContents(e),s.removeAllRanges(),s.addRange(r)}else if(document.selection){var r=document.body.createTextRange();r.moveToElementText(e),r.select()}}})}();\n</div><div tiddler="0protectking2wound" tags="dock" created="201701260031" modifier="twee">It's deep, and Irelith is sitting in a pool of her own blood.  She's tough, and she'll survive if they can get a healer to her.</div><div tiddler="0wall2door" tags="dock" created="201701242311" modifier="twee">A door to a storeroom.  If Elesun is where she thinks she is, this storeroom should be the one above the servant's quarters.\n\n&lt;&lt;if $helpServants is 1&gt;&gt;Now that Ripley mentions it, you can hear moaning coming from within.\n\n&lt;&lt;ctrlClick &quot;Check it out.&quot; &quot;0storeroom&quot; &quot;leave&quot;&gt;&gt;&lt;&lt;if $servants is 1&gt;&gt;&lt;&lt;set $helpServants++&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="quest widgets" tags="widget" created="201704221611" modifier="twee">&lt;&lt;widget &quot;questList&quot;&gt;&gt;\s\n  &lt;&lt;if $sq.length gt 0&gt;&gt;\s\n    ''Current Side Quests:''\n    &lt;&lt;for _i to 0; _i lt $sq.length; _i++&gt;&gt;\s\n    &lt;&lt;capture _i&gt;&gt;\s\n      &lt;&lt;set $quTitle[_i] to $sq[_i].title&gt;&gt;\s\n      &lt;&lt;set $quDescr[_i] to $sq[_i].descrPass&gt;&gt;\s\n      &lt;&lt;set $quCompl[_i] to $sq[_i].complPass&gt;&gt;\s\n      &lt;&lt;set $quProg[_i] to $sq[_i].progress&gt;&gt;\s\n      &lt;&lt;if $quProg[_i] lt 10&gt;&gt;\s\n        &lt;&lt;set $quStatus[_i] to &quot;Status&quot;&gt;&gt;\s\n      &lt;&lt;else&gt;&gt;\s\n        &lt;&lt;set $quStatus[_i] to &quot;Completed&quot;&gt;&gt;\s\n      &lt;&lt;endif&gt;&gt;\s\n      &lt;&lt;print $quTitle[_i]&gt;&gt; - \s\n      &lt;&lt;link $quStatus[_i]&gt;&gt;\n        &lt;&lt;popup $quDescr[_i]&gt;&gt;\n      &lt;&lt;/link&gt;&gt; \s\n      &lt;&lt;if $quProg[_i] gt 9&gt;&gt;\s\n        &lt;&lt;button &quot;Turn In!&quot;&gt;&gt;\n          &lt;&lt;goto $quCompl[_i] 'Quest Information'&gt;&gt;\n        &lt;&lt;/button&gt;&gt;\n      &lt;&lt;endif&gt;&gt;\s\n    &lt;&lt;/capture&gt;&gt;\s\n    &lt;&lt;/for&gt;&gt;\s\n  &lt;&lt;endif&gt;&gt;\s\n  &lt;&lt;if $sqDone.length gt 0&gt;&gt;\n    \n    &lt;&lt;button &quot;Completed Quests&quot;&gt;&gt;\n      &lt;&lt;popup &quot;quDone&quot; 'Completed Quests'&gt;&gt;\n    &lt;&lt;/button&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n\n  &lt;&lt;endif&gt;&gt;\s\n&lt;&lt;/widget&gt;&gt;\s\n      </div><div tiddler="codex_King" tags="menu" created="201701261838" modifier="twee">&lt;&lt;image &quot;KingPt&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''The King''\n\nHis Majesty King Harmon is the ruler of the kingdom of Juno, widely known and respected across the world for his wisdom and pragmatism.  \n\nRealizing that the cycle was upon them again and that Akatosh's return was near, the King assembled the demonkin and built a large army in the hopes of protecting humanity.\n\nHis son and heir, Prince Harlaus, seems to take after him in many ways.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="enemyai" tags="nobr" created="201612160633" modifier="twee">/%\n-Enemies can perform three possible actions: atk, def, and special, assigned to the numbers 1, 2, and 3.  Enemies do not &quot;move.&quot;\n\n-Enemies have combo limits ($NMElimit) in their object passages.  These limits determine how many possible attack actions can be chained together at max.  Enemies may stop attacking and switch to defense before this limit is reached.\n\n-There are three components to enemyai: base ai, type ai, and situation ai.\n\t-base ai: 1: 50%, 2: 25%, 3: 25%\n\t-type ai: \n\t\t-casters: 10: 20%, 20: 10%, 30:70% (3)\n\t\t-attackers: 10: 70%%, 20: 10%, 30: 20% (1)\n\t\t-tanks: 10: 30%, 20: 50%, 30: 20% (2)\n\t\t-boss: provided by the passage\n\t-situational AI:\n\t\t-enemy (self) grit low: 200\n\t\t-player grit low: 100: 50%, 200: 50%\n\t\t-both low: 100\n\t\t-normal: 100: 33%, 200: 33%, 300: 33%\n\n-The three AI values are stored in an array/string (not sure which yet), and they are checked:\n\n111-attack until limit is hit \n112-stop one attack from limit (121, 211)\n122-one attack, and then defend (212, 221)\n113-attack until limit or stop one from limit. (131, 311)\n123-stop once or twice and defend (213, 312)\n223-defend (232, 322)\n222-defend\n133-use special (313, 331)\n233-use special (323, 332)\n333-use special\n\n-Specials: if crit attack is special, perform normal combo attack (111), but boost crit rate by 10 just for that turn.  Other specials:\n\t-crits (3=atk) [default] (0)\n\t-steels itself (regain some hp on defends) (3=def) (1)\n\t-natural magic (snare: prevents mov and atk for two turns) (2)\n\t-light magic (casts a heal spell) (3)\n\t-neutral magic (force wave atk) (4)\n\t-dark magic (deals damage based on casters remaing grit, caster then loses that grit) (5)\n\t-hellish magic (hellfire atk) (6)\n\t-hellish magic (flash fire) (7)\n\t-riposte (occasionally dodges and deals minor damage) (8)\n\n%/\n\n&lt;&lt;if not $flinched&gt;&gt;\n\n&lt;&lt;set $nmebaseAI to either(1,1,2,3)&gt;&gt;\n\n&lt;&lt;if $nmetype is 1&gt;&gt;\n\t&lt;&lt;set $nmetypeAI to either(10,10,10,10,10,10,10,20,30,30)&gt;&gt;\n&lt;&lt;elseif $nmetype is 2&gt;&gt;\n\t&lt;&lt;set $nmetypeAI to either(10,10,10,20,20,20,20,20,30,30)&gt;&gt;\n&lt;&lt;elseif $nmetype is 3&gt;&gt;\n\t&lt;&lt;set $nmetypeAI to either(10,10,20,30,30,30,30,30,30,30)&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmegrit lte $nmemaxgrit/4 and $grit gt $maxgrit/4&gt;&gt;\n\t&lt;&lt;set $nmesitAI to 200&gt;&gt;\n&lt;&lt;elseif $nmegrit gt $nmemaxgrit/4 and $grit lte $maxgrit/4&gt;&gt;\n\t&lt;&lt;set $nmesitAI to 100&gt;&gt;\n&lt;&lt;elseif $nmegrit lte $nmemaxgrit/4 and $grit lte $maxgrit/4&gt;&gt;\n\t&lt;&lt;set $nmesitAI to either(100,100,100,200,300)&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $nmesitAI to either(100,200,300)&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\t\n&lt;&lt;set $nmeAI to $nmesitAI+$nmetypeAI+$nmebaseAI&gt;&gt;\n\n&lt;&lt;if $nmeAI is 111&gt;&gt;\n\t&lt;&lt;set $nmeaction to 1&gt;&gt; /%full attack%/\n&lt;&lt;elseif $nmeAI is 112 or $nmeAI is 121 or $nmeAI is 211&gt;&gt;\n\t&lt;&lt;set $nmeaction to 1.1&gt;&gt; /%attack one away from moveset limit then defend%/\n&lt;&lt;elseif $nmeAI is 122 or $nmeAI is 221 or $nmeAI is 212&gt;&gt;\n\t&lt;&lt;set $nmeaction to 1.2&gt;&gt; /%attack once then defend%/\n&lt;&lt;elseif $nmeAI is 113 or $nmeAI is 311 or $nmeAI is 131&gt;&gt;\n\t&lt;&lt;set $nmeaction to either(1,1.1)&gt;&gt;\n&lt;&lt;elseif $nmeAI is 123 or $nmeAI is 321 or $nmeAI is 213 or $nmeAI is 312 or $nmeAI is 132&gt;&gt;\n\t&lt;&lt;set $nmeaction to either(1.2,1.3)&gt;&gt;/%1.3 two attacks then defend%/\n&lt;&lt;elseif $nmeAI is 322 or $nmeAI is 223 or $nmeAI is 232&gt;&gt;\n\t&lt;&lt;set $nmeaction to 2&gt;&gt;/%defend%/\n&lt;&lt;elseif $nmeAI is 222&gt;&gt;\n\t&lt;&lt;set $nmeaction to 2&gt;&gt;/%defend%/\n&lt;&lt;elseif $nmeAI is 332 or $nmeAI is 233 or $nmeAI is 232&gt;&gt;\n\t&lt;&lt;set $nmeaction to 3&gt;&gt;/%use special%/\n&lt;&lt;elseif $nmeAI is 333&gt;&gt;\n\t&lt;&lt;set $nmeaction to 3&gt;&gt;/%use special%/\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $nmeaction to 1&gt;&gt; /%full attack%/\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmetype is 3&gt;&gt;\n\t&lt;&lt;if $nmeaction neq 3&gt;&gt;\n\t\t&lt;&lt;set $nmeaction to either(3,$nmeaction,$nmeaction)&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmeaction is 3&gt;&gt;\n\t&lt;&lt;if $enemyspecialname is &quot;heal&quot;&gt;&gt;\n\t\t&lt;&lt;if $NMEgrit gt 0.7*$NMEmaxgrit&gt;&gt;\n\t\t\t&lt;&lt;set $nmeaction to either(1,1.1)&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n/% adjust agression %/\n&lt;&lt;if setup.bal.agression neq 1&gt;&gt;\n\t&lt;&lt;switch setup.bal.agression&gt;&gt;\n\t&lt;&lt;default&gt;&gt; /% reduced enemy agression -- same as case 0 %/\n\t\t&lt;&lt;set _agression to random(100)&gt;&gt;\n\t\t&lt;&lt;if $nmeaction lt 2&gt;&gt;\n\t\t\t&lt;&lt;if $health lt 2&gt;&gt;\n\t\t\t\t&lt;&lt;if $nmeaction is 1&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _agression lt 20&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(2, 1.3, 1.2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _agression lt 50&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(1.3, 1.2, 1.1)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;else&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _aggression lt 20&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3, 2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _aggression lt 50&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;elseif $grit lt $maxgrit/5&gt;&gt;\n\t\t\t\t&lt;&lt;if $nmeaction is 1&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _agression lt 10&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(2, 1.3, 1.2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _agression lt 25&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(1.3, 1.2, 1.1)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;else&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _aggression lt 10&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3, 2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _aggression lt 25&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;case 0&gt;&gt; /% reduced enemy agression %/\n\t\t&lt;&lt;set _agression to random(100)&gt;&gt;\n\t\t&lt;&lt;if $nmeaction lt 2&gt;&gt;\n\t\t\t&lt;&lt;if $health lt 2&gt;&gt;\n\t\t\t\t&lt;&lt;if $nmeaction is 1&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _agression lt 20&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(2, 1.3, 1.2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _agression lt 50&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(1.3, 1.2, 1.1)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;else&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _aggression lt 20&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3, 2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _aggression lt 50&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;elseif $grit lt $maxgrit/5&gt;&gt;\n\t\t\t\t&lt;&lt;if $nmeaction is 1&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _agression lt 10&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(2, 1.3, 1.2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _agression lt 25&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either(1.3, 1.2, 1.1)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;else&gt;&gt;\n\t\t\t\t\t&lt;&lt;if _aggression lt 10&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3, 2)&gt;&gt;\n\t\t\t\t\t&lt;&lt;elseif _aggression lt 25&gt;&gt;\n\t\t\t\t\t\t&lt;&lt;set $nmeaction to either($nmeaction, 1.3)&gt;&gt;\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;case 2&gt;&gt; /% increased enemy aggression %/\n\t\t&lt;&lt;set _agression to random(100)&gt;&gt;\n\t\t&lt;&lt;if $nmeaction is 2&gt;&gt;\n\t\t\t&lt;&lt;if _agression lt 50&gt;&gt;\n\t\t\t\t&lt;&lt;set $nmeaction to either(1.3, 1.2, 3, 2)&gt;&gt;\n\t\t\t&lt;&lt;elseif _agression lt 30&gt;&gt;\n\t\t\t\t&lt;&lt;set $nmeaction to either(1.1, 1.2, 1.3, 3)&gt;&gt;\n\t\t\t&lt;&lt;elseif _agression lt 20&gt;&gt;\n\t\t\t\t&lt;&lt;set $nmeaction to either(1, 1.1, 1.2)&gt;&gt;\n\t\t\t&lt;&lt;elseif _agression lt 10&gt;&gt;\n\t\t\t\t&lt;&lt;set $nmeaction to either (1, 1.1)&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;/switch&gt;&gt;\n&lt;&lt;endif&gt;&gt;\t\n\n&lt;&lt;endif&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="mercenary_stats" tags="nobr" created="201612132345" modifier="twee">Variable level\n\n&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="hana_stats" tags="nobr" created="201612132344" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="banglesinfo" tags="" created="201612151708" modifier="twee">\nA set of eight golden bangles the Ripley wears on her arms and legs.  Forged by the Druid oracles and gifted only to elite Druid warriors, these bangles grant increased healing, longer life, and improved physical prowess.  Their real power, hoewever, is their ability to disperse magical energies, making the dispeling of hostile magic much easier.\n\n</div><div tiddler="Untitled Passage 1" tags="" created="201708260048" modifier="twee"></div><div tiddler="highway3" tags="combat" created="201612160721" modifier="twee">!Ally's Turn\n&lt;&lt;nobr&gt;&gt;\n&lt;&lt;display &quot;allyai&quot;&gt;&gt;&lt;&lt;display &quot;damagecalc_ally&quot;&gt;&gt;\n&lt;&lt;set $combatnext to &quot;highway5&quot;&gt;&gt;\n&lt;&lt;set $playerturn to 3&gt;&gt;\n&lt;&lt;display &quot;combatinfodock&quot;&gt;&gt;&lt;&lt;if $combatimages is 1&gt;&gt;&lt;&lt;comPt&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;span id=&quot;combatNME&quot;&gt;&lt;&lt;display &quot;combatboxNME&quot;&gt;&gt;&lt;/span&gt;\n&lt;span id=&quot;combatAlly&quot;&gt;&lt;&lt;display &quot;combatboxAlly&quot;&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;display &quot;health_checker&quot;&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="highway2" tags="combat" created="201612160718" modifier="twee">!Enemy's Turn\n&lt;&lt;nobr&gt;&gt;\n&lt;&lt;set $nmedefboost to 1.0&gt;&gt;&lt;&lt;set $nmeregen to $nmebaseregen&gt;&gt;\n\n&lt;&lt;display &quot;enemyai&quot;&gt;&gt;&lt;&lt;display &quot;damagecalc_NME&quot;&gt;&gt;\n&lt;&lt;if $allynumber is 0&gt;&gt;&lt;&lt;set $combatnext to &quot;highway5&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;set $combatnext to &quot;highway3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $playerturn to 2&gt;&gt;\n&lt;&lt;display &quot;combatinfodock&quot;&gt;&gt;&lt;div id=&quot;tray&quot;&gt;&lt;&lt;comPt&gt;&gt;&lt;/div&gt;\n&lt;span id=&quot;combatNME&quot;&gt;&lt;&lt;display &quot;combatboxNME&quot;&gt;&gt;&lt;/span&gt;\n&lt;&lt;if $allynumber neq 0&gt;&gt;&lt;span id=&quot;combatAlly&quot;&gt;&lt;&lt;display &quot;combatboxAlly&quot;&gt;&gt;&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;replace &quot;#combatactions&quot;&gt;&gt;&lt;&lt;display &quot;playeractions&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;\n\n&lt;&lt;endnobr&gt;&gt;\n\n\n\n\n\n\n</div><div tiddler="highway1" tags="combat" created="201612160717" modifier="twee">!Player's Turn\n&lt;&lt;nobr&gt;&gt;\n&lt;&lt;set $firstAtk to true&gt;&gt;\n&lt;&lt;set $playerturn to 1&gt;&gt;\n&lt;&lt;display &quot;combatinfodock&quot;&gt;&gt;&lt;div id=&quot;tray&quot;&gt;&lt;&lt;comPt&gt;&gt;&lt;/div&gt;\n&lt;span id=&quot;combatNME&quot;&gt;&lt;&lt;display &quot;combatboxNME&quot;&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;if $allynumber neq 0&gt;&gt;&lt;span id=&quot;combatAlly&quot;&gt;&lt;&lt;display &quot;combatboxAlly&quot;&gt;&gt;&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $playeraction to 1&gt;&gt;\n&lt;&lt;display &quot;health_checker&quot;&gt;&gt;\n\n&lt;&lt;endnobr&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="staggermaker" tags="nobr" created="201801140025" modifier="twee">&lt;&lt;if not $crityes&gt;&gt;\n\t&lt;&lt;set _staggerDam to Math.trunc(($wStaUse + $wilrank) * setup.bal.pstagger)&gt;&gt;\n\t&lt;&lt;set _roll to random($staggerOdds)&gt;&gt;\n\t&lt;&lt;if _roll lt _staggerDam&gt;&gt;\n\t\t&lt;&lt;set $flinched to true&gt;&gt;\n\t\t&lt;&lt;set $staggerOdds to $baseStaggerOdds&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t/% stagger damage adjustments %/\n\t\t&lt;&lt;if $weaponname is 'Great Sword' or $weaponname is 'Battle Axe'&gt;&gt;\n\t\t\t&lt;&lt;set _staggerDam += 2&gt;&gt;\n\t\t&lt;&lt;elseif $weaponname is 'Spear' or $weaponname is 'Scythe'&gt;&gt;\n\t\t\t&lt;&lt;set _staggerDam += 1&gt;&gt;\n\t\t&lt;&lt;elseif $weaponname is 'Unarmed' or $weaponname is 'Clawed Gauntlets'&gt;&gt;\n\t\t\t&lt;&lt;set _staggerDam -= 1&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;set $staggerOdds -= _staggerDam&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="updater" tags="" created="201612200117" modifier="twee" twine-position="710,710">&lt;&lt;set $infopop to 0&gt;&gt;/%validates display mode 0, -1 %/\n&lt;&lt;set $rageCurrent to 0&gt;&gt;/%validates transformation%/\n\n&lt;&lt;if $version lt 50&gt;&gt;\n\t&lt;&lt;goto &quot;oldsave&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $version eq 50&gt;&gt;\n\t&lt;&lt;set $version to 51&gt;&gt;\n\t&lt;&lt;set $song to $chapter&gt;&gt;\n\t&lt;&lt;display &quot;AudioLoad&quot;&gt;&gt;\n\t&lt;&lt;set $chapter to 0&gt;&gt;\n\t&lt;&lt;set $infopop to 0&gt;&gt;\n\t&lt;&lt;set $dockdisp to 1&gt;&gt;\n\t&lt;&lt;set $versionnumber to &quot;0.5.1&quot;&gt;&gt;\n\t&lt;&lt;set $weapon_ui to &quot;lswrd_ui&quot;&gt;&gt;\n\t&lt;&lt;set $armor_ui to &quot;leath_ui&quot;&gt;&gt;\n\t&lt;&lt;set $spell_ui to &quot;prot_ui&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_protect&quot;&gt;&gt;\n\t&lt;&lt;display &quot;leatherarmor&quot;&gt;&gt;\n\t&lt;&lt;display &quot;longsword&quot;&gt;&gt;\n\t&lt;&lt;stats&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $version eq 51 or $version eq 50&gt;&gt;\n\t&lt;&lt;script&gt;&gt;\n\t\tUI.alert(&quot;You are attempting to load a save file from a prototype version of &lt;em&gt;Holy Land&lt;/em&gt;.&lt;br&gt;Please delete your saves and start a new game.&lt;br&gt;The game will restart when you close this window&quot;, null, function () {Engine.restart();});\n\t&lt;&lt;/script&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="highway5" tags="combat" created="201612160723" modifier="twee">!Round &lt;&lt;print $round&gt;&gt; is over.\n&lt;&lt;display &quot;combat_upkeep&quot;&gt;&gt;\n&lt;&lt;print $endrndm1&gt;&gt;\n\n&lt;&lt;print $endrndm2&gt;&gt;\n&lt;&lt;if $despatk is 1&gt;&gt;&lt;&lt;set $despatk to 2&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;span id=&quot;conOpt&quot;&gt;[[Ctrl: Next Round|$combatnext][$round++]]&lt;/span&gt;\n\n\n\n\n&lt;span id=&quot;info&quot;&gt;\n\nRound &lt;&lt;print $round&gt;&gt; is over.\n\n[[Ctrl: Next Round|$combatnext][$round++]]\n&lt;/span&gt;</div><div tiddler="highway4" tags="deprecated" created="201612180832" modifier="twee">:(</div><div tiddler="pull_tut_hooks" tags="nobr" created="201707101827" modifier="twee" twine-position="570,990">/% remove tutorials %/\n&lt;&lt;deleteHook 'onCrit' 'tut_onCrit'&gt;&gt;\n&lt;&lt;deleteHook 'onNMEspell' 'tut_onNMEspell'&gt;&gt;\n&lt;&lt;deleteHook 'onFirstAtk' 'tut_onFirstAtk'&gt;&gt;\n&lt;&lt;deleteHook 'onDespAtk' 'tut_onDespAtk'&gt;&gt;\n&lt;&lt;deleteHook 'onGritDam' 'tut_onGritDam'&gt;&gt;\n&lt;&lt;deleteHook 'onHeartDam' 'tut_onHeartDam'&gt;&gt;\n&lt;&lt;deleteHook 'onMov' 'tut_onMov'&gt;&gt;\n&lt;&lt;deleteHook 'onNMEheartDam' 'tut_onNMEheartDam'&gt;&gt;\n&lt;&lt;deleteHook 'onDef' 'tut_onDef'&gt;&gt;\n&lt;&lt;deleteHook 'onDispel' 'tut_onDispel'&gt;&gt;\n&lt;&lt;deleteHook 'onDodge' 'tut_onDodge'&gt;&gt;\n&lt;&lt;deleteHook 'onTransform' 'tut_onTransform'&gt;&gt;\n&lt;&lt;deleteHook 'onRevert' 'tut_onRevert'&gt;&gt;\n&lt;&lt;deleteHook 'onFightEnd' 'tut_onFightEnd'&gt;&gt;</div><div tiddler="rank3lvl3_assassin" tags="nobr" created="201612181356" modifier="twee">&lt;&lt;set $enemyname to &quot;Lowly Assassin&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 3&gt;&gt;\n&lt;&lt;set $enemypower to 98&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme[&quot;NME_ninjawoman&quot;]&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 142&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 2&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 31&gt;&gt;\n&lt;&lt;set $nmedef to 30&gt;&gt;\n&lt;&lt;set $nmemov to 31&gt;&gt;\n&lt;&lt;set $nmemagic to 0&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 0&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 15&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.5&gt;&gt;\n&lt;&lt;set $nmespellpower to 0&gt;&gt;\n&lt;&lt;set $nmeacc to 90&gt;&gt;\n&lt;&lt;set $nmebaseregen to 3&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 4&gt;&gt;\n&lt;&lt;set $nmetype to 1&gt;&gt;\n\n&lt;&lt;set $nmexp to 20&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;</div><div tiddler="vowList" tags="init" created="201710061935" modifier="twee" twine-position="10,1270">/%\n   list of all vows, indexed by ID -- \n   the IDs are pushed into relevant story arrays \n%/\n&lt;&lt;set setup.vows.list to {\n\t'example' : {\n\t\tid : 'example',\n\t\ttitle : 'Example vow.',\n\t\tdescr : 'This is simply an example of a vow.',\n\t\toutc  : 'This is set in-story based on how it turned out.',\n\t\ttype  : 3\n\t},\n\t'protRip' : {\n\t\tid : 'protRip',\n\t\ttitle : 'Protect Ripley.',\n\t\tdescr : 'Elesun has sworn to protect the child of promise, Ripley, and keep her from harm.',\n\t\toutc  : '',\n\t\ttype  : 0\n\t},\n\t'serveKing' : {\n\t\tid : 'serveKing',\n\t\ttitle : 'Serve the king.',\n\t\tdescr : 'Elesun has sworn and oath to protect the king, his lands, his people, and his property.',\n\t\toutc  : '',\n\t\ttype  : 0\n\t}\n}&gt;&gt;</div><div tiddler="ch4journal" tags="" created="201612141430" modifier="twee"></div><div tiddler="0mainhall1throne" tags="dock" created="201701252352" modifier="twee">It's time to finish this.  Are you sure you're ready?\n\n&lt;&lt;ctrlClick &quot;Proceed.&quot; &quot;0protectking1&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="1HarlTalk" tags="talk" created="201707110028" modifier="twee">&lt;&lt;image &quot;HarlPtKid&quot;&gt;&gt;Elesun approaches Harlaus.\n\n&quot;Hello Elesun.&quot;\n\n&lt;&lt;dock &quot;Chit-chat.&quot; &quot;HarlChat1&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Ask about Ripley.&quot; &quot;1HarlRip&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;I must go.&quot; &quot;1HarlNVM&quot;&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n</div><div tiddler="1throne" tags="space" created="201701281953" modifier="twee">&lt;&lt;image &quot;KingSm&quot;&gt;&gt;The throne room's repairs are mostly complete; while the walls are still lined with cracks and &lt;&lt;weak 'the new stonework stands out against the old' '1throneStone'&gt;&gt;, the room is otherwise the same as it always was.\n\nThe &lt;&lt;action 'King sits on his throne' '1throneKing'&gt;&gt;.  No one else is around; unusual for this time of day.\n\nBehind Elesun, &lt;&lt;action 'the door to the main hall is open' '1throneDoor'&gt;&gt;.</div><div tiddler="1afterRip1" tags="scene" created="201701282003" modifier="twee">As the sun is setting, Elesun can see Merac in the distance, and the road winds ahead to meet it.  The horse spits blood, and pitches forward.  Elesun kicks her legs out and curls into a roll as the horse collapses.  It's breathing ragged.  It begins to whine.\n&lt;&lt;set $xpearned to $xpearned + 35&gt;&gt;\n[[Put the horse down.|1afterRip2][$mercyKill to 1]]\n\n[[There's no time!  Run to the town now.|1afterRip2][$mercyKill to 0]]</div><div tiddler="1afterRip2" tags="scene" created="201701282003" modifier="twee">&lt;&lt;if $mercyKill&gt;&gt;Elesun draws her sword and aims carefully, making sure to kill the horse in a single blow.\n\n&quot;Thank you,&quot; she says.  &quot;I'm sorry.&quot;\n\nElesun's blade strikes true, and the horse is still.\n\nShe turns back toward Merac and takes off running.&lt;&lt;else&gt;&gt;Elesun barely loses momentum coming out of her roll and continues running toward Merac.  She thanks the horse silently.  His pathetic breathing soon fades away as she leaves.&lt;&lt;endif&gt;&gt;\n\nElesun is steps from the town gates when she hears a whistle in the wind.  She crouches into a slide as an arrow parts the air where she would have been.  Atop a nearby hill she sees a man taking aim with another arrow.\n\nElesun draws her sword and charges up the hill.\n\n&lt;&lt;ctrlCon 'combat_call_1_2'&gt;&gt;</div><div tiddler="Aesil-phase-shift-4" tags="boss phase combat" created="201707261218" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Aesil stumbles back.\n\n&quot;No,&quot; he rasps.  &quot;This isn't...&quot; he turns to flee, but trips over himself.\n\n&lt;&lt;if $character is 'Elesun'&gt;&gt;Elesun throws her sword even as she feels her body collapsing; her muscles and bone are exposed across her body, pain fills her mind, darkness closes in on her vision.  Yet the sword strikes true, pinning Aesil to the ground--his blood runs over dead grass and leaves.&lt;&lt;else&gt;&gt;Ripley lunges at him, knocking him to the ground.  She stands over him.&lt;&lt;endif&gt;&gt;\n\n&quot;This is where you die,&quot; &lt;&lt;name&gt;&gt; says.\n\n[[Get Ready!|attack-bar]]\n&lt;&lt;set $nextBoss to 'Aes-boss-attack-3'&gt;&gt;</div><div tiddler="Aesil-phase-shift-3" tags="boss phase combat" created="201707261218" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Aesil is stumbling.  &quot;Can't lose...&quot; he says--a gaping hole in his chest causes his shrieks to come out as pathetic rasps.\n\n&lt;&lt;if $character is 'Elesun'&gt;&gt;Elesun isn't doing much better, though.  She can feel her skin practically dripping from her.\n\n&lt;&lt;endif&gt;&gt;&quot;Can't lose.  Won't lose.  Kill.&quot;  He rears back his head; bares his teeth, screams.  &quot;Won't lose won't lose.  Kill kill.&quot;  He throws himself at &lt;&lt;name&gt;&gt; in a desperate, ferocious final stand.\n\n[[Get Ready!|defend-bar]]\n&lt;&lt;set $nextBoss to 'Aes-boss-defend-3'&gt;&gt;\n&lt;&lt;set $defCon to 0&gt;&gt;&lt;&lt;set $defCount to 0&gt;&gt;</div><div tiddler="Aesil-phase-shift-2" tags="boss phase combat" created="201707261218" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Aesil's eyes are panicked, his breathing labored.  He's taken several wounds; each one should be fatal.  They're closing, healing.  But slower now.\n\n&lt;&lt;name&gt;&gt; grins.  &quot;You're afraid.  Why?  I told you: as many times as it takes.&quot;  She charges.\n\n&lt;&lt;if $character is 'Elesun'&gt;&gt;Even as she runs, blade raised and ready to strike, Elesun can feel the dark magic eating away at her body.  She's slower now, weaker.  Hopefully Aesil is, too...&lt;&lt;else&gt;&gt;The image keeps running through her mind--Elesun, pooled and puddled on the ground, a mix of blood and melted flesh, the smell of sick and rot, no longer recognizable.  Ripley feels it; the weight behind every punch and kick she throws.  The weight of her hate and rage.&lt;&lt;endif&gt;&gt;\n\n[[Get Ready!|attack-bar]]\n&lt;&lt;set $nextBoss to 'Aes-boss-attack-2'&gt;&gt;</div><div tiddler="Aesil-phase-shift-1" tags="boss phase combat" created="201707261218" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;name&gt;&gt; leaps forward and her blade strikes deep.  Aesil leaps back, but smiles.  The wound is already closing.\n\n&quot;I'll kill you as many times as it takes, you bastard,&quot; &lt;&lt;name&gt;&gt; says.  She raises her blade.\n\n&quot;Die!&quot; Aesil shrieks.  His eyes widen and he lets out an unsettling snarl.  &quot;You die!&quot;  He launches into a frenzied attack.\n\n&lt;&lt;message&gt;&gt;\s\nIn boss fights, the action will occasionally be broken up by descriptions and quick-time events.\n\nThere are two types of ''quick-time events'': ''defend events'' and ''attack events''.  During defend events, you will need to click on the block button with the proper timing.  A bar will appear on the screen, and when it turns white, you will have a split second to click it.  Doing so will allow you to avoid all damage, restore grit, or launch an attack event, depending on the encounter.  During attack events, a bar will also be placed on the screen.  Click on the attack button as many times as possible before the bar runs out to deal massive damage.\n\nThese quick-time events can allow you to kill enemies that are immensely more powerful than you.\s\n&lt;&lt;/message&gt;&gt;\n\n[[Get ready!|defend-bar]]\n&lt;&lt;set $nextBoss to 'Aes-boss-defend-1'&gt;&gt;</div><div tiddler="leath_ui" tags="" created="201702020424" modifier="twee">A suit of leather armor.  &lt;&lt;if $clothplus is 1&gt;&gt;Or so it seems.  Though this armor may not seem like much, it's been forged by the legendary blacksmiths of the Elysian realm, and should not be underestimated.&lt;&lt;endif&gt;&gt;\n\nLeather armor provides good defense without restricting movement too much, but leaves much to be desired against heavier attacks.\n\n|[img[setup.ui.icons.ui_def]]|Defense Bonus:|Low|\n|[img[setup.ui.icons.ui_mov]]|Encumberance:|Low|</div><div tiddler="wpn_comUI" tags="dock" created="201702020320" modifier="twee">&lt;&lt;display $weapon_ui&gt;&gt;</div><div tiddler="vow-title" tags="nobr" created="201710230747" modifier="twee" twine-position="430,1130">''Vows'' -- &lt;&lt;getstring true&gt;&gt;.</div><div tiddler="combatexplanation6menu" tags="menu" created="201704281529" modifier="twee">&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut6][combatexplanation7menu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;combatexplanation7menu&quot;&gt;&gt;</div><div tiddler="combat_test" tags="test menu" created="201701131707" modifier="twee" twine-position="1690,990">Select an enemy to fight:\n\n&lt;&lt;link &quot;Soldier of Fortune&quot;&gt;&gt;&lt;&lt;display &quot;rank3lvl5_soldier_akatosh&quot;&gt;&gt;&lt;&lt;goto &quot;combat_test_2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Wandering Knight&quot;&gt;&gt;&lt;&lt;display &quot;rank4lvl4_knight_akatosh&quot;&gt;&gt;&lt;&lt;goto &quot;combat_test_2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Lowly Assassin&quot;&gt;&gt;&lt;&lt;display &quot;rank3lvl3_assassin&quot;&gt;&gt;&lt;&lt;goto &quot;combat_test_2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Forest Witch&quot;&gt;&gt;&lt;&lt;display &quot;rank5lvl5_witch&quot;&gt;&gt;&lt;&lt;goto &quot;combat_test_2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n[[Cancel|debug_features]]</div><div tiddler="hookwidgets" tags="nobr widget" created="201707101329" modifier="twee" twine-position="150,990">&lt;&lt;widget 'tutorialHook'&gt;&gt;\n\t&lt;&lt;set _psg to $args[0]&gt;&gt;\n\t&lt;&lt;set _array to _psg.split('_')&gt;&gt;\n\t&lt;&lt;set _hk to _array[1]&gt;&gt;\n\t&lt;&lt;deleteHook _hk _psg&gt;&gt;\n\t&lt;&lt;addclass '#ui-dialog' 'fart'&gt;&gt;\n&lt;&lt;/widget&gt;&gt;</div><div tiddler="0choice2hate" tags="dock" created="201701250436" modifier="twee">If Elesun could only get her to use that anger as a motivation.  Ripley is too sweet, too soft.\n\nThere's a fine line, between caring too little and too much.  Elesun knows that she might care too little herself, but she also knows that Ripley cares way too much.</div><div tiddler="damagecalc_player" tags="nobr" created="201612160711" modifier="twee">/%calculates all player actions%/\n&lt;&lt;payload 'onEachAtk'&gt;&gt;\n&lt;&lt;if $firstAtk&gt;&gt;\n\t&lt;&lt;payload 'onFirstAtk'&gt;&gt;\n\t&lt;&lt;set $firstAtk to false&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $modifier to either(0.8,0.9,1.1,1.2)&gt;&gt;\n&lt;&lt;set $damagetoNME to 0&gt;&gt;\n&lt;&lt;if $movbonus gt 0&gt;&gt;\n\t&lt;&lt;set $booster to Math.trunc($mov*0.3+$movbonus)&gt;&gt;\n\t&lt;&lt;set $movbonus to 0&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $booster to 0&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $damagetoNME to Math.trunc(($atk*$modifier*$NMESpAtk)-($nmedef*0.5)+$booster)*$NMESpDam&gt;&gt;\n\n&lt;&lt;if $damagetoNME lt $atk*0.4&gt;&gt;\n\t&lt;&lt;if $nmedefboost is 1.5&gt;&gt;\n\t\t&lt;&lt;if $damagetoNME lt $atk*0.2&gt;&gt;\n\t\t\t&lt;&lt;if $devilForm is 0 and $formUnlock gte 1&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoNME to Math.trunc($atk*0.2)&gt;&gt;\n\t\t\t&lt;&lt;set $rage to Math.trunc($rageBuild*0.3)&gt;&gt;\n\t\t\t&lt;&lt;set $rageCurrent to $rageCurrent + $rage&gt;&gt;\n\t\t\t&lt;&lt;if $rageCurrent gt 200&gt;&gt;\n\t\t\t\t&lt;&lt;set $rageCurrent to 200&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;else&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoNME to Math.trunc($damagetoNME)&gt;&gt;\n\t\t\t&lt;&lt;if $devilForm is 0 and $formUnlock gte 1&gt;&gt;\n\t\t\t&lt;&lt;set $rage to Math.trunc($rageBuild*0.3)&gt;&gt;\n\t\t\t&lt;&lt;set $rageCurrent to $rageCurrent + $rage&gt;&gt;\n\t\t\t&lt;&lt;if $rageCurrent gt 200&gt;&gt;\n\t\t\t\t&lt;&lt;set $rageCurrent to 200&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $damagetoNME to Math.trunc($atk*0.4)&gt;&gt;\n\t\t&lt;&lt;if $devilForm is 0 and $formUnlock gte 1&gt;&gt;\n\t\t&lt;&lt;set $rage to Math.trunc($rageBuild*0.3)&gt;&gt;\n\t\t&lt;&lt;set $rageCurrent to $rageCurrent + $rage&gt;&gt;\n\t\t\t&lt;&lt;if $rageCurrent gt 200&gt;&gt;\n\t\t\t\t&lt;&lt;set $rageCurrent to 200&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="0letRipfight" tags="scene" created="201701110819" modifier="twee">&lt;&lt;set $xpearned to $xpearned + 25&gt;&gt;As Elesun predicts, Ripley doesn’t need any help.&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;\n\nThe assassin moves in with a slash, and almost before his arm moves, Ripley slips out of the way and delivers a devastating punch.  She wasn’t quite fast enough, though, and she receives a nick on her forearm.  She’s alive though, so the blade probably wasn’t poisoned.\n&lt;&lt;set $ripFight to 1&gt;&gt;\n“Good work,” Elesun says.\n\nRipley turns around, surprised.  “Oh, hey Elesun.”\n\n“Are you alright?”\n\n“I’m fine.”\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0meetupwithRip&quot;&gt;&gt;</div><div tiddler="helpmenu" tags="menu" created="201612152051" modifier="twee">*&lt;&lt;link &quot;About the Information Dock&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nThe information dock appears at the bottom of the screen in in any part of the game where it is used.  You can double click the dock to collapse it, or press the spacebar to reset it.\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;Different Types of Links&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nThere are two general types of links in the game.  Links that appear throughout text descriptions update the information dock with more detailed information when clicked.  Links that appear set apart at the bottom of some text, or within the information dock itself, usually perform some sort of action, make a decision, or cause the scene to change.\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;The Menu&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nThe frame on the left side of the screen contains various menu options that can be accessed at almost any part of the story.  You can collapse the menu frame by clicking the arrow on the top right of the frame.\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;Scenes and Spaces&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nThe story is primarily divided into scenes and spaces.  The spaces are areas where you are free to click around and explore.  Scenes are chunks of story that are followed by a &quot;continue&quot; link or a decision.  Scenes usually contain very important information that will be critical in making educated decisions later.\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;Decisions&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nMajor story decisions usually occur during scenes or conversations.  Other decisions, like who to talk to and where to go in spaces usually don't have a lasting impact on the story.\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;A Note on Roleplaying&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nWhile you control &lt;&lt;print $character&gt;&gt;, keep in mind that she is a distinct character in the world as well, with her own strengths, weaknesses, goals, and fears.  When you make decisions and impact the story, you are not so much controlling her as you are stepping into a role.  In other words, while you can tell &lt;&lt;print $character&gt;&gt; what to do, you can't really tell her how to feel or think.\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;Combat&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nWould you like to review the combat reference?  &lt;&lt;link [[Yes|combatexplanationmenu]]&gt;&gt;&lt;&lt;run Dialog.close()&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;Status Effects Reference&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;\n\nWould you view the status effect reference?  &lt;&lt;link [[Yes|status_effects_help]]&gt;&gt;&lt;&lt;run Dialog.close()&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\n*&lt;&lt;link &quot;Keyboard Shortcuts&quot;&gt;&gt;&lt;&lt;goto &quot;kb_controls&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n/%[[View the Online Guide.|https://holylanddev.files.wordpress.com/2017/01/readme1.pdf]]%/\n\n[[Return to the Journal|journalmenu]]\n\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="numberpool" tags="script" created="201702242336" modifier="twee" twine-position="570,290">/*! &lt;&lt;numberpool&gt;&gt; macro set for SugarCube 2.x */\n!function(){&quot;use strict&quot;;if(&quot;undefined&quot;==typeof version||&quot;undefined&quot;==typeof version.title||&quot;SugarCube&quot;!==version.title||&quot;undefined&quot;==typeof version.major||version.major&lt;2||&quot;undefined&quot;==typeof version.minor||version.minor&lt;5)throw new Error(&quot;&lt;&lt;numberpool&gt;&gt; macro set requires SugarCube 2.5.0 or greater, aborting load&quot;);Macro.add(&quot;numberbox&quot;,{handler:function(){function validateAndApply(el,addend){var curValue=Math.trunc(Wikifier.getValue(varName)),newValue=Math.trunc(el.value),newPoolValue=null;if(isNaN(newValue)||!isFinite(newValue))return el.value=curValue,!1;if(null!=addend&amp;&amp;(newValue+=addend),minValue&gt;newValue?newValue=minValue:newValue&gt;maxValue&amp;&amp;(newValue=maxValue),null!==pool){var poolValue=pool.get(),delta=(newValue-curValue)*poolCost;0&gt;delta?newPoolValue=poolValue-delta:delta&gt;0&amp;&amp;poolValue&gt;=poolCost?(delta&gt;poolValue&amp;&amp;(newValue=curValue+Math.trunc(poolValue/poolCost),delta=poolValue-poolValue%poolCost),newPoolValue=poolValue-delta):newValue=curValue}return Wikifier.setValue(varName,newValue),el.value=newValue,null!==newPoolValue&amp;&amp;pool.set(newPoolValue),!0}var _this=this;if(this.args.length&lt;4){var errors=[];return this.args.length&lt;1&amp;&amp;errors.push(&quot;story variable name&quot;),this.args.length&lt;2&amp;&amp;errors.push(&quot;default value&quot;),this.args.length&lt;3&amp;&amp;errors.push(&quot;min value&quot;),this.args.length&lt;4&amp;&amp;errors.push(&quot;max value&quot;),this.error(&quot;no &quot;+errors.join(&quot; or &quot;)+&quot; specified&quot;)}if(&quot;string&quot;!=typeof this.args[0]||&quot;$&quot;!==this.args[0].trim()[0])return this.error('story variable name &quot;'+this.args[0]+'&quot; is missing its sigil ($)');var varName=this.args[0].trim(),varId=Util.slugify(varName),defValue=Number(this.args[1]),minValue=Number(this.args[2]),maxValue=Number(this.args[3]),poolCost=1,autofocus=!1;if(this.args.length&gt;5?(poolCost=Number(this.args[4]),autofocus=&quot;autofocus&quot;===this.args[5]):this.args.length&gt;4&amp;&amp;(&quot;autofocus&quot;===this.args[4]?autofocus=!0:poolCost=Number(this.args[4])),isNaN(defValue)||!isFinite(defValue)||Math.trunc(defValue)!==defValue)return this.error(&quot;default value (&quot;+this.args[1]+&quot;) is not a whole number&quot;);if(isNaN(minValue)||!isFinite(minValue)||Math.trunc(minValue)!==minValue)return this.error(&quot;min value (&quot;+this.args[2]+&quot;) is not a whole number&quot;);if(isNaN(maxValue)||!isFinite(maxValue)||Math.trunc(maxValue)!==maxValue)return this.error(&quot;max value (&quot;+this.args[3]+&quot;) is not a whole number&quot;);if(isNaN(poolCost)||!isFinite(poolCost)||Math.trunc(poolCost)!==poolCost||0&gt;=poolCost)return this.error(&quot;pool cost (&quot;+this.args[4]+&quot;) is not a whole number greater than zero&quot;);if(minValue&gt;defValue)return this.error(&quot;default value (&quot;+this.args[1]+&quot;) is less than min value (&quot;+this.args[2]+&quot;)&quot;);if(defValue&gt;maxValue)return this.error(&quot;default value (&quot;+this.args[1]+&quot;) is greater than max value (&quot;+this.args[3]+&quot;)&quot;);var pool=function(){var parent=_this.contextSelect(function(c){return&quot;numberpool&quot;===c.name});return null!==parent&amp;&amp;parent.hasOwnProperty(&quot;pool&quot;)?parent.pool:null}();Config.debug&amp;&amp;this.debugView.modes({block:!0});var $elControl=jQuery(document.createElement(&quot;div&quot;)),$elInput=jQuery(document.createElement(&quot;input&quot;));$elControl.attr(&quot;id&quot;,this.name+&quot;-body-&quot;+varId).addClass(&quot;macro-&quot;+this.name).appendTo(this.output),jQuery(document.createElement(&quot;button&quot;)).attr({id:this.name+&quot;-minus-&quot;+varId,tabindex:0}).text(&quot;&quot;).on(&quot;click&quot;,function(){return validateAndApply($elInput[0],-1)}).appendTo($elControl),$elInput.attr({id:this.name+&quot;-input-&quot;+varId,name:this.name+&quot;-input-&quot;+varId,type:&quot;text&quot;,pattern:&quot;\s\sd+&quot;,tabindex:0}).on(&quot;change&quot;,function(){validateAndApply(this)}).on(&quot;keypress&quot;,function(evt){13===evt.which&amp;&amp;(evt.preventDefault(),$elInput.trigger(&quot;change&quot;))}).appendTo($elControl),jQuery(document.createElement(&quot;button&quot;)).attr({id:this.name+&quot;-plus-&quot;+varId,tabindex:0}).text(&quot;&quot;).on(&quot;click&quot;,function(){return validateAndApply($elInput[0],1)}).appendTo($elControl),$elInput.val(defValue),validateAndApply($elInput[0]),autofocus&amp;&amp;($elInput.attr(&quot;autofocus&quot;,&quot;autofocus&quot;),postdisplay[&quot;#autofocus:&quot;+$elInput.attr(&quot;id&quot;)]=function(task){setTimeout(function(){return $elInput.focus()},Engine.minDomActionDelay),delete postdisplay[task]})}}),Macro.add(&quot;numberpool&quot;,{tags:[&quot;onchange&quot;],handler:function(){if(0===this.args.length)return this.error(&quot;no variable name specified&quot;);if(this.payload.length&gt;2)return this.error(&quot;multiple &lt;&lt;onchange&gt;&gt; sections specified&quot;);if(&quot;string&quot;!=typeof this.args[0]||!/^[$_]/.test(this.args[0].trim()))return this.error('variable name &quot;'+this.args[0]+'&quot; is missing its sigil ($ or _)');var varName=this.args[0].trim(),varId=Util.slugify(varName);TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),Object.defineProperty(this,&quot;pool&quot;,{value:Object.defineProperties({},{get:{value:function(){return Wikifier.getValue(varName)}},set:{value:function(content){return function(value){var curValue=Wikifier.getValue(varName);value!==curValue&amp;&amp;(Wikifier.setValue(varName,value),content&amp;&amp;Wikifier.wikifyEval(content))}}(this.payload.length&gt;1?this.payload[1].contents.trim():&quot;&quot;)}})}),jQuery(document.createElement(&quot;div&quot;)).attr(&quot;id&quot;,this.name+&quot;-&quot;+varId+&quot;-&quot;+TempState[this.name][varId]++).addClass(&quot;macro-&quot;+this.name).wiki(this.payload[0].contents.replace(/^\sn/,&quot;&quot;)).appendTo(this.output)}}),Macro.add(&quot;numberslider&quot;,{handler:function(){function stepValidate(value){if(fracDigits&gt;0){var ma=Number(minValue+&quot;e&quot;+fracDigits),sa=Number(stepValue+&quot;e&quot;+fracDigits),va=Number(value+&quot;e&quot;+fracDigits)-ma;return Number(va-va%sa+ma+&quot;e-&quot;+fracDigits)}var _va=value-minValue;return _va-_va%stepValue+minValue}function validateAndApply(el){var curValue=Wikifier.getValue(varName),newValue=Number(el.value),newPoolValue=null;if(isNaN(newValue)||!isFinite(newValue))return el.value=curValue,!1;if(newValue=stepValidate(newValue),minValue&gt;newValue?newValue=minValue:newValue&gt;maxValue&amp;&amp;(newValue=maxValue),null!==pool)if(fracDigits&gt;0){var pa=Number(pool.get()+&quot;e&quot;+fracDigits),ca=Number(curValue+&quot;e&quot;+fracDigits),na=Number(newValue+&quot;e&quot;+fracDigits),delta=na-ca;delta&gt;pa&amp;&amp;(na-=delta-pa,delta=na-ca,newValue=Number(na+&quot;e-&quot;+fracDigits)),newPoolValue=Number(pa-delta+&quot;e-&quot;+fracDigits)}else{var poolValue=pool.get(),_delta=newValue-curValue;_delta&gt;poolValue&amp;&amp;(newValue-=_delta-poolValue,_delta=newValue-curValue),newPoolValue=poolValue-_delta}return Wikifier.setValue(varName,newValue),el.value=newValue,null!==newPoolValue&amp;&amp;pool.set(newPoolValue),!0}var _this2=this;if(this.args.length&lt;5){var errors=[];return this.args.length&lt;1&amp;&amp;errors.push(&quot;story variable name&quot;),this.args.length&lt;2&amp;&amp;errors.push(&quot;default value&quot;),this.args.length&lt;3&amp;&amp;errors.push(&quot;min value&quot;),this.args.length&lt;4&amp;&amp;errors.push(&quot;max value&quot;),this.args.length&lt;5&amp;&amp;errors.push(&quot;step value&quot;),this.error(&quot;no &quot;+errors.join(&quot; or &quot;)+&quot; specified&quot;)}if(&quot;string&quot;!=typeof this.args[0]||&quot;$&quot;!==this.args[0].trim()[0])return this.error('story variable name &quot;'+this.args[0]+'&quot; is missing its sigil ($)');var varName=this.args[0].trim(),varId=Util.slugify(varName),defValue=Number(this.args[1]),minValue=Number(this.args[2]),maxValue=Number(this.args[3]),stepValue=Number(this.args[4]),autofocus=this.args.length&gt;5&amp;&amp;&quot;autofocus&quot;===this.args[5];if(isNaN(defValue)||!isFinite(defValue))return this.error(&quot;default value (&quot;+this.args[1]+&quot;) is not a number&quot;);if(isNaN(minValue)||!isFinite(minValue))return this.error(&quot;min value (&quot;+this.args[2]+&quot;) is not a number&quot;);if(isNaN(maxValue)||!isFinite(maxValue))return this.error(&quot;max value (&quot;+this.args[3]+&quot;) is not a number&quot;);if(isNaN(stepValue)||!isFinite(stepValue)||0&gt;=stepValue)return this.error(&quot;step value (&quot;+this.args[4]+&quot;) is not a number greater than zero&quot;);if(minValue&gt;defValue)return this.error(&quot;default value (&quot;+this.args[1]+&quot;) is less than min value (&quot;+this.args[2]+&quot;)&quot;);if(defValue&gt;maxValue)return this.error(&quot;default value (&quot;+this.args[1]+&quot;) is greater than max value (&quot;+this.args[3]+&quot;)&quot;);var fracDigits=function(){var str=String(stepValue),pos=str.lastIndexOf(&quot;.&quot;);return-1===pos?0:str.length-pos-1}();if(stepValidate(maxValue)!==maxValue)return this.error(&quot;max value (&quot;+this.args[3]+&quot;) is not a multiple of the&quot;+(&quot; step value (&quot;+this.args[4]+&quot;) plus the min value (&quot;+this.args[2]+&quot;)&quot;));var pool=function(){var parent=_this2.contextSelect(function(c){return&quot;numberpool&quot;===c.name});return null!==parent&amp;&amp;parent.hasOwnProperty(&quot;pool&quot;)?parent.pool:null}();Config.debug&amp;&amp;this.debugView.modes({block:!0});var $elControl=jQuery(document.createElement(&quot;div&quot;)),$elInput=jQuery(document.createElement(&quot;input&quot;)),$elValue=void 0,showValue=void 0;$elControl.attr(&quot;id&quot;,this.name+&quot;-body-&quot;+varId).addClass(&quot;macro-&quot;+this.name).appendTo(this.output),$elInput.attr({id:this.name+&quot;-input-&quot;+varId,name:this.name+&quot;-input-&quot;+varId,type:&quot;range&quot;,min:minValue,max:maxValue,step:stepValue,tabindex:0}).on(&quot;change&quot;,function(){validateAndApply(this),&quot;function&quot;==typeof showValue&amp;&amp;showValue()}).on(&quot;input.&quot;+Util.slugify(this.name),function(){&quot;function&quot;==typeof showValue&amp;&amp;showValue()}).on(&quot;keypress&quot;,function(evt){13===evt.which&amp;&amp;(evt.preventDefault(),$elInput.trigger(&quot;change&quot;))}).appendTo($elControl),!Browser.isIE||Browser.ieVersion&gt;9?($elValue=jQuery(document.createElement(&quot;span&quot;)),$elValue.attr(&quot;id&quot;,this.name+&quot;-value-&quot;+varId).appendTo($elControl),showValue=function(){$elValue.text(Number($elInput.val()).toFixed(fracDigits))}):$elInput.off(&quot;input.&quot;+Util.slugify(this.name)),$elInput.val(defValue),validateAndApply($elInput[0]),&quot;function&quot;==typeof showValue&amp;&amp;showValue(),autofocus&amp;&amp;($elInput.attr(&quot;autofocus&quot;,&quot;autofocus&quot;),postdisplay[&quot;#autofocus:&quot;+$elInput.attr(&quot;id&quot;)]=function(task){setTimeout(function(){return $elInput.focus()},Engine.minDomActionDelay),delete postdisplay[task]})}})}();\n</div><div tiddler="1mainHarl" tags="dock" created="201707110037" modifier="twee">Harlaus seems to notice Elesun and nods to her.\n\n&lt;&lt;if !$HarlScene&gt;&gt;\s\n\t&lt;&lt;ctrlClick 'See what he wants.' '1HarlScene'&gt;&gt;\s\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;ctrlClick 'Speak to him.' '1HarlTalk'&gt;&gt;\s\n&lt;&lt;endif&gt;&gt;</div><div tiddler="event_controls" tags="script" created="201702092339" modifier="twee" twine-position="710,430">!function(){$(document).on(&quot;dblclick&quot;,&quot;#info&quot;,function(){$(&quot;#info&quot;).empty()}),$(document).keyup(function(e){32!=e.keyCode||e.shiftKey||1!=State.variables.gamestart||(&quot;Elesun&quot;==State.variables.character?($(&quot;#info&quot;).empty(),$('&lt;center&gt;&lt;img src=&quot;assets/img/EleCl.jpg&quot;&gt;&lt;/center&gt;').appendTo(&quot;#info&quot;)):($(&quot;#info&quot;).empty(),$('&lt;center&gt;&lt;img src=&quot;assets/img/RipCl.jpg&quot;&gt;&lt;/center&gt;').appendTo(&quot;#info&quot;)))})}(),function(){$(document).keyup(function(e){77==e.keyCode&amp;&amp;$(&quot;#mutebutton a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){68==e.keyCode&amp;&amp;1==State.variables.infopop&amp;&amp;$(&quot;#dismiss button&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){70==e.keyCode&amp;&amp;$(&quot;#fscreenbutton button&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){27==e.keyCode&amp;&amp;2==State.variables.gamestart&amp;&amp;(State.variables.gamestart=1,$(&quot;#return a&quot;).trigger(&quot;click&quot;))})}(),function(){$(document).keyup(function(e){81==e.keyCode&amp;&amp;2==State.variables.gamestart&amp;&amp;(State.variables.gamestart=1,$(&quot;#return a&quot;).trigger(&quot;click&quot;))})}(),function(){$(document).keyup(function(e){49==e.keyCode&amp;&amp;$(&quot;#atkOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){50==e.keyCode&amp;&amp;$(&quot;#defOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){51==e.keyCode&amp;&amp;$(&quot;#movOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){97==e.keyCode&amp;&amp;$(&quot;#atkOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){98==e.keyCode&amp;&amp;$(&quot;#defOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){99==e.keyCode&amp;&amp;$(&quot;#movOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){52==e.keyCode&amp;&amp;$(&quot;#endOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){100==e.keyCode&amp;&amp;$(&quot;#endOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){110==e.keyCode&amp;&amp;$(&quot;#endOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){17==e.keyCode&amp;&amp;$(&quot;#endOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){32==e.keyCode&amp;&amp;$(&quot;#trsOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){17==e.keyCode&amp;&amp;$(&quot;#conOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){96==e.keyCode&amp;&amp;$(&quot;#conOpt a&quot;).trigger(&quot;click&quot;)})}(),function(){$(document).keyup(function(e){32==e.keyCode&amp;&amp;e.shiftKey&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;charmenu&quot;))})}(),function(){$(document).keyup(function(e){192==e.keyCode&amp;&amp;e.shiftKey&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;debug_mode_activation&quot;))})}(),function(){$(document).keyup(function(e){67==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;charmenu&quot;))})}(),function(){$(document).keyup(function(e){69==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;equipmenu&quot;))})}(),function(){$(document).keyup(function(e){65==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;armorswap&quot;))})}(),function(){$(document).keyup(function(e){83!=e.keyCode||e.shiftKey||1!=State.variables.gamestart||(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;spellswap&quot;))})}(),function(){$(document).keyup(function(e){83==e.keyCode&amp;&amp;e.shiftKey&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;player_settings&quot;))})}(),function(){$(document).keyup(function(e){87==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;weaponswap&quot;))})}(),function(){$(document).keyup(function(e){74==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;journalmenu&quot;))})}(),function(){$(document).keyup(function(e){9!=e.keyCode||e.shiftKey||1!=State.variables.gamestart||(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;journalmenu&quot;))})}(),function(){$(document).keyup(function(e){9==e.keyCode&amp;&amp;e.shiftKey&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;codex_menu&quot;))})}(),function(){$(document).keyup(function(e){88==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;player_settings&quot;))})}(),function(){$(document).keyup(function(e){90==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;codex_menu&quot;))})}(),function(){$(document).keyup(function(e){72==e.keyCode&amp;&amp;1==State.variables.gamestart&amp;&amp;(State.variables[&quot;return&quot;]=passage(),State.variables.gamestart=2,State.display(&quot;helpmenu&quot;))})}(),function(){$(document).keyup(function(e){17==e.keyCode&amp;&amp;($(&quot;#ctrlClick a&quot;).trigger(&quot;click&quot;),$(&quot;#ctrlClick button&quot;).trigger(&quot;click&quot;))})}(),function(){$(document).keyup(function(e){96==e.keyCode&amp;&amp;($(&quot;#ctrlClick a&quot;).trigger(&quot;click&quot;),$(&quot;#ctrlClick button&quot;).trigger(&quot;click&quot;))})}(),function(){$(document).keyup(function(e){13==e.keyCode&amp;&amp;($(&quot;#ctrlClick a&quot;).trigger(&quot;click&quot;),$(&quot;#ctrlClick button&quot;).trigger(&quot;click&quot;))})}(),function(){$(document).keyup(function(e){(49==e.keyCode||97==e.keyCode)&amp;&amp;($(&quot;#oneAct a&quot;).trigger(&quot;click&quot;),$(&quot;#oneAct button&quot;).trigger(&quot;click&quot;)),(50==e.keyCode||98==e.keyCode)&amp;&amp;($(&quot;#twoAct a&quot;).trigger(&quot;click&quot;),$(&quot;#twoAct button&quot;).trigger(&quot;click&quot;)),(51==e.keyCode||99==e.keyCode)&amp;&amp;($(&quot;#threeAct a&quot;).trigger(&quot;click&quot;),$(&quot;#threeAct button&quot;).trigger(&quot;click&quot;)),(52==e.keyCode||100==e.keyCode)&amp;&amp;($(&quot;#fourAct a&quot;).trigger(&quot;click&quot;),$(&quot;#fourAct button&quot;).trigger(&quot;click&quot;)),(53==e.keyCode||101==e.keyCode)&amp;&amp;($(&quot;#fiveAct a&quot;).trigger(&quot;click&quot;),$(&quot;#fiveAct button&quot;).trigger(&quot;click&quot;)),(54==e.keyCode||102==e.keyCode)&amp;&amp;($(&quot;#sixAct a&quot;).trigger(&quot;click&quot;),$(&quot;#sixAct button&quot;).trigger(&quot;click&quot;)),(55==e.keyCode||103==e.keyCode)&amp;&amp;($(&quot;#sevenAct a&quot;).trigger(&quot;click&quot;),$(&quot;#sevenAct button&quot;).trigger(&quot;click&quot;)),(56==e.keyCode||104==e.keyCode)&amp;&amp;($(&quot;#eightAct a&quot;).trigger(&quot;click&quot;),$(&quot;#eightAct button&quot;).trigger(&quot;click&quot;)),(57==e.keyCode||105==e.keyCode)&amp;&amp;($(&quot;#nineAct a&quot;).trigger(&quot;click&quot;),$(&quot;#nineAct button&quot;).trigger(&quot;click&quot;)),(48==e.keyCode||96==e.keyCode)&amp;&amp;($(&quot;#zeroAct a&quot;).trigger(&quot;click&quot;),$(&quot;#zeroAct button&quot;).trigger(&quot;click&quot;))})}();\n!function(){$(document).on(&quot;dblclick&quot;,&quot;#ui-bar&quot;,function(){$(&quot;#ui-bar&quot;).toggleClass(&quot;stowed&quot;)});}();\n$(document).on('keyup', function (e) {\n  if ((e.which === 81 || e.which === 27 || e.which === 68) &amp;&amp; Dialog.isOpen()) {\n    Dialog.close();\n  }\n});</div><div tiddler="StorySettings" tags="" created="201612122021" modifier="twee" twine-position="850,10">jquery:on\nhash:off\nbookmark:on\nmodernizr:off\nundo:off\nobfuscate:off\nexitprompt:on\nblankcss:off\n</div><div tiddler="1baileyIre" tags="dock" created="201702121044" modifier="twee">Irelith is bad at looking busy.\n\nShould Elesun go bother her?\n\n&lt;&lt;ctrlClick &quot;Absolutely.&quot; &quot;1IreTalk&quot;&gt;&gt;</div><div tiddler="health_checker" tags="nobr" created="201612160713" modifier="twee">&lt;&lt;if $health lte 0&gt;&gt;\n\t&lt;&lt;set $playerturn to 0&gt;&gt;&lt;&lt;set $combatnext to &quot;gameover&quot;&gt;&gt;\n\t&lt;&lt;audio &quot;:playing&quot; fadeout&gt;&gt;\n\t&lt;&lt;set $SpEffEnd to -1&gt;&gt;\n\t&lt;&lt;set $specialOn to 0&gt;&gt;\n\t&lt;&lt;set $NMESpMov to 1.0&gt;&gt;\n\t&lt;&lt;set $NMESpDef to 1.0&gt;&gt;\n\t&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;\n\t&lt;&lt;set $NMESpDam to 1.0&gt;&gt;\n\t&lt;&lt;set $NMEStaUse to 0&gt;&gt;\n\t&lt;&lt;set $NMEStaLmt to 0&gt;&gt;\n\t&lt;&lt;set $SpEffDisplay to &quot;&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmehealth lte 0&gt;&gt;\n\t&lt;&lt;set $playerturn to 0&gt;&gt;&lt;&lt;set $combatnext to &quot;combat_end&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="Unarmed" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;fists_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;unarm&quot;]]\n[[No|weaponswap]]</div><div tiddler="ch5journal" tags="" created="201612141430" modifier="twee"></div><div tiddler="1IreTrainerPre" tags="dock" created="201702121037" modifier="twee">&quot;Sure, I could use some practice.&quot;\n\n&lt;&lt;ctrlClick &quot;Let's do it, then.&quot; &quot;1IreTrainer&quot;&gt;&gt;</div><div tiddler="arm_comUI" tags="dock" created="201702020320" modifier="twee">&lt;&lt;display $armor_ui&gt;&gt;</div><div tiddler="vol_settings" tags="nobr deprecated" created="201704231405" modifier="twee">&lt;span id=&quot;volMaker&quot;&gt;&lt;/span&gt;\n&lt;&lt;script&gt;&gt;\npostdisplay['volume-control'] = function (taskName) {\n  delete postdisplay[taskName];\n    $('#volMaker').append('&lt;input type=&quot;range&quot; name=&quot;volume&quot; min=&quot;0&quot; max=&quot;10&quot; step=&quot;1&quot; value=&quot;' + State.variables.vol + '&quot; oninput=&quot;volumeSlider();&quot; /&gt;');\n};\n&lt;&lt;/script&gt;&gt;\n\n\n/% old stuff\n  //$(document).ready(function(){\n&lt;input type=&quot;range&quot; name=&quot;volume&quot; min=&quot;0&quot; max=&quot;10&quot; step=&quot;1&quot; oninput=&quot;volumeSlider();&quot; /&gt;\n\n&lt;&lt;script&gt;&gt;\n!function(){\n  $(document).ready(function(){\n    $('#volMaker').append('&lt;input type=&quot;range&quot; name=&quot;volume&quot; min=&quot;0&quot; max=&quot;10&quot; step=&quot;1&quot; value=&quot;' + State.variables.vol + '&quot; oninput=&quot;volumeSlider();&quot; /&gt;');\n   });\n}();\n&lt;&lt;/script&gt;&gt;%/</div><div tiddler="title_onDespAtk_GraciousHost" tags="hook title" created="201707101733" modifier="twee">&lt;&lt;if $titles.has('Gracious Host')&gt;&gt;\n\t&lt;&lt;if $health lt $maxhealth&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 20&gt;&gt;\n\t\t\t&lt;&lt;set $health++&gt;&gt;\n\t\t\t&lt;&lt;if $health gte $maxhealth&gt;&gt;\n\t\t\t\t&lt;&lt;set $health to $maxhealth&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="Cloth Armor" tags="menu" created="201612131636" modifier="twee">&lt;&lt;display &quot;cloth_ui&quot;&gt;&gt;\nEquip this armor?\n\n[[Yes|changearmor][$change to &quot;cloth&quot;]]\n[[No|armorswap]]</div><div tiddler="0throneroomDoor" tags="dock" created="201701260221" modifier="twee">Go see Ripley?\n\n&lt;&lt;ctrlClick &quot;Go on.&quot; &quot;0choice3&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="0throneroomIre" tags="dock" created="201701260222" modifier="twee">Irelith is sleeping.  Elesun doesn't want to disturb her.</div><div tiddler="Leather Armor" tags="menu" created="201612131636" modifier="twee">&lt;&lt;display &quot;leath_ui&quot;&gt;&gt;\nEquip this armor?\n\n[[Yes|changearmor][$change to &quot;leath&quot;]]\n[[No|armorswap]]</div><div tiddler="bugcode-js" tags="script" created="201708261444" modifier="twee" twine-position="10,1130">setup.encode = function (obj) {\n\tvar encoded;\n\t\n\tif (!obj) {\n\t\tobj = State.variables;\n\t}\n\t\n\ttry {\n\t\tencoded = JSON.stringify(obj);\n\t\tencoded = btoa(encoded);\n\t} catch (e) {\n\t\tencoded = JSON.stringify(e);\n\t\tencoded = btoa(encoded);\n\t} finally {\n\t\treturn encoded;\n\t}\n};\n\nsetup.decode = function (bugcode) {\n\tvar decoded;\n\n\tdecoded = atob(bugcode);\n\tdecoded = JSON.parse(decoded);\n\t\n\treturn decoded;\n};</div><div tiddler="spell_healing" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Healing&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Light&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Healing&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;heal_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 0.9&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 10&gt;&gt;\n&lt;&lt;set $spellhealing to 50&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $lighttraining is 1&gt;&gt;\n\t&lt;&lt;set $spellhealing to 60&gt;&gt;\n&lt;&lt;elseif $lighttraining is 2&gt;&gt;\n\t&lt;&lt;set $spellregen to 20&gt;&gt;\n\t&lt;&lt;set $spellhealing to 60&gt;&gt;\n&lt;&lt;elseif $lighttraining is 3&gt;&gt;\n\t&lt;&lt;set $satk to 1.0&gt;&gt;\n\t&lt;&lt;set $spellregen to 20&gt;&gt;\n\t&lt;&lt;set $spellhealing to 60&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="title2" tags="menu" created="201702120649" modifier="twee">\t\t&lt;&lt;timed 1s t8n&gt;&gt;\n''Written, programmed, and designed by:''&lt;&lt;next 1s t8n&gt;&gt; ChapelR\n\t\t\t&lt;&lt;next 1s t8n&gt;&gt;\n''Voice actress:'' &lt;&lt;next 1s t8n&gt;&gt; [[Ashley Eddy|https://freesound.org/people/11linda/]]\n\t\t\t&lt;&lt;next 1s t8n&gt;&gt;\n''Music:'' &lt;&lt;next 1s t8n&gt;&gt;[[Shady Dave|https://soundcloud.com/shady-dave-2/tracks]] [[Eric Hopton|https://erichopton.bandcamp.com/]] [[Goran Andrić|https://soundcloud.com/zagi2]] [[Frankumjay|https://soundcloud.com/frankumjay]]\n\t\t\t&lt;&lt;next 1s t8n&gt;&gt;\n''Sound:'' &lt;&lt;next 1s t8n&gt;&gt;[[Bertof Sound|https://freesound.org/people/Bertrof/]] [[Abyssmal|https://freesound.org/people/Abyssmal/]] [[Joel Azzopardi|https://freesound.org/people/JoelAudio/]]\n\t\t\t&lt;&lt;next 1s t8n&gt;&gt;\n''Art and Icons:'' &lt;&lt;next 1s t8n&gt;&gt;[[Roman Alkan|http://www.rinmarugames.com/]] [[/u/Lorc|https://www.reddit.com/r/IndieGaming/comments/ifmie/i_made_700_rpg_icons_free_for_use_for_your_game/]]\n\t\t\t&lt;&lt;next 1s t8n&gt;&gt;\n''Resources:'' &lt;&lt;next 1s t8n&gt;&gt;[[Twine by Chris Klimas|https://twinery.org/]] [[Sugarcube by Thomas Michael Edwards|http://www.motoslave.net/sugarcube/]]\n[[Chromium|https://www.chromium.org/Home]] [[Node.js|https://nodejs.org/en/]] [[NW.js|https://nwjs.io/]] [[NW-Builder|https://github.com/nwjs/nw-builder]] [[Inno Setup|http://www.jrsoftware.org/isinfo.php]]\n\t\t&lt;&lt;/timed&gt;&gt;\n&lt;&lt;timed 15s&gt;&gt;&lt;&lt;goto &quot;title3&quot;&gt;&gt;\n&lt;&lt;/timed&gt;&gt;&lt;span id=&quot;ctrlClick&quot;&gt;@@display: none;[[skip|title3]]@@&lt;/span&gt;</div><div tiddler="title3" tags="menu" created="201702120650" modifier="twee">\n&lt;center&gt;\n&lt;div class=&quot;text-fade-in&quot;&gt;\n!!Make no vows.\n&lt;/div&gt;&lt;&lt;timed 2s t8n&gt;&gt;\n&lt;&lt;ctrlClick &quot;Continue&quot; &quot;ch1intro&quot;&gt;&gt;\n&lt;&lt;/timed&gt;&gt;&lt;/center&gt;</div><div tiddler="1dcSurvivors" tags="dock" created="201708282019" modifier="twee">Aesil didn't tend to leave survivors.  Still, they needed to be sure, if only so they could give mercy to the suffering ones he didn't quite finish.</div><div tiddler="initHooksAndTitles" tags="init nobr" created="201707101443" modifier="twee" twine-position="290,990">/% tutorial hooks -- place by default %/\n&lt;&lt;set setup.comTut to true&gt;&gt;\n\n&lt;&lt;display 'place_tut_hooks'&gt;&gt;\n/% title hooks added when titles are added %/\n\n&lt;&lt;set $titles to new Inventory('Demonkin')&gt;&gt;\n&lt;&lt;set $choice to new Inventory()&gt;&gt;</div><div tiddler="combatboxNME" tags="" created="201612171439" modifier="twee">&lt;span id=&quot;enemystatupdate&quot;&gt;&lt;&lt;display &quot;nmegritbar&quot;&gt;&gt;&lt;&lt;display &quot;nmeheartbreaker&quot;&gt;&gt;&lt;&lt;if $combatimages is 1 and $mobile neq 1&gt;&gt;&lt;span id=&quot;nmeport&quot;&gt;[img[$enemyimg]]&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;print $enemyname&gt;&gt; (&lt;&lt;print $enemypower&gt;&gt;)\n\n&lt;&lt;if $combatimages is 1&gt;&gt;[img[$NMEgritdisplay]]&lt;&lt;else&gt;&gt;&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;: &lt;&lt;print $nmegrit&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $combatimages is 1&gt;&gt;[img[$NMEheartdisplay]]&lt;&lt;else&gt;&gt;Health: &lt;&lt;print $nmehealth&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $playerturn is 1&gt;&gt;&lt;&lt;if $sta gte $wStaUse&gt;&gt;&lt;&lt;if $despatk is 2&gt;&gt;&lt;span id=&quot;atkOpt&quot;&gt;&lt;&lt;click &quot;1. Desperation Attack&quot;&gt;&gt;&lt;&lt;display &quot;desperation_atk&quot;&gt;&gt;&lt;&lt;shaketarget &quot;#combatNME&quot; 380ms&gt;&gt;&lt;&lt;/click&gt;&gt;&lt;/span&gt;&lt;&lt;else&gt;&gt;&lt;span id=&quot;atkOpt&quot;&gt;&lt;&lt;click &quot;1. Attack&quot;&gt;&gt;&lt;&lt;display &quot;attack&quot;&gt;&gt;&lt;&lt;shaketarget &quot;#combatNME&quot; 250ms&gt;&gt;&lt;&lt;/click&gt;&gt;&lt;/span&gt; (Cost: &lt;&lt;print $wStaUse + $NMEStaUse&gt;&gt; Stamina)&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;Not enough stamina.\n&lt;&lt;display &quot;playeractionsMobile&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $nmehealth lte 0&gt;&gt;Enemy defeated.\n&lt;&lt;display &quot;playeractionsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;Enemy's Turn...\n&lt;&lt;display &quot;playeractionsMobile&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;</div><div tiddler="nmeheartbreaker" tags="nobr" created="201701051306" modifier="twee">&lt;&lt;set $NMEhearts to ($nmemaxhealth*10)+$nmehealth&gt;&gt;\n\n&lt;&lt;if $NMEhearts is 11&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of1'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 10&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of1'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 22&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of2'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 21&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of2'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 20&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of2'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 33&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of3'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 32&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of3'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 31&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of3'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 30&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of3'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 44&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of4'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 43&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of4'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 42&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of4'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 41&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of4'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 40&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of4'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 55&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of5'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 54&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of5'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 53&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of5'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 52&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of5'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 51&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of5'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 50&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of5'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 66&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['6of6e'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 65&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of6e'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 64&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of6e'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 63&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of6e'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 62&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of6e'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 61&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of6e'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 60&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of6e'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 77&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['7of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 76&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['6of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 75&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 74&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 73&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 72&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 71&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of7'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 70&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of7'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 88&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['8of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 87&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['7of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 86&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['6of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 85&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 84&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 83&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 82&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 81&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of8'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 80&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of8'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 99&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['9of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 98&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['8of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 97&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['7of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 96&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['6of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 95&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 94&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 93&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 92&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 91&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of9'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 90&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of9'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 110&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['10of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 109&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['9of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 108&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['8of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 107&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['7of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 106&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['6of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 105&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 104&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 103&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 102&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 101&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of10'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 100&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of10'])&gt;&gt;\n\n&lt;&lt;elseif $NMEhearts is 220&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['20of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 219&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['19of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 218&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['18of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 217&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['17of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 216&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['16of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 215&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['15of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 214&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['14of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 213&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['13of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 212&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['12of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 211&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['11of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 210&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['10of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 209&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['9of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 208&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['8of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 207&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['7of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 206&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['6of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 205&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['5of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 204&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['4of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 203&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['3of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 202&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['2of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 201&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['1of20'])&gt;&gt;\n&lt;&lt;elseif $NMEhearts is 200&gt;&gt;\n\t&lt;&lt;set $NMEheartdisplay to clone(setup.ui.hearts['0of20'])&gt;&gt;\n\n&lt;&lt;endif&gt;&gt;\n</div><div tiddler="switchtoRipley" tags="nobr" created="201612131233" modifier="twee">&lt;&lt;set $formUnlock to 1&gt;&gt;\n&lt;&lt;set $scars to $ripleyscars&gt;&gt;\n&lt;&lt;set $bangles to 1&gt;&gt;\n&lt;&lt;set $character to &quot;Ripley&quot;&gt;&gt;\n&lt;&lt;set $naturalhave to 1&gt;&gt;\n&lt;&lt;set $tp to $tp+$ripleytp&gt;&gt;\n&lt;&lt;set $xp to $ripleyxp&gt;&gt;\n&lt;&lt;set $unarmedtraining to 2&gt;&gt;\n&lt;&lt;set $clothhave to 1&gt;&gt;\n&lt;&lt;display &quot;unarmed&quot;&gt;&gt;\n&lt;&lt;display &quot;spell_keen&quot;&gt;&gt;\n&lt;&lt;display &quot;clotharmor&quot;&gt;&gt;\n&lt;&lt;stats&gt;&gt;</div><div tiddler="bal-adj-nme" tags="nobr" created="201704272348" modifier="twee">/%balanceObj%/\n&lt;&lt;set $nmeatk to Math.trunc($nmeatk * setup.bal.eatk)&gt;&gt;\n&lt;&lt;set $nmedef to Math.trunc($nmedef * setup.bal.edef)&gt;&gt;\n&lt;&lt;set $nmemov to Math.trunc($nmemov * setup.bal.emov)&gt;&gt;\n&lt;&lt;set $nmemaxgrit to Math.trunc($nmemaxgrit * setup.bal.egrit)&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmexp to Math.trunc($nmexp * setup.bal.xpEarn)&gt;&gt;</div><div tiddler="xpinfo" tags="" created="201612172043" modifier="twee">\nThe total amount of experience &lt;&lt;print $character&gt;&gt; has earned since the last time she earned a level.  She will earn a new level once her pool of experience reaches 100.\n\n</div><div tiddler="0aesRun" tags="scene" created="201701250407" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Elesun charges Aesil shoulder first and crashes into him, knocking them both to the ground.\n\nShe manages to make it to her feet first, and grabs Ripley's hand and sprints up the steps with her in tow.\n\nThey run back through the storeroom and spill back out onto the wall.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0aesil_escape&quot;&gt;&gt;</div><div tiddler="double_check" tags="menu" created="201702190816" modifier="twee">''&lt;&lt;switch $mode&gt;&gt;&lt;&lt;case 0&gt;&gt;Story Mode&lt;&lt;case 1&gt;&gt;Normal Mode&lt;&lt;case 2&gt;&gt;Easy Mode&lt;&lt;case 3&gt;&gt;Intense Mode&lt;&lt;/switch&gt;&gt;''\n&lt;&lt;stats&gt;&gt;\nAre you sure?\n\n&lt;&lt;ctrlClick &quot;I'm sure.&quot; &quot;ch1intro&quot;&gt;&gt;\n\n[[Select something else.|difficulty_check]]</div><div tiddler="0iwlever1" tags="dock" created="201701070320" modifier="twee">Elesun suspects that this is the lever that controls the courtyard gate.\n\n&lt;&lt;ctrlClick &quot;Pull it.&quot; &quot;0iwlever2&quot; &quot;interact&quot;&gt;&gt;</div><div tiddler="0protectking2sellswords" tags="dock" created="201701260031" modifier="twee">There's a lot more sellswords than soldiers, which is good.  Probably largely Irelith's doing.  Akatosh's men were motivated by fear and money, and they were taking heavy losses.  Their morale wouldn't hold.</div><div tiddler="StoryAuthor" tags="" created="201612121659" modifier="twee" twine-position="570,10">&lt;&lt;if $debug is 1 and $release is 1&gt;&gt;Debug Mode &lt;&lt;link &quot;Turn Off&quot;&gt;&gt;&lt;&lt;set $debug to 0&gt;&gt;&lt;&lt;script&gt;&gt;UI.alert(&quot;Debug mode will deactivate on next passage transition.&quot;);&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $debug is 0 and $release is 0&gt;&gt;Development Build &lt;&lt;if $verify is 2&gt;&gt;\n&lt;&lt;link &quot;Turn On Debug Features&quot;&gt;&gt;&lt;&lt;set $debug to 1&gt;&gt;&lt;&lt;script&gt;&gt;UI.alert(&quot;Debug mode will activate on next passage transition.&quot;);&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;elseif $debug is 1 and $release is 0&gt;&gt;Development Build (Debug) \n&lt;&lt;link &quot;Turn Off Debug Features&quot;&gt;&gt;&lt;&lt;set $debug to 0&gt;&gt;&lt;&lt;script&gt;&gt;UI.alert(&quot;Debug mode will deactivate on next passage transition.&quot;);&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;else&gt;&gt;A narrative game by Chapel&lt;&lt;endif&gt;&gt;</div><div tiddler="ghst_ui" tags="" created="201702021713" modifier="twee">Ghost grants a large bonus to critical chance in exchange for a penalty to critical damage.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="emote codes" tags="annotation" created="201701231153" modifier="twee" twine-position="1270,570">[conf] confused      [hapy] happy\n[grin] grin          [detr] determined\n[mask] wearing mask  [exct] excited\n[surp] surprised     [sadd] sad\n[doll] dolled up     [dola] dolled up (angry)\n[doln] dolled up (neutral)\n----------------------------------------------------------------\n&lt;&lt;emote &quot;code&quot; &quot;size[pt or sm]&quot;&gt;&gt;\n----------------------------------------------------------------\n&lt;&lt;portrait&gt;&gt; or &lt;&lt;thumb&gt;&gt; for non-emote images.</div><div tiddler="flash" tags="nobr" created="201701241629" modifier="twee">/%  5  %/\n&lt;&lt;set $specialMult to 0.8&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;Burned&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,1,1)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 0.9&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 0.9&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 2&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Flash Fire&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="1KingIre" tags="dock" created="201708112344" modifier="twee">&quot;The brave captain of my personal guard,&quot; the King say, grinning.  &quot;I assume she's hard at work organizing my men.&quot;\n\n&quot;Something like that, I'm sure.&quot;</div><div tiddler="1Map1Bailey" tags="dock map" created="201702180659" modifier="twee">Head south to the bailey?\n\n&lt;&lt;ctrlClick &quot;Go to the bailey.&quot; &quot;1bailey&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="0choice1stance" tags="dock" created="201701140610" modifier="twee">Elesun sighs.\n\nRipley's legs are too far apart and her shoulders are too far forward.  //Again//.</div><div tiddler="spell_regeneration" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Regeneration&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Light&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Regeneration&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;rgn_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 10&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 20&gt;&gt;\n&lt;&lt;set $spellhealing to 5&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $lighttraining is 1&gt;&gt;\n\t&lt;&lt;set $spellregen to 25&gt;&gt;\n&lt;&lt;elseif $lighttraining is 2&gt;&gt;\n\t&lt;&lt;set $spellregen to 30&gt;&gt;\n&lt;&lt;elseif $lighttraining is 3&gt;&gt;\n\t&lt;&lt;set $spellhealing to 10&gt;&gt;\n\t&lt;&lt;set $spellregen to 30&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="0choice1waits" tags="dock" created="201701140610" modifier="twee">Ripley was playing this well.\n\nShe’s trained in the use of many weapons, but she always did prefer her fists--they’re less lethal.  When fighting with fists against all manner of weapons, being on the defensive is ideal.</div><div tiddler="0cylisten" tags="dock" created="201701070314" modifier="twee">Elesun listens closer.  She hears screams and war cries, and the sounds of metal clashing against metal.  A lot of people are dying out there.</div><div tiddler="0wallTragedy" tags="dock" created="201701242246" modifier="twee">Elesun could almost see his face.  Akatosh.&lt;&lt;image &quot;AkaSm_craz&quot;&gt;&gt;\n\nHe'd get his soon.</div><div tiddler="Inferno" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;infr_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;infr&quot;]]\n[[No|spellswap]]</div><div tiddler="helpTraining" tags="help" created="201702120809" modifier="twee">Elesun can train to improve her effectiveness with weapons and spells.  Visit combat trainers (like Irelith) or magic trainers to spend training points (TP) to level up her skills.  Weapons and schools of magic can be trained up to rank 3.  The bonuses conferred by training are small at first, and so are the costs.  High level training, on the other hand, has potentially massive benefits, though they can cost quite a bit of TP.</div><div tiddler="PlayerCloseUp" tags="" created="201701050453" modifier="twee" twine-position="290,850">&lt;&lt;if $character is &quot;Elesun&quot;&gt;&gt;[img[setup.img.EleCl]]&lt;&lt;else&gt;&gt;[img[setup.img.RipCl]]&lt;&lt;endif&gt;&gt;</div><div tiddler="codex_menu_people" tags="menu" created="201612141348" modifier="twee">!People\n\n&lt;span id=&quot;codexpeo&quot;&gt;Description of People&lt;/span&gt;\n\n&lt;&lt;link &quot;The Kingdom of Juno&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpeo&quot;&gt;&gt;Junovians&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Kingdom of Valne&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpeo&quot;&gt;&gt;Valnese&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Northers&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpeo&quot;&gt;&gt;Northers&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Druid Tribes&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpeo&quot;&gt;&gt;Druids&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Other Peoples&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpeo&quot;&gt;&gt;Other peeps.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n[[Back|codex_menu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="levelup2" tags="menu" created="201612131856" modifier="twee">!Welcome to level &lt;&lt;print $lvl&gt;&gt;.\n&lt;&lt;stats&gt;&gt;&lt;&lt;display &quot;rest_basic&quot;&gt;&gt;\n!!Power: &lt;&lt;print $power&gt;&gt;\n|!Health:|&lt;&lt;print $health&gt;&gt;/&lt;&lt;print $maxhealth&gt;&gt;|!Scars:|&lt;&lt;print $scars&gt;&gt;|\n|!&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:     |&lt;&lt;print $maxgrit&gt;&gt;|!Stamina:|&lt;&lt;print $maxsta&gt;&gt;|\n| |\n|!Attributes:| | |!Derived Attributes:| |\n|Strength| |&lt;&lt;print $strrank&gt;&gt;|Attack:| |&lt;&lt;print $atk&gt;&gt;|\n|Agility| |&lt;&lt;print $agirank&gt;&gt;|Defense:| |&lt;&lt;print $def&gt;&gt;|\n|Endurance| |&lt;&lt;print $endrank&gt;&gt;|Movement:| |&lt;&lt;print $mov&gt;&gt;|\n|Will| |&lt;&lt;print $wilrank&gt;&gt;|Critical Chance:| |&lt;&lt;print $critchance&gt;&gt;|\n|Cunning| |&lt;&lt;print $cngrank&gt;&gt;|Dodge Chance:| |&lt;&lt;print $dodge&gt;&gt;|\n\nTraining Points (TP): &lt;&lt;print $tp&gt;&gt;\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|$exitpassage]]&lt;/span&gt;\n\n\n\n\n</div><div tiddler="storyJump" tags="test menu" created="201705030335" modifier="twee" twine-position="2110,710">Once you start, there's no turning back--the variables demand it.  Set your level now with the level up button!\n\nJump to which chapter:\n\n[[Chapter 1|ch1-jump]] (recommended level: 4)\n\n...\n[[Cancel|debug_features]]</div><div tiddler="TheReaper-E-1" tags="" created="201707262301" modifier="twee"></div><div tiddler="linkKeysScript" tags="script" created="201705030643" modifier="twee" twine-position="150,430">!function(){$(document).keyup(function(t){49==t.keyCode&amp;&amp;($(&quot;#oneAct a&quot;).trigger(&quot;click&quot;),$(&quot;#oneAct button&quot;).trigger(&quot;click&quot;)),50==t.keyCode&amp;&amp;($(&quot;#twoAct a&quot;).trigger(&quot;click&quot;),$(&quot;#threeAct button&quot;).trigger(&quot;click&quot;)),51==t.keyCode&amp;&amp;($(&quot;#threeAct a&quot;).trigger(&quot;click&quot;),$(&quot;#threeAct button&quot;).trigger(&quot;click&quot;)),52==t.keyCode&amp;&amp;($(&quot;#fourAct a&quot;).trigger(&quot;click&quot;),$(&quot;#fourAct button&quot;).trigger(&quot;click&quot;)),52==t.keyCode&amp;&amp;($(&quot;#fourAct a&quot;).trigger(&quot;click&quot;),$(&quot;#fourAct button&quot;).trigger(&quot;click&quot;)),53==t.keyCode&amp;&amp;($(&quot;#fiveAct a&quot;).trigger(&quot;click&quot;),$(&quot;#fiveAct button&quot;).trigger(&quot;click&quot;)),54==t.keyCode&amp;&amp;($(&quot;#sixAct a&quot;).trigger(&quot;click&quot;),$(&quot;#sixAct button&quot;).trigger(&quot;click&quot;)),55==t.keyCode&amp;&amp;($(&quot;#sevenAct a&quot;).trigger(&quot;click&quot;),$(&quot;#sevenAct button&quot;).trigger(&quot;click&quot;)),56==t.keyCode&amp;&amp;($(&quot;#eightAct a&quot;).trigger(&quot;click&quot;),$(&quot;#eightAct button&quot;).trigger(&quot;click&quot;)),57==t.keyCode&amp;&amp;($(&quot;#nineAct a&quot;).trigger(&quot;click&quot;),$(&quot;#nineAct button&quot;).trigger(&quot;click&quot;)),48==t.keyCode&amp;&amp;($(&quot;#zeroAct a&quot;).trigger(&quot;click&quot;),$(&quot;#zeroAct button&quot;).trigger(&quot;click&quot;)),9==t.keyCode&amp;&amp;($(&quot;#tabAct a&quot;).trigger(&quot;click&quot;),$(&quot;#tabAct button&quot;).trigger(&quot;click&quot;)),32==t.keyCode&amp;&amp;($(&quot;#spaceAct a&quot;).trigger(&quot;click&quot;),$(&quot;#spaceAct button&quot;).trigger(&quot;click&quot;)),17==t.keyCode&amp;&amp;($(&quot;#ctrlAct a&quot;).trigger(&quot;click&quot;),$(&quot;#ctrlAct button&quot;).trigger(&quot;click&quot;)),8==t.keyCode&amp;&amp;($(&quot;#bkspAct a&quot;).trigger(&quot;click&quot;),$(&quot;#bkspAct button&quot;).trigger(&quot;click&quot;)),27==t.keyCode&amp;&amp;($(&quot;#escAct a&quot;).trigger(&quot;click&quot;),$(&quot;#escAct button&quot;).trigger(&quot;click&quot;)),46==t.keyCode&amp;&amp;($(&quot;#delAct a&quot;).trigger(&quot;click&quot;),$(&quot;#delAct button&quot;).trigger(&quot;click&quot;)),13==t.keyCode&amp;&amp;($(&quot;#enterAct a&quot;).trigger(&quot;click&quot;),$(&quot;#enterAct button&quot;).trigger(&quot;click&quot;)),18==t.keyCode&amp;&amp;($(&quot;#altAct a&quot;).trigger(&quot;click&quot;),$(&quot;#altAct button&quot;).trigger(&quot;click&quot;)),81==t.keyCode&amp;&amp;($(&quot;#qKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#qKeyAct button&quot;).trigger(&quot;click&quot;)),87==t.keyCode&amp;&amp;($(&quot;#wKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#wKeyAct button&quot;).trigger(&quot;click&quot;)),69==t.keyCode&amp;&amp;($(&quot;#eKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#eKeyAct button&quot;).trigger(&quot;click&quot;)),82==t.keyCode&amp;&amp;($(&quot;#rKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#rKeyAct button&quot;).trigger(&quot;click&quot;)),84==t.keyCode&amp;&amp;($(&quot;#tKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#tKeyAct button&quot;).trigger(&quot;click&quot;)),89==t.keyCode&amp;&amp;($(&quot;#yKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#yKeyAct button&quot;).trigger(&quot;click&quot;)),85==t.keyCode&amp;&amp;($(&quot;#uKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#uKeyAct button&quot;).trigger(&quot;click&quot;)),73==t.keyCode&amp;&amp;($(&quot;#iKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#iKeyAct button&quot;).trigger(&quot;click&quot;)),79==t.keyCode&amp;&amp;($(&quot;#oKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#oKeyAct button&quot;).trigger(&quot;click&quot;)),80==t.keyCode&amp;&amp;($(&quot;#pKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#pKeyAct button&quot;).trigger(&quot;click&quot;)),65==t.keyCode&amp;&amp;($(&quot;#aKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#aKeyAct button&quot;).trigger(&quot;click&quot;)),83==t.keyCode&amp;&amp;($(&quot;#sKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#sKeyAct button&quot;).trigger(&quot;click&quot;)),68==t.keyCode&amp;&amp;($(&quot;#dKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#dKeyAct button&quot;).trigger(&quot;click&quot;)),70==t.keyCode&amp;&amp;($(&quot;#fKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#fKeyAct button&quot;).trigger(&quot;click&quot;)),71==t.keyCode&amp;&amp;($(&quot;#gKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#gKeyAct button&quot;).trigger(&quot;click&quot;)),72==t.keyCode&amp;&amp;($(&quot;#hKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#hKeyAct button&quot;).trigger(&quot;click&quot;)),74==t.keyCode&amp;&amp;($(&quot;#jKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#jKeyAct button&quot;).trigger(&quot;click&quot;)),75==t.keyCode&amp;&amp;($(&quot;#kKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#kKeyAct button&quot;).trigger(&quot;click&quot;)),76==t.keyCode&amp;&amp;($(&quot;#lKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#lKeyAct button&quot;).trigger(&quot;click&quot;)),90==t.keyCode&amp;&amp;($(&quot;#zKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#zKeyAct button&quot;).trigger(&quot;click&quot;)),88==t.keyCode&amp;&amp;($(&quot;#xKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#xKeyAct button&quot;).trigger(&quot;click&quot;)),67==t.keyCode&amp;&amp;($(&quot;#cKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#cKeyAct button&quot;).trigger(&quot;click&quot;)),86==t.keyCode&amp;&amp;($(&quot;#vKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#vKeyAct button&quot;).trigger(&quot;click&quot;)),66==t.keyCode&amp;&amp;($(&quot;#bKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#bKeyAct button&quot;).trigger(&quot;click&quot;)),78==t.keyCode&amp;&amp;($(&quot;#nKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#nKeyAct button&quot;).trigger(&quot;click&quot;)),77==t.keyCode&amp;&amp;($(&quot;#mKeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#mKeyAct button&quot;).trigger(&quot;click&quot;)),112==t.keyCode&amp;&amp;($(&quot;#f1KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f1KeyAct button&quot;).trigger(&quot;click&quot;)),113==t.keyCode&amp;&amp;($(&quot;#f2KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f2KeyAct button&quot;).trigger(&quot;click&quot;)),114==t.keyCode&amp;&amp;($(&quot;#f3KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f3KeyAct button&quot;).trigger(&quot;click&quot;)),115==t.keyCode&amp;&amp;($(&quot;#f4KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f4KeyAct button&quot;).trigger(&quot;click&quot;)),116==t.keyCode&amp;&amp;($(&quot;#f5KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f5KeyAct button&quot;).trigger(&quot;click&quot;)),117==t.keyCode&amp;&amp;($(&quot;#f6KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f6KeyAct button&quot;).trigger(&quot;click&quot;)),118==t.keyCode&amp;&amp;($(&quot;#f7KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f7KeyAct button&quot;).trigger(&quot;click&quot;)),119==t.keyCode&amp;&amp;($(&quot;#f8KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f8KeyAct button&quot;).trigger(&quot;click&quot;)),120==t.keyCode&amp;&amp;($(&quot;#f9KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f9KeyAct button&quot;).trigger(&quot;click&quot;)),121==t.keyCode&amp;&amp;($(&quot;#f10KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f10KeyAct button&quot;).trigger(&quot;click&quot;)),122==t.keyCode&amp;&amp;($(&quot;#f11KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f11KeyAct button&quot;).trigger(&quot;click&quot;)),123==t.keyCode&amp;&amp;($(&quot;#f12KeyAct a&quot;).trigger(&quot;click&quot;),$(&quot;#f12KeyAct button&quot;).trigger(&quot;click&quot;))})}();</div><div tiddler="keen_ui" tags="" created="201702021704" modifier="twee">Grants a large increase to critical attack chance and critical attack damage.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="1cyGuards" tags="dock" created="201702191054" modifier="twee">&lt;&lt;if $stoneLoc is 0&gt;&gt;&lt;&lt;set $stoneLoc to 1&gt;&gt;&quot;Hey Elesun.  How's Ripley been since the siege?&quot; one of the guards asks.\n\n&quot;She's putting on a brave face,&quot; Elesun replies.\n\n&quot;She still have that rock collection?  I saw a pretty neat-looking rock over by the well.&quot;&lt;&lt;else&gt;&gt;They're just shooting the breeze.&lt;&lt;endif&gt;&gt;</div><div tiddler="tut_onDespAtk" tags="hook tutorial" created="201707101337" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has performed a desperation attack.\n\n&lt;&lt;name&gt;&gt; gains access to this powerful technique after losing a heart, and it replaces her ability to perform ordinary attacks.  The desperation attack deals massive damage at the cost of all stamina.  It's power is not affected by equipment.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onDespAtk'&gt;&gt;</div><div tiddler="charmenu" tags="menu char" created="201612122026" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;if $characterHide is 0&gt;&gt;&lt;&lt;portrait&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;&lt;&lt;endnobr&gt;&gt;&lt;&lt;if $characterHide is 0&gt;&gt;\n!&lt;&lt;print &quot;\su2629\s &quot; + $character&gt;&gt;\n!!&lt;&lt;link &quot;Level&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;lvlinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;&lt;print $lvl&gt;&gt;, &lt;&lt;link &quot;Power&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&lt;&lt;display &quot;powinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;&lt;print $power&gt;&gt;\n|!&lt;&lt;link &quot;Health&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;healthinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;:|&lt;&lt;print $health&gt;&gt;/&lt;&lt;print $maxhealth&gt;&gt;|!&lt;&lt;link &quot;Scars&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;scarsinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;:|&lt;&lt;print $scars&gt;&gt;|\n|!&lt;&lt;link setup.words.grit&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;gritinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;:     |&lt;&lt;print $maxgrit&gt;&gt;|!&lt;&lt;link &quot;Stamina&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;stainfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;:|&lt;&lt;print $maxsta&gt;&gt;|\n| |\n| |!Attributes:| | | | | |\n|[img[setup.ui.icons.strIcon]]|&lt;&lt;link &quot;Strength&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;strinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;print $strrank&gt;&gt;|[img[setup.ui.icons.ui_atk]]|Attack:| |&lt;&lt;print $atk&gt;&gt;| |\n|[img[setup.ui.icons.agiIcon]]|&lt;&lt;link &quot;Agility&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;agiinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;print $agirank&gt;&gt;|[img[setup.ui.icons.ui_def]]|Defense:| |&lt;&lt;print $def&gt;&gt;| |\n|[img[setup.ui.icons.endIcon]]|&lt;&lt;link &quot;Endurance&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;endinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;print $endrank&gt;&gt;|[img[setup.ui.icons.ui_mov]]|Movement:| |&lt;&lt;print $mov&gt;&gt;| |\n|[img[setup.ui.icons.wilIcon]]|&lt;&lt;link &quot;Will&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;wilinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;print $wilrank&gt;&gt;|[img[setup.ui.icons.ui_crit]]|Critical Chance:| |&lt;&lt;print $critchance&gt;&gt;| |\n|[img[setup.ui.icons.cngIcon]]|&lt;&lt;link &quot;Cunning&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;cnginfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;print $cngrank&gt;&gt;|[img[setup.ui.icons.ui_dodge]]|Dodge Chance:| |&lt;&lt;print $dodge&gt;&gt;| |\n\n|!Special:|\n&lt;&lt;if $bangles eq 1&gt;&gt;&lt;&lt;link &quot;Druid Bangles&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;banglesinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;else&gt;&gt;Nothing of note.&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $formUnlock is 1&gt;&gt;&lt;&lt;link &quot;Devil Form&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;devilforminfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $formUlock is 2&gt;&gt;&lt;&lt;link &quot;Final Form&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;finalforminfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n|&lt;&lt;link &quot;Experience Points&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;xpinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt; (XP):  |&lt;&lt;print $xp&gt;&gt;/100|\n|&lt;&lt;link &quot;Training Points&quot;&gt;&gt;&lt;&lt;dialog 'Information'&gt;&gt;&lt;&lt;display &quot;tpinfo&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt; (TP):  |&lt;&lt;print $tp&gt;&gt;|\n\n&lt;span id=&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;\n\n&lt;&lt;else&gt;&gt;Nothing here right now...&lt;&lt;endif&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="codex_Elesun" tags="menu" created="201701261829" modifier="twee">&lt;&lt;image &quot;ElePt&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Elesun''\n\nKing Harmon found Elesun living a simple life as a serf.  When he realized she was demonkin, he instructed Irelith to train her and offered her a place on the King's Guard.  Elesun agreed, and excelled in every form of combat.  Her skill gave rise to half-joking arguments among the King's soldiers over which one of the two demonkin would win in a fight.\n\nOnce Ripley was discovered and brought to the castle, Elesun became her personal body guard, trainer, and companion.  The two grew close over the years.\n\nElesun tends to be a more thoughtful, careful, and crafty warrior than most, but isn't above brute-forcing her way through a fight.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="debug_features" tags="test menu" created="201701131701" modifier="twee" twine-position="1410,850">&lt;&lt;set $gamestart to 2&gt;&gt;Debug options.\n\nTurns: &lt;&lt;set _exclude to visitedTags(&quot;combat&quot;) + visitedTags(&quot;dock&quot;) + visitedTags(&quot;menu&quot;) + visitedTags(&quot;menu&quot;) + visitedTags(&quot;nobr&quot;)&gt;&gt;&lt;&lt;set _baseTurns to turns()&gt;&gt;&lt;&lt;set _turnResult to _baseTurns - _exclude&gt;&gt;&lt;&lt;print _baseTurns + &quot;(Total) - &quot; + _exclude + &quot;(Menus/Combat/Doubles) = &quot; + _turnResult + &quot;(Adjusted)&quot;&gt;&gt;\n\n&lt;&lt;link &quot;Check Variables&quot;&gt;&gt;&lt;&lt;checkvars&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n[[Training Dummy|debug_trainingdummy]]\n\n[[Level Up|debug_thelevelupbutton]]\n\n[[Info Tester|info macro test]]\n\n[[Sound Tester|soundtest]]\n\n[[Bug Code Unpacker|TheDebugDecoderRing]]\n\n[[Test Combat|combat_test]]\n\n[[Image Tester|debug_images]]\n\n[[Boss Fight Test|boss-fight-debug]]\n\nWARNING: The following options will ruin your game state.\n\n[[Chapter Select|storyJump]]\n\n[[Title Screen|title]]\n\n[[Game Over|gameover]]\n\n&lt;&lt;link &quot;Switch to Ripley&quot;&gt;&gt;&lt;&lt;set $character to &quot;Ripley&quot;&gt;&gt;&lt;&lt;set $formUnlock to 1&gt;&gt;&lt;&lt;set $bangles to 1&gt;&gt;&lt;&lt;stats&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n[[Cancel|$exitpassage][$gamestart to 1]]</div><div tiddler="easy-bal-adj" tags="nobr" created="201704272353" modifier="twee" twine-position="1970,290">/% changes:\n\tplayer deals more damage globally\n\tdesp atks more effective\n\tenemy spells are weaker\n\tenemies deal less damage and have less health\n\tenemies are less agressive\n%/\n&lt;&lt;display balanceObj&gt;&gt; /%reset%/\n&lt;&lt;set setup.bal.patk to 1.5&gt;&gt;\n&lt;&lt;set setup.bal.pdef to 1.2&gt;&gt;\n&lt;&lt;set setup.bal.pgrit to 1.2&gt;&gt;\n&lt;&lt;set setup.bal.eatk to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.edef to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.egrit to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.estagger to 0.9&gt;&gt;\n&lt;&lt;set setup.bal.xpEarn to 1.0&gt;&gt;\n&lt;&lt;set setup.bal.espell to 0.5&gt;&gt;\n&lt;&lt;set setup.bal.desp to 2.0&gt;&gt;\n&lt;&lt;set setup.bal.agression to 0&gt;&gt;</div><div tiddler="TheDebugDecoderRing" tags="test" created="201701120932" modifier="twee" twine-position="1410,990">The Debug Decoder Ring\n\n&lt;&lt;textbox &quot;$bugcode&quot; &quot;&quot; &quot;debugdecode&quot; autofocus&gt;&gt;\n\nPress enter to continue.\n\n[[Cancel|debug_features]]</div><div tiddler="combatboxAlly" tags="" created="201612171509" modifier="twee">&lt;span id=&quot;allystatupdate&quot;&gt;\nblah\n&lt;/span&gt;</div><div tiddler="1sq2" tags="" created="201701282010" modifier="twee"></div><div tiddler="saber" tags="nobr" created="201612131442" modifier="twee">&lt;&lt;set $weaponname to &quot;Saber&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;sbr_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 0.9&gt;&gt;\n&lt;&lt;set $wdef to 0.9&gt;&gt;\n&lt;&lt;set $wmov to 1.1&gt;&gt;\n&lt;&lt;set $critrange to 95&gt;&gt;\n\n&lt;&lt;set $wStaUse to 5&gt;&gt;\n\n&lt;&lt;if $sabertraining is 1&gt;&gt;\n\t&lt;&lt;set $watk to 1.0&gt;&gt;\n&lt;&lt;elseif $sabertraining is 2&gt;&gt;\n\t&lt;&lt;set $watk to 1.0&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n&lt;&lt;elseif $sabertraining is 3&gt;&gt;\n\t&lt;&lt;set $watk to 1.0&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n\t&lt;&lt;set $critrange to 90&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="desperation_atk" tags="nobr" created="201612160714" modifier="twee">&lt;&lt;if $despatk is 0&gt;&gt;\n\t&lt;&lt;set $despatk to 1&gt;&gt;\n&lt;&lt;elseif $despatk is 2&gt;&gt;\n\t&lt;&lt;set $despatk to 0&gt;&gt;\n\t&lt;&lt;set $sta to 0&gt;&gt;\n\t&lt;&lt;payload 'onDespAtk'&gt;&gt;\n    &lt;&lt;set _despMod to either(0.8, 0.9, 0.9, 1, 1, 1, 1, 1, 1.1, 1.1, 1.1, 1.2, 1.2, 1.3, 1.5)&gt;&gt;\n\t&lt;&lt;set $damagetoNME to Math.trunc($power * _despMod * setup.bal.desp) + $maxsta&gt;&gt;\n\t&lt;&lt;set $nmegrit to Math.trunc($nmegrit-$damagetoNME)&gt;&gt;\n\n    /%audio%/\n    &lt;&lt;if $character is &quot;Ripley&quot;&gt;&gt;\n\t&lt;&lt;set _despSel to either(1,2,2,3,3,3,4,4,4,4,4,5,5,5,5)&gt;&gt;\n    &lt;&lt;switch _despSel&gt;&gt;\n    &lt;&lt;case 1&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-1&quot; stop&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-1&quot; unloop play&gt;&gt;\n    &lt;&lt;case 2&gt;&gt;\n      &lt;&lt;set _despSelB to either(1,1,2)&gt;&gt;\n      &lt;&lt;if _despSelB is 2 and $character is &quot;Ripley&quot;&gt;&gt;\n        &lt;&lt;playlist &quot;desp-atk-R&quot; stop&gt;&gt;\n        &lt;&lt;playlist &quot;desp-atk-R&quot; unloop play&gt;&gt;\n      &lt;&lt;else&gt;&gt;\n        &lt;&lt;playlist &quot;desp-atk-2&quot; stop&gt;&gt;\n        &lt;&lt;playlist &quot;desp-atk-2&quot; unloop play&gt;&gt;\n      &lt;&lt;endif&gt;&gt;\n    &lt;&lt;case 3&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-3&quot; stop&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-3&quot; unloop play&gt;&gt;\n    &lt;&lt;case 4&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-4&quot; stop&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-4&quot; unloop play&gt;&gt;\n    &lt;&lt;case 4&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-5&quot; stop&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-5&quot; unloop play&gt;&gt;\n    &lt;&lt;default&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-1&quot; stop&gt;&gt;\n      &lt;&lt;playlist &quot;desp-atk-1&quot; unloop play&gt;&gt;\n    &lt;&lt;/switch&gt;&gt;\n    &lt;&lt;else&gt;&gt;\n      &lt;&lt;audio &quot;critical&quot; play&gt;&gt;\n    &lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if $nmegrit lte 0&gt;&gt;\n\t\t&lt;&lt;set $nmehealth to $nmehealth-1&gt;&gt;\n\t\t&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;replace &quot;#combatmessages&quot;&gt;&gt;&lt;&lt;if $crityes is 1&gt;&gt;''Desperate Attack:  ''&lt;&lt;endif&gt;&gt;Dealt &lt;&lt;print $damagetoNME&gt;&gt; damage.&lt;&lt;/replace&gt;&gt;\n\n\t&lt;&lt;if $nmehealth lte 0&gt;&gt;\n\t\t&lt;&lt;set $nmegrit to 0&gt;&gt;\n\t\t&lt;&lt;display &quot;health_checker&quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if $allynumber is 0&gt;&gt;\n\t\t&lt;&lt;com_update_noally&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;com_update&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="0protectking2king" tags="dock" created="201701260031" modifier="twee">&lt;&lt;if $process lte 3&gt;&gt;&lt;&lt;set $process++&gt;&gt;&lt;&lt;endif&gt;&gt;&quot;It's good to see you two,&quot; the king says.  &quot;I've received reports that Aesil is out there somewhere.  I sent Folsom to go deal with it, but now we're without his wisdom and magic when Irelith needs it.  Just another of many of my decisions that I'm sure you'll have treasonous opinions on.&quot;\n\n&quot;I didn't say anything,&quot; Elesun replies.\n\n&quot;Oh, but you will, won't you?&quot;\n\n&quot;If we live long enough you'll find out.&quot;</div><div tiddler="greatsword" tags="nobr" created="201612131443" modifier="twee">&lt;&lt;set $weaponname to &quot;Great Sword&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;gswd_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.5&gt;&gt;\n&lt;&lt;set $wdef to 1.1&gt;&gt;\n&lt;&lt;set $wmov to 0.9&gt;&gt;\n&lt;&lt;set $critrange to 103&gt;&gt;\n\n&lt;&lt;set $wStaUse to 8&gt;&gt;\n\n&lt;&lt;if $greatswordtraining is 1&gt;&gt;\n\t&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;elseif $greatswordtraining is 2&gt;&gt;\n\t&lt;&lt;set $wdef to 1.2&gt;&gt;\n\t&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;elseif $greatswordtraining is 3&gt;&gt;\n\t&lt;&lt;set $critrange to 100&gt;&gt;\n\t&lt;&lt;set $wdef to 1.2&gt;&gt;\n\t&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="infr_ui" tags="" created="201702021725" modifier="twee">Inferno causes critical attacks to do absurd damage, but it slightly reduces critical attack chance and moderately reduces grit.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_down]]|//Moderate//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="wilinfo" tags="" created="201612151656" modifier="twee">\nA measure of willpower, sense, and wisdom.  Will influences stamina, &lt;&lt;name&gt;&gt;'s chance to dispel hostile magic, and end-of-round grit regeneration. &lt;&lt;if $character is &quot;Ripley&quot;&gt;&gt;It also determines the rate at which Ripley's rage increases.&lt;&lt;endif&gt;&gt;\n\n</div><div tiddler="slash-style" tags="stylesheet" created="201708110213" modifier="twee">#slash {\n  margin: 2em 0;\n  height: 5em;\n  background-color: #111;\n  z-index: -1;\n}\n\n#slashes {\n  display: none;\n  position: relative;\n  width: 10em;\n  height: 5em;\n  background-color: #fff;\n  border: 1px solid #fff;\n  border-radius: 50%;\n}\n\n.internal-slash {\n  display: block;\n  position: relative;\n  width: 10em;\n  margin: 1em;\n  height: 5em;\n  background-color: #111;\n  border: 1px solid #111;\n  border-radius: 50%;\n}\n\n.slash-1 {\n  display: block;\n}\n\n.slash-2 {\n  display: block;\n  transform: rotate(90deg);\n}\n.slash-3 {\n  display: block;\n  transform: skew(60deg);\n}\n.slash-4 {\n  display: block;\n  transform: skew(45deg);\n  transform: rotate(270deg);\n}\n.slash-5 {\n  display: block;\n  transform: skew(240deg);\n  transform: rotate(180deg);\n}\n.slash-6 {\n  display: block;\n  transform: skew(60deg);\n  transform: rotate(300deg);\n}</div><div tiddler="0wall2Rip" tags="dock" created="201701242311" modifier="twee">&lt;&lt;if $helpServants is 0&gt;&gt;&lt;&lt;set $helpServants to 1&gt;&gt;&quot;Do you hear that?&quot;\n\nElesun listens.  She can just barely hear moaning and crying coming from inside the storeroom.\n\n&quot;Someone's hurt.  We need to help.&quot;&lt;&lt;timed 500ms&gt;&gt;&lt;&lt;replace &quot;#gone&quot;&gt;&gt;&lt;&lt;action &quot;throne room&quot; &quot;0wall2continue&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;&lt;&lt;else&gt;&gt;&quot;We need to help them!&quot; Ripley says.  &quot;Let's go.&quot;\n\n&quot;We need to get to the king.&quot;  Elesun says.\n\n&quot;Irelith's with him, he'll be fine.&quot;\n\n&quot;We have a duty.  And Irelith isn't invincible.&quot;\n\n&quot;You'd leave them to die?&quot; Ripley shouts.\n\n&quot;Ripley...&quot;&lt;&lt;timed 1s&gt;&gt;&lt;&lt;replace &quot;#goneA&quot;&gt;&gt;Ripley&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="0byvillage" tags="dock" created="201701110808" modifier="twee">Ripley was fond of many of the villagers, and after some initial awkwardness, they came to accept their new Lady, young as she was at the time.  Ripley couldn’t have been like any noble they’d ever known, running everywhere barefoot, always inviting herself to join in every event, from parties to moonlit lovers’ walks.\n\nThe poor girl would break if she knew that Elesun was going to let them die to keep her safe.  She’d never need to know.</div><div tiddler="helpdock" tags="help" created="201701070313" modifier="twee">Clicking the links in the text updates the ''information dock'' at the bottom of the screen.  Take a look around and investigate at your leisure.  Links that appear within the information dock itself will generally perform some action or take you to a new location.  You can either click the links that appear in the dock, or press Ctrl to activate them.\n\nIf the dock is getting in the way, you can press Spacebar to reset its contents, or double click on it to collapse it.</div><div tiddler="alva_stats" tags="nobr" created="201612131947" modifier="twee">&lt;&lt;set $allyname to &quot;Alva&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 1&gt;&gt;/%0 is no ally%/\n\n&lt;&lt;set $allylvl to 2&gt;&gt;\n&lt;&lt;set $allymaxhealth to 2&gt;&gt;\n&lt;&lt;set $allymaxgrit to 70&gt;&gt;\n&lt;&lt;set $allyatk to 42&gt;&gt;\n&lt;&lt;set $allydef to 47&gt;&gt;\n&lt;&lt;set $allymov to 42&gt;&gt;\n&lt;&lt;set $allymagic to 42&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n/%special attack code (0 is watchback, 1 is magic, etc.)%/\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="main menu" tags="menu" created="201612121956" modifier="twee" twine-position="1550,150">&lt;&lt;if $webversion is 1&gt;&gt;\nYou are playing the browser version of Holy Land.\n\n//Holy Land// may or may not be compatible with your browser.  &lt;&lt;link &quot;Click here&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\nDialog.setup(&quot;Browser Support&quot;);\nDialog.wiki(Story.get(&quot;browserSupport&quot;).processText());\nDialog.open();\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;/link&gt;&gt; for more information.\n&lt;&lt;endif&gt;&gt;\n\n\n\n&lt;&lt;link &quot;Continue&quot;&gt;&gt;&lt;&lt;script&gt;&gt;\nif (Save.autosave.has()) {\n    Save.autosave.load();\n} else {\n\tUI.alert(&quot;No autosave found.&quot;);\n}\n&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;New Game&quot;&gt;&gt;&lt;&lt;audio &quot;beep&quot; play&gt;&gt;&lt;&lt;goto &quot;newgame&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Load Game&quot;&gt;&gt;&lt;&lt;audio &quot;beep&quot; play&gt;&gt;&lt;&lt;script&gt;&gt;UI.saves();&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n&lt;&lt;link &quot;About&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\nDialog.setup(&quot;About&quot;);\nDialog.wiki(Story.get(&quot;about&quot;).processText());\nDialog.open();\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n[[Controls|control-ref]]</div><div tiddler="1EleDying" tags="scene" created="201701282007" modifier="twee"></div><div tiddler="spell_explosion" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Explosion&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Hellish&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Explosion&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;expl_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 5&gt;&gt;\n&lt;&lt;set $spellcritdam to 2.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 1.1&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $hellishtraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcrit to 10&gt;&gt;\n&lt;&lt;elseif $hellishtraining is 2&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n\t&lt;&lt;set $spellcrit to 10&gt;&gt;\n&lt;&lt;elseif $hellishtraining is 3&gt;&gt;\n\t&lt;&lt;set $spellcrit to 15&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="armrinfo" tags="" created="201612151713" modifier="twee">Equip armor to protect yourself.  Heavier armor hampers movement.</div><div tiddler="1afterThem" tags="scene" created="201701282008" modifier="twee"></div><div tiddler="1bailey" tags="space" created="201701281952" modifier="twee">&lt;&lt;image &quot;IreSm&quot;&gt;&gt;The sun is up, and though the &lt;&lt;weak &quot;castle&quot; &quot;1baileyCastle&quot;&gt;&gt; has seen better days, the signs of the &lt;&lt;dock &quot;siege&quot; &quot;1baileySiege&quot;&gt;&gt; are few and far between.\n\nThe &lt;&lt;action &quot;gate&quot; &quot;1baileyGate&quot;&gt;&gt; to the courtyard is open, and a few soldiers are milling about inside.\n\n&lt;&lt;action &quot;Irelith&quot; &quot;1baileyIre&quot;&gt;&gt; is looking busy nearby.\n\n&lt;span id=&quot;navbox&quot;&gt;&lt;&lt;mapHarlan $now&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpFreedom&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="example" tags="nobr" created="201701241248" modifier="twee">&lt;&lt;set $specialMult to 1.0&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,0)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;None&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * $bal.espell&gt;&gt;</div><div tiddler="clotharmor" tags="nobr" created="201612131617" modifier="twee">&lt;&lt;set $armorname to &quot;Cloth Armor&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;cloth_ui&quot;&gt;&gt;\n\n&lt;&lt;set $aatk to 1.0&gt;&gt;\n&lt;&lt;set $adef to 0.9&gt;&gt;\n&lt;&lt;set $amov to 1.1&gt;&gt;\n\n&lt;&lt;if $clothplus eq 1&gt;&gt;\n\t&lt;&lt;set $adef to 1.0&gt;&gt;\n\t&lt;&lt;set $armorname to &quot;Cloth Armor+&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="engine-setup" tags="init" created="201707082159" modifier="twee" twine-position="990,150">&lt;&lt;set $attackSec to 6&gt;&gt;\n&lt;&lt;set $nextBoss to &quot;&quot;&gt;&gt;\n&lt;&lt;set $def_success to false&gt;&gt;\n&lt;&lt;set $QTEatk to 0&gt;&gt;\n\n&lt;&lt;set $weapon_ui to &quot;lswd_ui&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;prot_ui&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;leath_ui&quot;&gt;&gt;\n\n&lt;&lt;set $formUnlock to 0&gt;&gt;\n&lt;&lt;set $devilForm to 0&gt;&gt;\n&lt;&lt;set $rage to 0&gt;&gt;\n\n&lt;&lt;set $spBase to 1000&gt;&gt;\n\n&lt;&lt;set $location to &quot;&quot;&gt;&gt;\n&lt;&lt;set $from to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $battletheme to 1&gt;&gt;\n&lt;&lt;set $battlethemepicker to 0&gt;&gt;\n&lt;&lt;set $hurtmaker to 0&gt;&gt;\n&lt;&lt;set $subj to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $scarchance to 0&gt;&gt;\n&lt;&lt;set $scarchancesAmt to 0&gt;&gt;\n&lt;&lt;set $scartest to 0&gt;&gt;\n&lt;&lt;set $scarReport to 0&gt;&gt;\n&lt;&lt;set $wounds to 0&gt;&gt;\n&lt;&lt;set $restScars to &quot;&quot;&gt;&gt;\n&lt;&lt;set $restReport to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set setup.xpreq to 100&gt;&gt;/%xp per level%/\n&lt;&lt;set setup.attrcap to 10&gt;&gt;/%attribute cap%/\n\n&lt;&lt;set $booster to 0&gt;&gt;\n&lt;&lt;set $movbonus to 0&gt;&gt;\n&lt;&lt;set $crityes to 0&gt;&gt;\n\n&lt;&lt;set $playeraction to 1&gt;&gt;\n&lt;&lt;set $combatnext to &quot;&quot;&gt;&gt;\n&lt;&lt;set $nmeaction to 1&gt;&gt;\n&lt;&lt;set $nmedefboost to 1.0&gt;&gt;\n\n&lt;&lt;set $armorupgrade to 0&gt;&gt;\n\n&lt;&lt;set $playerturn to 1&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n&lt;&lt;set $courtyardgate to 0&gt;&gt;\n\n&lt;&lt;set $specialname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $spelldamReport to &quot;&quot;&gt;&gt;\n&lt;&lt;set $effectReport to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $flinched to false&gt;&gt;\n&lt;&lt;set $rager to 0&gt;&gt;\n</div><div tiddler="extrajournal" tags="" created="201612141430" modifier="twee"></div><div tiddler="0choice1one" tags="dock" created="201701140607" modifier="twee">Elesun hopes the king and Irelith are alright.\n\nShe needs to wrap this up fast.</div><div tiddler="1servQuarters" tags="space" created="201701281954" modifier="twee">&lt;&lt;image &quot;manSm&quot;&gt;&gt;&lt;&lt;image &quot;womanSm&quot;&gt;&gt;&lt;&lt;if $helpServants&gt;&gt;The servant's quarters were cleaned, but Elesun can't forget what she saw here.&lt;&lt;else&gt;&gt;Apparently, Aesil had his way with the servants quarters and its occupants during the siege.&lt;&lt;endif&gt;&gt;  The poor bastards who &lt;&lt;weak 'cleaned it' '1servqClean'&gt;&gt; were taking turns puking outside and crying.\n\nA few &lt;&lt;weak 'servants' '1servqServ'&gt;&gt; are milling about, taking breaks or finishing up the day's work.  &lt;&lt;action &quot;Andre, the King's royal smith&quot; '1servqAndre'&gt;&gt; is sitting on the ground outside his quarters, and he looks exhausted. \n\n&lt;span id=&quot;navbox&quot;&gt;&lt;&lt;mapHarlan $now&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="spell_rage" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Rage&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Neutral&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Rage&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;rage_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 5&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.2&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to -10&gt;&gt;\n\n&lt;&lt;set $satk to 1.1&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to -5&gt;&gt;\n\n&lt;&lt;if $neutraltraining is 1&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n&lt;&lt;elseif $neutraltraining is 2&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n\t&lt;&lt;set $spelldispel to 0&gt;&gt;\n&lt;&lt;elseif $neutraltraining is 3&gt;&gt;\n\t&lt;&lt;set $spellgrit to 0&gt;&gt;\n\t&lt;&lt;set $satk to 1.2&gt;&gt;\n\t&lt;&lt;set $spelldispel to 0&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="unarmed" tags="nobr" created="201612131440" modifier="twee">&lt;&lt;set $weaponname to &quot;Unarmed&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;fists_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 0.6&gt;&gt;\n&lt;&lt;set $wdef to 0.8&gt;&gt;\n&lt;&lt;set $wmov to 1.2&gt;&gt;\n&lt;&lt;set $critrange to 95&gt;&gt;\n\n&lt;&lt;set $wStaUse to 3&gt;&gt;\n\n&lt;&lt;if $unarmedtraining is 1&gt;&gt;\n\t&lt;&lt;set $critrange to 90&gt;&gt;\n&lt;&lt;elseif $unarmedtraining is 2&gt;&gt;\n\t&lt;&lt;set $critrange to 90&gt;&gt;\n\t&lt;&lt;set $watk to 0.8&gt;&gt;\n&lt;&lt;elseif $unarmedtraining is 3&gt;&gt;\n\t&lt;&lt;set $critrange to 90&gt;&gt;\n\t&lt;&lt;set $watk to 1.0&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="codex_Irelith" tags="menu" created="201701261837" modifier="twee">&lt;&lt;image &quot;IrePt&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Irelith''\n\nIrelith was the first demonkin to join King Harmon's army, and swore fealty to him.  Her strength and skill in combat is unmatched, and she rose through the ranks of his military quickly over the next ten years.\n\nIrelith is currently the commander of the King's Guard, and serves as Harmon's personal body guard.  Years ago, in more peaceful times, she trained Lady Ripley and Prince Harlaus in the use of weapons and in personal combat.\n\nIrelith has earned a reputation on the battlefield for her sometimes reckless aggression and near-constant grinning.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="1cross2" tags="scene" created="201701282006" modifier="twee"></div><div tiddler="1cross3" tags="scene" created="201701282006" modifier="twee"></div><div tiddler="stats-setup" tags="init" created="201707082156" modifier="twee" twine-position="710,150">&lt;&lt;set $healing to 0&gt;&gt;\n\n&lt;&lt;set setup.base to 50&gt;&gt;\n&lt;&lt;set $rageCurrent to 0&gt;&gt;\n&lt;&lt;set $statbase to setup.base + Math.trunc($rageCurrent/4)&gt;&gt;\n&lt;&lt;set $strrank to 2&gt;&gt;\n&lt;&lt;set $strval to ($statbase*($strrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $agirank to 1&gt;&gt;\n&lt;&lt;set $agival to ($statbase*($agirank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $endrank to 1&gt;&gt;\n&lt;&lt;set $endval to ($statbase*($endrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $wilrank to 1&gt;&gt;\n&lt;&lt;set $wilval to ($statbase*($wilrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $cngrank to 1&gt;&gt;\n&lt;&lt;set $cngval to ($statbase*($cngrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n\n&lt;&lt;set $atkbase to Math.trunc($strval*0.5+$cngval*0.2)&gt;&gt;\n&lt;&lt;set $watk to 1.0&gt;&gt; /%weapon atk mod%/\n&lt;&lt;set $aatk to 1.0&gt;&gt; /%armor atk mod%/\n&lt;&lt;set $satk to 1.0&gt;&gt; /%spell atk mod%/\n&lt;&lt;set $atk to Math.trunc($atkbase*$watk*$aatk*$satk)&gt;&gt;\n\n&lt;&lt;set $defbase to Math.trunc($endval*0.5+$strval*0.2)&gt;&gt;\n&lt;&lt;set $wdef to 1.0&gt;&gt;\n&lt;&lt;set $adef to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.1&gt;&gt;\n&lt;&lt;set $def to Math.trunc($defbase*$wdef*$adef*$sdef)&gt;&gt;\n\n&lt;&lt;set $movbase to Math.trunc($agival*0.5+$cngval*0.2)&gt;&gt;\n&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;set $amov to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n&lt;&lt;set $mov to Math.trunc($movbase*$wmov*$amov*$smov)&gt;&gt;\n\n&lt;&lt;set $critchance to Math.trunc(($agival/10+$cngrank)+$spellcrit)&gt;&gt;\n&lt;&lt;set $critmult to $agival/100+1&gt;&gt;\n&lt;&lt;set $critdam to Math.trunc($atk*$critmult*$spellcritdam)&gt;&gt;\n&lt;&lt;set $dodge to Math.trunc(((5+$agirank*2.5)+$cngrank)+$spelldodge)&gt;&gt;\n\n&lt;&lt;set $maxsta to Math.trunc($endval/10+$wilrank+8)&gt;&gt;\n&lt;&lt;set $sta to $maxsta&gt;&gt;\n&lt;&lt;set $maxgrit to 100+$endval+$spellgrit&gt;&gt;\n&lt;&lt;set $grit to $maxgrit&gt;&gt;\n&lt;&lt;set $maxhealth to Math.trunc(3+$scars/5)&gt;&gt;\n&lt;&lt;set $health to $maxhealth&gt;&gt;\n&lt;&lt;set $power to $lvl*$statbase+(($maxhealth*$maxhealth*$maxhealth)+$maxhealth*7)+$lvl+1&gt;&gt;\n\n&lt;&lt;set $dodgedatks to 0&gt;&gt;\n&lt;&lt;set $regen to Math.trunc($wilrank/2)&gt;&gt;\n\n&lt;&lt;set $rageBuild to $wilrank + 4&gt;&gt;\n&lt;&lt;set $rageDecay to 34 - $endrank&gt;&gt;\n&lt;&lt;set $rageStock to 0&gt;&gt;\n\n&lt;&lt;set $dispel to $basedispel+$spelldispel+$wilrank&gt;&gt;\n\n&lt;&lt;set $ripleylvl to 1&gt;&gt;\n&lt;&lt;set $ripleyscars to 0&gt;&gt;\n&lt;&lt;set $ripleystr to 1&gt;&gt;\n&lt;&lt;set $ripleyagi to 1&gt;&gt;\n&lt;&lt;set $ripleyend to 1&gt;&gt;\n&lt;&lt;set $ripleywil to 1&gt;&gt;\n&lt;&lt;set $ripleycng to 1&gt;&gt;\n&lt;&lt;set $ripleybase to 60&gt;&gt;\n&lt;&lt;set $ripleyxp to 0&gt;&gt;\n&lt;&lt;set $ripleytp to 0&gt;&gt;</div><div tiddler="1cross1" tags="scene" created="201701282006" modifier="twee"></div><div tiddler="0wall" tags="space" created="201701140720" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;span id=&quot;gone&quot;&gt;&lt;&lt;dock &quot;Ripley&quot; &quot;0wallRip&quot;&gt;&gt;&lt;/span&gt; is still standing near the edge, but she’s turned her back to the &lt;&lt;action &quot;tragedy below&quot; &quot;0wallTragedy&quot;&gt;&gt;.\n\nElesun hopes that if they &lt;&lt;action &quot;hurry&quot; &quot;0wallSouth&quot;&gt;&gt;, they can get to the king before anything bad happens.\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="No Armor" tags="menu" created="201612131636" modifier="twee">Do you wish to unequip your armor?\n\nYour defenses will plummet.\n\n[[Yes|changearmor][$change to &quot;no&quot;]]\n[[No|armorswap]]</div><div tiddler="weaken" tags="nobr" created="201701241630" modifier="twee">/%  6  %/\n&lt;&lt;set $specialMult to 0.4&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;Blunted&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,1,1)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 0.5&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 0.5&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Weaken&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="navbox" tags="" created="201702120853" modifier="twee" twine-position="290,710">&lt;span id=&quot;navbox&quot;&gt; &lt;/span&gt;</div><div tiddler="1sqETC" tags="" created="201701282012" modifier="twee"></div><div tiddler="cominfo_fake0" tags="" created="201701260136" modifier="twee">&lt;span id=&quot;info&quot;&gt;&lt;span id=&quot;playerstats&quot;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playerstatsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playerstats&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;\n&lt;span id=&quot;combatmessages&quot;&gt;&lt;&lt;display &quot;combat_report&quot;&gt;&gt;&lt;/span&gt;\n&lt;span id=&quot;combatactions&quot;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playeractions_fake0&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playeractions_fake0&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;\n&lt;/span&gt;</div><div tiddler="sq1compl" tags="menu" created="201704221625" modifier="twee">/%Open as alert.%/Elesun stops by the smithy to tell the blacksmith about the king's decision.\n\n&quot;Thanks, Elesun,&quot; the blacksmith says.  &quot;After I finish the repairs, I'll make something special for you.  Stop back in a few days.&quot; \n&lt;&lt;silently&gt;&gt;\n&lt;&lt;set $sq1.progress to 100&gt;&gt;\n&lt;&lt;for _i to 0; _i lt $sq.length; _i++&gt;&gt;\n  &lt;&lt;if $sq[_i].code is 1&gt;&gt;\n    &lt;&lt;set $index to _i&gt;&gt;\n    &lt;&lt;break&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;/for&gt;&gt;\n&lt;&lt;run $sq.splice($index, 1)&gt;&gt;/%remove sidequest from docket%/\n&lt;&lt;run $sqDone.push($sq1.title)&gt;&gt; /%add title of sidequest to finished quests docket%/\n&lt;&lt;endsilently&gt;&gt;\n[[Okay.|previous()]]</div><div tiddler="1KingHarl" tags="dock" created="201707110121" modifier="twee">&quot;My dutiful son, always trying to be wiser than I.  He just might be.  If you haven't seen him yet you should, he's been meaning to talk to you.&quot;</div><div tiddler="gaun_ui" tags="" created="201702020412" modifier="twee">Well-armored gauntlets featuring claws and spikes.\n\nThe spikes and claws make holding a weapon with these gauntlets difficult.  Fortunately, their design makes them a weapon in themselves.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Low|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:Very Low|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Moderate|\n*__Finesse__: Very High\n*__Stamina__: Very Low</div><div tiddler="cnginfo" tags="" created="201612151656" modifier="twee">\nA measure of intelligence and craftiness.  Cunning has influences attack and movement, and has a large impact on critical chance.\n\n</div><div tiddler="playeractionsMobile" tags="" created="201701110239" modifier="twee">&lt;&lt;if $playerturn is 1&gt;&gt;&lt;&lt;if $sta gt 0&gt;&gt;[[2. Defend|highway2][$playeraction to 2]] - [[3. Move|highway2][$playeraction to 3]]&lt;&lt;else&gt;&gt;[[4. End Turn|highway2]]&lt;&lt;endif&gt;&gt;&lt;&lt;else&gt;&gt;[[Ctrl: Continue|$combatnext]]\n&lt;&lt;endif&gt;&gt;</div><div tiddler="leatherarmor" tags="nobr" created="201612131618" modifier="twee">&lt;&lt;set $armorname to &quot;Leather Armor&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;leath_ui&quot;&gt;&gt;\n\n&lt;&lt;set $aatk to 1.0&gt;&gt;\n&lt;&lt;set $adef to 1.0&gt;&gt;\n&lt;&lt;set $amov to 1.0&gt;&gt;\n\n&lt;&lt;if $leatherplus eq 1&gt;&gt;\n\t&lt;&lt;set $adef to 1.1&gt;&gt;\n\t&lt;&lt;set $amov to 1.1&gt;&gt;\n\t&lt;&lt;set $armorname to &quot;Leather Armor+&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1ripqMed" tags="dock" created="201708232057" modifier="twee">Druids love their meditiation--connecting with nature.  They seem to enjoy it most when they're indoors.  There's something to it, probably, those traditional Druid beliefs.  Elesun doesn't know what, but there's probably something to it.</div><div tiddler="naked_ui" tags="" created="201702020430" modifier="twee">No armor is equipped.\n\n|[img[setup.ui.icons.ui_def]]|Defense Bonus:|None|\n|[img[setup.ui.icons.ui_mov]]|Encumberance:|None|</div><div tiddler="Great Sword" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;gswd_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;great&quot;]]\n[[No|weaponswap]]</div><div tiddler="Ghost" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;ghst_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;gho&quot;]]\n[[No|spellswap]]</div><div tiddler="vowInit" tags="init" created="201710061920" modifier="twee" twine-position="290,1130">/% types: 0 - main, 1 - side, 2 - secret, 3 - debug %/\n&lt;&lt;set setup.vows to {\n\tlist : {},\n\tprot : {\n\t\tid    : '',\n\t\ttitle : '',\n\t\tdescr : '',\n\t\toutc  : '',\n\t\ttype  : 0\n\t},\n\tnames : [\n\t\t'bastard', \n\t\t'charlatan', \n\t\t'scoundrel',\n\t\t'and unproven',\n\t\t'advocate',\n\t\t'upholder',\n\t\t'oathkeeper',\n\t\t'champion'\n\t],\n\ttiers : [\n\t\t'neutral',\n\t\t'pragmatic',\n\t\t'tricky',\n\t\t'opportunistic',\n\t\t'slick',\n\t\t'rigid',\n\t\t'noble',\n\t\t'devoted',\n\t\t'idealistic',\n\t\t'pedantic',\n\t\t'strict',\n\t\t'level-headed',\n\t\t'driven'\n\t]\n}&gt;&gt;\n\n&lt;&lt;set $vows to {\n\tcurrent  : [],\n\tcomplete : [],\n    broken   : [],\n\tstats    : {\n\t\tstrict : 0,\n\t\tloose  : 0,\n\t\tletter : 0,\n\t\tspirit : 0,\n\t\thonor  : 1,\n\t\tclever : 1\n\t},\n\tordered  : [],\n\tpoints   : 0,\n\ttier     : 'neutral',\n\tname     : 'and unproven',\n\tstr      : 'neutral and unproven'\n}&gt;&gt;\n\n&lt;&lt;display 'vowList'&gt;&gt;\n\n&lt;&lt;addvow 'protRip'&gt;&gt;\n&lt;&lt;addvow 'serveKing'&gt;&gt;</div><div tiddler="0choice2friends" tags="dock" created="201701250436" modifier="twee">Elesun bet that Ripley knew the name of every servant, cook, and soldier in the castle.  Maybe every serf in the village, too.  She made friends easy.  And Akatosh killed them just as easily.\n\nHow much will be enough to break her?</div><div tiddler="0protectking2Ire" tags="dock" created="201701260031" modifier="twee">&lt;&lt;if $process lt 3&gt;&gt;&quot;Good to see you alive, Elesun,&quot; Irelith says.&lt;&lt;set $process++&gt;&gt;\n\n&quot;You too.  You going to be all right?&quot;\n\n&quot;Yeah.  We managed to drive most of them off.  Just wish I wasn't stuck in here.&quot;&lt;&lt;else&gt;&gt;&quot;You hear that?&quot; Irelith looks toward the remains of the wall.  &quot;Someone's coming.&quot;\n\n&lt;&lt;ctrlClick &quot;Yeah.  I hear it.&quot; &quot;0protectking3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="1orMole" tags="dock" created="201701281959" modifier="twee">Who would do it?  And why?  Sure, wars often had their defectors and traitors, but it was hard for Elesun to imagine anyone actively trying to get Ripley killed.</div><div tiddler="tut_onGritDam" tags="hook tutorial" created="201707101335" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has just been attacked by an enemy and taken some &lt;&lt;= setup.words.grit&gt;&gt; damage. Her &lt;&lt;= setup.words.grit&gt;&gt; is represented as a bar on the bottom of the screen.  When her &lt;&lt;= setup.words.grit&gt;&gt; is fully depleted, &lt;&lt;name&gt;&gt; will lose a heart.\n\n&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt; represents &lt;&lt;name&gt;&gt;'s ability to avoid getting wounded or taking a nasty blow--it's a combination of her skill, luck, and armor.  When her luck runs out and her &lt;&lt;= setup.words.grit&gt;&gt; is depleted, she takes a hit and gets wounded.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onGritDam'&gt;&gt;</div><div tiddler="volume-js" tags="script" created="201706111327" modifier="twee" twine-position="430,430">// volume slider, by chapel; for sugarcube 2\n// version 1.0\n\n// create namespace\nsetup.vol = {};\n\n// options object\nsetup.vol.options = {\n\tcurrent  : 75,\n\trangeMax : 100,\n\tstep     : 1\n};\n\nsetup.vol.last = setup.vol.options.current;\nsetup.vol.start = setup.vol.last / setup.vol.options.rangeMax;\n\npostdisplay['volume-task'] = function (taskName) {\n\tdelete postdisplay[taskName];\n\tSimpleAudio.volume = setup.vol.start;\n}\n\n!function () {\n\t$(document).on('input', 'input[name=volume]', function() {\n\t\t// grab new volume from input\n\t\tvar volRef     = setup.vol.options;\n\t\tvar change     = $('input[name=volume]').val();\n\t\tvar newVol     = change / volRef.rangeMax;\n\t\tvolRef.current = newVol.toFixed(2);\n\n\t\t// change volume; set slider position\n\t\tSimpleAudio.volume = volRef.current;\n\t\tsetup.vol.last = change;\n\t});\n}();\n\nMacro.add('volume', {\n\thandler : function () {\n\t\t\n\t\t// set up variables\n\t\tvar $wrapper  = $(document.createElement('span'));\n\t\tvar $slider   = $(document.createElement('input'));\n\t\tvar className = 'macro-' + this.name;\n\t\tvar volRef    = setup.vol.options;\n\t\t\n\t\t// create range input\n\t\t$slider\n\t\t\t.attr({\n\t\t\t\tid    : 'volume-control',\n\t\t\t\ttype  : 'range',\n\t\t\t\tname  : 'volume',\n\t\t\t\tmin   : '0',\n\t\t\t\tmax   : volRef.rangeMax,\n\t\t\t\tstep  : volRef.step,\n\t\t\t\tvalue : setup.vol.last\n\t\t\t});\n\t\t// class '.macro-volume' and id '#volume-control' for styling\n\t\t\t\n\t\t// output\n\t\t$wrapper\n\t\t\t.append($slider)\n\t\t\t.addClass(className)\n\t\t\t.appendTo(this.output);\n\t}\n});</div><div tiddler="0protectking2soldier" tags="dock" created="201701260031" modifier="twee">A sad thing to see.  Ripley seemed almost like she was trying not to look for fear of seeing a familiar face.</div><div tiddler="0iwinspect" tags="dock" created="201701070318" modifier="twee">It's early evening, and the torches give the dark corridor a hellish orange glow.  The hall is clean and well-kept, though the stone walls are growing more uneven every few years.</div><div tiddler="levelup" tags="menu" created="201612131849" modifier="twee">Select an attribute to increase:\n&lt;&lt;set $lvl to $lvl+1&gt;&gt;&lt;&lt;set $tp to $tp+3&gt;&gt;\n|[img[setup.ui.icons.strIcon]] |&lt;&lt;if $strrank lt setup.attrcap&gt;&gt;[[Strength|levelup2][$strrank to $strrank+1]]:  &lt;&lt;print $strrank&gt;&gt;&lt;&lt;else&gt;&gt;Your strength can't go any higher.&lt;&lt;endif&gt;&gt;|\n|[img[setup.ui.icons.agiIcon]] |&lt;&lt;if $agirank lt setup.attrcap&gt;&gt;[[Agility|levelup2][$agirank to $agirank+1]]:  &lt;&lt;print $agirank&gt;&gt;&lt;&lt;else&gt;&gt;Your agility can't go any higher.&lt;&lt;endif&gt;&gt;|\n|[img[setup.ui.icons.endIcon]] |&lt;&lt;if $endrank lt setup.attrcap&gt;&gt;[[Endurance|levelup2][$endrank to $endrank+1]]:  &lt;&lt;print $endrank&gt;&gt;&lt;&lt;else&gt;&gt;Your endurance can't go any higher.&lt;&lt;endif&gt;&gt;|\n|[img[setup.ui.icons.wilIcon]] |&lt;&lt;if $wilrank lt setup.attrcap&gt;&gt;[[Will|levelup2][$wilrank to $wilrank+1]]:  &lt;&lt;print $wilrank&gt;&gt;&lt;&lt;else&gt;&gt;Your will can't go any higher.&lt;&lt;endif&gt;&gt;|\n|[img[setup.ui.icons.cngIcon]] |&lt;&lt;if $cngrank lt setup.attrcap&gt;&gt;[[Cunning|levelup2][$cngrank to $cngrank+1]]:  &lt;&lt;print $cngrank&gt;&gt;&lt;&lt;else&gt;&gt;Your cunning can't go any higher.&lt;&lt;endif&gt;&gt;|</div><div tiddler="1orRescue" tags="dock" created="201701281959" modifier="twee">At this pace, Elesun should make Merac by nighfall.\n\n&lt;&lt;ctrlClick 'Push the horse harder.' '1afterRip1'&gt;&gt;</div><div tiddler="AudioLoad" tags="nobr" created="201701062356" modifier="twee" twine-position="10,850">&lt;&lt;masteraudio stop&gt;&gt;\n&lt;&lt;switch $song&gt;&gt;\n&lt;&lt;case 0&gt;&gt;\n\t&lt;&lt;audio &quot;oh&quot; loop play&gt;&gt;\n&lt;&lt;case -1&gt;&gt;\n\t&lt;&lt;audio &quot;herat7&quot; loop play&gt;&gt;\n&lt;&lt;case -2&gt;&gt;\n\t&lt;&lt;audio &quot;expressions-of-the-mind&quot; loop play&gt;&gt;\n&lt;&lt;case 1&gt;&gt;\n\t&lt;&lt;audio &quot;cibelle&quot; loop play&gt;&gt;\n&lt;&lt;case -3&gt;&gt;\n\t&lt;&lt;audio &quot;demon1&quot; loop play&gt;&gt;\n&lt;&lt;case -4&gt;&gt;\n\t&lt;&lt;audio &quot;demon2&quot; loop play&gt;&gt;\n&lt;&lt;/switch&gt;&gt;</div><div tiddler="1tavern" tags="space" created="201701282004" modifier="twee"></div><div tiddler="1HarlScene" tags="scene save" created="201702121122" modifier="twee">&lt;&lt;image 'HarlSmKid'&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;set $HarlScene to 1&gt;&gt;&quot;Have you been to the village, yet?&quot; Harlaus asks.  &quot;Since the attack, I mean.&quot;\n\nElesun sighs.  &quot;Yeah.&quot;\n\n&quot;I think we need to get Ripley out of the castle.  It's only a two days' ride to the grove.  She's been wanting to go.  What do you think?&quot;\n\n&quot;I think that'd be good for her.  See some friendly faces.&quot;\n\n&quot;I've spoken to my father.  I'll have a carriage prepared in the morning.  I can have Irelith assemble some soldiers to keep you safe.&quot;\n\n&quot;That's a good idea,&quot; Elesun replies.  &quot;Not too many men, though, we don't need any attention.&quot;\n\n&quot;Fair point.&quot;\n\n//Journal updated.//&lt;&lt;set $storystage to 2&gt;&gt;\n\n&lt;&lt;ctrlCon '1mainhall'&gt;&gt;</div><div tiddler="shakemacro" tags="script" created="201612172141" modifier="twee" twine-position="430,290">/*! &lt;&lt;shake&gt;&gt; macro set for SugarCube 2.x */\n!function(){&quot;use strict&quot;;if(&quot;undefined&quot;==typeof version||&quot;undefined&quot;==typeof version.title||&quot;SugarCube&quot;!==version.title||&quot;undefined&quot;==typeof version.major||version.major&lt;2||&quot;undefined&quot;==typeof version.minor||version.minor&lt;5)throw new Error(&quot;&lt;&lt;shake&gt;&gt; macro requires SugarCube 2.5.0 or greater, aborting load&quot;);Macro.add(&quot;shake&quot;,{tags:null,handler:function(){var duration=this.args.length&gt;0?this.args[0]:1/0,shakeClass=&quot;shake&quot;;if(1/0!==duration)try{duration=Math.max(Engine.minDomActionDelay,Util.fromCssTime(duration))}catch(e){return this.error(e.message)}Config.debug&amp;&amp;this.debugView.modes({block:!0});var $wrapper=jQuery(document.createElement(&quot;span&quot;));$wrapper.addClass(&quot;macro-&quot;+this.name+&quot; &quot;+shakeClass).wiki(this.payload[0].contents).appendTo(this.output),1/0!==duration&amp;&amp;setTimeout(function(){$wrapper.removeClass(shakeClass)},Engine.minDomActionDelay+duration)}}),Macro.add([&quot;shakescreen&quot;,&quot;shaketarget&quot;],{handler:function(){var $targets,duration,shakeClass;if(&quot;shakescreen&quot;===this.name)$targets=jQuery(&quot;#passages&quot;),duration=this.args.length&gt;0?this.args[0]:1/0,shakeClass=&quot;shake-block&quot;;else{if(0===this.args.length)return this.error(&quot;no selector specified&quot;);if($targets=jQuery(this.args[0]),0===$targets.length)return this.error('no elements matched the selector &quot;'+this.args[0]+'&quot;');duration=this.args.length&gt;1?this.args[1]:1/0,shakeClass=&quot;block&quot;===jQuery($targets[0]).css(&quot;display&quot;)?&quot;shake-block&quot;:&quot;shake&quot;}if(&quot;stop&quot;===duration)return void $targets.removeClass(shakeClass);if(1/0!==duration)try{duration=Math.max(Engine.minDomActionDelay,Util.fromCssTime(duration))}catch(e){return this.error(e.message)}$targets.addClass(shakeClass),1/0!==duration&amp;&amp;setTimeout(function(){$targets.removeClass(shakeClass)},Engine.minDomActionDelay+duration)}})}();\n</div><div tiddler="0choice2" tags="choice" created="201701140729" modifier="twee">&lt;&lt;image &quot;RipPtKid&quot;&gt;&gt;&lt;&lt;set $choice2 to 1&gt;&gt;Ripley looks up at Elesun when she gets near.  &quot;I'm sorry, I need to &lt;&lt;weak &quot;pull myself together&quot; &quot;0choice2tough&quot;&gt;&gt;.&quot;\n\nBefore she can say anything else, she sobs again.  &quot;I think I saw &lt;&lt;weak &quot;Jonah's face&quot; &quot;0choice2friends&quot;&gt;&gt; on the side of it.  Part of it at least.&quot;\n\nShe shudders, &lt;&lt;weak &quot;with both powerless rage and desperate sadness&quot; &quot;0choice2hate&quot;&gt;&gt;.\n\n&lt;span id='action-link'&gt;[[Be considerate.|0choice2thoughtful][$ripleyxp to $ripleyxp+20]]&lt;/span&gt;\n\n&lt;span class='action-link'&gt;[[Be tough.|0choice2rough][$ripleyscars++]]&lt;/span&gt;\n\n&lt;span class='action-link'&gt;[[Be supportive.|0choice2motherly][$ripleytp++]]&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n</div><div tiddler="Clawed Gauntlets" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;gaun_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;gaunt&quot;]]\n[[No|weaponswap]]</div><div tiddler="bugr" tags="menu" created="201701110314" modifier="twee">&lt;&lt;set $bugcode to setup.encode(State.variables)&gt;&gt;If you have encountered a bug, please create a report using the form below&lt;&lt;if $webversion is 0&gt;&gt; (requires internet connection)&lt;&lt;endif&gt;&gt;.\n\nHere is your bug report code:  \n\n&lt;&lt;button 'Select All'&gt;&gt;&lt;&lt;run $('#bug textarea').select()&gt;&gt;&lt;&lt;/button&gt;&gt; &lt;&lt;button 'Copy to Clipboard'&gt;&gt;&lt;&lt;run $('#bug textarea').select(); document.execCommand('copy');&gt;&gt;&lt;&lt;/button&gt;&gt;\n&lt;span id='bug'&gt;&lt;&lt;textarea '_dummy' $bugcode&gt;&gt;&lt;/span&gt;\n&lt;&lt;nobr&gt;&gt;&lt;&lt;script&gt;&gt;\npostdisplay['bug-text-readonly'] = function (t) {\n\t$('#bug textarea').attr('readonly', true);\n\tdelete postdisplay[t];\n};\n&lt;&lt;/script&gt;&gt;&lt;&lt;endnobr&gt;&gt;\n&lt;center&gt;\n&lt;iframe src=&quot;https://docs.google.com/forms/d/e/1FAIpQLScDj4h2ChNrm2dOxw9pDP8hCR2lENz9XPfjb1cnkMqNhp1GYA/viewform?embedded=true&quot; width=&quot;900&quot; height=&quot;500&quot; frameborder=&quot;0&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&gt;Loading...&lt;/iframe&gt;&lt;/center&gt;\n\n</div><div tiddler="0choice1" tags="choice save" created="201701110810" modifier="twee">&lt;&lt;image &quot;RipPtKid&quot;&gt;&gt;&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpdecisions&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\nAs Elesun approaches Ripley’s quarters, she can here fighting.  Ripley seems to have been the &lt;&lt;weak &quot;target&quot; &quot;0choice1target&quot;&gt;&gt; all along.  At least &lt;&lt;weak &quot;one of them&quot; &quot;0choice1one&quot;&gt;&gt;.  She enters the stone corridors of the parapet and rushes up the spiraling stone stairs until she finds herself in Ripley’s antechamber.\n\nBefore she can enter Ripley’s room, the door &lt;&lt;weak &quot;explodes open&quot; &quot;0choice1door&quot;&gt;&gt; as a soldier crashes through it and slides motionless across the floor to her feet.  He’s hurt, but &lt;&lt;weak &quot;still alive&quot; &quot;0choice1pacifism&quot;&gt;&gt;.  As usual for Ripley.\n\nThrough the door, Elesun can see her.  She has red hair gathered in a braid, and she’s dressed for supper, not battle.  She’s &lt;&lt;weak &quot;barefoot&quot; &quot;0choice1barefoot&quot;&gt;&gt; in accordance with her &lt;&lt;weak &quot;druid beliefs&quot; &quot;0choice1druid&quot;&gt;&gt;.  She’s wearing a &lt;&lt;weak &quot;white dress&quot; &quot;0choice1dress&quot;&gt;&gt;, and her &lt;&lt;weak &quot;golden bangles&quot; &quot;0choice1bangles&quot;&gt;&gt; gleam on her wrists, arms, ankles, and legs.\n\nShe has her back to what’s left of the door, and is staring down a &lt;&lt;weak &quot;well-armed assassin&quot; &quot;0choice1assassin&quot;&gt;&gt;.  The assassin raises his blade toward her.  Ripley just takes a &lt;&lt;weak &quot;fighting stance&quot; &quot;0choice1stance&quot;&gt;&gt; and &lt;&lt;weak &quot;waits&quot; &quot;0choice1waits&quot;&gt;&gt;.\n\nElesun considers her options.\n\n&lt;span class='action-link'&gt;[[Ripley can handle herself.|0letRipfight][$ripleyscars++]]&lt;/span&gt;\n\n&lt;span class='action-link'&gt;[[She’s in danger.|combat_call_0_2][$ripleytp++]]&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="ASSET_LOADER" tags="init" created="201707072217" modifier="twee" twine-position="10,150">/% path grabber %/\n&lt;&lt;set setup.assets to {\n\timg: 'assets/img/',\n\tmisc: 'assets/img/art/misc/',\n\trip: 'assets/img/art/rip/',\n\tripKid: 'assets/img/art/rip/kid/',\n\tripAd: 'assets/img/art/rip/adult/',\n\tripEmL: 'assets/img/art/rip/adult/emPt/',\n\tripEmS: 'assets/img/art/rip/adult/emSm/',\n\tele: 'assets/img/art/ele/',\n\tire: 'assets/img/art/ire/',\n\tnme: 'assets/img/nme/',\n\tmaps: 'assets/img/maps/',\n\tui_: 'assets/img/interface/',\n\tgrit: 'assets/img/interface/grit/',\n\thearts: 'assets/img/interface/hearts/',\n\trage: 'assets/img/interface/rage/',\n\ticn: 'assets/img/interface/icn/',\n\ttut: 'assets/img/interface/tut/',\n\n\taudio: 'assets/audio/',\n\teffects: 'assets/audio/effects/',\n\tmusic: 'assets/audio/music/',\n\tbattle: 'assets/audio/music/battle/',\n\tvoice: 'assets/audio/voice/'\n}&gt;&gt;\n\n/% image grabber %/\n&lt;&lt;set setup.img to {\n\tEleCl: 'assets/img/art/ele/cl.jpg',\n\tEleSm: 'assets/img/art/ele/sm.jpg',\n\tElePt: 'assets/img/art/ele/pt.jpg',\n\n\tIreCl: 'assets/img/art/ire/cl.jpg',\n\tIreSm: 'assets/img/art/ire/sm.jpg',\n\tIrePt: 'assets/img/art/ire/pt.jpg',\n\n\tRipCl: 'assets/img/art/rip/adult/cl.jpg',\n\tRipSm: 'assets/img/art/rip/adult/sm.jpg',\n\tRipPt: 'assets/img/art/rip/adult/pt.jpg',\n\n\tRipClKid: 'assets/img/art/rip/kid/cl.jpg',\n\tRipSmKid: 'assets/img/art/rip/kid/sm.jpg',\n\tRipPtKid: 'assets/img/art/rip/kid/pt.jpg',\n\n\tRipPtECH1: 'assets/img/art/rip/kid/endCh1.jpg',\n\tRipSmECH1: 'assets/img/art/rip/kid/endCh1Sm.jpg',\n\tRipPtdevlKid: 'assets/img/art/rip/kid/smDvl.jpg',\n\tRipSmdevlKid: 'assets/img/art/rip/kid/PtDvl.jpg',\n\n\tRipSmbeat: 'assets/img/art/rip/adult/emSm/beat.jpg',\n\tRipPtbeat: 'assets/img/art/rip/adult/emPt/beat.jpg',\n\tRipSmbthp: 'assets/img/art/rip/adult/emSm/bthp.jpg',\n\tRipPtbthp: 'assets/img/art/rip/adult/emPt/bthp.jpg',\n\tRipSmconf: 'assets/img/art/rip/adult/emSm/conf.jpg',\n\tRipPtconf: 'assets/img/art/rip/adult/emPt/conf.jpg',\n\tRipSmdetr: 'assets/img/art/rip/adult/emSm/detr.jpg',\n\tRipPtdetr: 'assets/img/art/rip/adult/emPt/detr.jpg',\n\tRipSmdevl: 'assets/img/art/rip/adult/emSm/devl.jpg',\n\tRipPtdevl: 'assets/img/art/rip/adult/emPt/devl.jpg',\n\tRipSmdola: 'assets/img/art/rip/adult/emSm/dola.jpg',\n\tRipPtdola: 'assets/img/art/rip/adult/emPt/dola.jpg',\n\tRipSmdoll: 'assets/img/art/rip/adult/emSm/doll.jpg',\n\tRipPtdoll: 'assets/img/art/rip/adult/emPt/doll.jpg',\n\tRipSmdoln: 'assets/img/art/rip/adult/emSm/doln.jpg',\n\tRipPtdoln: 'assets/img/art/rip/adult/emPt/doln.jpg',\n\tRipSmeatn: 'assets/img/art/rip/adult/emSm/eatn.jpg',\n\tRipPteatn: 'assets/img/art/rip/adult/emPt/eatn.jpg',\n\tRipSmedis: 'assets/img/art/rip/adult/emSm/edis.jpg',\n\tRipPtedis: 'assets/img/art/rip/adult/emPt/edis.jpg',\n\tRipSmehap: 'assets/img/art/rip/adult/emSm/ehap.jpg',\n\tRipPtehap: 'assets/img/art/rip/adult/emPt/ehap.jpg',\n\tRipSmexct: 'assets/img/art/rip/adult/emSm/exct.jpg',\n\tRipPtexct: 'assets/img/art/rip/adult/emPt/exct.jpg',\n\tRipSmfinl: 'assets/img/art/rip/adult/emSm/finl.jpg',\n\tRipPtfinl: 'assets/img/art/rip/adult/emPt/finl.jpg',\n\tRipSmgrin: 'assets/img/art/rip/adult/emSm/grin.jpg',\n\tRipPtgrin: 'assets/img/art/rip/adult/emPt/grin.jpg',\n\tRipSmhapy: 'assets/img/art/rip/adult/emSm/hapy.jpg',\n\tRipPthapy: 'assets/img/art/rip/adult/emPt/hapy.jpg',\n\tRipSmhope: 'assets/img/art/rip/adult/emSm/hope.jpg',\n\tRipPthope: 'assets/img/art/rip/adult/emPt/hope.jpg',\n\tRipSmjoys: 'assets/img/art/rip/adult/emSm/joys.jpg',\n\tRipPtjoys: 'assets/img/art/rip/adult/emPt/joys.jpg',\n\tRipSmlagh: 'assets/img/art/rip/adult/emSm/lagh.jpg',\n\tRipPtlagh: 'assets/img/art/rip/adult/emPt/lagh.jpg',\n\tRipSmmask: 'assets/img/art/rip/adult/emSm/mask.jpg',\n\tRipPtmask: 'assets/img/art/rip/adult/emPt/mask.jpg',\n\tRipSmsadd: 'assets/img/art/rip/adult/emSm/sadd.jpg',\n\tRipPtsadd: 'assets/img/art/rip/adult/emPt/sadd.jpg',\n\tRipSmsigh: 'assets/img/art/rip/adult/emSm/sigh.jpg',\n\tRipPtsigh: 'assets/img/art/rip/adult/emPt/sigh.jpg',\n\tRipSmsurp: 'assets/img/art/rip/adult/emSm/surp.jpg',\n\tRipPtsurp: 'assets/img/art/rip/adult/emPt/surp.jpg',\n\tRipSmtoas: 'assets/img/art/rip/adult/emSm/toas.jpg',\n\tRipPttoas: 'assets/img/art/rip/adult/emPt/toas.jpg',\n\tRipSmwhat: 'assets/img/art/rip/adult/emSm/what.jpg',\n\tRipPtwhat: 'assets/img/art/rip/adult/emPt/what.jpg',\n\tRipSmworr: 'assets/img/art/rip/adult/emSm/worr.jpg',\n\tRipPtworr: 'assets/img/art/rip/adult/emPt/worr.jpg',\n\n\tAesPt1: 'assets/img/art/misc/AesPt1.jpg',\n\tAesSm1: 'assets/img/art/misc/AesSm1.jpg',\n\tAesPt2: 'assets/img/art/misc/AesPt2.jpg',\n\tAesSm2: 'assets/img/art/misc/AesSm2.jpg',\n\tAesPt3: 'assets/img/art/misc/AesPt3.jpg',\n\tAesSm3: 'assets/img/art/misc/AesSm3.jpg',\n\tAkaPt: 'assets/img/art/misc/AkaPt.jpg',\n\tAkaSm: 'assets/img/art/misc/AkaSm.jpg',\n\tAkaPtgrin: 'assets/img/art/misc/AkaPt_grin.jpg',\n\tAkaSmgrin: 'assets/img/art/misc/AkaSm_grin.jpg',\n\tAkaPtcraz: 'assets/img/art/misc/AkaPt_craz.jpg',\n\tAkaSmcraz: 'assets/img/art/misc/AkaSm_craz.jpg',\n\n\tFolsomPt: 'assets/img/art/misc/FolsomPt.jpg',\n\tFolsomSm: 'assets/img/art/misc/FolsomSm.jpg',\n\tHarlPt: 'assets/img/art/misc/HarlPt.jpg',\n\tHarlSm: 'assets/img/art/misc/HarlSm.jpg',\n\tHarlPtKid: 'assets/img/art/misc/HarlPtKid.jpg',\n\tHarlSmKid: 'assets/img/art/misc/HarlSmKid.jpg',\n\tKingPt: 'assets/img/art/misc/KingPt.jpg',\n\tKingSm: 'assets/img/art/misc/KingSm.jpg',\n\n\tmanPt: 'assets/img/art/misc/manPt.jpg',\n\tmanSm: 'assets/img/art/misc/manSm.jpg',\n\twomanPt: 'assets/img/art/misc/womanPt.jpg',\n\twomanSm: 'assets/img/art/misc/womanSm.jpg'\n\n}&gt;&gt;\n\n&lt;&lt;set setup.nme to {\n\tcloaked: 'assets/img/nme/cloaked.jpg',\n\tdragon: 'assets/img/nme/dragon.jpg',\n\tghostwoman: 'assets/img/nme/ghostwoman.jpg',\n\tknight: 'assets/img/nme/knight.jpg',\n\tNMEaes2: 'assets/img/nme/NMEaes2.jpg',\n\tNMEaxe: 'assets/img/nme/NMEaxe.jpg',\n\tNMEfemwarrior: 'assets/img/nme/NMEfemwarrior.jpg',\n\tNMEmage: 'assets/img/nme/NMEmage.jpg',\n\tNMEninjawoman: 'assets/img/nme/NMEninjawoman.jpg',\n\tNMEspear: 'assets/img/nme/NMEspear.jpg',\n\tNMEwarrior: 'assets/img/nme/NMEwarrior.jpg'\n}&gt;&gt;\n\n&lt;&lt;set setup.gen to {\n\tEleCl: 'assets/img/EleCl.jpg',\n\tRipCl: 'assets/img/RipCl.jpg',\n\t\n\ticon: 'assets/img/ic.png',\n\ttitlecard: 'assets/img/titlecard.png',\n\tcontrols: 'assets/img/controls.png'\n}&gt;&gt;\n\n&lt;&lt;set setup.ui to {\n\thearts: {},\n\tgrit: {},\n\trage: {},\n\ticons: {},\n\ttut: {},\n\t\n\tbanner: 'assets/img/interface/banner.png',\n\tgover: 'assets/img/interface/gover.png'\n}&gt;&gt;\n\n&lt;&lt;set setup.ui.hearts to {\n\t'0of1': 'assets/img/interface/hearts/0of1.png',\n\t'1of1': 'assets/img/interface/hearts/1of1.png',\n\t'0of2': 'assets/img/interface/hearts/0of2.png',\n\t'1of2': 'assets/img/interface/hearts/1of2.png',\n\t'2of2': 'assets/img/interface/hearts/2of2.png',\n\t'0of3': 'assets/img/interface/hearts/0of3.png',\n\t'1of3': 'assets/img/interface/hearts/1of3.png',\n\t'2of3': 'assets/img/interface/hearts/2of3.png',\n\t'3of3': 'assets/img/interface/hearts/3of3.png',\n\t'0of4': 'assets/img/interface/hearts/0of4.png',\n\t'1of4': 'assets/img/interface/hearts/1of4.png',\n\t'2of4': 'assets/img/interface/hearts/2of4.png',\n\t'3of4': 'assets/img/interface/hearts/3of4.png',\n\t'4of4': 'assets/img/interface/hearts/4of4.png',\n\t'0of5': 'assets/img/interface/hearts/0of5.png',\n\t'1of5': 'assets/img/interface/hearts/1of5.png',\n\t'2of5': 'assets/img/interface/hearts/2of5.png',\n\t'3of5': 'assets/img/interface/hearts/3of5.png',\n\t'4of5': 'assets/img/interface/hearts/4of5.png',\n\t'5of5': 'assets/img/interface/hearts/5of5.png',\n\t'0of6': 'assets/img/interface/hearts/0of6.png',\n\t'1of6': 'assets/img/interface/hearts/1of6.png',\n\t'2of6': 'assets/img/interface/hearts/2of6.png',\n\t'3of6': 'assets/img/interface/hearts/3of6.png',\n\t'4of6': 'assets/img/interface/hearts/4of6.png',\n\t'5of6': 'assets/img/interface/hearts/5of6.png',\n\t'6of6': 'assets/img/interface/hearts/6of6.png',\n\t'0of6e' : 'assets/img/interface/hearts/0of6e.png',\n\t'1of6e' : 'assets/img/interface/hearts/1of6e.png',\n\t'2of6e' : 'assets/img/interface/hearts/2of6e.png',\n\t'3of6e' : 'assets/img/interface/hearts/3of6e.png',\n\t'4of6e' : 'assets/img/interface/hearts/4of6e.png',\n\t'5of6e' : 'assets/img/interface/hearts/5of6e.png',\n\t'6of6e' : 'assets/img/interface/hearts/6of6e.png',\n\t'0of7': 'assets/img/interface/hearts/0of7.png',\n\t'1of7': 'assets/img/interface/hearts/1of7.png',\n\t'2of7': 'assets/img/interface/hearts/2of7.png',\n\t'3of7': 'assets/img/interface/hearts/3of7.png',\n\t'4of7': 'assets/img/interface/hearts/4of7.png',\n\t'5of7': 'assets/img/interface/hearts/5of7.png',\n\t'6of7': 'assets/img/interface/hearts/6of7.png',\n\t'7of7': 'assets/img/interface/hearts/7of7.png',\n\t'0of8': 'assets/img/interface/hearts/0of8.png',\n\t'1of8': 'assets/img/interface/hearts/1of8.png',\n\t'2of8': 'assets/img/interface/hearts/2of8.png',\n\t'3of8': 'assets/img/interface/hearts/3of8.png',\n\t'4of8': 'assets/img/interface/hearts/4of8.png',\n\t'5of8': 'assets/img/interface/hearts/5of8.png',\n\t'6of8': 'assets/img/interface/hearts/6of8.png',\n\t'7of8': 'assets/img/interface/hearts/7of8.png',\n\t'8of8': 'assets/img/interface/hearts/8of8.png',\n\t'0of9': 'assets/img/interface/hearts/0of9.png',\n\t'1of9': 'assets/img/interface/hearts/1of9.png',\n\t'2of9': 'assets/img/interface/hearts/2of9.png',\n\t'3of9': 'assets/img/interface/hearts/3of9.png',\n\t'4of9': 'assets/img/interface/hearts/4of9.png',\n\t'5of9': 'assets/img/interface/hearts/5of9.png',\n\t'6of9': 'assets/img/interface/hearts/6of9.png',\n\t'7of9': 'assets/img/interface/hearts/7of9.png',\n\t'8of9': 'assets/img/interface/hearts/8of9.png',\n\t'9of9': 'assets/img/interface/hearts/9of9.png',\n\t'0of10': 'assets/img/interface/hearts/0of10.png',\n\t'1of10': 'assets/img/interface/hearts/1of10.png',\n\t'2of10': 'assets/img/interface/hearts/2of10.png',\n\t'3of10': 'assets/img/interface/hearts/3of10.png',\n\t'4of10': 'assets/img/interface/hearts/4of10.png',\n\t'5of10': 'assets/img/interface/hearts/5of10.png',\n\t'6of10': 'assets/img/interface/hearts/6of10.png',\n\t'7of10': 'assets/img/interface/hearts/7of10.png',\n\t'8of10': 'assets/img/interface/hearts/8of10.png',\n\t'9of10': 'assets/img/interface/hearts/9of10.png',\n\t'10of10': 'assets/img/interface/hearts/10of10.png',\n\t'0of20': 'assets/img/interface/hearts/0of20.png',\n\t'1of20': 'assets/img/interface/hearts/1of20.png',\n\t'2of20': 'assets/img/interface/hearts/2of20.png',\n\t'3of20': 'assets/img/interface/hearts/3of20.png',\n\t'4of20': 'assets/img/interface/hearts/4of20.png',\n\t'5of20': 'assets/img/interface/hearts/5of20.png',\n\t'6of20': 'assets/img/interface/hearts/6of20.png',\n\t'7of20': 'assets/img/interface/hearts/7of20.png',\n\t'8of20': 'assets/img/interface/hearts/8of20.png',\n\t'9of20': 'assets/img/interface/hearts/9of20.png',\n\t'10of20': 'assets/img/interface/hearts/10of20.png',\n\t'11of20': 'assets/img/interface/hearts/11of20.png',\n\t'12of20': 'assets/img/interface/hearts/12of20.png',\n\t'13of20': 'assets/img/interface/hearts/13of20.png',\n\t'14of20': 'assets/img/interface/hearts/14of20.png',\n\t'15of20': 'assets/img/interface/hearts/15of20.png',\n\t'16of20': 'assets/img/interface/hearts/16of20.png',\n\t'17of20': 'assets/img/interface/hearts/17of20.png',\n\t'18of20': 'assets/img/interface/hearts/18of20.png',\n\t'19of20': 'assets/img/interface/hearts/19of20.png',\n\t'20of20': 'assets/img/interface/hearts/20of20.png'\n}&gt;&gt;\n\n&lt;&lt;set setup.ui.grit to {\n\t'0grit': 'assets/img/interface/grit/0grit.png',\n\t'5grit': 'assets/img/interface/grit/5grit.png',\n\t'10grit': 'assets/img/interface/grit/10grit.png',\n\t'15grit': 'assets/img/interface/grit/15grit.png',\n\t'20grit': 'assets/img/interface/grit/20grit.png',\n\t'25grit': 'assets/img/interface/grit/25grit.png',\n\t'30grit': 'assets/img/interface/grit/30grit.png',\n\t'35grit': 'assets/img/interface/grit/35grit.png',\n\t'40grit': 'assets/img/interface/grit/40grit.png',\n\t'45grit': 'assets/img/interface/grit/45grit.png',\n\t'50grit': 'assets/img/interface/grit/50grit.png',\n\t'55grit': 'assets/img/interface/grit/55grit.png',\n\t'60grit': 'assets/img/interface/grit/60grit.png',\n\t'65grit': 'assets/img/interface/grit/65grit.png',\n\t'70grit': 'assets/img/interface/grit/70grit.png',\n\t'75grit': 'assets/img/interface/grit/75grit.png',\n\t'80grit': 'assets/img/interface/grit/80grit.png',\n\t'85grit': 'assets/img/interface/grit/85grit.png',\n\t'90grit': 'assets/img/interface/grit/90grit.png',\n\t'95grit': 'assets/img/interface/grit/95grit.png',\n\t'100grit': 'assets/img/interface/grit/100grit.png'\n}&gt;&gt;\n\n&lt;&lt;set setup.ui.rage to {\n\t'rage0-1': 'assets/img/interface/rage/rage0-1.png',\n\t'rage0-05': 'assets/img/interface/rage/rage0-05.png',\n\t'rage0-10': 'assets/img/interface/rage/rage0-10.png',\n\t'rage0-15': 'assets/img/interface/rage/rage0-15.png',\n\t'rage0-20': 'assets/img/interface/rage/rage0-20.png',\n\t'rage0-25': 'assets/img/interface/rage/rage0-25.png',\n\t'rage0-30': 'assets/img/interface/rage/rage0-30.png',\n\t'rage0-35': 'assets/img/interface/rage/rage0-35.png',\n\t'rage0-40': 'assets/img/interface/rage/rage0-40.png',\n\t'rage0-45': 'assets/img/interface/rage/rage0-45.png',\n\t'rage0-50': 'assets/img/interface/rage/rage0-50.png',\n\t'rage0-55': 'assets/img/interface/rage/rage0-55.png',\n\t'rage0-60': 'assets/img/interface/rage/rage0-60.png',\n\t'rage0-65': 'assets/img/interface/rage/rage0-65.png',\n\t'rage0-70': 'assets/img/interface/rage/rage0-70.png',\n\t'rage0-75': 'assets/img/interface/rage/rage0-75.png',\n\t'rage0-80': 'assets/img/interface/rage/rage0-80.png',\n\t'rage0-85': 'assets/img/interface/rage/rage0-85.png',\n\t'rage0-90': 'assets/img/interface/rage/rage0-90.png',\n\t'rage0-95': 'assets/img/interface/rage/rage0-95.png',\n\t'rage0-100': 'assets/img/interface/rage/rage0-100.png',\n\t'rage1-1': 'assets/img/interface/rage/rage1-1.png',\n\t'rage1-05': 'assets/img/interface/rage/rage1-05.png',\n\t'rage1-10': 'assets/img/interface/rage/rage1-10.png',\n\t'rage1-15': 'assets/img/interface/rage/rage1-15.png',\n\t'rage1-20': 'assets/img/interface/rage/rage1-20.png',\n\t'rage1-25': 'assets/img/interface/rage/rage1-25.png',\n\t'rage1-30': 'assets/img/interface/rage/rage1-30.png',\n\t'rage1-35': 'assets/img/interface/rage/rage1-35.png',\n\t'rage1-40': 'assets/img/interface/rage/rage1-40.png',\n\t'rage1-45': 'assets/img/interface/rage/rage1-45.png',\n\t'rage1-50': 'assets/img/interface/rage/rage1-50.png',\n\t'rage1-55': 'assets/img/interface/rage/rage1-55.png',\n\t'rage1-60': 'assets/img/interface/rage/rage1-60.png',\n\t'rage1-65': 'assets/img/interface/rage/rage1-65.png',\n\t'rage1-70': 'assets/img/interface/rage/rage1-70.png',\n\t'rage1-75': 'assets/img/interface/rage/rage1-75.png',\n\t'rage1-80': 'assets/img/interface/rage/rage1-80.png',\n\t'rage1-85': 'assets/img/interface/rage/rage1-85.png',\n\t'rage1-90': 'assets/img/interface/rage/rage1-90.png',\n\t'rage1-95': 'assets/img/interface/rage/rage1-95.png',\n\t'rage1-100': 'assets/img/interface/rage/rage1-100.png'\n}&gt;&gt;\n\n&lt;&lt;set setup.ui.icons to {\n\tagiIcon: 'assets/img/interface/icn/agiIcon.jpg',\n\tcngIcon: 'assets/img/interface/icn/cngIcon.jpg',\n\tendIcon: 'assets/img/interface/icn/endIcon.jpg',\n\tstrIcon: 'assets/img/interface/icn/strIcon.jpg',\n\twilIcon: 'assets/img/interface/icn/wilIcon.jpg',\n\n\tlvlIcon: 'assets/img/interface/icn/lvlIcon.jpg',\n\tpowIcon: 'assets/img/interface/icn/powIcon.jpg',\n\tragebIcon: 'assets/img/interface/icn/ragebIcon.jpg',\n\tragedIcon: 'assets/img/interface/icn/ragedIcon.jpg',\n\tscarsIcon: 'assets/img/interface/icn/scarsIcon.jpg',\n\tstaIcon: 'assets/img/interface/icn/staIcon.jpg',\n\tgrit2: 'assets/img/interface/icn/grit2.jpg',\n\n\tui_armor: 'assets/img/interface/icn/ui_armor.jpg',\n\tui_atk: 'assets/img/interface/icn/ui_atk.jpg',\n\tui_crit: 'assets/img/interface/icn/ui_crit.jpg',\n\tui_def: 'assets/img/interface/icn/ui_def.jpg',\n\tui_disp: 'assets/img/interface/icn/ui_disp.jpg',\n\tui_dodge: 'assets/img/interface/icn/ui_dodge.jpg',\n\tui_down: 'assets/img/interface/icn/ui_down.jpg',\n\tui_grit: 'assets/img/interface/icn/ui_grit.jpg',\n\tui_heal: 'assets/img/interface/icn/ui_heal.jpg',\n\tui_mov: 'assets/img/interface/icn/ui_mov.jpg',\n\tui_regen: 'assets/img/interface/icn/ui_regen.jpg',\n\tui_same: 'assets/img/interface/icn/ui_same.jpg',\n\tui_spell: 'assets/img/interface/icn/ui_spell.jpg',\n\tui_up: 'assets/img/interface/icn/ui_up.jpg',\n\tui_weapon: 'assets/img/interface/icn/ui_weapon.jpg'\n}&gt;&gt;\n\n&lt;&lt;set setup.ui.tut to {\n\ttut1: 'assets/img/interface/tut/tut1.jpg',\n\ttut2: 'assets/img/interface/tut/tut2.jpg',\n\ttut3: 'assets/img/interface/tut/tut3.jpg',\n\ttut4: 'assets/img/interface/tut/tut4.jpg',\n\ttut5: 'assets/img/interface/tut/tut5.jpg',\n\ttut6: 'assets/img/interface/tut/tut6.jpg',\n\ttut7: 'assets/img/interface/tut/tut7.jpg'\n}&gt;&gt;\n\n&lt;&lt;set setup.maps to {\n\tmap11: 'assets/img/maps/map11.jpg'\n}&gt;&gt;</div><div tiddler="eqp-setup" tags="init" created="201707082152" modifier="twee" twine-position="430,150">&lt;&lt;set $neutraltraining to 0&gt;&gt;\n&lt;&lt;set $naturaltraining to 0&gt;&gt;\n&lt;&lt;set $lighttraining to 0&gt;&gt;\n&lt;&lt;set $darktraining to 0&gt;&gt;\n&lt;&lt;set $hellishtraining to 0&gt;&gt;\n\n&lt;&lt;set $longswordtraining to 0&gt;&gt;\n&lt;&lt;set $greatswordtraining to 0&gt;&gt;\n&lt;&lt;set $unarmedtraining to 0&gt;&gt;\n&lt;&lt;set $sabertraining to 0&gt;&gt;\n&lt;&lt;set $scythetraining to 0&gt;&gt;\n&lt;&lt;set $speartraining to 0&gt;&gt;\n&lt;&lt;set $sideswordtraining to 0&gt;&gt;\n&lt;&lt;set $katanatraining to 0&gt;&gt;\n&lt;&lt;set $battleaxetraining to 0&gt;&gt;\n&lt;&lt;set $gauntletstraining to 0&gt;&gt;\n\n&lt;&lt;set $gswordhave to 0&gt;&gt;\n&lt;&lt;set $katanahave to 0&gt;&gt;\n&lt;&lt;set $spearhave to 0&gt;&gt;\n&lt;&lt;set $sswordhave to 0&gt;&gt;\n&lt;&lt;set $gauntletshave to 0&gt;&gt;\n&lt;&lt;set $scythehave to 0&gt;&gt;\n&lt;&lt;set $saberhave to 0&gt;&gt;\n&lt;&lt;set $axehave to 0&gt;&gt;\n\n&lt;&lt;set $clothhave to 0&gt;&gt;\n&lt;&lt;set $leatherhave to 1&gt;&gt;\n&lt;&lt;set $chainhave to 0&gt;&gt;\n&lt;&lt;set $platehave to 0&gt;&gt;\n\n&lt;&lt;set $clothplus to 0&gt;&gt;\n&lt;&lt;set $leatherplus to 0&gt;&gt;\n&lt;&lt;set $chainplus to 0&gt;&gt;\n&lt;&lt;set $plateplus to 0&gt;&gt;\n\n&lt;&lt;set $neutralhave to 1&gt;&gt;\n&lt;&lt;set $naturalhave to 0&gt;&gt;\n&lt;&lt;set $lighthave to 0&gt;&gt;\n&lt;&lt;set $darkhave to 0&gt;&gt;\n&lt;&lt;set $hellishhave to 0&gt;&gt;</div><div tiddler="helpspaces" tags="help" created="201701260400" modifier="twee">Talking to people multiple times will occasionally trigger new responses.  Try to click around and see what happens.</div><div tiddler="1Map1" tags="widget" created="201702120822" modifier="twee">/%\nCreates a navigation menu for the bailey in ch1, making the directions relative to the current passage and elminating the nav reference to the current passage. \n\nsyntax: &lt;&lt;mapHarlan &quot;current passage&quot;&gt;&gt;\n\n[title of passage is: (ch)Map(number in ch)]\n\ncastle map:\n\nNorth\n\tRipley's quarters.\n\t\tExt: Wall-------Ext = only accessible through parent\n\tServant's quarters.\n\t!+Bailey--------------! = midpoint; + = start point\n\t\tExt: Courtyard\n\tMainhall\n\t\tExt: Throneroom\nSouth\n\nWest:\n\tElesun's quarters\n%/&lt;&lt;widget &quot;mapHarlan&quot;&gt;&gt;''&lt;&lt;name&gt;&gt; is &lt;&lt;if $args[0] is &quot;1bailey&quot;&gt;&gt;in the bailey&lt;&lt;elseif $args[0] is &quot;1RipQuarters&quot;&gt;&gt;in Ripley's quarters&lt;&lt;elseif $args[0] is &quot;1servQuarters&quot;&gt;&gt;in the servant's quarters&lt;&lt;elseif $args[0] is &quot;1mainhall&quot;&gt;&gt;in the main hall&lt;&lt;elseif $args[0] is &quot;1EleQuarters&quot;&gt;&gt;in her own quarters&lt;&lt;endif&gt;&gt;.''\n&lt;&lt;switch $args[0]&gt;&gt;&lt;&lt;case &quot;1bailey&quot;&gt;&gt;&lt;&lt;link &quot;Ripley's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Rip&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Servants' Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Serv&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Elesun's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Ele&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Main Hall&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Hall&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;case &quot;1RipQuarters&quot;&gt;&gt;&lt;&lt;link &quot;Bailey&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Bailey&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Servants' Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Serv&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Elesun's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Ele&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Main Hall&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Hall&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;case &quot;1servQuarters&quot;&gt;&gt;&lt;&lt;link &quot;Ripley's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Rip&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Bailey&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Bailey&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Elesun's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Ele&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Main Hall&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Hall&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;case &quot;1EleQuarters&quot;&gt;&gt;&lt;&lt;link &quot;Ripley's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Rip&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Servants' Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Serv&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Bailey&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Bailey&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Main Hall&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Hall&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;case &quot;1mainhall&quot;&gt;&gt;&lt;&lt;link &quot;Ripley's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Rip&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Servants' Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Serv&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Bailey&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Bailey&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Elesun's Quarters&quot;&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;1Map1Ele&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;/switch&gt;&gt;&lt;&lt;button &quot;See Map&quot;&gt;&gt;&lt;&lt;replace &quot;#navbox&quot;&gt;&gt;&lt;&lt;display &quot;map_1_1-pass&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;endwidget&gt;&gt;</div><div tiddler="0byenemy" tags="dock" created="201701110808" modifier="twee">Elesun knows Akatosh is behind this attack.\n\nThe thought of him alone makes her heart hurt for poor Ripley.  And then the thought makes her angry.  Someday Ripley would make him pay.  And if Ripley’s strength failed, Elesun would be there.</div><div tiddler="combatexplanation2menu" tags="menu" created="201612181745" modifier="twee">&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut2][combatexplanation3menu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;combatexplanation3menu&quot;&gt;&gt;</div><div tiddler="fireball" tags="nobr" created="201701241624" modifier="twee">/%  2  %/\n&lt;&lt;set $specialMult to 1.0&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,0)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Fire Ball&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="combat_end" tags="combat" created="201612160724" modifier="twee">&lt;&lt;unset $staggerOdds&gt;&gt;&lt;&lt;unset $baseStaggerOdds&gt;&gt;&lt;&lt;if $bossFight&gt;&gt;&lt;&lt;display $hookPull&gt;&gt;&lt;&lt;set $bossFight to false&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;audio &quot;:playing&quot; fadeout&gt;&gt;&lt;&lt;payload 'onFightEnd'&gt;&gt;&lt;&lt;set $xpearned to $nmexp&gt;&gt;&lt;&lt;set $sta to $maxsta&gt;&gt;&lt;&lt;set $gamestart to 1&gt;&gt;&lt;&lt;set $grit to $maxgrit&gt;&gt;&lt;&lt;set $sta to $maxsta&gt;&gt;&lt;&lt;set $SpEffEnd to -1&gt;&gt;&lt;&lt;set $specialOn to 0&gt;&gt;&lt;&lt;set $NMESpMov to 1.0&gt;&gt;&lt;&lt;set $NMESpDef to 1.0&gt;&gt;&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;&lt;&lt;set $NMESpDam to 1.0&gt;&gt;&lt;&lt;set $NMEStaUse to 0&gt;&gt;&lt;&lt;set $NMEStaLmt to 0&gt;&gt;&lt;&lt;set $SpEffDisplay to &quot;&quot;&gt;&gt;&lt;&lt;display &quot;rage_store&quot;&gt;&gt;&lt;&lt;set $rageCurrent to 0&gt;&gt;&lt;&lt;xp&gt;&gt;</div><div tiddler="1tocamp2" tags="scene" created="201701281955" modifier="twee">&lt;&lt;first&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio 'herat7' loop play&gt;&gt;&lt;&lt;/first&gt;&gt;&lt;&lt;image 'RipSmKid'&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;if $drawOrNot&gt;&gt;Elesun breaks out into a sprint, sword in hand.  Behind her, the guards drop what they're holding and run after her.&lt;&lt;else&gt;&gt;Elesun walks more quickly.\n\n&quot;Ripley, what's wrong?&quot; she calls.\n\nThe guards behind her set their things down.  &quot;What is it?&quot; one asks.  They start to trot after Elesun.&lt;&lt;endif&gt;&gt;\n\nBefore Elesun can get there, Ripley jumps back--a tendril of inky-dark magical energy explodes into the ground where she was standing.  Elesun and Ripley both look for the source, and see a cloaked figure emerge from the darkness.\n\n&quot;No,&quot; Ripley gasps.  &quot;What did you do to them?&quot;\n\n&lt;&lt;ctrlCon '1tocamp3'&gt;&gt;</div><div tiddler="tpinfo" tags="" created="201612151705" modifier="twee">\nTraining points, or TP, are paid to trainers found throughout the game to improve the effectiveness of your weapons and magic.  All training starts at level 0, and has a maximum level of 3.\n\n</div><div tiddler="1takeRipAway" tags="scene" created="201701282008" modifier="twee"></div><div tiddler="combatexplanation5menu" tags="menu" created="201704281529" modifier="twee">&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut5][combatexplanation6menu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;combatexplanation6menu&quot;&gt;&gt;</div><div tiddler="0kingsListen" tags="dock" created="201701252209" modifier="twee">From the sound of it, there's some fighting happening on the grounds outside the throne room.  Things seem quiet inside, though.</div><div tiddler="rest_basic" tags="nobr" created="201701241653" modifier="twee">&lt;&lt;set $wounds to $wounds + ($health - $maxhealth)&gt;&gt;\n&lt;&lt;set $health to $maxhealth&gt;&gt;\n&lt;&lt;set $day to $day+1&gt;&gt;</div><div tiddler="autoload" tags="" created="201702281038" modifier="twee">&lt;&lt;if $holyLandAutoLoad is 1&gt;&gt;* &lt;&lt;radiobutton &quot;$holyLandAutoLoad&quot; 0&gt;&gt; No.  Default.\n*&lt;&lt;radiobutton &quot;$holyLandAutoLoad&quot; 1 checked&gt;&gt; Yes.&lt;&lt;else&gt;&gt;* &lt;&lt;radiobutton &quot;$holyLandAutoLoad&quot; 0 checked&gt;&gt; No.  Default.\n*&lt;&lt;radiobutton &quot;$holyLandAutoLoad&quot; 1&gt;&gt; Yes.&lt;&lt;endif&gt;&gt;</div><div tiddler="heal_ui" tags="" created="201702021708" modifier="twee">Healing causes defending to replenish &lt;&lt;= setup.words.grit&gt;&gt; and grants a small bonus to &lt;&lt;= setup.words.grit&gt;&gt; regeneration.  Slight penalty to attack.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_down]]|//Slight//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_up]]|//Moderate//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_up]]|//Large//|</div><div tiddler="map1-script" tags="script" created="201705180302" modifier="twee">!function(){\n\t$(document).on('click', '#map1-1-ele', function(e){\n\t\te.preventDefault();\n\t\tnew Wikifier (null, &quot;&lt;&lt;replace #info&gt;&gt;&lt;&lt;display '1Map1Ele'&gt;&gt;&lt;&lt;/replace&gt;&gt;&quot;);\n\t});\n\t$(document).on('click', '#map1-1-bly', function(e){\n\t\te.preventDefault();\n\t\tnew Wikifier (null, &quot;&lt;&lt;replace #info&gt;&gt;&lt;&lt;display '1Map1Bailey'&gt;&gt;&lt;&lt;/replace&gt;&gt;&quot;);\n\t});\n\t$(document).on('click', '#map1-1-mhl', function(e){\n\t\te.preventDefault();\n\t\tnew Wikifier (null, &quot;&lt;&lt;replace #info&gt;&gt;&lt;&lt;display '1Map1Hall'&gt;&gt;&lt;&lt;/replace&gt;&gt;&quot;);\n\t});\n\t$(document).on('click', '#map1-1-srv', function(e){\n\t\te.preventDefault();\n\t\tnew Wikifier (null, &quot;&lt;&lt;replace #info&gt;&gt;&lt;&lt;display '1Map1Serv'&gt;&gt;&lt;&lt;/replace&gt;&gt;&quot;);\n\t});\n\t$(document).on('click', '#map1-1-rip', function(e){\n\t\te.preventDefault();\n\t\tnew Wikifier (null, &quot;&lt;&lt;replace #info&gt;&gt;&lt;&lt;display '1Map1Rip'&gt;&gt;&lt;&lt;/replace&gt;&gt;&quot;);\n\t});\n}();\n\n!function(){\n\t$(document).on('mouseenter', '#map1-1-ele', function(e){\n\t\t$('#map-descr').addClass('ele');\n\t}).on('mouseout', '#map1-1-ele', function(e){\n\t\t$('#map-descr').removeClass('ele');\n\t});\n\t$(document).on('mouseenter', '#map1-1-rip', function(e){\n\t\t$('#map-descr').addClass('rip');\n\t}).on('mouseout', '#map1-1-rip', function(e){\n\t\t$('#map-descr').removeClass('rip');\n\t});\n\t$(document).on('mouseenter', '#map1-1-bly', function(e){\n\t\t$('#map-descr').addClass('bly');\n\t}).on('mouseout', '#map1-1-bly', function(e){\n\t\t$('#map-descr').removeClass('bly');\n\t});\n\t$(document).on('mouseenter', '#map1-1-srv', function(e){\n\t\t$('#map-descr').addClass('srv');\n\t}).on('mouseout', '#map1-1-srv', function(e){\n\t\t$('#map-descr').removeClass('srv');\n\t});\n\t$(document).on('mouseenter', '#map1-1-mhl', function(e){\n\t\t$('#map-descr').addClass('mhl');\n\t}).on('mouseout', '#map1-1-mhl', function(e){\n\t\t$('#map-descr').removeClass('mhl');\n\t});\n}();</div><div tiddler="1KingTalk" tags="talk" created="201707110029" modifier="twee">&lt;&lt;image &quot;KingPt&quot;&gt;&gt;Elesun steps toward the throne.\n\n&quot;Do you need something, Elesun?&quot;\n\n&lt;&lt;dock &quot;Chit-chat.&quot; &quot;KingChat1&quot;&gt;&gt;\n\n&lt;&lt;dock 'Talk about Ripley.' '1KingRip'&gt;&gt;\n\n&lt;&lt;dock 'Talk about Folsom.' '1KingFolsom'&gt;&gt;\n\n&lt;&lt;dock 'Talk about Harlaus.' '1KingHarl'&gt;&gt;\n\n&lt;&lt;dock 'Talk about Irelith.' '1KingIre'&gt;&gt;\n\n&lt;&lt;dock &quot;Goodbye.&quot; &quot;1KingNVM&quot;&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n</div><div tiddler="1rescue2" tags="scene" created="201701282008" modifier="twee"></div><div tiddler="1rescue1" tags="scene" created="201701282008" modifier="twee"></div><div tiddler="style" tags="stylesheet" created="201612151533" modifier="twee" twine-position="10,570">@font-face {\n  font-family: code;\n  src: url(&quot;assets/fonts/code.otf&quot;);\n }\n\n@font-face {\n  font-family: base;\n  src: url(&quot;assets/fonts/base.ttf&quot;);\n }\n\n@font-face {\n  font-family: base-med;\n  src: url(&quot;assets/fonts/rob-m.ttf&quot;);\n  font-size: 22px;\n }\n\n@font-face {\n  font-family: runes;\n  src: url(&quot;assets/fonts/runes.ttf&quot;);\n }\n\nbody {\n  font-family: base;\n }\n\n#ui-dialog {\n  font-family: base-med;\n }\n\n#story-caption {\n\tdisplay: none;\n}\n\n#story-title, #story-author, #story-banner, .error {\n\tdisplay: none;\n}\n\n#story-subtitle {\n\tfont-size: 162.5%;\n  \tfont-weight: bold;\n\tmargin: 0;\n}\n\nbody.menu {\n\tcolor: #111;\n\tbackground-color: #fff;\n}\nbody.menu a {\n\tcolor: #35c;\n}\nbody.menu a:hover {\n\tcolor: #57e;\n}\n\nbody.menu #info a {\n\tcolor: red;\n\tfont-weight: bold;\n}\n\nbody.menu button {\n\tcolor: #111;\n\tbackground-color: #acf;\n\tborder-color: #8ad;\n}\nbody.menu button:hover {\n\tbackground-color: #8ad;\n\tborder-color: #68b;\n}\nbody.menu button:disabled {\n\tbackground-color: #ccc;\n\tborder-color: #aaa;\n}\nbody.menu input, select, textarea {\n\tcolor: #111;\n\tborder-color: #ccc;\n}\nbody.menu input:focus, select:focus, textarea:focus,\ninput:hover, select:hover, textarea:hover {\n\tbackground-color: #eee;\n\tborder-color: #111;\n}\n\nbody.menu #ui-bar {\n\tbackground-color: #696969;\n\tborder-color: #ccc;\n}\n\nbody.menu #info {\n\tposition: fixed;\n\tbottom: 20px;\n\tborder: 5px solid #000;\n\tpadding: 10px;\n\tmargin: 15px;\n\tmax-height: 25%;\n\tmin-width: 60%;\n\tmax-width: 60%;\n\toverflow: auto;\n\tbackground-color: #696969; \n\tcolor: #fff;\n\topacity: 0.8;\n}\n\nbody.menu #info:hover {\n\topacity: 1.0;\n}\n\nbody.menu #ui-overlay {\n\tbackground-color: #777;\n}\nbody.menu #ui-dialog-titlebar {\n\tbackground-color: #ccc;\n}\nbody.menu #ui-dialog-close:hover {\n\tbackground-color: #b44;\n\tborder-color: #a33;\n}\nbody.menu #ui-dialog-body {\n\tbackground-color: #fff;\n\tborder-color: #ccc;\n}\nbody.menu #ui-dialog-body hr {\n\tbackground-color: #ccc;\n}\n\n/* List-based dialog styling */\nbody.menu #ui-dialog-body.list li:not(:first-child) {\n\tborder-top-color: #ccc;\n}\nbody.menu #ui-dialog-body.list li a {\n\tcolor: #111;\n}\nbody.menu #ui-dialog-body.list li a:hover {\n\tbackground-color: #ccc;\n\tborder-color: #111;\n}\n\n#menu li a {\n  text-transform: none;\n  font-size: 110%;\n }\n\n#titlecard {\n\tfloat: left;\n}\n\n#info {\n\tposition: fixed !important;\n\tbottom: 20px;\n\tborder: 5px solid #fff;\n\tpadding: 10px;\n\tmargin: 15px;\n\tmax-height: 25%;\n\tmin-width: 60%;\n\tmax-width: 60%;\n\toverflow: auto;\n\tcolor: #fff;\n\tbackground-color: #000000; \n\topacity: 0.9;\n}\n\n#panda {\n\tfloat: right;\n\tborder: 5px solid #fff;\n\tpadding: 10px;\n\tmargin: 15px;\n\tmin-height: 25%;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 25%;\n\tbackground-color: #000000;\n\toverflow: auto;\n}\n\n#info:hover {\n\topacity: 1.0;\n}\n\n#cominfo {\n\tposition: fixed;\n\tbottom: 20px;\n\tborder: 5px solid #fff;\n\tpadding: 10px;\n\tmargin: 15px;\n\tmax-height: 25%;\n\tmin-width: 60%;\n\tmax-width: 60%;\n\toverflow: auto;\n\tcolor: #fff;\n\tbackground-color: #000000; \n\topacity: 0.9;\n}\n\n#cominfo:hover {\n\topacity: 1.0;\n}\n\n\n\n#combatAlly {\n\tfloat: right;\n\tborder: 5px solid #fff;\n\tpadding: 10px;\n\tmargin: 15px;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 25%;\n\toverflow: auto;\n\tbackground-color: #000000; \n\topacity: 0.9;\n}\n\n#combatAlly:hover {\n\topacity: 1.0;\n}\n\n#portrait {\n\tfloat: right;\n\tpadding: 10px;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 45%;\n\tclear: right;\n}\n\n#portrait2 {\n\tfloat: right;\n\tborder: 5px solid #fff;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 45%;\n\tclear: right;\n}\n\n#subj {\n\tfloat: right;\n\tpadding: 10px;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 45%; \n\tclear: right;\n}\n\n#nmeport {\n\tfloat: left;\n\tpadding: 5px;\n\tmargin: 10px;\n}\n\n#combatNME {\n\tfloat: right;\n\tborder: 5px solid #fff;\n\tpadding: 10px;\n\tmargin: 15px;\n\tmin-height: 20%;\n\tmax-height: 25%;\n\tmin-width: 45%;\n\tmax-width: 45%;\n\toverflow: auto;\n\tbackground-color: #000000; \n\topacity: 0.9;\n}\n\n#combatNME:hover {\n\topacity: 1.0;\n}\n\n#bugcode {\n\tdisplay: block;\n\tborder: 5px solid #696969;\n\tpadding: 10px;\n\tmargin: 15px;\n\tbackground-color: #fff;\n\tcolor: #000;\n\tword-wrap: break-word;\n\toverflow: auto;\n\theight: 10em;\n}\n\n.mobile.space .passage {\n\tposition: fixed;\n\tborder: 3px solid #fff;\n\tfont-size: 120%;\n\tpadding: 2px;\n\tmargin: none;\n\tmax-height: 80%;\n\tmin-width: 70%;\n\tmax-width: 70%;\n\toverflow: auto;\n\tbackground-color: #000;\n\tcolor: #fff;\n}\n\n.mobile #info {\n\tposition: fixed;\n\tbottom: 5px;\n\tborder: 3px solid #fff;\n\tpadding: 2px;\n\tmargin: 3px;\n\tmax-height: 20%;\n\tmin-width: 70%;\n\tmax-width: 70%;\n\toverflow: auto;\n\tbackground-color: #000000; \n\topacity: 0.6;\n}\n\nbody.mobile #portrait {\n\tfloat: right;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 45%;\n\toverflow: auto;\n\ttext-size: 90%;\n}\n\n.mobile.combat #comele #comrip {\n\tdisplay: none;\n\tfloat: right;\n\tmax-height: 25%;\n\tmin-width: 25%;\n\tmax-width: 45%;\n\toverflow: auto;\n\ttext-size: 90%;\n}\n\nbody.mobile.combat .passage {\n\tposition: static;\n\tborder: none;\n\tfont-size: 100%;\n\tpadding: initial;\n\tmargin: auto;\n\tmax-height: none;\n\tmin-width: none;\n\tmax-width: none;\n\toverflow: visible;\n\tbackground-color: #111;\n\tcolor: #eee;\n}\n\nbody.mobile #combatNME {\n\tposition: absolute;\n\tmin-height: 20%;\n\tmax-height: 40%;\n\tmin-width: 60%;\n\tmax-width: 60%;\n\toverflow: auto;\n\tbackground-color: #000000; \n\topacity: 0.9;\n}\n\nbody.mobile #combatNME:hover {\nopacity: 1.0;\n}\n\n.mobile #info:hover {\n\topacity: 1.0;\n}\n\n#comele {\n\tfloat: right;\n\tcolor: #fff;\n\tfont-size: 100%;\n\theight: 600px;\n\twidth: 45%;\n\tbackground-image: url('assets/img/art/_ele/pt.jpg');\n\tbackground-size: contain;\n\tbackground-color: #111;\n\tbackground-repeat: no-repeat;\n\toverflow: auto;\n\tz-index: -1;\n}\n\n#comrip {\n\tfloat: right;\n\tcolor: #fff;\n\tfont-size: 100%;\n\theight: 600px;\n\twidth: 45%;\n\tbackground-image: url('assets/img/art/__rip/adult/pt.jpg');\n\tbackground-size: contain;\n\tbackground-color: #111;\n\tbackground-repeat: no-repeat;\n\toverflow: auto;\n\tz-index: -1;\n}\n\n#comripDvl {\n\tfloat: right;\n\tcolor: #fff;\n\tfont-size: 100%;\n\theight: 600px;\n\twidth: 45%;\n\tbackground-image: url('assets/img/art/__rip/adult/emPt/devl.jpg');\n\tbackground-size: contain;\n\tbackground-color: #111;\n\tbackground-repeat: no-repeat;\n\toverflow: auto;\n\tz-index: -1;\n}\n\n#comripFnl {\n\tfloat: right;\n\tcolor: #fff;\n\tfont-size: 100%;\n\theight: 600px;\n\twidth: 45%;\n\tbackground-image: url('assets/img/art/__rip/adult/emPt/finl.jpg');\n\tbackground-size: contain;\n\tbackground-color: #111;\n\tbackground-repeat: no-repeat;\n\toverflow: auto;\n\tz-index: -1;\n}\n\n.switch {\n\tposition: relative;\n\tright: -100%;\n\tleft: 0;\n\ttop: 0;\n\tbottom: 0;\n\t/*visibility: hidden;*/\n\twidth: 0px;\n\ttransition: width 150ms;\n\t-webkit-transition: width 150ms;\n\t-moz-transition: width 150ms;\n\t-o-transition: width 150ms;\n}\n\n#comele:hover .switch {\n\t/*visibility: visible;*/\n\twidth: 100%;\n}\n\n#comrip:hover .switch {\n\t/*visibility: visible;*/\n\twidth: 100%;\n}\n\n#comripDvl:hover .switch {\n\t/*visibility: visible;*/\n\twidth: 100%;\n}\n\n#comripFnl:hover .switch {\n\t/*visibility: visible;*/\n\twidth: 100%;\n}\n\n#helpA, #helpB, #helpC {\n\tcolor: #01ff70;\n}\n\n#journallink a {\n\tcolor: #eee;\n\ttext-decoration: underline;\n}\n\n.info2 {\n\tposition: fixed;\n\ttop: 10%;\n\tright: 20%;\n\tmin-height: 15%;\n\tmax-height: 60%;\n\tmin-width: 40%;\n\tmax-width: 40%;\n\tbackground-color: #000;\n\tborder: 5px solid #696969;\n\tcolor: #fff;\n\topacity: 0.9;\n\tmargin: 10px;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n}\n\n.info2titlebar {\n\tposition: relative;\n\ttop: 0;\n\tright: 0;\n\tleft: 0;\n\theight: 40px;\n\tbackground-color: #696969;\n\tcolor: #000;\n}\n\n#info2title {\n\tposition: relative;\n\twidth: 150px;\n\tpadding-top: 10px;\n\tpadding-left: 20px;\n\tfont-weight: bold;\n}\n\n#info2close {\n    float: right;\n\theight: 40px;\n\tbackground-color: red;\n    text-decoration: none;\n\tz-index: 4;\n}\n\n#info2close a:hover {\n\topacity: 0.7;\n}\n\n#info2close a:hover {\n\ttext-decoration: none;\n}\n\n.mobile .info2 {\n\tright: 0%;\n\tmin-width: 80%;\n\tmax-width: 80%;\n\tmargin: 3px;\n\tpadding: 1px;\n}\n\n.info2:hover {\n\topacity: 1.0;\n}\n\n#infoX {\n\tposition: relative;\n\tdisplay: block;\n\tline-height: 1.6;\n\tpadding: 20px;\n}\n\n#info3 {\n\tposition: relative;\n\tmin-height: 25%;\n\tmax-height: 35%;\n\tbackground-color: #000;\n\tborder: 5px solid #696969;\n\tcolor: #fff;\n\topacity: 0.9;\n\tpadding: 10px;\n\tmargin: 15px;\n\toverflow: auto;\n}\n\n#info3:hover {\n\topacity: 1.0;\n}\n\n#info3close {\n\tdisplay: none;\n}\n\n.space #info3close {\n\tdisplay: initial;\n}\n\n.choice #info3close {\n\tdisplay: initial;\n}\n\n.info4 {\n\tvisibility: visible;\n\tposition: relative;\n    display: inline-block;\n\tcolor: #35c;\n\ttext-decoration: underline;\n}\n\n.info4 .info4tip {\n    visibility: hidden;\n    width: 120px;\n    background-color: #eee;\n    color: #111;\n    text-align: center;\n    padding: 5px 0;\n    border-radius: 6px;\n    position: absolute;\n    z-index: 1;\n\twidth: 120px;\n    top: 100%;\n    left: 50%; \n    margin-left: -60px;\n}\n\n.info4 .info4tip::after {\n    content: &quot; &quot;;\n    position: absolute;\n    bottom: 100%;  /* At the top of the tooltip */\n    left: 50%;\n    margin-left: -5px;\n    border-width: 5px;\n    border-style: solid;\n    border-color: transparent transparent black transparent;\n}\n\n.info4:hover .info4tip {\n\topacity: 1.0;\n    visibility: visible;\n}\n\n.comDisp {\n\tposition: relative;\n\ttop: 5%;\n\tright: 0;\n\tleft: 0;\n\tmin-height: 30%;\n\tmax-height: 50%;\n\tbackground: rgba(0, 0, 0, 0.4);\n\tcolor: #fff;\n\toverflow: hidden;\n\tvisibility: inherit;\n}\n\n.comUIimg {\n\topacity: 0.6;\n\tvisibility: inherit;\n}\n\n.comUIimg:hover {\n\topacity: 1.0;\n}\n\n.switch:hover {\n\tvisibility: visible;\n}\n\n#transformbutton {\n\tposition: relative;\n\ttop: 10px;\n\tleft: 0;\n\tright: 0;\n}\n\n#transformbutton a {\n\tanimation: blinker 1s linear infinite;\n\tcolor: red;\n\tfont-size: 150%;\n}\n\n#transformbutton a:hover{\n\tanimation: blinker 500ms linear infinite;\n\ttext-decoration: none;\n}\n\n#transformbutton2 a {\n\tanimation: blinker 1s linear infinite;\n\tcolor: red;\n}\n\n#transformbutton2 a:hover{\n\tanimation: blinker 500ms linear infinite;\n\ttext-decoration: none;\n}\n\n@keyframes blinker {  \n  50% { opacity: 0; }\n}\n\n#rager {\n\tfloat: right;\n\tmargin-right: 20%;\n\tmargin-top: 20px;\n\ttext-align: center;\n}\n\n#mutebutton {\n\tvisibility: hide;\n}\n\n#titleContainer {\n\tposition: static;\n\tmargin-left: -4em;\n}\n\n#titlecard {\n\tposition: relative;\n\tmax-width: 60vp;\n}\n\n#navbox {\n\tdisplay: inline-block;\n\tborder: 5px solid #fff;\n\tpadding: 10px;\n\toverflow: auto;\n\tcolor: #fff;\n\tbackground-color: #000; \n\topacity: 0.9;\n}\n\n#navbox:hover{\n\topacity: 1;\n}\n\n.time-bar {\n    width: 60%;\n    height: 12px;\n    border-radius: 3px;\n    border: 2px solid red;\n}\n.time-bar span {\n\tposition: relative;\n\ttop: -7px;\n    background: red;\n    height: 12px;\n    display: inline-block;\n}\n.time-bar .w0 {\n    animation: w0 4s ease forwards;\n}\n\n.time-bar .w0 {\n\tposition: relative;\n\twidth: 1%;\n}\n\n@keyframes w0 {\n\t0% {width: 1%;}\n\t60% {width: 80%;}\n\t100% {width: 100%;}\n}\n\n.battle-bar {\n    width: 60%;\n    height: 20px;\n    border-radius: 5px;\n    border: 2px solid #fff;\n}\n\n.battle-bar span {\n    position: relative;\n    top: 0px;\n    background: #fff;\n    height: 18px;\n    border-radius: 5px;\n    display: inline-block;\n}\n\n.battle-bar .w1 {\n    position: relative;\n    width: 100%;\n}\n\n.battle-bar .w2 {\n    position: relative;\n    width: 0%;\n\tanimation: w2 1500ms linear forwards;\n}\n\n@keyframes w2 {\n    0% { width: 100%; }\n    33% { width: 66%; background: #fff }\n\t34% { width: 65%; background: red;}\n\t65% { width: 34%; background: red;}\n\t66% { width: 33%; background: #fff;}\n\t100% { width: 1%; }\n}\n\n.time-btn {\n\tfont-size: 275%;\n}\n\n.runes {\n  font-family: runes;\n  font-wieght: bold;\n  font-size: 400%;\n  text-align: center;\n }\n\n.titleText {\n  font-family: code;\n  font-size: 400%;\n  font-weight: bold;\n  text-align: center;\n }\n\n/* ----------------------------------------------\n * Generated by Animista on 2017-4-7 0:43:14\n * http://animista.net\n * T: @cssanimista\n * ---------------------------------------------- */\n\n@-webkit-keyframes text-focus-in{0%{-webkit-filter:blur(12px);filter:blur(12px);opacity:0}100%{-webkit-filter:blur(0);filter:blur(0);opacity:1}}@keyframes text-focus-in{0%{-webkit-filter:blur(12px);filter:blur(12px);opacity:0}100%{-webkit-filter:blur(0);filter:blur(0);opacity:1}}\n\n.text-focus-in {\n\t-webkit-animation: text-focus-in 0.4s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;\n\t-moz-animation: text-focus-in 0.4s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;\n\tanimation: text-focus-in 0.4s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;\n}\n\ninput[type=range] {\n  -webkit-appearance: none;\n  width: 200px;\n  margin: 0 10px;\n  vertical-align: text-bottom;\n  border: 0;\n}\ninput[type=range]:focus {\n  outline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n  width: 100%;\n  height: 5px;\n  cursor: pointer;\n  box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;\n  background: #000000;\n  border-radius: 0px;\n  border: 0px solid #010101;\n}\ninput[type=range]::-webkit-slider-thumb {\n  box-shadow: 0px 0px 0px rgba(0, 0, 62, 0.67), 0px 0px 0px rgba(0, 0, 88, 0.67);\n  border: 1.9px solid #000000;\n  height: 15px;\n  width: 15px;\n  border-radius: 15px;\n  background: #ffffff;\n  cursor: pointer;\n  -webkit-appearance: none;\n  margin-top: -5px;\n}\ninput[type=range]:focus::-webkit-slider-runnable-track {\n  background: #0a0a0a;\n}\ninput[type=range]::-moz-range-track {\n  width: 100%;\n  height: 5px;\n  cursor: pointer;\n  box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;\n  background: #000000;\n  border-radius: 0px;\n  border: 0px solid #010101;\n}\ninput[type=range]::-moz-range-thumb {\n  box-shadow: 0px 0px 0px rgba(0, 0, 62, 0.67), 0px 0px 0px rgba(0, 0, 88, 0.67);\n  border: 1.9px solid #000000;\n  height: 15px;\n  width: 15px;\n  border-radius: 15px;\n  background: #ffffff;\n  cursor: pointer;\n}\ninput[type=range]::-ms-track {\n  width: 100%;\n  height: 5px;\n  cursor: pointer;\n  background: transparent;\n  border-color: transparent;\n  color: transparent;\n}\ninput[type=range]::-ms-fill-lower {\n  background: #000000;\n  border: 0px solid #010101;\n  border-radius: 0px;\n  box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;\n}\ninput[type=range]::-ms-fill-upper {\n  background: #000000;\n  border: 0px solid #010101;\n  border-radius: 0px;\n  box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;\n}\ninput[type=range]::-ms-thumb {\n  box-shadow: 0px 0px 0px rgba(0, 0, 62, 0.67), 0px 0px 0px rgba(0, 0, 88, 0.67);\n  border: 1.9px solid #000000;\n  height: 15px;\n  width: 15px;\n  border-radius: 15px;\n  background: #ffffff;\n  cursor: pointer;\n  height: 5px;\n}\ninput[type=range]:focus::-ms-fill-lower {\n  background: #000000;\n}\ninput[type=range]:focus::-ms-fill-upper {\n  background: #0a0a0a;\n}\n\n#tutorial img {\n  width: 135%;\n  margin-left: -10em;\n  margin-top: -2em;\n }\n\n.help a { color: #01FF70; }\n.help a:hover { color: #3D9970; }\n.help.open a { color: #3D9970; }\n.help.open a:hover { color: #01FF70; }\n.help {\n  color: #01ff70;\n }\n\n.action-info a { color: #7FDBFF; }\n.action-info a:hover { color: #0074D9; }\n.action-link a { color: #7FDBFF; }\n.action-link a:hover { color: #0074D9; }\n\n#splash {\n\tz-index: 100;\n\tposition: fixed;\n\ttop: 0; bottom: 0; left: 0; right: 0;\n\tbackground-color: #111;\n\tcolor: #eee;\n\theight: 100%;\n\twidth: 100%;\n\ttext-align: center;\n\tpadding-top: 10%;\n}\n\n#splash-text {\n\tfont-size: 250%;\n}\n\n#imgloader-box{position:fixed;left:0;top:0;width:2px;height:2px;overflow:hidden;z-index:0}\n#imgloader-box img{position:absolute;left:0;top:0;width:1px;height:1px}\n\n.tutDlg { padding: 10em 15em !important; }</div><div tiddler="playerstatsMobile" tags="" created="201701110238" modifier="twee">&lt;&lt;display &quot;heartbreaker&quot;&gt;&gt;&lt;&lt;display &quot;gritbar&quot;&gt;&gt;Stamina: &lt;&lt;print $sta&gt;&gt;/&lt;&lt;print $maxsta&gt;&gt;\n[img[$gritdisplay]][img[$heartdisplay]]</div><div tiddler="0choice3leavealone" tags="scene" created="201701242357" modifier="twee">&lt;&lt;image &quot;RipPtKid&quot;&gt;&gt;&quot;You're stronger than I give you credit for,&quot; Elesun says.  &quot;I'm sorry.&quot;\n&lt;&lt;set $comfortRip to 0&gt;&gt;\nRipley doesn't say anything.\n\n&quot;And thank you for saving my life,&quot; Elesun says.\n\nElesun turns and heads back to the throne room.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;prol6&quot;&gt;&gt;</div><div tiddler="checkvar" tags="stylesheet" created="201612151919" modifier="twee" twine-position="710,570">/*! &lt;&lt;checkvars&gt;&gt; macro for SugarCube 2.x */\n#ui-dialog-body.checkvars{padding:1em}#ui-dialog-body.checkvars h1{font-size:1.5em;margin-top:0}#ui-dialog-body.checkvars table{border-collapse:collapse;border-spacing:0}#ui-dialog-body.checkvars thead tr{border-bottom:2px solid #444}#ui-dialog-body.checkvars tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.checkvars td,#ui-dialog-body.checkvars th{padding:.25em 1em}#ui-dialog-body.checkvars td:first-child,#ui-dialog-body.checkvars th:first-child{padding-left:.5em;border-right:1px solid #444}#ui-dialog-body.checkvars td:last-child,#ui-dialog-body.checkvars th:last-child{padding-right:.5em}#ui-dialog-body.checkvars th:first-child{text-align:center}#ui-dialog-body.checkvars td:first-child{font-weight:700;text-align:right}#ui-dialog-body.checkvars td{font-family:monospace,monospace;vertical-align:top;white-space:pre-wrap}#ui-dialog-body.checkvars .scroll-pad{margin:0;padding:0}\n</div><div tiddler="armorsmith" tags="menu" created="201612141557" modifier="twee">&lt;&lt;set $gamestart to 0&gt;&gt;The Elysian smith has agreed to help Ripley.  You can select one of your suits of armor to upgrade.  This upgrade is permanent, and cannot be changed later.\n\n[[Upgrade my cloth armor.|armorsmith2][$clothplus to 1; $armorupgrade to 0]]\n\n[[Upgrade my leather armor.|armorsmith2][$leatherplus to 1; $armorupgrade to 0]]\n\n[[Upgrade my chain armor.|armorsmith2][$chainplus to 1; $armorupgrade to 0]]\n\n[[Upgrade my plate armor.|armorsmith2][$plateplus to 1; $armorupgrade to 0]]\n\n[[Cancel upgrading.|$exitpassage][$gamestart to 1]]</div><div tiddler="soundtest" tags="test" created="201701070612" modifier="twee" twine-position="2110,850">[[Music|musictester]]\n\n[[Sound|effecttester]]\n\n\n[[Cancel|debug_features]]</div><div tiddler="StoryTitle" tags="" created="201612121659" modifier="twee" twine-position="290,10">Holy Land</div><div tiddler="newgame2" tags="menu" created="201612122040" modifier="twee" twine-position="1830,150">\n\n\n\n\n\n\nPlease note:\n\nThe browser version of //Holy Land// uses your browser's cache to record saves.  If you want to clear your browser data or switch browsers/computers, you can export/import your save games to your disk drive from the @@font-family: tme-fa-icons;&lt;&lt;- &quot;\sue82b&quot;&gt;&gt;@@ Saves menu on the left.\n\n&lt;&lt;ctrlClick &quot;Okay&quot; &quot;newgame3&quot;&gt;&gt;</div><div tiddler="tut_onNMEspell" tags="hook tutorial" created="201707101328" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\nThe enemy has cast a spell.\n\nSpells are powerful, and most have a chance to cause ''status effects''.  Fortunately, &lt;&lt;name&gt;&gt; has a chance to dispel every spell an enemy casts.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onNMEspell'&gt;&gt;</div><div tiddler="debugdecode" tags="test" created="201701120940" modifier="twee" twine-position="1550,710">&lt;&lt;print $bugcode&gt;&gt;\n&lt;&lt;run setup.decode($bugcode)&gt;&gt;\n\n''Version and Progression'':\n*Version (&lt;&lt;print $versionnumber&gt;&gt;)\n*Chapter (&lt;&lt;print $chapter&gt;&gt;)\n*Stage (&lt;&lt;print $storystage&gt;&gt;)\n&lt;&lt;display &quot;AudioLoad&quot;&gt;&gt;\nSettings (&lt;&lt;print $bugcodeSettings&gt;&gt;):\n*Dock (&lt;&lt;print $dockmode&gt;&gt;)\n*Mobile (&lt;&lt;print $mobile&gt;&gt;)\n*Combat Images (&lt;&lt;print $combatimages&gt;&gt;)\n*Audio (&lt;&lt;print $audioswitch&gt;&gt;)\n*Master Audio (&lt;&lt;print $masteraudioswitch&gt;&gt;)\n*Demo (&lt;&lt;print $demomode&gt;&gt;)\n*Debug (&lt;&lt;print $debug&gt;&gt;)\n\n''Stats'':\n*Character (&lt;&lt;print $character&gt;&gt;)\n*Level (&lt;&lt;print $lvl&gt;&gt;)\n*Stat Base (&lt;&lt;print $statbase&gt;&gt;)\n*Attributes: Str (&lt;&lt;print $strrank&gt;&gt;), Agi (&lt;&lt;print $agirank&gt;&gt;), End (&lt;&lt;print $endrank&gt;&gt;), Wil (&lt;&lt;print $wilrank&gt;&gt;), Cng (&lt;&lt;print $cngrank&gt;&gt;)\n*XP (&lt;&lt;print $xp&gt;&gt;)\n*TP (&lt;&lt;print $tp&gt;&gt;)\n*Scars (&lt;&lt;print $scars&gt;&gt;)\n\n''Items Loaded...''\n&lt;&lt;message &quot;View&quot;&gt;&gt;&lt;&lt;display &quot;debug_decode_view_items&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n''Game Location'' (&lt;&lt;print $return&gt;&gt;) :\n*[[Go there now.|$return][$gamestart to 1]]\n*[[Go in debug mode.|$return][$debug to 1, $gamestart to 1]]\n\nJump to a different passage with the loaded stats:\n\n&lt;&lt;textbox &quot;$go&quot; &quot;&quot; &quot;go&quot; autofocus&gt;&gt;\n\nPress enter to jump.\n\n\n[[Back to decoder.|TheDebugDecoderRing]]\n\n\n</div><div tiddler="irelith5_stats" tags="nobr" created="201612132246" modifier="twee">&lt;&lt;set $allyname to &quot;Irelith&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 2&gt;&gt;\n\n&lt;&lt;set $allylvl to 5&gt;&gt;\n&lt;&lt;set $allymaxhealth to 3&gt;&gt;\n&lt;&lt;set $allymaxgrit to 165&gt;&gt;\n&lt;&lt;set $allyatk to 61&gt;&gt;\n&lt;&lt;set $allydef to 63&gt;&gt;\n&lt;&lt;set $allymov to 56&gt;&gt;\n&lt;&lt;set $allymagic to 56&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;guard&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Guard&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 1&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="tut_onHeartDam" tags="hook tutorial" created="201707101335" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has been wounded.\n\nWhen &lt;&lt;name&gt;&gt;'s &lt;&lt;= setup.words.grit&gt;&gt; is fully depleted, she loses one point of health, represented by the hearts at the bottom of the screen.  If &lt;&lt;name&gt;&gt; loses all her hearts, she dies and it's game over.\n\nHearts can usually only be restored by resting.  When &lt;&lt;name&gt;&gt; rests and recovers from her wounds, she has a chance to earn new scars.  If she earns enough scars, she will gain a new heart.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onHeartDam'&gt;&gt;</div><div tiddler="menu_directory2" tags="annotation" created="201701230931" modifier="twee">\n\n&lt;-journal and help\n\n</div><div tiddler="menu_directory3" tags="annotation" created="201701230933" modifier="twee">^\n|_-weapons\n\n&lt;-spells\n\n\n\n\nsettings-&gt;</div><div tiddler="ch2journal" tags="" created="201612141429" modifier="twee"></div><div tiddler="break" tags="nobr" created="201701241633" modifier="twee">/%  7  %/\n&lt;&lt;set $specialMult to 0.2&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;Shattered&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,1,1,2)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 0.1&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 0.5&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Break&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="ch1journal" tags="" created="201612131830" modifier="twee">&lt;&lt;if $storystage lt 1&gt;&gt;Nothing here yet.&lt;&lt;else&gt;&gt;''Chapter One: Broken Promises''\n\n&lt;&lt;if $storystage lt 3&gt;&gt;Relax a bit.&lt;&lt;else&gt;&gt;Protect and escort Ripley.&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $storystage is 2&gt;&gt;Get some rest before you set out.&lt;&lt;elseif $storystage is 3&gt;&gt;Keep an eye out for trouble.&lt;&lt;elseif $storystage is 4&gt;&gt;Find Ripley.&lt;&lt;elseif $storystage is 5&gt;&gt;Rescue Ripley.&lt;&lt;elseif $storystage is 6&gt;&gt;Kill Aesil.&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="platearmor" tags="nobr" created="201612131619" modifier="twee">&lt;&lt;set $armorname to &quot;Plate Armor&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;plate_ui&quot;&gt;&gt;\n\n&lt;&lt;set $aatk to 0.9&gt;&gt;\n&lt;&lt;set $adef to 1.2&gt;&gt;\n&lt;&lt;set $amov to 0.9&gt;&gt;\n\n&lt;&lt;if $plateplus eq 1&gt;&gt;\n\t&lt;&lt;set $adef to 1.3&gt;&gt;\n\t&lt;&lt;set $aatk to 1.0&gt;&gt;\n\t&lt;&lt;set $armorname to &quot;Plate Armor+&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="0iwgreatsword1" tags="dock" created="201701070318" modifier="twee">It's a mean-looking steel blade, almost as tall as Elesun is herself.  One of the castle’s soldiers must have decided on a more functional weapon.\n\n&lt;&lt;ctrlClick &quot;Pick up the greatsword.&quot; &quot;0iwgreatsword2&quot; &quot;interact&quot;&gt;&gt;</div><div tiddler="epiloguejournal" tags="" created="201612141430" modifier="twee"></div><div tiddler="1servqAndre" tags="dock" created="201708260113" modifier="twee">Andre notices Elesun.  &quot;Lady Elesun, might I have a word?&quot; he asks, standing up.\n\n&lt;&lt;ctrlClick 'Sure.' '1AndreScene'&gt;&gt;</div><div tiddler="0kingsRip" tags="dock" created="201701252208" modifier="twee">&lt;&lt;set $allyTalk to either(&quot;Those are nice paintings&quot;, &quot;Hey that portrait's of me.  I remember having to sit for it&quot;, &quot;There's a painting of Harlaus, there's one of the king over there, too&quot;, &quot;That witch didn't hurt you, right?  You look a little wobbly&quot;)&gt;&gt;&quot;&lt;&lt;print $allyTalk&gt;&gt;,&quot; Ripley says.</div><div tiddler="elysian_mercenary_stats" tags="nobr" created="201612132346" modifier="twee">Summonable, end game.\n\n&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 20&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="spell_inferno" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Inferno&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Hellish&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Inferno&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;infr_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to -10&gt;&gt;\n&lt;&lt;set $spellcritdam to 4.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to -50&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $hellishtraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n&lt;&lt;elseif $hellishtraining is 2&gt;&gt;\n\t&lt;&lt;set $spellgrit to -30&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n&lt;&lt;elseif $hellishtraining is 3&gt;&gt;\n\t&lt;&lt;set $spellcrit to 0&gt;&gt;\n\t&lt;&lt;set $spellgrit to -30&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="fake_comcall_0" tags="fake" created="201701260137" modifier="twee">&lt;&lt;display &quot;Aesil_Prol&quot;&gt;&gt;You’re about to fight &lt;&lt;print $enemyname&gt;&gt;.\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|com_Aes_fake][$gamestart to 0]]&lt;/span&gt;</div><div tiddler="google analytics hooks" tags="annotation" created="201701310043" modifier="twee" twine-position="990,570">&lt;script&gt;\n  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n\n  ga('create', 'UA-91155432-1', 'auto');\n  ga('require', 'urlChangeTracker');\n  ga('require', 'pageVisibilityTracker');\n  ga('send', 'pageview');\n\n&lt;/script&gt;\n&lt;script async src='https://www.google-analytics.com/analytics.js'&gt;&lt;/script&gt;\n&lt;script async src='track/autotrack.js'&gt;&lt;/script&gt;</div><div tiddler="toch2" tags="endch" created="201701282009" modifier="twee">&lt;&lt;nobr&gt;&gt;\n/% delete chapter flags %/\n&lt;&lt;unset $RipScene&gt;&gt;\n&lt;&lt;unset $HarlScene&gt;&gt;\n&lt;&lt;unset $FolsomScene&gt;&gt;\n&lt;&lt;unset $KingScene&gt;&gt;\n&lt;&lt;unset $stoneLoc&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;</div><div tiddler="toch1" tags="endCh" created="201701140731" modifier="twee">!!!Prologue End\n\n&lt;&lt;timed 1s t8n&gt;&gt;&lt;&lt;if $gswordhave is 1&gt;&gt;Elesun found a greatsword and took it with her.&lt;&lt;run $choices.pickUp('tookWeapon-1')&gt;&gt;&lt;&lt;unset $gswordhave&gt;&gt;&lt;&lt;else&gt;&gt;Elesun didn't find anything useful&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;next 1s t8n&gt;&gt;&lt;&lt;if $ripFight is 1&gt;&gt;Elesun let Ripley fight her own battles.&lt;&lt;run $choices.pickUp('ripFight-1')&gt;&gt;&lt;&lt;unset $ripFight&gt;&gt;&lt;&lt;else&gt;&gt;Elesun protected Ripley from the enemy.&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;next 1s t8n&gt;&gt;&lt;&lt;if $helpServants is 1&gt;&gt;Elesun and Ripley tried to help the servants, but were too late.&lt;&lt;run $choices.pickUp('helpServants-1')&gt;&gt;&lt;&lt;unset $helpServants&gt;&gt;&lt;&lt;else&gt;&gt;Elesun and Ripley got to the king as fast as possible.&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;next 1s t8n&gt;&gt;&lt;&lt;if $comfortRip is 1&gt;&gt;Elesun did her best to comfort Ripley.&lt;&lt;run $choices.pickUp('comfortRip-1')&gt;&gt;&lt;&lt;unset $comfortRip&gt;&gt;&lt;&lt;else&gt;&gt;Elesun gave Ripley her space.&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;next 1s t8n&gt;&gt;\s\n&lt;&lt;ctrlClick &quot;Next Chapter&quot; &quot;difficulty_check&quot;&gt;&gt;\n&lt;&lt;/timed&gt;&gt;</div><div tiddler="noally_stats" tags="nobr" created="201612132245" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="StoryInit" tags="" created="201612131335" modifier="twee" twine-position="10,10">/% IFID: 2E6EE76E-E31A-4AD3-B730-FFCC2FAA304D %/\n\n/% asset loaders %/\n&lt;&lt;display 'ASSET_LOADER'&gt;&gt;\n\n/% initialzie version %/\n&lt;&lt;display 'version'&gt;&gt;\n\n/% words %/\n&lt;&lt;set setup.words to {\n\tgrit : 'grit',\n\tmaxgrit : 'maximum grit',\n\tspells : 'charms',\n\tspell : 'charm'\n}&gt;&gt;\n\n/% external init %/\n&lt;&lt;display 'eqp-setup'&gt;&gt;\n&lt;&lt;display 'char-setup'&gt;&gt;\n&lt;&lt;display 'stats-setup'&gt;&gt;\n\n&lt;&lt;display 'engine-setup'&gt;&gt;\n\n/% variable declaration \n&lt;&lt;set $bugcode to &quot;&quot;&gt;&gt;\n&lt;&lt;set $bugcodeVersion to &quot;&quot;&gt;&gt;\n&lt;&lt;set $bugcodeSettings to &quot;&quot;&gt;&gt;\n&lt;&lt;set $bugcodeStats to &quot;&quot;&gt;&gt;\n&lt;&lt;set $bugcodeItems to &quot;&quot;&gt;&gt;\n&lt;&lt;set $chartrue to &quot;&quot;&gt;&gt;\n&lt;&lt;set $bugpassage to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $item to [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;]&gt;&gt;%/\n\n&lt;&lt;set $imageSize to &quot;&quot;&gt;&gt;\n&lt;&lt;set $emote_subj to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $gamestart to 0&gt;&gt;\n&lt;&lt;set $summon to 0&gt;&gt;\n&lt;&lt;set $return to &quot;main menu&quot;&gt;&gt;\n&lt;&lt;set $exitpassage to &quot;main menu&quot;&gt;&gt;\n\n&lt;&lt;set $mode to 1&gt;&gt;\n&lt;&lt;set $modeatk to 1.0&gt;&gt;\n&lt;&lt;set $modeNMEatk to 1.0&gt;&gt;\n\n&lt;&lt;set $song to 0&gt;&gt;\n&lt;&lt;set $storystage to 0&gt;&gt;\n&lt;&lt;set $chapter to 0&gt;&gt;\n&lt;&lt;set $day to 0&gt;&gt;\n\n&lt;&lt;set $anchor to 0&gt;&gt;\n\n&lt;&lt;display 'quest-setup'&gt;&gt;\n\n&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;\n&lt;&lt;display &quot;bal-adjust&quot;&gt;&gt;\n\n&lt;&lt;set setup.xpreq to Math.trunc(setup.xpreq * setup.bal.xpNeed)&gt;&gt;\n\n&lt;&lt;display 'AudioInit'&gt;&gt;\n\n&lt;&lt;if setup.audioswitch is 0&gt;&gt;\n\t&lt;&lt;masteraudio mute&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;display 'initHooksAndTitles'&gt;&gt;\n\n&lt;&lt;set $bossFight to false&gt;&gt;\n&lt;&lt;set $theme to ''&gt;&gt;\n&lt;&lt;set $hookPull to ''&gt;&gt;\n\n&lt;&lt;display 'vowInit'&gt;&gt;\n&lt;&lt;set $choices to new Inventory()&gt;&gt;</div><div tiddler="combat_outro_0_1" tags="comcall" created="201701070325" modifier="twee">The soldier falls before Elesun.&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; time 25 loop play&gt;&gt;\n\n//Elesun is no ordinary warrior.  While levels do matter, her power relative to the power of her foes is a much better indication of how she'll fair in a fight.\n\nFurthermore, many of the more difficult encounters in the game will be hinted at long before they happen.  Try to prepare yourself for every battle by selecting your best equipment and spells for a given fight.\n\nAlso, note that while stamina and grit will return between fights, health damage can only be cured by rest.  Curing health damage through rest also has a chance to give Elesun new scars.  Collecting a certain number of scars will increase Elesun's health permanently.//\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|prol3][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combat_outro_0_2" tags="comcall" created="201701110819" modifier="twee">The assassin falls at Elesun’s feet.\n&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; time 25 loop play&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;\nShe turns to Ripley.  “Are you all right?”\n\n“Yeah, I’m fine.”\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|0meetupwithRip][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combat_outro_0_3" tags="comcall" created="201701242353" modifier="twee">&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; time 25 loop play&gt;&gt;&lt;&lt;set $song to 0&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;The witch falls, and Elesun catches her breath.  A moment later, Ripley comes tumbling down the muddied stone of the wall and lands flat on her back.\n\n&quot;Everything okay?&quot; she asks, climbing to her feet.\n\n&quot;All good here.  You?&quot;\n\n&quot;Eh,&quot; Ripley replies.  &quot;I've fallen farther.&quot;\n\n&quot;Come on, let's get to the throne room.&quot;\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue.|0kingsquarters][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combat_outro_0_4" tags="comcall" created="201701140727" modifier="twee">&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; time 25 loop play&gt;&gt;&lt;&lt;thumb&gt;&gt;The knight falls, and Elesun turns to head back to the throne room.\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue.|0nearvillage][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combat_outro_0_5" tags="comcall" created="201701260109" modifier="twee">&lt;&lt;set $song to 0&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;anticipation&quot; loop play&gt;&gt;&lt;&lt;thumb&gt;&gt;The witch falls, and Elesun catches her breath.  She was definitely the one who destroyed the wall.\n\n[[Continue.|0nearvillage][$gamestart to 1]]</div><div tiddler="1cyGate" tags="dock" created="201702191050" modifier="twee">Head back to the Bailey?\n\n&lt;&lt;ctrlClick &quot;Proceed.&quot; &quot;1bailey&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="Aes-boss-attack-1" tags="qte combat" created="201707261232" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Aesil shrieks in pain as &lt;&lt;name&gt;&gt;'s blows rain down on him.  She follows up the onslaught with a kick, sending Aesil stumbling backward.\n&lt;&lt;print $QTEatk&gt;&gt;\n&quot;Demonkin!&quot; Aesil screams.  &quot;Die!&quot;\n\nAesil extends his hand, and a shadowy black tendril shoots out from it.\n\n&lt;&lt;if $character is 'Ripley'&gt;&gt;Ripley crosses her arms in front of her and her bangles glow faintly.  The dark tendril breaks apart when it meets her, turning to smoke and floating away harmlessly on the air.  &quot;You're a joke,&quot; Ripley says.&lt;&lt;else&gt;&gt;&quot;Shit!&quot; Elesun jumps to the side, but the tendril turns in middair to find her, and hits her, turning to smoke and washing over her.  A weakness begins spreading through her body.\n\n&quot;This spell will kill me,&quot; Elesun says.  &quot;It doesn't matter, though--you won't live to see me die.&quot;&lt;&lt;endif&gt;&gt;\n&lt;&lt;nobr&gt;&gt;\s\n&lt;&lt;if $QTEatk lte 22&gt;&gt;\n\t&lt;&lt;set $nmehealth -= 1&gt;&gt;\n&lt;&lt;elseif $QTEatk lte 35&gt;&gt;\n\t&lt;&lt;set $nmehealth -= 1&gt;&gt;\n\t&lt;&lt;set $nmegrit to Math.trunc( $nmegrit / 2 )&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $nmehealth -= 2&gt;&gt;\n\t&lt;&lt;set $bossPoints++&gt;&gt;\n&lt;&lt;endif&gt;&gt;\s\n&lt;&lt;endnobr&gt;&gt;\n&lt;&lt;ctrlCon 'highway1'&gt;&gt;\n</div><div tiddler="Aes-boss-attack-2" tags="qte combat" created="201707261305" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;name&gt;&gt; tries to keep on the offensive.  Aesil shifts and attempts to gain momentum, but she punches his face hard, cracking skull under her fist.  &lt;&lt;if $character is 'Elesun'&gt;&gt;Elesun gasps, feeling her own bones shatter like glass, and when she pulls her hand away, her fingers are hanging by strands of skin and tendon.  \n\n&quot;Damn it,&quot; she curses.  Her arm feels heavy, sluggish.&lt;&lt;else&gt;&gt;Aesil reels back, but fires another spell before Ripley can close in.  She dispels it easily, but is forced back.&lt;&lt;endif&gt;&gt;\n\n&quot;No!&quot; Aesil shrieks.  &quot;No, no, no no no nonononononononono!  I'm strong!&quot;  He jerks both hands forward toward &lt;&lt;name&gt;&gt;.  In a circle around him, out to a radius of several feet, the grass turns brown as a mass of shadowy dark energy forms in his hands.  &quot;This will kill you!  I will kill you!&quot;\n\n&quot;Come on!&quot; &lt;&lt;name&gt;&gt; cries.  &quot;I am not afraid.&quot;\n\n[[Get Ready!|defend-bar]]\n&lt;&lt;set $nextBoss to 'Aes-boss-defend-2'&gt;&gt;\n&lt;&lt;nobr&gt;&gt;\s\n&lt;&lt;if $QTEatk lte 22&gt;&gt;\n\t&lt;&lt;set $nmehealth -= 1&gt;&gt;\n&lt;&lt;elseif $QTEatk lte 36&gt;&gt;\n\t&lt;&lt;set $nmehealth -= 2&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $nmehealth -= 2&gt;&gt;\n\t&lt;&lt;set $nmegrit to 1&gt;&gt;\n\t&lt;&lt;set $bossPoints++&gt;&gt;\n&lt;&lt;endif&gt;&gt;\s\n&lt;&lt;endnobr&gt;&gt;</div><div tiddler="Aes-boss-attack-3" tags="qte combat" created="201707262108" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;It takes Aesil several attempts to finally climb to his feet.\n\n&quot;Let's end this,&quot; &lt;&lt;name&gt;&gt; says.\n\n&lt;&lt;if $QTEatk lt 23&gt;&gt;\s\n&lt;&lt;set $nmegrit to Math.trunc($nmegrit / 2)&gt;&gt;\s\n&lt;&lt;ctrlCon 'highway1'&gt;&gt;\n&lt;&lt;else&gt;&gt;\s\n&lt;&lt;set $nmegrit to 1&gt;&gt;\s\n&lt;&lt;set $nmehealth to 1&gt;&gt;\s\n&lt;&lt;button [[DESPERATION ATTACK|UltimateDespAtk-Aesil]]&gt;&gt;&lt;&lt;/button&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="kb_controls" tags="menu" created="201702100456" modifier="twee">//Holy Land// supports a number of keyboard shortcuts that can be used to quickly navigate the game screens.\n\n[img[setup.gen.controls]]\n\nOf all the keyboard commands, ''Ctrl'' is probably most worth getting to know.  Use the control key to quickly activate links that are either the only link on the screen (such as &quot;Continue&quot;) or appear in the information dock or pop-up.\n\n&lt;pre&gt;\n''Ctrl or Numpad 0''.....Continue/Select\n''E''....................Equipment Screen \n''C or Shift + Space''...Character Screen \n''A''....................Armor (Equip) \n''S''....................Charms (Equip) \n''W''....................Weapons (Equip) \n''J or Tab''.............Journal Screen \n''X or Shift + S''.......Settings \n''Z or Shift + Tab''.....Codex Menu \n''H''....................Help Menu \n''Q or Esc''.............Exit Menu/Dismiss Popup \n''F''....................Fullscreen Mode \n''M''....................Mute Sound\n''F''....................Dismiss Popup \n''Space''................Clears the information dock\n\nDuring Combat:\n''1 or Numpad 1''............Attack\n''2 or Numpad 2''............Defend\n''3 or Numpad 3''............Move\n''4 or Ctrl or Numpad . ''...End Turn\n''Ctrl or Numpad 0''.........Continue/Next Round&lt;/pre&gt;&lt;&lt;if $character is &quot;Ripley&quot;&gt;&gt;&lt;pre&gt;\n''Space''....................Transform&lt;/pre&gt;&lt;&lt;endif&gt;&gt;\n\n[[Back.|helpmenu]]\n\n[[Return to the Journal|journalmenu]]\n\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;\n</div><div tiddler="Abaddon-6-2" tags="" created="201707262256" modifier="twee"></div><div tiddler="RipChat1" tags="chitchat" created="201707110030" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set _RipChat1 to either(\n&quot;I really did miss Folsom.  It's good to have him around again.  I feel like I can tell him anything.&quot;, \n&quot;Irelith showed me a few new moves yesterday.  I'll show you when we spar next.&quot;,\n&quot;I missed the King and Harlaus.  You're great company, Elesun, but I'm really glad we're all together again.&quot;,\n&quot;I know it's wrong, but when I look down at the village now, I feel guilt.  I know it's not my fault, but it just...it hurts.&quot;,\n&quot;The King seems to be in a pretty foul mood these last few days.  You haven't been too hard on him, have you?&quot;,\n&quot;You look tired.  You should rest up in your quarters.  Don't push yourself too hard, okay?&quot;,\n&quot;One of the masons that was working on the repairs &lt;i&gt;made&lt;/i&gt; me a stone for my collection.  He chiseled it into a perfect little heart-shape.  Isn't that nice?&quot;\n)&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;&lt;&lt;print '&quot;' + _RipChat1 + '&quot;'&gt;&gt;</div><div tiddler="weight" tags="nobr" created="201701241635" modifier="twee">/%  8  %/\n&lt;&lt;set $specialMult to 0.7&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;Weighted&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,1)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 0.9&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 2&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 6&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Burden&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="0wall2continue" tags="dock" created="201701242311" modifier="twee">&quot;Elesun, wait,&quot; Ripley cries.  &quot;Please!&quot;\n\nShe isn't budging from the storeroom door.\n\n&lt;&lt;ctrlClick &quot;Drag her, if that's what it takes.&quot; &quot;0towardthethrone&quot; &quot;leave&quot;&gt;&gt;&lt;&lt;if $servants is 1&gt;&gt;&lt;&lt;set $helpServants++&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="rgn_ui" tags="" created="201702021706" modifier="twee">Grants a massive boost to &lt;&lt;= setup.words.grit&gt;&gt; and &lt;&lt;= setup.words.grit&gt;&gt; regeneration and provides minor healing on defend actions.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_up]]|//Slight//|</div><div tiddler="debug_decode_view_items" tags="test menu" created="201701132036" modifier="twee" twine-position="1830,710">\n!!!Weapons:\n|!Unarmed|Have|Rank: &lt;&lt;print $unarmedtraining&gt;&gt;|\n|!Longsword|Have|Rank: &lt;&lt;print $longswordtraining&gt;&gt;|\n|!Greatsword|&lt;&lt;if $gswordhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $greatswordtraining&gt;&gt;|\n|!Katana|&lt;&lt;if $katanahave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $katanatraining&gt;&gt;|\n|!Spear|&lt;&lt;if $spearhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $speartraining&gt;&gt;|\n|!Sidesword|&lt;&lt;if $sswordhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $sideswordtraining&gt;&gt;|\n|!Gauntlets|&lt;&lt;if $gauntletshave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $gauntletstraining&gt;&gt;|\n|!Scythe|&lt;&lt;if $scythehave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $scythetraining&gt;&gt;|\n|!Saber|&lt;&lt;if $saberhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $sabertraining&gt;&gt;|\n|!Battle Axe|&lt;&lt;if $axehave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $battleaxetraining&gt;&gt;|\n\n!!!Spells:\n|!Neutral|&lt;&lt;if $neutralhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $neutraltraining&gt;&gt;|\n|!Natural|&lt;&lt;if $naturalhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $naturaltraining&gt;&gt;|\n|!Light|&lt;&lt;if $lighthave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $lighttraining&gt;&gt;|\n|!Dark|&lt;&lt;if $darkhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $darktraining&gt;&gt;|\n|!Hellish|&lt;&lt;if $hellishhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|Rank: &lt;&lt;print $hellishtraining&gt;&gt;|\n\n!!!Armor:\n|!Cloth|&lt;&lt;if $clothhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|&lt;&lt;if $clothplus is 1&gt;&gt;Upgraded&lt;&lt;else&gt;&gt;Normal&lt;&lt;endif&gt;&gt;|\n|!Leather|&lt;&lt;if $leatherhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|&lt;&lt;if $leatherplus is 1&gt;&gt;Upgraded&lt;&lt;else&gt;&gt;Normal&lt;&lt;endif&gt;&gt;|\n|!Chain|&lt;&lt;if $chainhave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|&lt;&lt;if $chainplus is 1&gt;&gt;Upgraded&lt;&lt;else&gt;&gt;Normal&lt;&lt;endif&gt;&gt;|\n|!Plate|&lt;&lt;if $platehave is 1&gt;&gt;Have&lt;&lt;else&gt;&gt;Don't Have&lt;&lt;endif&gt;&gt;|&lt;&lt;if $plateplus is 1&gt;&gt;Upgraded&lt;&lt;else&gt;&gt;Normal&lt;&lt;endif&gt;&gt;|\n\n!!!Other Items:\n*Bangles? &lt;&lt;if $bangles is 1&gt;&gt;Yes&lt;&lt;else&gt;&gt;No&lt;&lt;endif&gt;&gt;</div><div tiddler="tut_onRevert" tags="hook tutorial" created="201707101338" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has reverted to her normal form, ending her transformation.\n\n&lt;&lt;name&gt;&gt;'s rage steadily depletes while she is in her transformed state.  When her rage reaches 0%, she returns to her base form.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onRevert'&gt;&gt;</div><div tiddler="shattered_help" tags="dock" created="201701250217" modifier="twee">The influence of powerful dark magic makes &lt;&lt;print $character&gt;&gt;'s flesh and bones weak and prone to injury.  Sustained exposure to this dark magic could turn her into a puddle.\n\nMassive penalty to Move actions and Defense.</div><div tiddler="hard-bal-adj" tags="nobr" created="201704272357" modifier="twee" twine-position="1970,150">/% changes:\n\tcritcal attack are weaker but more common\n\tdesp atks far less effective\n\ttransformations take longer to achieve and are shorter\n\tenemies and the player both have less health\n\tenemies are more agressive and hit harder\n\tmore experience is earned\n\tRipley starts with additional bonuses in Chapter 2\n\t\t-bonus tp\n\t\t-freely unlocked gear\n\t\t-a special title\n%/\n&lt;&lt;display balanceObj&gt;&gt; /%reset%/\n&lt;&lt;set setup.bal.patk to 1.1&gt;&gt;\n&lt;&lt;set setup.bal.pdef to 1.0&gt;&gt;\n&lt;&lt;set setup.bal.pstagger to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.eatk to 1.1&gt;&gt;\n&lt;&lt;set setup.bal.critOdds to 1.2&gt;&gt;\n&lt;&lt;set setup.bal.critical to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.rageB to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.rageD to 1.2&gt;&gt;\n&lt;&lt;set setup.bal.eatk to 1.1&gt;&gt;\n&lt;&lt;set setup.bal.edef to 1.0&gt;&gt;\n&lt;&lt;set setup.bal.egrit to 0.8&gt;&gt;\n&lt;&lt;set setup.bal.estagger to 1.0&gt;&gt; \n&lt;&lt;set setup.bal.ebossSt to 1.8&gt;&gt; \n&lt;&lt;set setup.bal.xpEarn to 1.1&gt;&gt;\n&lt;&lt;set setup.bal.espell to 1.0&gt;&gt;\n&lt;&lt;set setup.bal.desp to 0.5&gt;&gt;\n&lt;&lt;set setup.bal.agression to 2&gt;&gt;\n</div><div tiddler="folsom_stats" tags="nobr" created="201612132343" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="playeractions_fake0" tags="" created="201701260136" modifier="twee">&lt;span id=&quot;twoAct&quot;&gt;[[2. Defend|0aesil4Rip][$gamestart to 1]]&lt;/span&gt;: End turn and focus on defense.\n&lt;span id=&quot;threeAct&quot;&gt;[[3. Move|0aesil4Rip][$gamestart to 1]]&lt;/span&gt;: End turn and try to get an advantage for next time.</div><div tiddler="ripley10_stats" tags="nobr" created="201612132321" modifier="twee">&lt;&lt;set $allyname to &quot;Ripley&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 3&gt;&gt;\n\n&lt;&lt;set $allylvl to 10&gt;&gt;\n&lt;&lt;set $allymaxhealth to 3&gt;&gt;\n&lt;&lt;set $allymaxgrit to 205&gt;&gt;\n&lt;&lt;set $allyatk to 97&gt;&gt;\n&lt;&lt;set $allydef to 82&gt;&gt;\n&lt;&lt;set $allymov to 82&gt;&gt;\n&lt;&lt;set $allymagic to 74&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;chain&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Co-op Attack&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 2&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;\n</div><div tiddler="StoryBanner" tags="Twine.image" created="201701061542" modifier="twee" twine-position="150,10">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMkAAAAzCAYAAAA9zyx6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAANuSURBVHhe7d27btpgGAbglyqp0iFSqzRzF5wBpTdAegMkS9Q76OKoE1mQegEZImUxUwVb1wxVhsbMlQpDZ8SAvXRs06odOlQiqmub3wfA+CMOKhjeR/qS3ydg8Kv/4KAUADhuEdEUD9RvIpqCISESMCREAoaESMCQEAkYEiIBQ0IkYEiIBAwJkYAhIRIwJEQChoRIwJAQCRgSIgFDQiTI+H2SbdSwhR2/PcB7/MJnv020eubQk2ziJXbd0Gyo7fkoGxYcx/HL1NXOmegw1XWOY7pbs8p6naBswApe1zJQVrspPzKGZIDvqhXYwSM8U22iVZIxJLe4US2iVZeLiXulEQyD4kOWMgwrtt+riXFZBY3wuBpC6WZ4vmWkD350M7g2quE1Ce+tyv8Isfdw2lUU/VejvMrf6laxinfujaqbbVTH775Kww3KsdrwtNBqqSY0lNz7u1zS1DZg9TqqNankzokaFbURU6y2U+dIlZoJs5ZwIeXWDCF5jHN3Yj5aT/BCHY1s4fXEecN6pc7IqnVSwEHdVluefUT3uo36Sd39qWiaG4fI1VWQkiL29t0r94Jk2eh3VVMw/v5ayX2h0Nj7j0g7RnkhhMRb6t1U7eyeznnl6066/fAmrRwbUbjsa1xO70iIQqkheYaH6lnIfQzw0Z3oL0ynB0s1oR3hKOhIrB7SMtI71VAoFPw6bMZ7IFo3KSHZwPM5TFl+4PeCHzQ2EY24iuEk2p5xrBU8r0man9B6SEnBLT7gBm8S6yc+qbMif/A24dyLRfYiSrc/OStIm7QPDR8utidWB2jd3L+ryIHO5fXY5FmetJeMGoLOY3LhgNbJHEMywBfVWjrxeYnPgtSR7HEOQsocQ7K5xH+W0sXIiMvuu3uIZpMxJLf4plqL0UUv7BqKqDZiT7Uta6zX8HRweR1LibCy5enHUuU98c82Nxn7bJRLmXuSr/irWoH/O9xqHh5gYppg13FweKU2RnWiVM20stU7vUD4sP5O+jjTTjJeS8vK+z5Jxtp2ath1zv3aSji+RKWbTsDUE46zWNMrcecKle5E8fCYjp54HouVXGuxBBxn18/QVG2iWfDfwREJ1q4nIborhoRIwJAQCRgSIgFDQiRgSIgEDAmRgCEhEjAkRAKGhEjAkBAJGBIiAUNCJGBIiAQMCVEq4B+ahuBYtOD6rwAAAABJRU5ErkJggg==</div><div tiddler="title_onNMEatk_Diplomat" tags="hook title" created="201707101745" modifier="twee">&lt;&lt;if $titles.has('Diplomat')&gt;&gt;\n\t&lt;&lt;if $dodgecheck gte $dodge and $weaponname eq 'Unarmed'&gt;&gt;\n\t\t&lt;&lt;set $dodgecheck to random(1, ($nmeacc - 10))&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1HarlRip" tags="dock" created="201707110055" modifier="twee">&quot;What about Lady Ripley?&quot;\n\n&lt;span class='action-link'&gt;&lt;&lt;dock `'&quot;Do you think she' + &quot;'&quot; + 's pretty?&quot;'` '1HarlRip_pretty'&gt;&gt;&lt;/span&gt;\n&lt;span class='action-link'&gt;&lt;&lt;dock `'&quot;She' + &quot;'&quot; + 'd make a fine queen.&quot;'` '1HarlRip_queen'&gt;&gt;&lt;/span&gt;\n&lt;span class='action-link'&gt;&lt;&lt;dock `'&quot;She' + &quot;'&quot; + 's very fond of you.&quot;'` '1HarlRip_fond'&gt;&gt;&lt;/span&gt;</div><div tiddler="player_settings" tags="menu" created="201701061626" modifier="twee">!!&lt;&lt;print &quot;\su2699&quot;&gt;&gt; Settings\n&lt;&lt;button &quot;Report Bug&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\nDialog.setup(&quot;Bug Report&quot;);\nDialog.wiki(Story.get(&quot;bugr&quot;).processText());\nDialog.open();\n&lt;&lt;/script&gt;&gt;&lt;&lt;/button&gt;&gt;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&lt;&lt;button &quot;Patch Notes&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\nDialog.setup(&quot;Version History&quot;);\nDialog.wiki(Story.get(&quot;Update History&quot;).processText());\nDialog.open();\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;/button&gt;&gt;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&lt;&lt;display &quot;fullscreen_toggler&quot;&gt;&gt;\n\n&lt;&lt;set $gamestart to 2&gt;&gt;Volume: &lt;&lt;volume&gt;&gt; &lt;&lt;display &quot;muter&quot;&gt;&gt;\n\nDock Mode:\n&lt;&lt;display &quot;docksettings&quot;&gt;&gt;\nInterface: (//Beta//)\n&lt;&lt;display &quot;dockdisplay&quot;&gt;&gt;\n\n/%Load last auto-save on start up:\n&lt;&lt;display &quot;autoload&quot;&gt;&gt;%/\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;\n\nHoly Land's IFID is: 2E6EE76E-E31A-4AD3-B730-FFCC2FAA304D\n\n''This is an unfinished build of the game.''\n\n\n</div><div tiddler="kata_ui" tags="" created="201702020416" modifier="twee">Strange, curved blade of a foreign land.\n\nThe weapon is lightwieght and sharp, but also fragile, making it unreliable for defense.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Moderate|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Very Low|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Moderate|\n*__Finesse__: Very High\n*__Stamina__: Moderate</div><div tiddler="Katana" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;kata_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;katn&quot;]]\n[[No|weaponswap]]</div><div tiddler="0choice2tough" tags="dock" created="201701250436" modifier="twee">Ripley is tough--not unbreakable, maybe, but tough as hell nonetheless.\n\nThis alone wouldn't break her.  She'd get over it.  And she'd get her revenge.  Even when she's crying on the ground, Elesun can see her potential.</div><div tiddler="Flame Shroud" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;fshr_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;shroud&quot;]]\n[[No|spellswap]]</div><div tiddler="codex_Aesil" tags="menu" created="201701261837" modifier="twee">&lt;&lt;image &quot;AesPt3&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Aesil''\n\nThe dark mage Aesil is something of an oddity.  Though human, or at least formerly human, he has become nearly unkillable and unbelievably powerful since he has sworn loyalty to Akatosh.  However, his mind and body seem damaged from their deal, leading some to speculate that his deal with Akatosh wasn't made willingly.\n\nAesil's power exceeds even that of the demonkin, and his mastery of magic puts him on even footing with even the most learned wizards.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="debug_thelevelupbutton" tags="nobr test" created="201612132316" modifier="twee">&lt;&lt;set $gamestart to 0&gt;&gt;\n&lt;&lt;set $xpearned to 100&gt;&gt;\n&lt;&lt;xp&gt;&gt;</div><div tiddler="0aesil4Rip" tags="scene" created="201701260059" modifier="twee">&lt;&lt;timed 3s t8n&gt;&gt;&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;Before Elesun can make a move, she hears something.\n&lt;&lt;timed 3s t8n&gt;&gt;\n&quot;Bastard!&quot; &lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; screams, tearing out of the throne room toward Aesil.  &quot;You bastards aren't taking anyone else.&quot;\n\n&quot;Ripley!  Stay away!&quot; Elesun cries.  She rushes, but she won't beat Ripley to Aesil.\n\n&lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; extends his hand and inky black tendrils erupt from the ground toward Ripley and engulf her, holding her in place and wrapping around her limbs and pulling them taught.\n\nElesun throws herself at Aesil, but is knocked back by a single swing of his arm.\n\n&quot;Ripley!&quot; she shouts as she clatters to the ground.\n\nRipley throws her head back and screams in rage.  &quot;Enough!&quot; she shouts, and her bangles ignite with light.  The dark magic holding her dissipates and she lands safely on the ground.\n\nAesil takes a step back.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0aesil4Rip2&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;</div><div tiddler="battleaxe" tags="nobr" created="201612131448" modifier="twee">&lt;&lt;set $weaponname to &quot;Battle Axe&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;baxe_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.6&gt;&gt;\n&lt;&lt;set $wdef to 0.9&gt;&gt;\n&lt;&lt;set $wmov to 0.8&gt;&gt;\n&lt;&lt;set $critrange to 105&gt;&gt;\n\n&lt;&lt;set $wStaUse to 9&gt;&gt;\n\n&lt;&lt;if $battleaxetraining is 1&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n&lt;&lt;elseif $battleaxetraining is 2&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n\t&lt;&lt;set $critrange to 100&gt;&gt;\n&lt;&lt;elseif $battleaxetraining is 3&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n\t&lt;&lt;set $critrange to 100&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="difficulty_check" tags="menu" created="201702190801" modifier="twee">!!!Would you like to change the combat difficulty level before moving on?\nYou will not be able to alter this setting again without restarting the game.\n\nYou &lt;&lt;if $mode is 0&gt;&gt;are currently playing in Story Mode, and have combat turned off&lt;&lt;else&gt;&gt;are currently playing in &lt;&lt;switch $mode&gt;&gt;&lt;&lt;case 1&gt;&gt;Normal&lt;&lt;case 2&gt;&gt;Easy&lt;&lt;case 3&gt;&gt;Intense&lt;&lt;/switch&gt;&gt; Mode&lt;&lt;endif&gt;&gt;.\n\n&lt;&lt;if $mode is 1&gt;&gt;&lt;&lt;link &quot;Stay in Normal Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 1&gt;&gt;&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Change to Easy Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 2&gt;&gt;&lt;&lt;display &quot;easy-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Change to Intense Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 3&gt;&gt;&lt;&lt;display &quot;hard-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Turn combat off.&quot;&gt;&gt;&lt;&lt;set $mode to 0&gt;&gt;&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $mode is 0&gt;&gt;&lt;&lt;link &quot;Leave combat off.&quot;&gt;&gt;&lt;&lt;set $mode to 0&gt;&gt;&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Change to Normal Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 1&gt;&gt;&lt;&lt;display 'balanceObj'&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Change to Easy Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 2&gt;&gt;&lt;&lt;display &quot;easy-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Change to Intense Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 3&gt;&gt;&lt;&lt;display &quot;hard-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $mode is 2&gt;&gt;&lt;&lt;link &quot;Stay in Easy Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 2&gt;&gt;&lt;&lt;display &quot;easy-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Change to Normal Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 1&gt;&gt;&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Change to Intense Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 3&gt;&gt;&lt;&lt;display &quot;hard-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Turn combat off.&quot;&gt;&gt;&lt;&lt;set $mode to 0&gt;&gt;&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;link &quot;Stay in Intense Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 3&gt;&gt;&lt;&lt;display 'hard-bal-adj'&gt;&gt;&lt;&lt;goto 'double_check'&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Change to Normal Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 1&gt;&gt;&lt;&lt;display 'balanceObj'&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Change to Easy Mode.&quot;&gt;&gt;&lt;&lt;set $mode to 2&gt;&gt;&lt;&lt;display &quot;easy-bal-adj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Turn combat off.&quot;&gt;&gt;&lt;&lt;set $mode to 0&gt;&gt;&lt;&lt;display &quot;balanceObj&quot;&gt;&gt;&lt;&lt;goto &quot;double_check&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;button &quot;About Difficulty Levels&quot;&gt;&gt;&lt;&lt;popup &quot;diff_expl&quot;&gt;&gt;&lt;&lt;/button&gt;&gt;</div><div tiddler="rage_store" tags="nobr" created="201703200030" modifier="twee">&lt;&lt;set $rageStock to 0&gt;&gt;\n&lt;&lt;if $rageCurrent lte 10&gt;&gt;\n  &lt;&lt;set $rageStock to $rageCurrent&gt;&gt;\n&lt;&lt;elseif $rageCurrent lte 25&gt;&gt;\n  &lt;&lt;set $rageStock to $rageCurrent - 5&gt;&gt;\n&lt;&lt;elseif $rageCurrent lte 50&gt;&gt;\n  &lt;&lt;set $rageStock to 15 + Math.trunc($rageCurrent+0.5)&gt;&gt;\n&lt;&lt;elseif $rageCurrent lte 100&gt;&gt;\n  &lt;&lt;set $rageStock to 30 + Math.trunc($rageCurrent+0.5)&gt;&gt;\n&lt;&lt;elseif $rageCurrent lte 150&gt;&gt;\n  &lt;&lt;set $rageStock to 80 + Math.trunc($rageCurrent+0.5)&gt;&gt;\n&lt;&lt;elseif $rageCurrent lte 200&gt;&gt;\n  &lt;&lt;set $rageStock to 120 + Math.trunc($rageCurrent+0.5)&gt;&gt;\n&lt;&lt;else&gt;&gt;\n  &lt;&lt;set $rageStock to 0&gt;&gt;\n  &lt;&lt;script&gt;&gt;UI.alert(&quot;Rage meter broke!!!!&quot;)&lt;&lt;/script&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="ElysianBeast-6-1" tags="" created="201707262255" modifier="twee"></div><div tiddler="devil form notes" tags="annotation" created="201702081046" modifier="twee">Devil Form increase stat base by a significant margin (25-30 initially, 25-50 later.)\n\nDevil Form has penalties:\n*can't perform crits.\n*can't perform desperation attacks.\n*lowers dispel and dodge.\n*prevents all regen.\n*halves healing.</div><div tiddler="elysian_mage_stats" tags="nobr" created="201612132346" modifier="twee">Summonable, end game.\n\n&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 20&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="1throneDoor" tags="dock" created="201708112305" modifier="twee">Go back to the main hall?\n\n&lt;&lt;ctrlClick 'Go.' '1mainhall' 'leave'&gt;&gt;</div><div tiddler="Protect" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;prot_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;prot&quot;]]\n[[No|spellswap]]</div><div tiddler="Ally dialogue" tags="annotation" created="201702022258" modifier="twee">System deprecated.</div><div tiddler="0aesil1" tags="scene" created="201701140727" modifier="twee">&lt;span id=&quot;gone&quot;&gt;Elesun walks down the steps.  Every step, the smell grows stronger.  Ripley stops partway down in a fit of gagging.  \n\nElesun arrives at the bottom of the steps.  It's hard to see.  The floor is wet.\n\n&lt;&lt;timed 2s t8n&gt;&gt;&lt;span id=&quot;ctrlClick&quot;&gt;&lt;&lt;link &quot;Wait for Ripley.&quot;&gt;&gt;&lt;&lt;append &quot;#gone&quot;&gt;&gt;&lt;&lt;display &quot;0aesWait&quot;&gt;&gt;&lt;&lt;/append&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;/timed&gt;&gt;\n\n&lt;/span&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="0aesil3" tags="choice" created="201701250403" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;Ripley manages to dispel his magic--her bangles gleam with light.\n\nElesun jumps to her feet and charges to her side.\n\n&quot;Go!  Get out of here!&quot; she cries.\n\n&quot;We can beat him together,&quot; Ripley says.\n\n[[Grab Ripley and run.|0aesRun][$ripleytp++]]\n\n[[Stand and fight.|0aesFight][$ripleyscars++]]</div><div tiddler="0aesil2" tags="scene" created="201701250328" modifier="twee">&lt;&lt;image &quot;AesPt3&quot;&gt;&gt;That's not a face you forget.  Last time they met, Elesun was forced to run.  She'd love to kill him though, if it was even possible.\n\n&lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; shrieks, and with a gesture, knocks Elesun across the room with a burst of magical force.\n\n&lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; shouts, and Elesun can hear a struggle starting as she crashes into the far wall and falls face first onto the bloody floor.\n\n&lt;&lt;ctrlClick &quot;Get up.&quot; &quot;0aesil3&quot;&gt;&gt;</div><div tiddler="heartbreaker" tags="nobr" created="201701051033" modifier="twee">&lt;&lt;set $hearts to ($maxhealth*10)+$health&gt;&gt;\n\n&lt;&lt;if $hearts is 33&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['3of3'])&gt;&gt;\n&lt;&lt;elseif $hearts is 32&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['2of3'])&gt;&gt;\n&lt;&lt;elseif $hearts is 31&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['1of3'])&gt;&gt;\n&lt;&lt;elseif $hearts is 30&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['0of3'])&gt;&gt;\n\n&lt;&lt;elseif $hearts is 44&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['4of4'])&gt;&gt;\n&lt;&lt;elseif $hearts is 43&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['3of4'])&gt;&gt;\n&lt;&lt;elseif $hearts is 42&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['2of4'])&gt;&gt;\n&lt;&lt;elseif $hearts is 41&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['1of4'])&gt;&gt;\n&lt;&lt;elseif $hearts is 40&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['0of4'])&gt;&gt;\n\n&lt;&lt;elseif $hearts is 55&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['5of5'])&gt;&gt;\n&lt;&lt;elseif $hearts is 54&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['4of5'])&gt;&gt;\n&lt;&lt;elseif $hearts is 53&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['3of5'])&gt;&gt;\n&lt;&lt;elseif $hearts is 52&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['2of5'])&gt;&gt;\n&lt;&lt;elseif $hearts is 51&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['1of5'])&gt;&gt;\n&lt;&lt;elseif $hearts is 50&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['0of5'])&gt;&gt;\n\n&lt;&lt;elseif $hearts is 66&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['6of6'])&gt;&gt;\n&lt;&lt;elseif $hearts is 65&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['5of6'])&gt;&gt;\n&lt;&lt;elseif $hearts is 64&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['4of6'])&gt;&gt;\n&lt;&lt;elseif $hearts is 63&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['3of6'])&gt;&gt;\n&lt;&lt;elseif $hearts is 62&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['2of6'])&gt;&gt;\n&lt;&lt;elseif $hearts is 61&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['1of6'])&gt;&gt;\n&lt;&lt;elseif $hearts is 60&gt;&gt;\n\t&lt;&lt;set $heartdisplay to clone(setup.ui.hearts['0of6'])&gt;&gt;\n\n&lt;&lt;endif&gt;&gt;\n</div><div tiddler="0aesil4" tags="scene" created="201701260055" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;if $helpServants is 0&gt;&gt;Aesil is a master of dark magic, consumed by his lust for murder, and loyal only to &lt;&lt;journallink &quot;Akatosh&quot; &quot;codex_Akatosh&quot;&gt;&gt;.  Elesun had faced him once or twice before.  She knows she can't kill him, but she might be able to hold him off.&lt;&lt;else&gt;&gt;Elesun knows she can't kill Aesil, but she only needs to hold him off.&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; climbs to his feet, and upon seeing Elesun, his eyes grow wide and his mouth contorts into a grin too big for his face.  &quot;Demonkin!&quot; he shrieks.\n\n&quot;All right,&quot; Elesun says to herself.  &quot;I can do this.&quot;\n\n&lt;&lt;ctrlClick &quot;Stay alive.&quot; &quot;fake_comcall_0&quot;&gt;&gt;</div><div tiddler="codex_menu_history" tags="menu" created="201612141348" modifier="twee">!History\n\n&lt;span id=&quot;codexhis&quot;&gt;Description of History&lt;/span&gt;\n\n&lt;&lt;link &quot;The Founding of Juno&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Juno history&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The First Druids&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Druid history&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Endless Cycle&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;The history of the demonkin&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Vampire Lord&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Vampire history&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Dragon Pacts&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Dragon/human history&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Elysian Affair&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Past Elysian incidents&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Valnese Revolution&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Valne history&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Fall of the North&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexhis&quot;&gt;&gt;Norther history&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n[[Back|codex_menu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="musictester" tags="test menu" created="201701070600" modifier="twee" twine-position="2250,990">&lt;&lt;link &quot;Anticipation&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;anticipation&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Snowfall&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;snowfall&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Expressions of the Mind&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;expressions-of-the-mind&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Aesil's Theme&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;herat7&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;It's Like Her Eyes Are on Fire&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;eyes-fire&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;There's Nothing Left for You Here&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;nothing-left&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n[[Sounds|effecttester]]\n\n[[Back|debug_features]]\n\n\n&lt;&lt;link &quot;Battle Theme 1&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle1&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 2&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle2&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 3&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle3&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 4&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle4&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 5&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle5&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 6&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle6&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 7&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle7&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 8&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle8&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Battle Theme 9&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;battle9&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n[[Sounds|effecttester]]\n\n[[Back|debug_features]]\n\n\n&lt;&lt;link &quot;alhambra&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;alhambra&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;another&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;another&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;asked&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;asked&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;breath&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;breath&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;cell&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;cell&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;cibelle&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;cibelle&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;desperate&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;desperate&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;dope&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;dope&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;dunno&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;dunno&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;escape&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;escape&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n[[Sounds|effecttester]]\n\n[[Back|debug_features]]\n\n\n&lt;&lt;link &quot;milan&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;milan&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;mx&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;mx&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;oh&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;ophelia&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;ophelia&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;red&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;red&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;rhodes&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rhodes&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;sleeping&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;sleeping&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;slow&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;slow&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;space&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;space&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;spin&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;spin&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n[[Sounds|effecttester]]\n\n[[Back|debug_features]]\n\n\n&lt;&lt;link &quot;stand&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;stand&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;summer&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;summer&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;un&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;un&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;what&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;what&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;you&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;you&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;wa&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;wa&quot; loop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n\n[[Sounds|effecttester]]\n\n[[Back|debug_features]]\n\n\n</div><div tiddler="allies" tags="annotation" created="201702022257" modifier="twee">Deprecated in favor of more depth for Arkan.</div><div tiddler="Spear" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;spr_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;spear&quot;]]\n[[No|weaponswap]]</div><div tiddler="prot_ui" tags="" created="201702021630" modifier="twee">Protect grants small bonuses to dodge, dispel, &lt;&lt;= setup.words.grit&gt;&gt;, and defense at no cost.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="VampireLord-5-1" tags="" created="201707262254" modifier="twee"></div><div tiddler="link keys macro" tags="script" created="201705020520" modifier="twee" twine-position="10,430">\n/*\n&lt;&lt;linkkey&gt;&gt; macro\n\nusage:\n&lt;&lt;linkkey 'link text' 'linkkey id' (optional: keyword)&gt;&gt;...&lt;&lt;/message&gt;&gt;\n\n\nex. &lt;&lt;linkkey 'Click me' 'oneAct'&gt;&gt;...&lt;&lt;/linkkey&gt;&gt;\nex. &lt;&lt;linkkey 'Clickity click' 'aKeyAct' app&gt;&gt;...&lt;&lt;/linkey&gt;&gt;\n\nLINK TEXT:  The text of the link.\n\nLINKKEY ID:  ID associated with an event handler to fire the link.\n\nKEYWORD:  One of the following:\n\t* btn : renders as a button\n    * pre : prepend\n    * rpl : replace\n    * app : append\n    * defaults to an ordinary link\n\nNOTE:  Cannot accept a target-passage argument--use &lt;&lt;goto&gt;&gt;!\n*/\nMacro.add('linkkey', {\n\t   tags : null,\n\thandler : function () {\n\t\n\t\tvar $wrapper = $(document.createElement('span'));\n\t\tvar $content = $(document.createElement('span'));\n\t\tvar link     = 'link';\n\t\tvar content  = this.payload[0].contents;\n\t\t\n\t\tif (this.args.length &lt; 2 || this.args.length &gt; 3) {\n\t\t\treturn this.error('must be 2 or 3 arguments');\n\t\t} else {\n\t\t\tvar text     = this.args[0];\n\t\t\tvar key      = this.args[1];\n\t\t}\n\n\t\tif (this.args.length === 3) {\n\t\t\tif (this.args.includes('btn')) {\n\t\t\t\tlink = 'button';\n\t\t\t} else if (this.args.includes('rpl')) {\n\t\t\t\tlink = 'linkreplace';\n\t\t\t} else if (this.args.includes('app')) {\n\t\t\t\tlink = 'linkappend';\n\t\t\t} else if (this.args.includes('pre')) {\n\t\t\t\tlink = 'linkprepend';\n\t\t\t} else {\n\t\t\t\tlink = 'link';\n\t\t\t}\n\t\t}\n\t\t\n\t\t$wrapper\n\t\t\t.wiki('&lt;&lt;' + link + ' &quot;' + text + '&quot;&gt;&gt;' + content + '&lt;&lt;/' + link + '&gt;&gt;')\n\t\t\t.attr('id', key)\n\t\t\t.appendTo(this.output);\n\t\t}\n});</div><div tiddler="0choice1barefoot" tags="dock" created="201701140608" modifier="twee">Ripley doesn’t wear shoes often.  The druids believe that their connection to the earth grants them spiritual power, and only wear shoes when absolutely necessary.\n\nThere was something to it.  Elesun heard tell of druid oracles who could sense the location of others across respectable distances by feeling the ground.  That said, for Ripley it was just a cultural thing.</div><div tiddler="rank4lvl4_knight_akatosh" tags="nobr" created="201612181024" modifier="twee">&lt;&lt;set $enemyname to &quot;Wandering Knight&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 2&gt;&gt;\n&lt;&lt;set $enemypower to 187&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme['NME_knight']&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 160&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 3&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 44&gt;&gt;\n&lt;&lt;set $nmedef to 45&gt;&gt;\n&lt;&lt;set $nmemov to 42&gt;&gt;\n&lt;&lt;set $nmemagic to 30&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;heal&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 10&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 7&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.6&gt;&gt;\n&lt;&lt;set $nmespellpower to 60&gt;&gt;\n&lt;&lt;set $nmeacc to 100&gt;&gt;\n&lt;&lt;set $nmebaseregen to 4&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 3&gt;&gt;\n&lt;&lt;set $nmetype to 2&gt;&gt;\n\n&lt;&lt;set $nmexp to 45&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;</div><div tiddler="carthus_stats" tags="nobr" created="201612132344" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="Aesil_phase" tags="boss hook" created="201707261215" modifier="twee">&lt;&lt;if $nmehealth lte 9 and $phase is 0&gt;&gt;\n\t&lt;&lt;set $QTEatk to 0&gt;&gt;\n\t&lt;&lt;set $phase to 1&gt;&gt;\n\t&lt;&lt;set $sta to $maxsta - $NMEStaLmt&gt;&gt;\n\t&lt;&lt;goto 'Aesil-phase-shift-1'&gt;&gt;\n&lt;&lt;elseif $nmehealth lte 6 and $phase is 1&gt;&gt;\n\t&lt;&lt;set $QTEatk to 0&gt;&gt;\n\t&lt;&lt;set $phase to 2&gt;&gt;\n\t&lt;&lt;set $sta to $maxsta - $NMEStaLmt&gt;&gt;\n\t&lt;&lt;goto 'Aesil-phase-shift-2'&gt;&gt;\n&lt;&lt;elseif $nmehealth lte 2 and $phase is 2&gt;&gt;\n\t&lt;&lt;set $QTEatk to 0&gt;&gt;\n\t&lt;&lt;set $phase to 3&gt;&gt;\n\t&lt;&lt;set $sta to $maxsta - $NMEStaLmt&gt;&gt;\n\t&lt;&lt;goto 'Aesil-phase-shift-3'&gt;&gt;\n&lt;&lt;elseif $nmehealth lte 1 and $bossPoints is 6 and $phase is 3&gt;&gt;\n\t/% special fight ending if QTEs were perfect %/\n\t&lt;&lt;goto 'Aesil-phase-shift-4'&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="nmegritbar" tags="nobr" created="201701051306" modifier="twee">&lt;&lt;set $NMEtruegrit to Math.trunc(($nmegrit/$nmemaxgrit)*100)&gt;&gt;\n\n&lt;&lt;if $NMEtruegrit lt 5&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['0grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 10&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['5grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 15&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['10grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 20&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['15grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 25&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['20grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 30&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['25grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 35&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['30grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 40&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['35grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 45&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['40grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 50&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['45grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 55&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['50grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 60&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['55grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 65&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['60grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 70&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['65grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 75&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['70grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 80&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['75grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 85&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['80grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 90&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['85grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 95&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['90grit'])&gt;&gt;\n&lt;&lt;elseif $NMEtruegrit lt 100&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['95grit'])&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $NMEgritdisplay to clone(setup.ui.grit['100grit'])&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n\n\n</div><div tiddler="tut_onCrit" tags="hook tutorial" created="201707101327" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has just scored a critical hit!\n\nWith every attack she launches, &lt;&lt;name&gt;&gt; has a chance of scoring a critical hit.  Critical hits deal much higher damage than normal.  The odds of scoring a critical hit and the damage they deal are influenced by Agility and Cunning and the currently equipped weapon.\n\nGenerally, lighter and faster weapons have a higher chance of scoring a critical, and allow more attacks per turn, further increasing the odds.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onCrit'&gt;&gt;</div><div tiddler="audiomute" tags="nobr" created="201701062243" modifier="twee" twine-position="430,710">&lt;&lt;if setup.masteraudioswitch is 1&gt;&gt;\n\n\t&lt;&lt;link &quot;\su00a0\su00a0\su00a0\su2669\su00a0\su00a0\su00a0\s Mute Sound&quot;&gt;&gt;\n\n\t\t&lt;&lt;if setup.audioswitch is 1&gt;&gt;\n\t\t\t&lt;&lt;masteraudio mute&gt;&gt;\n\t\t\t&lt;&lt;set setup.audioswitch to 0&gt;&gt;\n\n\t\t&lt;&lt;else&gt;&gt;\n\t\t\t&lt;&lt;masteraudio unmute&gt;&gt;\n\t\t\t&lt;&lt;set setup.audioswitch to 1&gt;&gt;\n\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;/link&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="chain_ui" tags="" created="201702020423" modifier="twee">A suit of chain armor.  &lt;&lt;if $clothplus is 1&gt;&gt;Or so it seems.  Though this armor may not seem like much, it's been forged by the legendary blacksmiths of the Elysian realm, and should not be underestimated.&lt;&lt;endif&gt;&gt;\n\nChain armor is heavy and awkward, but provides excellent defense.\n\n|[img[setup.ui.icons.ui_def]]|Defense Bonus:|Moderate|\n|[img[setup.ui.icons.ui_mov]]|Encumberance:|Moderate|</div><div tiddler="defend-bar" tags="combat" created="201702222231" modifier="twee">\n\n\n\n\n&lt;center&gt;&lt;div class=&quot;battle-bar&quot;&gt;&lt;span class=&quot;w2&quot;&gt;&lt;/span&gt;&lt;/div&gt;\n\n&lt;div class=&quot;time-btn def-bar&quot;&gt;&lt;span id=&quot;timedpress&quot;&gt;&lt;&lt;button &quot;Wait!&quot;&gt;&gt;&lt;&lt;audio &quot;hurt2&quot; play&gt;&gt;&lt;&lt;set $def_success to false&gt;&gt;&lt;&lt;goto $nextBoss&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;&lt;timed 500ms&gt;&gt;\n&lt;&lt;replace &quot;#timedpress&quot;&gt;&gt;&lt;&lt;button &quot;Block!&quot;&gt;&gt;&lt;&lt;audio &quot;defend&quot; play&gt;&gt;&lt;&lt;set $def_success to true&gt;&gt;&lt;&lt;goto $nextBoss&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;/replace&gt;&gt;\n&lt;&lt;next 500ms&gt;&gt;\n&lt;&lt;replace &quot;#timedpress&quot;&gt;&gt;&lt;&lt;button &quot;Wait!&quot;&gt;&gt;&lt;&lt;audio &quot;hurt1&quot; play&gt;&gt;&lt;&lt;set $def_success to false&gt;&gt;&lt;&lt;goto $nextBoss&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;/replace&gt;&gt;\n&lt;&lt;next 500ms&gt;&gt;\n&lt;&lt;audio &quot;hurt3&quot; play&gt;&gt;&lt;&lt;goto $nextBoss&gt;&gt;\n&lt;&lt;/timed&gt;&gt;&lt;/center&gt;</div><div tiddler="spr_ui" tags="" created="201702020411" modifier="twee">A sturdy spear with an elongated tip for sweeping.\n\nThe range of the spear makes it easy to keep enemies back, but it's length can also make it awkward to wield.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Moderate|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Very High|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Very Low|\n*__Finesse__: Moderate\n*__Stamina__: Moderate</div><div tiddler="0meetupwithRip" tags="scene" created="201701110821" modifier="twee">&lt;&lt;set $storystage to 2&gt;&gt;&lt;&lt;set $xpearned to $xpearned + 70&gt;&gt;&lt;&lt;set $exitpassage to &quot;prol4&quot;&gt;&gt;\n&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;\n'How are things going out there?&quot; Ripley asks.\n\n&quot;Everything is going to be fine.  We need to regroup with Irelith and help protect the king.&quot;\n\n&quot;We could go over the walls, it might be faster.&quot;\n\n&quot;Good idea, let’s go.&quot;\n\n//You earned enough experience to level up.//\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helplevelup&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;ctrlClick &quot;Level up.&quot; &quot;tallyxp&quot;&gt;&gt;\n\n&lt;&lt;set $helpthestaff to 0&gt;&gt;\n&lt;&lt;notifyJournal&gt;&gt;</div><div tiddler="1FolsomTalk" tags="talk" created="201707110028" modifier="twee">&lt;&lt;image &quot;FolsomPt&quot;&gt;&gt;Elesun approaches Folsom.\n\n&quot;Hello Elesun.&quot;\n\n&lt;&lt;dock &quot;Chit-chat.&quot; &quot;FolsomChat1&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;How are you holding up?&quot; &quot;1FolsomHow&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Goodbye.&quot; &quot;1FolsomNVM&quot;&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n</div><div tiddler="Start" tags="menu" created="201612121659" modifier="twee" twine-position="1550,10">&lt;div id=&quot;titleContainer&quot;&gt;&lt;span id=&quot;titlecard&quot;&gt;[img[setup.gen.titlecard]]&lt;/span&gt;&lt;/div&gt;\n\n\n&lt;&lt;ctrlClick &quot;Continue&quot; &quot;main menu&quot;&gt;&gt;\n\n&lt;&lt;tipster&gt;&gt;\n&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio 'space' loop play&gt;&gt;\n&lt;&lt;nobr&gt;&gt;\n/%&lt;&lt;display 'splash-screen'&gt;&gt;%/\n/% cache images %/\n&lt;&lt;script&gt;&gt;(function () {\n\tvar sources = [], img = [], icn = [], grit = [], rage = [], hearts = [],\n\t\tdocFrag = document.createDocumentFragment(),\n\t\timgBox  = document.createElement(&quot;div&quot;);\n\t\t\n\timg = $.map(setup.img, function(value, index) {\n\t\treturn [value];\n\t});\n\ticn = $.map(setup.ui.icons, function(value, index) {\n\t\treturn [value];\n\t});\n\tgrit = $.map(setup.ui.grit, function(value, index) {\n\t\treturn [value];\n\t});\n\trage = $.map(setup.ui.rage, function(value, index) {\n\t\treturn [value];\n\t});\n\thearts = $.map(setup.ui.hearts, function(value, index) {\n\t\treturn [value];\n\t});\n\tsources = sources.concat(img, icn, grit, rage, hearts);\n\t\n\t\n\timgBox.id = &quot;imgloader-box&quot;;\n\tdocFrag.appendChild(imgBox);\n\tsources.forEach(function (src) {\n\t\tvar image = document.createElement(&quot;img&quot;);\n\t\timage.src = src;\n\t\timgBox.appendChild(image);\n\t});\n\tdocument.body.appendChild(docFrag);\n}());\n\n/*$(document).one(':audiofullyloaded', function () {\n\t$('#splash-title').fadeOut(500);\n\t$('#splash').delay(250).fadeOut(1000);\n});*/\n&lt;&lt;/script&gt;&gt;\n/%&lt;&lt;timed 6s&gt;&gt;\n\t&lt;&lt;run $('#splash-title').fadeOut(500);&gt;&gt;\n\t&lt;&lt;run $('#splash').delay(250).fadeOut(1000);&gt;&gt;\n&lt;&lt;/timed&gt;&gt;%/\n&lt;&lt;endnobr&gt;&gt;</div><div tiddler="dockdisplay" tags="" created="201701301728" modifier="twee">&lt;&lt;if $dockdisp is -1&gt;&gt;* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; -1 checked&gt;&gt; Mixed:  Dock links that provide information are shown in the dock at the bottom of the screen.  Dock links that include further links to click are rendered as &quot;pop ups.&quot;&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; 1&gt;&gt; Dock Only:  The contents of all dock links appear in the dock at the bottom of the screen. Default.&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; 0&gt;&gt; Pop Up Only:  All dock links open a pop-up style window on the screen when a link is clicked and the dock is completely removed.&lt;/label&gt;&lt;&lt;elseif $dockdisp is 1&gt;&gt;* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; -1&gt;&gt; Mixed:  Dock links that provide information are shown in the dock at the bottom of the screen.  Dock links that include links are rendered as &quot;pop ups.&quot;&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; 1 checked&gt;&gt; Dock Only:  The contents of all dock links appear in the dock at the bottom of the screen. Default.&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; 0&gt;&gt; Pop Up Only:  All dock links open a pop-up style window on the screen when a link is clicked and the dock is completely removed.&lt;/label&gt;&lt;&lt;elseif $dockdisp is 0&gt;&gt;* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; -1&gt;&gt; Mixed:  Dock links that provide information are shown in the dock at the bottom of the screen.  Dock links that include links are rendered as &quot;pop ups.&quot;&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; 1&gt;&gt; Dock Only:  The contents of all dock links appear in the dock at the bottom of the screen. Default.&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockdisp&quot; 0 checked&gt;&gt; Pop Up Only:  All dock links open a pop-up style window on the screen when a link is clicked and the dock is completely removed.&lt;/label&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="0mainhall1Rip" tags="dock" created="201701252356" modifier="twee">&quot;I'm ready,&quot; Ripley says.  &quot;Let's go.&quot;</div><div tiddler="ch1intro" tags="save" created="201612182013" modifier="twee">!Chapter 1: Broken Promises&lt;&lt;portrait&gt;&gt;\nSeptember 13, 1101:&lt;&lt;set $chapter to 1&gt;&gt;&lt;&lt;set $storystage to 0&gt;&gt; ''Three months later.''\n&lt;&lt;if visited() is 1&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;cibelle&quot; loop play&gt;&gt;&lt;&lt;set $song to 1&gt;&gt;&lt;&lt;endif&gt;&gt;\nThings aren't as dire as they could be, and Elesun knows it.  Every day that passes without word of &lt;&lt;journallink &quot;Akatosh&quot; &quot;codex_Akatosh&quot;&gt;&gt; is worrying--but no news is good news.  The siege hit the castle hard.  It Ripley hard.  But &lt;&lt;journallink &quot;Prince Harlaus&quot; &quot;codex_Harlaus&quot;&gt;&gt; arrived at the castle last month, and his presence is a calm sea after a storm; even after all the funerals, Ripley still manages to smile when he's near.\n\nShe'll be okay.  &lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; beleives that, she forces herself to believe it.  Still...\n\nThere's a darkness forming in Ripley--a rage and anger that Elesun had never known her to have.  It wasn't obvious--indeed, no one else seemed to notice.  But Elesun saw it.  She could see it when &lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; would fall silent, set her jaw, and stare off in to the distance.  Every once in a while, Ripley would doze off like that, and though Elesun couldn't guess what she was thinking about, but she could see the thoughts pass over her face like shadows chasing light.&lt;&lt;if $mode is 3&gt;&gt;\n\n//Intense Mode bonuses added.//\n\n&lt;&lt;message 'About Intense Mode'&gt;&gt;In Intense Mode, the player and enemies both have less health across the board, critical hits occur more frequently but deal less damage, deperation attacks and transformations are weaker, and enemies are more aggressive.\n\nIn exchange, you gain more experience and start the game with extra training points and equipment, among a few other bonuses.&lt;&lt;/message&gt;&gt;&lt;&lt;set $tp += 9, $gauntletshave to 1, $axehave to 1, $spearhave to 1, $darkhave to 1, $lighthave to 1, $chainhave to 1&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;ctrlClick &quot;Start.&quot; &quot;ch1-1&quot;&gt;&gt;\s\n&lt;&lt;nobr&gt;&gt;\n/% init chapter flags %/\n&lt;&lt;set $RipScene to 0&gt;&gt;\n&lt;&lt;set $HarlScene to 0&gt;&gt;\n&lt;&lt;set $FolsomScene to 0&gt;&gt;\n&lt;&lt;set $KingScene to 0&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;</div><div tiddler="1courtyard" tags="space" created="201701281953" modifier="twee">The &lt;&lt;action &quot;courtyard&quot; &quot;1cyInspect&quot;&gt;&gt; is pristine as always.  A pair of &lt;&lt;dock &quot;guards&quot; &quot;1cyGuards&quot;&gt;&gt; are standing in the far corner talking near the &lt;&lt;action &quot;well&quot; &quot;1cyWell&quot;&gt;&gt;.\n\nThe bailey is just through the &lt;&lt;action &quot;gate&quot; &quot;1cyGate&quot;&gt;&gt;.\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="splinfo" tags="" created="201612151713" modifier="twee">&lt;&lt;print $character&gt;&gt; is capable of using bound magic, and the &lt;&lt;= setup.words.spell&gt;&gt; you select provides various passive bonuses and unique effects, occasionally offset by penalties.</div><div tiddler="decode" tags="script" created="201701121029" modifier="twee" twine-position="850,430">/*try { \n  version.extensions['decoderMacro'] = { \n    major:1, minor:1, revision:2 \n  };\n\tmacros['decoder'] = {\n\t\thandler: function(place, macroName, params, parser) {\n\t\t\tvar bcode, vn1, vn2, vn3,loc,itemcode;\n\t\t\tbcode = State.variables.bugcode;\n\t\t\tState.variables.chapter = bcode.charAt(6);\n\t\t\tvn1 = bcode.charAt(0);\n\t\t\tvn2 = bcode.charAt(2);\n\t\t\tvn3 = bcode.charAt(4);\n\t\t\tState.variables.versionnumber = vn1+&quot;.&quot;+vn2+&quot;.&quot;+vn3;\n\t\t\tState.variables.storystage = bcode.charAt(8);\n\t\t\tState.variables.dockmode = bcode.charAt(10);\n\t\t\tState.variables.mobile = bcode.charAt(11);\n\t\t\tState.variables.combatimages = bcode.charAt(12);\n\t\t\tState.variables.audioswitch = bcode.charAt(13);\n\t\t\tState.variables.masteraudioswitch = bcode.charAt(14);\n\t\t\tState.variables.demomode = bcode.charAt(15);\n\t\t\tState.variables.debug = bcode.charAt(16);\n\t\t\tState.variables.lvl = bcode.charAt(18) + bcode.charAt(19);\n\t\t\tState.variables.xp = bcode.charAt(21) + bcode.charAt(22) + bcode.charAt(23);\n\t\t\tState.variables.tp = bcode.charAt(25) + bcode.charAt(26) + bcode.charAt(27) + bcode.charAt(28);\n\t\t\tState.variables.scars = bcode.charAt(30) + bcode.charAt(31);\n\t\t\tState.variables.chartrue = bcode.charAt(33);\n\t\t\tState.variables.strrank = bcode.charAt(37) + bcode.charAt(38);\n\t\t\tState.variables.agirank = bcode.charAt(39) + bcode.charAt(40);\n\t\t\tState.variables.endrank = bcode.charAt(41) + bcode.charAt(42);\n\t\t\tState.variables.wilrank = bcode.charAt(43) + bcode.charAt(44);\n\t\t\tState.variables.cngrank = bcode.charAt(45) + bcode.charAt(46);\n\t\t\tState.variables.statbase = bcode.charAt(47) + bcode.charAt(48);\n\t\t\tloc = bcode.split(&quot;:&quot;);\n\t\t\tState.variables.bugcodeVersion = loc[0];\n\t\t\tState.variables.bugcodeSettings = loc[1];\n\t\t\tState.variables.bugcodeStats = loc[2];\n\t\t\tState.variables.bugcodeItems = loc[3];\n\t\t\titemcode = loc[3];\n\t\t\tState.variables.item[0] = itemcode.charAt(0);\n\t\t\tState.variables.item[1] = itemcode.charAt(2);\n\t\t\tState.variables.item[2] = itemcode.charAt(4);\n\t\t\tState.variables.item[3] = itemcode.charAt(6);\n\t\t\tState.variables.item[4] = itemcode.charAt(8);\n\t\t\tState.variables.item[5] = itemcode.charAt(10);\n\t\t\tState.variables.item[6] = itemcode.charAt(12);\n\t\t\tState.variables.item[7] = itemcode.charAt(14);\n\t\t\tState.variables.item[8] = itemcode.charAt(16);\n\t\t\tState.variables.item[9] = itemcode.charAt(18);\n\t\t\tState.variables.item[10] = itemcode.charAt(20);\n\t\t\tState.variables.item[11] = itemcode.charAt(22);\n\t\t\tState.variables.item[12] = itemcode.charAt(24);\n\t\t\tState.variables.item[13] = itemcode.charAt(26);\n\t\t\tState.variables.item[14] = itemcode.charAt(28);\n\t\t\tState.variables.item[15] = itemcode.charAt(30);\n\t\t\tState.variables.item[16] = itemcode.charAt(32);\n\t\t\tState.variables.item[17] = itemcode.charAt(34);\n\t\t\tState.variables.item[18] = itemcode.charAt(36);\n\t\t\tState.variables.item[19] = itemcode.charAt(38);\n\t\t\tState.variables.bugpassage = loc[4];\n\t\t},\n\t};\n} catch(e) {\n\tthrowError(place, &quot;decoder error &quot;+e.message);\n}*/</div><div tiddler="mov_comUI" tags="dock" created="201702020322" modifier="twee">''Movement''\n\nThe &quot;move&quot; action ends your turn and grants a bonus to attacks on the following turn.  The magnitude of the bonus depends, in part, on how much stamina is remaining when you select the option.  You current Move Rating is &lt;&lt;print $mov&gt;&gt;.\n\nYour defense will lower slightly until your next turn when you take a move action.\n</div><div tiddler="journal-linksCSS" tags="stylesheet" created="201801140407" modifier="twee">#journal-menu-buttons button {\n\twidth: 40%;\n}</div><div tiddler="title_onDespAtk_TrueNeutral" tags="hook title" created="201707101736" modifier="twee">&lt;&lt;if $titles.has('True Neutral')&gt;&gt;\n\t&lt;&lt;set _dam to random(1, 25)&gt;&gt;\n\t&lt;&lt;set _dam to Math.trunc(($power / 4) - _dam)&gt;&gt;\n\t&lt;&lt;set $NMEgrit to Math.trunc($NMEgrit - _dam)&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="rafe_stats" tags="nobr" created="201612132346" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="rage_ui" tags="" created="201702021654" modifier="twee">Rage grants bonuses to attack, critical attack chance, and critical attack damage in exchange for a small penalty to &lt;&lt;= setup.words.grit&gt;&gt;.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Moderate//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_down]]|//Slight//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_down]]|//Slight//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="custom macros collection" tags="script" created="201706111325" modifier="twee" twine-position="290,430">// simple-inventory.js, by chapel; for sugarcube 2\n// version 2.1.0\n\n// namespace\nsetup.simpleInv = {};\n\n// options\nsetup.simpleInv.options = {\n\ttryGlobal  : true, // send constructor to global scope\n\tdefaultStrings : {\n\t\tempty     : 'The inventory is empty...',\n\t\tlistDrop  : 'Discard',\n\t\tseparator : '\sn'\n\t}\n};\n\n// events\nsetup.simpleInv.attachEvent = function (inv, loc, items, cont) {\n\t$(document).trigger({\n\t\ttype       : (cont === 'initialized') ?  ':inventory-init' : ':inventory-update', // the event name\n\t\tinstance   : inv, // the calling instance; the giver in transfers\n\t\treceiving  : loc, // the inventory recieving transfers, or null\n\t\tmoved      : items, // the items moved to or from the calling inventory, or null\n\t\tcontext    : cont // drop, pickup, transfer, or initialized\n\t});\n};\n\n// the invetory constructor\nsetup.simpleInv.inventory = function (array) {\n\t&quot;use strict&quot;; // prevent leaks to global scope\n\t\n\tif (array) {\n\t\t// some number of arguments were passed\n\t\tarray = [].slice.call(arguments);\n\t\tarray = array.flatten();\n\t} else { \n\t\t// no arguments were passed\n\t\tarray = [];\n\t}\n\t\n\tif (this instanceof setup.simpleInv.inventory) {\n\t\tthis.inv = array;\n\t\tarray = (array.length) ? array : null;\n\t\t// run the event only if assignement is successful\n\t\tsetup.simpleInv.attachEvent(this, null, array, 'initialized');\n\t} else { // if the author forgets the 'new' operator, add it for them\n\t\treturn new setup.simpleInv.inventory(array);\n\t}\n};\n\n// static methods\nsetup.simpleInv.inventory.is = function (inv) {\n\t// test to see if passed object is an inventory instance\n\treturn (inv instanceof setup.simpleInv.inventory);\n};\nsetup.simpleInv.inventory.log = function (inv) {\n\t// logs the inventory to the console (for debugging)\n\tvar string = (setup.simpleInv.inventory.is(inv)) ?\n\t\t('Inventory.log() -&gt; ' + inv.toArray().join(' - ')) : \n\t\t('Inventory.log() -&gt; object is not an inventory...');\n\treturn string;\n};\nsetup.simpleInv.inventory.removeDuplicates = function (inv) {\n\t// removes duplicate items from an inventory\n\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\treturn; // not an inventory\n\t}\n\tvar items = inv.toArray();\n\tvar uniq  = (function (i) {\n\t\tvar ret = [];\n\t\ti.forEach( function (item) {\n\t\t\tif (!ret.includes(item)) {\n\t\t\t\tret.push(item);\n\t\t\t}\n\t\t});\n\t\treturn ret;\n\t}(items));\n\t\n\treturn uniq;\n};\nsetup.simpleInv.inventory.getUID = function (name, i) {\n\tvar key = Math.random().toString(36).substring(7);\n\tif (arguments.length &lt; 2) {\n\t\t// we'll generate an id anyway, but it might not be as unique as i'd like.\n\t\tname = Math.random().toString(36).substring(7);\n\t\ti    = random(99);\n\t}\n\treturn ('simple-inv-' + i + '-' + Date.now() + '-' + name.replace(/[^A-Za-z0-9]/g, '') + '-' + key);\n};\n\n// the instance methods -&gt; \n// these are on the prototype; we don't need them copied to each instance, and that saves us memory\nsetup.simpleInv.inventory.prototype = {\n\t\n\ttransfer : function (loc) {\n\t\t// transfer items from this inventory to a specified inventory\n\t\tif (arguments.length &lt; 2) {\n\t\t\treturn this; // error in args, do nothing\n\t\t}\t\n\t\tif (!(loc instanceof setup.simpleInv.inventory)) {\n\t\t\treturn this; // error in args, do nothing\n\t\t}\n\t\t\n\t\tvar items = [].slice.call(arguments);\n\t\titems = items.slice(1).flatten();\n\t\t\n\t\tvar pushed = [];\n\t\tfor (var i = 0, l = items.length; i &lt; l; i++) {\n\t\t\t// only transfer the item if it exists\n\t\t\tif (this.inv.includes(items[i])) { \n\t\t\t\tthis.inv.delete(items[i]);\n\t\t\t\tpushed.push(items[i]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (pushed.length) {\n\t\t\tloc.inv = loc.inv.concat(pushed);\n\t\t\tsetup.simpleInv.attachEvent(this, loc, pushed, 'transfer');\n\t\t\treturn this; // for chaining\n\t\t}\n\t\treturn this; // for chaining\n\t},\n\t\n\thas : function () { // this inventory has any of the passed items\n\t\tvar items = [].slice.call(arguments).flatten();\n\t\tif (items &amp;&amp; items.length) {\n\t\t\treturn this.inv.includesAny(items);\n\t\t}\n\t\treturn false;\n\t},\n\t\n\thasAll : function () { // this inventory has all of the passed items\n\t\tvar items = [].slice.call(arguments).flatten();\n\t\tif (items &amp;&amp; items.length) {\n\t\t\treturn this.inv.includesAll(items);\n\t\t}\n\t\treturn false;\n\t},\n\t\n\tpickUp : function (unique) { // add items to this inventory\n\t\tvar items = [].slice.call(arguments).flatten(), inventory = this;\n\t\tif (items &amp;&amp; items.length) {\n\t\t\tif (unique === 'unique' || items[0] === 'unique') { // JS API only; items must be unique in eash inventory instance\n\t\t\t\titems = items.splice(1);\n\t\t\t\titems = (function (items) { \n\t\t\t\t\tvar ret = []; // this code could use some cleanup\n\t\t\t\t\titems.forEach(function (item) {\n\t\t\t\t\t\tif (!inventory.inv.includes(item)) {\n\t\t\t\t\t\t\tret.push(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn ret;\n\t\t\t\t}(items));\n\t\t\t}\n\t\t\t// concat the arrays and call the event\n\t\t\tthis.inv = this.inv.concat(items);\n\t\t\tsetup.simpleInv.attachEvent(this, null, items, 'pickup');\n\t\t}\n\t\treturn this; // for chaining\n\t},\n\t\n\tdrop : function () { // remove items from this inventory\n\t\tvar items = [].slice.call(arguments).flatten(),\n\t\t\tinventory = this; // we need to access this in the &lt;array&gt;.forEach()\n\t\tif (items &amp;&amp; items.length) {\n\t\t\tvar moved = [];\n\t\t\titems.forEach(function (item) {\n\t\t\t\tif (inventory.has(item)) {\n\t\t\t\t\tmoved.push(item); // for the event below\n\t\t\t\t\tinventory.inv.delete(item);\n\t\t\t\t}\n\t\t\t});\n\t\t\tsetup.simpleInv.attachEvent(this, null, moved, 'drop');\n\t\t}\n\t\treturn this; // for chaining\n\t},\n\t\n\tsort : function () { // sorts this inventory\n\t\tthis.inv = this.inv.sort();\n\t\tsetup.simpleInv.attachEvent(this, null, null, 'sort');\n\t\treturn this;\n\t},\n\t\n\tshow : function (sep) { // returns a string representing the inventory\n\t\tif (!sep || typeof sep !== 'string') {\n\t\t\tsep = setup.simpleInv.options.defaultStrings.separator; // default\n\t\t}\n\t\tif (this.inv.length) {\n\t\t\treturn this.inv.join(sep);\n\t\t}\n\t\treturn setup.simpleInv.options.defaultStrings.empty; // nothing is in this inventory\n\t},\n\t\n\tempty : function () { // remove all items from this inventory\n\t\tvar temp = clone(this.inv); // for the event\n\t\tthis.inv = []; \n\t\t// this is still technically a 'drop' event\n\t\tsetup.simpleInv.attachEvent(this, null, temp, 'drop');\n\t\treturn this; // for that sweet chaining action\n\t},\n\t\n\ttoArray : function () { // not super necessary\n\t\treturn (this.inv);\n\t},\n\t\n\tlinkedList : function (loc, action) { // construct the list elements to keep the macro call clean-ish\n\t\tif (!loc || !(loc instanceof setup.simpleInv.inventory)) {\n\t\t\tloc = false; // if no loc, then no transferring\n\t\t}\n\t\t\n\t\t// set up vars\n\t\tvar list = this.toArray();\n\t\tvar inv = this;\n\t\tvar $wrapper = $(document.createElement('span'));\n\t\t\n\t\t// if inventory is empty, append message and return element\n\t\tif (!list || !list.length) {\n\t\t\t$wrapper.wiki(setup.simpleInv.options.defaultStrings.empty);\n\t\t\treturn $wrapper;\n\t\t}\n\t\t\n\t\t// construct the link list\n\t\tlist.forEach(function (item, idx, arr) {\n\t\t\tvar $listing = $(document.createElement('span')),\n\t\t\t\t$link    = $(document.createElement('a')),\n\t\t\t\tdrop     = (action) ? action : setup.simpleInv.options.defaultStrings.drop, // the action name or default\n\t\t\t\tUID      = setup.simpleInv.inventory.getUID(item, idx); // create a unique element ID \n\t\t\t\n\t\t\t$link // create the drop link\n\t\t\t\t.wiki(drop)\n\t\t\t\t.addClass('simple-inv drop-link');\n\t\t\t\n\t\t\t// add click event handler\n\t\t\t$link.ariaClick(function () {\n\t\t\t\tif (loc) {\n\t\t\t\t\tinv.transfer(loc, item);\n\t\t\t\t} else {\n\t\t\t\t\tinv.drop(item);\n\t\t\t\t}\n\t\t\t\t$('#' + UID).empty(); // empty the listing by its UID\n\t\t\t});\n\t\t\t\n\t\t\t// set up the listing element, which contains the name and the link\n\t\t\t$listing\n\t\t\t\t.attr('id', UID)\n\t\t\t\t.addClass('simple-inv link-listing')\n\t\t\t\t.wiki(item + ' ')\n\t\t\t\t.append($link);\n\t\t\t\n\t\t\t// add newline via &lt;br&gt; for listings that aren't last\n\t\t\t// this also allows the newline to disappear with its associated listing when dropped\n\t\t\tif (idx &lt; arr.length - 1) {\n\t\t\t\t$listing.wiki('&lt;br /&gt;');\n\t\t\t}\n\t\t\t\n\t\t\t// attach to the return element\n\t\t\t$wrapper.append($listing);\n\t\t});\n\t\t\n\t\t// return the whole element\n\t\treturn $wrapper;\n\t},\n\t\n\t// we need to reassign this since we may have clobbered it using the prototype\n\tconstructor : setup.simpleInv.inventory,\n\t\n\ttoJSON : function () { // the custom revive wrapper for SugarCube's state tracking\n\t\treturn JSON.reviveWrapper('new setup.simpleInv.inventory(' + JSON.stringify(this.inv) + ')');\n\t},\n    \n    clone : function () { return new setup.simpleInv.inventory(this.inv); }\n};\n\n/*\n\tINVENTORY METHODS LIST\n\t * (new) Inventory([items]) // constructor \n\t * Inventory.is(&lt;inv&gt;) // check if passed object is an inventory instance\n\t * &lt;inv&gt;.transfer(&lt;inv&gt;, [items]) // chainable\n\t * &lt;inv&gt;.has([items]), // not chainable; returns boolean\n\t * &lt;inv&gt;.hasAll([items]), // not chainable; returns boolean\n\t * &lt;inv&gt;.pickUp([items]), // chainable\n\t * &lt;inv&gt;.drop([items]), // chainable\n\t * &lt;inv&gt;.sort(), // chainable\n\t * &lt;inv&gt;.show([seperator]), // not chainable; returns string\n\t * &lt;inv&gt;.empty(), // chainable\n\t * &lt;inv&gt;.toArray(), // not chainable; returns array\n\t * &lt;inv&gt;.linkedList(), // returns a jQuery instance of the linked list\n*/\n\n// global\nif (setup.simpleInv.options.tryGlobal) {\n\t// this allows authors to access the JS API using the Inventory class\n\t// rather than the setup.simpleInv.inventory class, which is a mouthful\n\twindow.Inventory = window.Inventory || setup.simpleInv.inventory;\n\t// ... but only if window.Inventory is undefined\n}\n\n/* MACROS */\n// &lt;&lt;newinventory '$var' '(optional) list of items'&gt;&gt;\nMacro.add('newinventory', {\n\thandler : function () {\n\n\t\tif (this.args.length !== 1) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// set up new inventory\n\t\tWikifier.setValue(varName, new setup.simpleInv.inventory(this.args.slice(1).flatten()));\n\t}\n});\n\n// &lt;&lt;pickup '$var' 'list of items'&gt;&gt;\nMacro.add('pickup', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length &lt; 2) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\tinv.pickUp(this.args.slice(1).flatten());\n\t}\n});\n\n// &lt;&lt;drop '$var' 'list of items'&gt;&gt;\nMacro.add('drop', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length &lt; 2) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\tinv.drop(this.args.slice(1).flatten());\n\t}\n});\n\n// &lt;&lt;transfer '$var' '$anotherVar' 'list of items'&gt;&gt;\nMacro.add('transfer', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length &lt; 3) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\t/* the receiving inventory */\n\t\tvar recVarName = this.args[1].trim();\n\t\t// check variable string\n\t\tif (recVarName[0] !== '$' &amp;&amp; recVarName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[1] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar recInv = Wikifier.getValue(recVarName);\n\t\tif (!setup.simpleInv.inventory.is(recInv)) {\n\t\t\treturn this.error('variable ' + recVarName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\tinv.transfer(recInv, this.args.slice(2).flatten());\n\t}\n});\n\n// &lt;&lt;dropall '$var'&gt;&gt;\nMacro.add('dropall', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length !== 1) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\tinv.empty();\n\t}\n});\n\n// &lt;&lt;clear&gt;&gt; (same as &lt;&lt;dropall&gt;&gt;)\nMacro.add('clear', 'dropall', false);\n\n// &lt;&lt;sort '$var'&gt;&gt;\nMacro.add('sort', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length !== 1) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\tinv.sort();\n\t}\n});\n\n// &lt;&lt;inventory '$var' 'separator'&gt;&gt;\nMacro.add('inventory', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length &lt; 1 || this.args.length &gt; 2) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar varName = this.args[0].trim();\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[0] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\t// create output element and add to DOM\n\t\tvar $wrapper = $(document.createElement('span')), \n\t\t\tsep = (this.args[1]) ? this.args[1] : false;\n\t\t\n\t\t$wrapper\n\t\t\t.wiki(inv.show(sep))\n\t\t\t.addClass('macro-' + this.name)\n\t\t\t.appendTo(this.output);\n\t}\n});\n\n// &lt;&lt;linkedinventory 'action name' '$var' '(optional) $anotherVar'\nMacro.add('linkedinventory', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length &lt; 2 || this.args.length &gt; 3) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t}\n\t\t\n\t\tvar recInv = false,\n\t\t\tvarName = this.args[1].trim(),\n\t\t\taction = (typeof this.args[0] === 'string') ? this.args[0] : false; // the action name, which is required\n\t\t\n\t\tif (!action) { // just in case\n\t\t\treturn this.error('first argument should be the link text');\n\t\t}\n\t\t\n\t\t// check variable string\n\t\tif (varName[0] !== '$' &amp;&amp; varName[0] !== '_') {\n\t\t\treturn this.error('variable name &quot;' + this.args[1] + '&quot; is missing its sigil ($ or _)');\n\t\t}\n\t\t\n\t\t// use a varID for linked lists\n\t\tvar varID = Util.slugify(varName); \n\t\tvarID = this.name + '-' + varID;\n\t\t\n\t\t// check if story var is an inventory instance\n\t\tvar inv = Wikifier.getValue(varName);\n\t\tif (!setup.simpleInv.inventory.is(inv)) {\n\t\t\treturn this.error('variable ' + varName + ' is not an inventory!');\n\t\t}\n\t\t\n\t\tif (this.args.length &gt; 2) {\n\t\t\t// the receiving inventory, if applicable\n\t\t\tvar recVarName = this.args[2].trim();\n\t\t\t// check variable string\n\t\t\tif (recVarName[0] !== '$' &amp;&amp; recVarName[0] !== '_') {\n\t\t\t\treturn this.error('variable name &quot;' + this.args[2] + '&quot; is missing its sigil ($ or _)');\n\t\t\t}\n\t\t\t\n\t\t\t// check if story var is an inventory instance\n\t\t\trecInv = Wikifier.getValue(recVarName);\n\t\t\tif (!setup.simpleInv.inventory.is(recInv)) {\n\t\t\t\treturn this.error('variable ' + recVarName + ' is not an inventory!');\n\t\t\t}\n\t\t}\n\t\t\n\t\t// create output and att to DOM\n\t\tvar $list = inv.linkedList(recInv, action);\n\t\t$list\n\t\t\t.attr('id', varID)\n\t\t\t.addClass('macro-' + this.name)\n\t\t\t.appendTo(this.output);\n\t},\n});\n\n/* &quot;simple inventory&quot; is becoming more and more of a misnomer */\n\n// dialog API macro set, by chapel; for sugarcube 2\n// version 1.0\n// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#dialog-api-macros\n\n// &lt;&lt;dialog&gt;&gt; macro\nMacro.add('dialog', {\n\t   tags : null,\n\thandler : function () {\n\n\t\tvar content = this.payload[0].contents;\n\t\t\n\t\tif (this.args.length &gt; 1) {\n\t\t\tvar title = this.args[0];\n\t\t\tthis.args.deleteAt(0);\n\t\t\tthis.args.push('macro-' + this.name);\n\t\t\tvar classNames = this.args.join(' ');\n\t\t} else if (this.args.length === 1) {\n\t\t\tvar title = this.args[0];\n\t\t\tvar classNames = 'macro-' + this.name;\n\t\t} else {\n\t\t\tvar title = 'Information';\n\t\t\tvar classNames = 'macro-' + this.name;\n\t\t}\n\t\t\n\t\tDialog.setup(title, classNames);\n\t\tDialog.wiki(content);\n\t\tDialog.open();\n\t\t\n\t}\n\n});\n\n// &lt;&lt;popup&gt;&gt; macro\nMacro.add('popup', {\n\thandler : function () {\n\t\t\n\t\tif (this.args.length &gt; 2) {\n\t\t\tvar passageName = this.args[0];\n\t\t\tvar title = this.args[1];\n\t\t\tthis.args.deleteAt(0, 1);\n\t\t\tthis.args.push('macro-' + this.name);\n\t\t\tvar classNames = this.args.join(' ');\n\t\t} else if (this.args.length === 2) {\n\t\t\tvar passageName = this.args[0];\n\t\t\tvar title = this.args[1];\n\t\t\tvar classNames = 'macro-' + this.name;\n\t\t} else if (this.args.length === 1) {\n\t\t\tvar passageName = this.args[0];\n\t\t\tvar title = 'Information';\n\t\t\tvar classNames = 'macro-' + this.name;\n\t\t} else {\n\t\t\treturn this.error('need at least one argument; the passage to display');\n\t\t}\n\t\t\n\t\tDialog.setup(title, classNames);\n\t\tDialog.wiki(Story.get(passageName).processText());\n\t\tDialog.open();\n\t\t\n\t}\n\n});\n\n// fading macro set, by chapel; for SugarCube 2\n// version 1.0\n// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#fading-macros\n\n// &lt;&lt;fadein&gt;&gt; macro\nMacro.add('fadein', {\n\t   tags : null,\n\thandler : function () {\n\n\t\tvar $wrapper  = $(document.createElement('span'));\n\t\tvar className = ('macro-' + this.name);\n\t\tvar content   = this.payload[0].contents;\n\t\tvar delay     = 0;\n\t\tvar time      = 0;\n\n\t\tif (this.args.length === 1) {\n\t\t\tvar delay = 0;\n\t\t\tvar time  = this.args[0] * 1000;\n\t\t} else if (this.args.length === 2) {\n\t\t\tvar delay = this.args[0] * 1000;\n\t\t\tvar time  = this.args[1] * 1000;\n\t\t} else {\n\t\t\treturn this.error('incorrect number of arguments...');\n\t\t}\n\n\t\t$wrapper\n\t\t\t.wiki(content)\n\t\t\t.addClass(className)\n\t\t\t.appendTo(this.output)\n\t\t\t.hide()\n\t\t\t.delay(delay)\n\t\t\t.fadeIn(time);\n\n\t}\n});\n\n// &lt;&lt;fadeout&gt;&gt; macro\nMacro.add('fadeout', {\n\t   tags : null,\n\thandler : function () {\n\n\t\tvar $wrapper  = $(document.createElement('span'));\n\t\tvar className = ('macro-' + this.name);\n\t\tvar content   = this.payload[0].contents;\n\t\tvar delay     = 0;\n\t\tvar time      = 0;\n\n\t\tif (this.args.length === 1) {\n\t\t\tvar delay = 0;\n\t\t\tvar time  = this.args[0] * 1000;\n\t\t} else if (this.args.length === 2) {\n\t\t\tvar delay = this.args[0] * 1000;\n\t\t\tvar time  = this.args[1] * 1000;\n\t\t} else {\n\t\t\treturn this.error('incorrect number of arguments...');\n\t\t}\n\n\t\t$wrapper\n\t\t\t.wiki(content)\n\t\t\t.addClass(className)\n\t\t\t.appendTo(this.output)\n\t\t\t.delay(delay)\n\t\t\t.fadeOut(time);\n\n\t}\n});\n\n// play time system, by chapel; for SugarCube 2\n// version 1.0\n// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#play-time-system\n\n// intialize namespace\nsetup.playTime = {};\n\n// options object:\nsetup.playTime.options = {\n\tstoryVar : 'playTime',\n\tpauseTag : 'menu'\n};\n\n// create and initialize story variables\nState.variables[setup.playTime.options.storyVar] = {\n\t hr : 0,\n\tmin : 0,\n\tsec : 0,\n\t ms : 0,\n\tstr : ''\n};\nsetup.playTime.ptRef = () =&gt; State.variables[setup.playTime.options.storyVar];\n\nsetup.playTime.timeCount = function (timer) {\n\t// check for pause tag\n\tif (!tags().includes(setup.playTime.options.pauseTag)) {\n\t\ttimer.ms += time();\n\t\t\n\t\t// get time in ms and split it into hr:min:sec\n\t\tif (timer.ms &gt;= 1000) {\n\t\t\ttimer.sec += Math.trunc(timer.ms / 1000);\n\t\t\ttimer.ms   = timer.ms % 1000;\n\t\t}\n\t\tif (timer.sec &gt;= 60) {\n\t\t\ttimer.min += Math.trunc(timer.sec / 60);\n\t\t\ttimer.sec  = timer.sec % 60;\n\t\t}\n\t\tif (timer.min &gt;= 60) {\n\t\t\ttimer.hr  += Math.trunc(timer.min / 60);\n\t\t\ttimer.min  = timer.min % 60;\n\t\t}\n\t\t\n\t\t// add leading 0's (if necessary)\n\t\tvar hh = (timer.hr &lt; 10)  ? \n\t\t\t\t'0' + timer.hr  : timer.hr;\n\t\tvar mm = (timer.min &lt; 10) ? \n\t\t\t\t'0' + timer.min : timer.min;\n\t\tvar ss = (timer.sec &lt; 10) ? \n\t\t\t\t'0' + timer.sec : timer.sec;\n\t\t\n\t\t// format time string and save to story variable property 'str'\n\t\ttimer.str = '&lt;b&gt;' + hh + ':' + mm + '&lt;/b&gt;:' + ss;\n\t}\n} \n\nprehistory[&quot;logTime&quot;] = function (taskName) {\n\t// log time before old passage transitions out\n\tvar t = setup.playTime.ptRef();\n\tsetup.playTime.timeCount(t);\n};\n\n// &lt;&lt;playtime&gt;&gt; macro\nMacro.add('playtime', {\n\thandler : function () {\n\n\t\tvar $wrapper  = $(document.createElement('span'));\n\t\tvar className = 'macro-' + this.name;\n\t\tvar timer     = setup.playTime.ptRef();\n\t\tvar content   = timer.str;\n\n\t\t$wrapper\n\t\t\t.wiki(content)\n\t\t\t.addClass(className)\n\t\t\t.appendTo(this.output);\n\t\t\n\t}\n\n});\n\n// message macro, by chapel (with help from T.M. Edwards); for sugarcube 2\n// version 1.0\n// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#message-macro\n\n//intialize namespace\nsetup.messageMacro = {};\n\n// default text option:\nsetup.messageMacro.default = 'Help';\n\n// &lt;&lt;message&gt;&gt; macro\nMacro.add('message', {\n\ttags    : null,\n\thandler : function () {\n\t\tvar message  = this.payload[0].contents;\n\t\tvar $wrapper = $(document.createElement('span'));\n\t\tvar $link    = $(document.createElement(this.args.includes('btn') ? 'button' : 'a'));\n\t\tvar $content = $(document.createElement('span'));\n\n\t\t$link\n\t\t\t.wiki(this.args.length &gt; 0 &amp;&amp; this.args[0] !== 'btn' ? this.args[0] : setup.messageMacro.default)\n\t\t\t.ariaClick(function () {\n\t\t\t\tif ($wrapper.hasClass('open')) {\n\t\t\t\t\t$content\n\t\t\t\t\t\t.css('display', 'none')\n\t\t\t\t\t\t.empty();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$content\n\t\t\t\t\t\t.css('display', 'block')\n\t\t\t\t\t\t.wiki(message);\n\t\t\t\t}\n\n\t\t\t\t$wrapper.toggleClass('open');\n\t\t\t});\n\n\t\t$wrapper\n\t\t\t.attr('id', 'macro-' + this.name + '-' + this.args.join('').replace(/[^A-Za-z0-9]/g, ''))\n\t\t\t.addClass('help')\n\t\t\t.append($link)\n\t\t\t.append($content)\n\t\t\t.appendTo(this.output);\n\t}\n});\n\n// first macro, by chapel; for sugarcube 2\n// version 1.0\n// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#first-macro\n\n// &lt;&lt;first&gt;&gt; macro\nMacro.add('first', {\n\t   tags : ['then', 'finally'],\n\thandler : function () {\n\n\t\tvar $wrapper    = $(document.createElement('span'));\n\t\tvar className   = 'macro-' + this.name;\n\t\tvar length      = this.payload.length;\n\t\tvar visits       = visited() - 1;\n\t\tvar lastTag     = this.payload[ length - 1 ].name;\n\t\tvar lastContent = this.payload[ length - 1 ].contents;\n\t\tvar content;\n\n\t\tif (visits &lt; length){\n\t\t\tcontent = this.payload[visits].contents;\n\t\t} else {\n\t\t\tcontent = (lastTag === 'finally') ? lastContent : '';\n\t\t}\n\n\t\t$wrapper\n\t\t\t.wiki(content)\n\t\t\t.addClass(className)\n\t\t\t.appendTo(this.output);\n\t}\n\n});\n\n//&lt;&lt;dropdown&gt;&gt; macro\nMacro.add('dropdown', {\n\thandler : function () {\n\t\t\n        var $wrapper = $(document.createElement('span'));\n        var $drop    = $(document.createElement('select'));\n\t\t\n        var opts      = this.args;\n        var storyVar = opts.shift();\n        var store;\n        var i;\n\t\t\n        // handle simple errors\n        if (typeof storyVar == 'undefined') {\n            return this.error('No arguments provided.');\n        }\n        if (opts.length &lt; 1) {\n            return this.error('Must provide at least one list option.');\n        }\n\t\t\n        if (storyVar.charAt(0) === '$') {\n            store = State.variables;\n        } else if (storyVar.charAt(0) === '_') {\n            store = State.temporary;\n        } else {\n            return this.error('First argument should be a valid TwineScript variable.');\n        }\n        storyVar = storyVar.slice(1);\n        store[storyVar] = opts[0];\n\t\t\t\n\t\t\n        for (i = 0; i &lt; opts.length; i++) {\n            var $option = $(document.createElement('option'));\n            $option\n                .attr('value', opts[i])\n                .wiki(opts[i])\n                .appendTo($drop);\n        }\n\t\t\n        $drop\n            .attr({\n                name : 'dropdown-macro',\n                id   : storyVar\n            })\n            .appendTo($wrapper);\n\t\t\n        $wrapper\n            .addClass('macro-' + this.name)\n            .appendTo(this.output);\n\t\t\n        $(document).on('change', 'select#' + storyVar, function () { \n            store[storyVar] = $('select#' + storyVar).val();\n        })\n\t\t\n\t\t\n    }\n});</div><div tiddler="attack" tags="nobr" created="201612171511" modifier="twee">&lt;&lt;display &quot;damagecalc_player&quot;&gt;&gt;\n&lt;&lt;display &quot;critmaker&quot;&gt;&gt;\n&lt;&lt;display 'staggermaker'&gt;&gt;\n&lt;&lt;if $crityes is 1&gt;&gt;&lt;&lt;audio &quot;critical&quot; play&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;audio &quot;attack&quot; play&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;replace &quot;#combatmessages&quot;&gt;&gt;&lt;&lt;if $crityes is 1&gt;&gt;''Critical Hit:  ''&lt;&lt;endif&gt;&gt;Dealt &lt;&lt;print Math.trunc($damagetoNME)&gt;&gt; damage.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;set $crityes to 0&gt;&gt;\n&lt;&lt;if $damagetoNME&gt;&gt;&lt;&lt;payload 'onNMEgritDam'&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $nmegrit to $nmegrit-$damagetoNME&gt;&gt;\n&lt;&lt;if $nmegrit lte 0&gt;&gt;&lt;&lt;set $nmehealth to $nmehealth-1&gt;&gt;&lt;&lt;payload 'onNMEheartDam'&gt;&gt;&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmehealth lte 0&gt;&gt;&lt;&lt;set $nmegrit to 0&gt;&gt;&lt;&lt;display &quot;health_checker&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $sta to $sta-($wStaUse+$NMEStaUse)&gt;&gt;\n/%&lt;&lt;display &quot;damagecalc_player&quot;&gt;&gt;%/\n&lt;&lt;if $allynumber is 0&gt;&gt;\n\t&lt;&lt;com_update_noally&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;com_update&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1onroad" tags="space" created="201701281958" modifier="twee">Elesun rides hard for Merac, and as the sun rises, her horse begins to slow.  She doesn't stop cracking the reigns, even as it grows &lt;&lt;weak 'unsteady' '1orUnsteady'&gt;&gt;.  It's well-trained.\n\nAs she rides, she grows more and more uneasy.  Aesil knew where Ripley would be.  &lt;&lt;dock 'Someone at the castle' '1orMole'&gt;&gt; must have told him.  For now, though, &lt;&lt;action 'rescuing Ripley' '1orRescue'&gt;&gt; is all she can do.\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="noarmor" tags="nobr" created="201612131635" modifier="twee">&lt;&lt;set $armorname to &quot;No Armor&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;naked_ui&quot;&gt;&gt;\n\n&lt;&lt;set $aatk to 1.0&gt;&gt;\n&lt;&lt;set $adef to 0.6&gt;&gt;\n&lt;&lt;set $amov to 1.0&gt;&gt;</div><div tiddler="0mainhall" tags="scene" created="201701252110" modifier="twee">&lt;&lt;portrait&gt;&gt;&lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; and Elesun head across the wall and arrive at the door that leads into the main hall.  From here, the throne room should be a few floors down.\n\nElesun puts her hand to the door to pull it open.\n\n&quot;Look out!&quot; Ripley shouts.\n\nThe stone of the wall beneath Elesun pitches suddenly, like a wave, and the stone melts into muck.  She falls.  Ripley dives for her, sliding to the edge, hands out, but can't reach her in time.\n\nElesun finds herself in the king's quarters, just above the throne room.  A woman--a witch--in a black dress is standing nearby, smiling.\n\n&quot;Hello, demonkin,&quot; the witch says.\n\nElesun draws her sword and throws it at the witch.  The witch raises her hand, and the sword stops in midair inches from her face.  Elesun is already on her feet though, and leaps toward the witch, plucking the sword from the air and swinging.  The witch dodges--barely, but a red cut forms on her cheek and blood drips down the side of her face.\n\n&quot;Come on!&quot; Elesun says.\n\n&quot;As you wish,&quot; the witch says, drawing her own sword.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;combat_call_0_3&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n</div><div tiddler="widgets" tags="widget" created="201612180851" modifier="twee" twine-position="150,710">/%custom widgets and tags%/\n&lt;&lt;widget &quot;showdock&quot;&gt;&gt;&lt;&lt;display &quot;infobox&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;info&quot;&gt;&gt;&lt;&lt;display &quot;infobox&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;stats&quot;&gt;&gt;&lt;&lt;display &quot;statupdater&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;rest&quot;&gt;&gt;&lt;&lt;display &quot;rest_scars&quot;&gt;&gt;&lt;&lt;print $restReport&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%anchor set--for returning from combat and other things%/\n&lt;&lt;widget &quot;anchor&quot;&gt;&gt;&lt;&lt;set $exitpassage to passage()&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;anchorswitch&quot;&gt;&gt;&lt;&lt;set $anchor to 1&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;anchorreturn&quot;&gt;&gt;[[Continue|$exitpassage]]&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;anchorkill&quot;&gt;&gt;&lt;&lt;set $anchor to 0&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;com_update&quot;&gt;&gt;&lt;&lt;replace &quot;#enemystatupdate&quot;&gt;&gt;&lt;&lt;display &quot;combatboxNME&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;replace &quot;#allystatupdate&quot;&gt;&gt;&lt;&lt;display &quot;combatboxAlly&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;replace &quot;#playerstats&quot;&gt;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playerstatsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playerstats&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;replace &quot;#combatactions&quot;&gt;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playeractionsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playeractions&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;com_update_noally&quot;&gt;&gt;&lt;&lt;replace &quot;#enemystatupdate&quot;&gt;&gt;&lt;&lt;display &quot;combatboxNME&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;replace &quot;#playerstats&quot;&gt;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playerstatsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playerstats&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;replace &quot;#combatactions&quot;&gt;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playeractionsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playeractions&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;comUpdate&quot;&gt;&gt;&lt;&lt;if $allynumber is 0&gt;&gt;&lt;&lt;com_update_noally&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;com_update&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;xp&quot;&gt;&gt;&lt;&lt;display &quot;tallyxp&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;dock&quot;&gt;&gt;&lt;&lt;if $dockdisp is 1 or $dockdisp is -1&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display $args[1]&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $dockdisp is 0&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;popup $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;weak&quot;&gt;&gt;&lt;&lt;if $dockmode is 0&gt;&gt;&lt;&lt;print $args[0]&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $dockdisp is 1 or $dockdisp is -1&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display $args[1]&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $dockdisp is 0&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;popup $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;action&quot;&gt;&gt;&lt;span class='action-info'&gt;&lt;&lt;if $dockdisp is 1&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display $args[1]&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;elseif $dockdisp is 0 or $dockdisp is -1&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;popup $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;dock &quot;link text&quot; &quot;passage_to_display&quot;&gt;&gt;: updates the infodock--requires &lt;&lt;info&gt;&gt; to be in the same passage work\n\na weak dock link disappears in dockmode 0%/\n\n&lt;&lt;widget &quot;help&quot;&gt;&gt;&lt;&lt;link &quot;Help&quot;&gt;&gt;&lt;&lt;replace &quot;#helpA&quot;&gt;&gt;&lt;&lt;display $args[0]&gt;&gt;\n&lt;&lt;link &quot;Close&quot;&gt;&gt;&lt;&lt;replace &quot;#helpA&quot;&gt;&gt;...&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;span id=&quot;helpA&quot;&gt;...&lt;/span&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;help &quot;passage_to_display&quot;&gt;&gt;%/\n\n&lt;&lt;widget &quot;help_string&quot;&gt;&gt;&lt;&lt;link &quot;Help&quot;&gt;&gt;&lt;&lt;replace &quot;#helpB&quot;&gt;&gt;&lt;&lt;print $args[0]&gt;&gt;\n&lt;&lt;link &quot;Close&quot;&gt;&gt;&lt;&lt;replace &quot;#helpB&quot;&gt;&gt;...&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;span id=&quot;helpB&quot;&gt;...&lt;/span&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;help &quot;string to display&quot;&gt;&gt;: string-based variant%/\n\n&lt;&lt;widget &quot;tutorial&quot;&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;replace &quot;#helpC&quot;&gt;&gt;&lt;&lt;display $args[1]&gt;&gt;\n&lt;&lt;link &quot;Close&quot;&gt;&gt;&lt;&lt;replace &quot;#helpC&quot;&gt;&gt;...&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;span id=&quot;helpC&quot;&gt;...&lt;/span&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;tutorial &quot;link text&quot; &quot;passage_to_display&quot;&gt;&gt;: help variant where link text can be edited%/\n\n/%you can use &lt;&lt;help&gt;&gt;, &lt;&lt;help_string&gt;&gt;, and &lt;&lt;tutorial&gt;&gt; to display up to three different help messages in the same passage%/\n\n&lt;&lt;widget &quot;portrait&quot;&gt;&gt;&lt;&lt;if $mobile neq 1&gt;&gt;&lt;&lt;display &quot;PlayerPortrait&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;PlayerPortSmall&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;thumb&quot;&gt;&gt;&lt;&lt;if $mobile neq 1&gt;&gt;&lt;&lt;display &quot;PlayerPortSmall&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;closeup&quot;&gt;&gt;&lt;&lt;if $mobile is 1&gt;&gt;Information&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;PlayerCloseUp&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;image&quot;&gt;&gt;&lt;&lt;set $subj to clone(setup.img[ $args[0] ])&gt;&gt;&lt;&lt;display &quot;ShowImage&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;combat &quot;enemy&quot; &quot;passage to display before combat&quot; &quot;passage to exit combat into&quot;&gt;&gt;%/\n&lt;&lt;widget &quot;combat&quot;&gt;&gt;&lt;&lt;if $anchor is 0&gt;&gt;&lt;&lt;display $args[0]&gt;&gt;&lt;&lt;anchor&gt;&gt;&lt;&lt;display $args[1]&gt;&gt;\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|combat_init]]&lt;/span&gt;&lt;&lt;else&gt;&gt;&lt;&lt;anchorkill&gt;&gt;&lt;&lt;goto $args[2]&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;name&quot;&gt;&gt;&lt;&lt;print $character&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;interact&quot;&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;audio &quot;click&quot;d play&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;leave&quot;&gt;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;audio &quot;steps&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;tipster&quot;&gt;&gt;&lt;&lt;display &quot;tips&quot;&gt;&gt;&lt;&lt;button &quot;Give me another tip.&quot;&gt;&gt;&lt;&lt;display &quot;tips&quot;&gt;&gt;&lt;&lt;replace &quot;#tip&quot;&gt;&gt;&lt;&lt;print $tip&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/button&gt;&gt; //&lt;span id=&quot;tip&quot;&gt;&lt;&lt;print $tip&gt;&gt;&lt;/span&gt;//  &lt;&lt;/widget&gt;&gt;\n\n&lt;&lt;widget &quot;comPt&quot;&gt;&gt;&lt;&lt;display &quot;combat_portrait&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;journallink&quot;&gt;&gt;&lt;span id=&quot;journallink&quot;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;set $return to passage()&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;audio &quot;page&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;ctrlClick &quot;text&quot; &quot;passage&quot; (optional &quot;type&quot;)&gt;&gt;%/\n&lt;&lt;widget &quot;ctrlClick&quot;&gt;&gt;&lt;span id=&quot;ctrlClick&quot; class='action-link'&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;if $args[2]&gt;&gt;&lt;&lt;if $args[2] is &quot;leave&quot;&gt;&gt;&lt;&lt;audio &quot;steps&quot; volume 0.3 play&gt;&gt;&lt;&lt;elseif $args[2] is &quot;interact&quot;&gt;&gt;&lt;&lt;audio &quot;equip&quot; play&gt;&gt;&lt;&lt;elseif $args[2] is &quot;codex&quot;&gt;&gt;&lt;&lt;audio &quot;page&quot; play&gt;&gt;&lt;&lt;set $return to passage()&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;endwidget&gt;&gt;\n\n/%&lt;&lt;ctrlContinue(or ctrlCon) &quot;passage&quot; (optional &quot;leave&quot;)&gt;&gt;%/\n&lt;&lt;widget &quot;ctrlContinue&quot;&gt;&gt;&lt;span id=&quot;ctrlClick&quot; class='action-link'&gt;&lt;&lt;link &quot;Continue.&quot;&gt;&gt;&lt;&lt;if $args[1] is &quot;leave&quot;&gt;&gt;&lt;&lt;audio &quot;steps&quot; volume 0.3 play&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;goto $args[0]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;/widget&gt;&gt;\n&lt;&lt;widget &quot;ctrlCon&quot;&gt;&gt;&lt;span id=&quot;ctrlClick&quot; class='action-link'&gt;&lt;&lt;link &quot;Continue.&quot;&gt;&gt;&lt;&lt;if $args[1] is &quot;leave&quot;&gt;&gt;&lt;&lt;audio &quot;steps&quot; volume 0.3 play&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;goto $args[0]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;/widget&gt;&gt;\n\n/%&lt;&lt;selection &quot;link text&quot; &quot;passage (goto)&quot; integer(number key to fire link)&gt;&gt;%/\n&lt;&lt;widget &quot;selection&quot;&gt;&gt;&lt;&lt;switch $args[2]&gt;&gt;&lt;&lt;case 1&gt;&gt;&lt;span id=&quot;oneAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 2&gt;&gt;&lt;span id=&quot;twoAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 3&gt;&gt;&lt;span id=&quot;threeAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 4&gt;&gt;&lt;span id=&quot;fourAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 5&gt;&gt;&lt;span id=&quot;fiveAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 6&gt;&gt;&lt;span id=&quot;sixAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 7&gt;&gt;&lt;span id=&quot;sevenAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 8&gt;&gt;&lt;span id=&quot;eightAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 9&gt;&gt;&lt;span id=&quot;nineAct&quot;&gt;&lt;&lt;link &quot;&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;case 10&gt;&gt;&lt;span id=&quot;zeroAct&quot;&gt;&lt;&lt;link &quot;1&quot; + $args[3] + &quot;: &quot; + $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;default&gt;&gt;&lt;span id=&quot;zeroAct&quot;&gt;&lt;&lt;link $args[0]&gt;&gt;&lt;&lt;goto $args[1]&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;/switch&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\n&lt;&lt;widget &quot;nav&quot;&gt;&gt;&lt;&lt;display &quot;navbox&quot;&gt;&gt;&lt;&lt;/widget&gt;&gt;\n\n&lt;&lt;widget &quot;toTop&quot;&gt;&gt;&lt;&lt;if $args[0] or $args[0] is &quot;&quot;&gt;&gt;&lt;&lt;set _linkText to $args[0]&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;set _linkText to &quot;Return to top.&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $args[1] is &quot;l&quot; or $args[1] is &quot;link&quot;&gt;&gt;&lt;&lt;link _linkText&gt;&gt;&lt;&lt;script&gt;&gt;window.scroll(0, 0);&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;button _linkText&gt;&gt;&lt;&lt;script&gt;&gt;window.scroll(0, 0);&lt;&lt;/script&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;/widget&gt;&gt;\n\n/%&lt;&lt;toTop &quot;link text&quot; (optional) &quot;l (or 'link')&quot; (to use link insead of button, optional, requires link text to have some value or an empty string)&gt;&gt;%/</div><div tiddler="newgame3" tags="menu" created="201612122045" modifier="twee" twine-position="1830,290">!!!Initial Settings\n//You can access more settings from the settings menu once you start the game.//\n\n''Volume and Sound:''\nVolume: &lt;&lt;volume&gt;&gt; &lt;&lt;display &quot;muter&quot;&gt;&gt;\n\n''Screen Mode:''\n&lt;&lt;display &quot;fullscreen_toggler&quot;&gt;&gt;\n\n''Combat Tutorials''\nWhen on, combat tutorials will show up.  Each tutorial message is only displayed once.\n&lt;&lt;display 'combat_tutorials'&gt;&gt;\n\n''Difficulty Setting:''\nWhile this is primarily a narrative game, there is combat.  For those who just wish to enjoy the story, you may turn the combat to easy mode, or off entirely.  Note that doing so may prevent you from completing certain content in the game.\n\nHow would you like to play?\n\n[[Normal Mode|prologueintro][$mode to 1]]: The way it was intended.\n\n&lt;&lt;link &quot;Easy Mode&quot;&gt;&gt;&lt;&lt;set $mode to 2&gt;&gt;&lt;&lt;display &quot;easy-bal-adj&quot;&gt;&gt;&lt;&lt;stats&gt;&gt;&lt;&lt;goto &quot;prologueintro&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;: Put the story first.\n\n&lt;&lt;if $demomode&gt;&gt;&lt;b&gt;Intense Mode&lt;/b&gt;: Gain some bonuses, but combat is faster-paced and more deadly. (Not available in this demo.)&lt;&lt;else&gt;&gt;&lt;&lt;link &quot;Intense Mode&quot;&gt;&gt;&lt;&lt;set $mode to 3&gt;&gt;&lt;&lt;display &quot;hard-bal-adj&quot;&gt;&gt;&lt;&lt;stats&gt;&gt;&lt;&lt;goto &quot;prologueintro&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;: Gain some bonuses, but combat is faster-paced and more deadly.&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $demomode&gt;&gt;&lt;b&gt;Story Mode&lt;/b&gt;: Just the story; combat is turned off. (Not available in  this demo.)&lt;&lt;else&gt;&gt;[[Story Mode|prologueintro][$mode to 0]]: Just the story; combat is skipped.&lt;&lt;endif&gt;&gt;\n\n\n[['[' + 'View the combat reference.' + ']'|combatexplanationmenu]]\n</div><div tiddler="wpninfo" tags="" created="201612151712" modifier="twee">Equip a weapon to use in combat.  Heavier weapons do more damage, but also cost more stamina to attack with, and also have lower critical attack rates.</div><div tiddler="1RipNVM" tags="dock" created="201708232101" modifier="twee">&quot;See you later.&quot;\n\n&lt;&lt;ctrlClick 'Be good.' '1RipQuarters'&gt;&gt;</div><div tiddler="UltimateDespAtk-Aesil" tags="boss specialkill combat" created="201707262109" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;display 'ultimateDespAudio'&gt;&gt;\s\n&lt;&lt;if $character is 'Elesun'&gt;&gt;Elesun drives her sword into Aesil's gut and carves outward.  He falls, and her left leg gives way, bones cracking and skin tearing.  She kneels over him, and forces the sword deeper into the earth.  She wanted to drive his blood to the center of the earth.\n\nAesil gasped and choked, clinging to life.  Elesun pulls back her sword and swings.  She watches as her hand separates at the wrist and follows the weight of the sword as it cleaves through Aesil.  She doesn't feel it--not anymore, not anything.  But she can see the red blood chasing after her hand.&lt;&lt;else&gt;&gt;Ripley drives her fist through Aesil's chest until her hand comes out the other side.\n\nAesil swings desperately, but Ripley catches his arm and wrenches it off in a single motion.  She pushes him to the ground, steps on his chest, and takes hold of his head in both hands.  Her muscles strain as Aesil struggles, but his head eventually comes free.  Finally, Aesil becomes still.&lt;&lt;endif&gt;&gt;\n\n''Aesil is defeated.''\n\n&lt;&lt;ctrlCon 'combat_end'&gt;&gt;</div><div tiddler="Dragon-1-2" tags="nobr" created="201707262253" modifier="twee"></div><div tiddler="1RipDruids" tags="dock" created="201708260030" modifier="twee">&quot;You know, Elesun, the grove has great respect for you.  The elder even proposed making you an honorary warrior.  They'd have given you bangles and everything.&quot;\n\n&quot;Is that so?  First I've heard of it.&quot;\n\n&quot;Well, the oracles started prophesying doom and some of the warriors got really mad--&quot;\n\n&quot;I get it,&quot; Elesun said.  &quot;I've gotten this far without bangles, I think I'll make it.&quot;</div><div tiddler="debug_images" tags="test menu" created="201701241606" modifier="twee" twine-position="2110,990">&lt;&lt;portrait&gt;&gt;\n[img[setup.img.RipPtKid]]\n[img[setup.img.IrePt]]\n[img[setup.img.FolsomPt]]\n[img[setup.img.RipCl]]\n[img[setup.img.EleCl]]\n&lt;&lt;thumb&gt;&gt;\n&lt;&lt;masked&gt;&gt;\n&lt;&lt;excited&gt;&gt;\n&lt;&lt;grinning&gt;&gt;\n&lt;&lt;happy&gt;&gt;\n&lt;&lt;confused&gt;&gt;\n&lt;&lt;dolled-up&gt;&gt;\n&lt;&lt;grinning&gt;&gt;\n&lt;&lt;sad&gt;&gt;\n&lt;&lt;dolled-up-neutral&gt;&gt;\n&lt;&lt;th-determined&gt;&gt;\n&lt;&lt;devil-form&gt;&gt;\n&lt;&lt;what&gt;&gt;\n&lt;&lt;eating-happy&gt;&gt;\n&lt;&lt;worried&gt;&gt;\n&lt;&lt;joyous&gt;&gt;\n&lt;&lt;hoping&gt;&gt;\n&lt;&lt;th-sigh&gt;&gt;\n&lt;&lt;eating-dismissive&gt;&gt;\n[[Back|debug_features]]</div><div tiddler="0transition2" tags="transition" created="201701250521" modifier="twee">&lt;&lt;set $xpearned to $xpearned+40&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Ripley and Elesun head down into the main hall.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0levelupcheck2&quot;&gt;&gt;</div><div tiddler="0transition1" tags="transition" created="201701250521" modifier="twee">&lt;&lt;set $xpearned to $xpearned+50&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;As they reach the door that leads to the main hall, and the throne room, Elesun can see a woman in a long black dress walking away from them along the wall.\n\n&quot;Who's that?&quot; Ripley asks.\n\n&quot;I don't know.  No one good.  Come on.&quot;\n\nThey enter the main hall, and head down the steps.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0levelupcheck2&quot;&gt;&gt;</div><div tiddler="0choice1bangles" tags="dock" created="201701140609" modifier="twee">The golden bangles Ripley wears are made by the druid oracles, and the process of making them is a closely guarded secret.  The bangles are reserved for only the most elite druid warriors, and the process of binding them can kill the bearer if he or she is too weak.  They were given to Ripley once the oracles realized she was the promised child.\n\nThe bangles amplify strength and speed up healing.  Perhaps most impressive, they amplify one’s ability to dispel most forms of hostile magic.  There are eight in total, two on each limb.</div><div tiddler="0aesWait" tags="dock" created="201701250345" modifier="twee">It takes Ripley a second to catch up with the light.  In the center of the floor, surrounded by stretching pools of blood, is a--\n\nA pile of bodies.  Sort of.\n\nElesun had seen this before.  It was the work of dark magic.\n\n&lt;&lt;timed 2s t8n&gt;&gt;&lt;span id=&quot;ctrlClick&quot;&gt;&lt;&lt;link &quot;Try to look away.&quot;&gt;&gt;&lt;&lt;append &quot;#gone&quot;&gt;&gt;&lt;&lt;display &quot;0aesTry&quot;&gt;&gt;&lt;&lt;/append&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;/timed&gt;&gt;\n\n</div><div tiddler="tut_onNMEheartDam" tags="hook tutorial" created="201707101339" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has wounded the enemy.\n\nTo win a fight, &lt;&lt;name&gt;&gt; must deplete all of an enemy's hearts.  To deplete a heart, she must deplete all of an enemy's &lt;&lt;= setup.words.grit&gt;&gt;.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onNMEheartDam'&gt;&gt;</div><div tiddler="1FolsomHow" tags="dock" created="201707110118" modifier="twee">&quot;I'm fine,&quot; Folsom says. &quot;Thank you for asking.  The attack did take a lot out of me, but it took more out of them.  That's all we can hope for, anyway.&quot;</div><div tiddler="codex_menu_magic" tags="menu" created="201612141349" modifier="twee">!Magic\n&lt;span id=&quot;codexmag&quot;&gt;\nMagic is a powerful ally.  While the number of people who can cast true, unbound magic is incredibly limited, bound spells are relatively easy to learn and master, and are widely used the world over.&lt;/span&gt;\n\n&lt;&lt;link &quot;The Source of Magic&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexmag&quot;&gt;&gt;\n''The Source of Magic''\n\nWhile arguments abound to the true nature and source of magical power, all scholars agree that it is &quot;borrowed&quot; from the other world.  \n\nWhile a great deal of practitioners reject the notion that all magic comes from the same source, scholars have argued for centuries that the schools of magic are too similar to be completely unique.  Many have pointed to the Hellish Flame as a likely originator of the various forms of magic, claiming that hellish magic is magic in its rawest, most primal state.  Others resist this notion, believing that magic flows naturally into this world from the next through natural forces, life, or even through human will.  \n\nSeveral objective studies have been carried out, but most are marred by controversy, tribalism, and scandal.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Schools of Magic&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexmag&quot;&gt;&gt;\n''The Schools of Magic''\n\nThere are five major schools of magic.  While bound magic can generally be learned in only a few years, learning unbound magic can take a lifetime, and most dedicated mages devote themselves to the study of only one school.\n\n*Neutral magic, occasionally called anti-magic, was the most recently founded school of magic, with a history of roughly three-hundred years--short in comparison to the other schools.  Neutral magic focuses on controlling and reacting to other magical forces, both naturally occurring and man-made.  Neutral magic can bend, dispel, and manipulate other forms of magic, and also allows casters to channel ambient magic to various ends.\n\n*Natrual magic, or Druidic magic, is a closely guarded secret, used exclusively by the Druid tribes in both its bound and unbound forms.  Natural magic tends to focus on enhancing and empowering already existing skills, but also mixes elements of light magic and neutral magic.  Although neutral magic is a much more modern invention, scholars have identified many key similarities between the two.  The Druids believe their magic is an extension of their relationship to the natural world, and comes from the same source as all life.\n\n*Light (or white) magic focuses on enhancing and speeding up the natural healing processes of living beings.  Unbound light magic is incredibly powerful, capable of healing deadly wounds, but its power comes at a cost, as more powerful spells often drain the caster's life force.  Its nature as a healing medium and its sacrificial requirements has made practicitioners of light magic into saints in the eyes of most people.  Light magic is the most studied form of magic in the world.\n\n*Dark magic is sometimes described as a perversion of light magic, though most scholars see it as its own form.  The practice of dark magic is shunned and outlawed by many societies.  Dark magic can harm others, slow the healing process, and wear away at the life force of its targets, but the wielders of dark magic are also weakened and injured by its use, usually in similar ways, even in its bound forms.  Unlike most other forms of magic, unbound dark magic can be manifested in various physical forms and manipulated by its caster, such as shadowy blades or tendrils of inky darkness.\n\n*Hellish magic is a mind-boggling and often devastating power.  It is the only form of magic to be regulated by a neutral, international body, and its use in wartime, other than for self-defense or the defense of innocents, is considered a war crime.  It is said that dragons taught humans to harness hellish magic, and that they, in turn, had learned it from the Hellish Flame, a supposedly living, thinking fire that exists in the Other World.  Hellish magic manifests as bright, reddish energy that vaguely suggests fire, and its heat, light, and force can be controlled by its caster in its unbound form.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Mages and Wizards&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexmag&quot;&gt;&gt;\n''On Mages and Wizards''\n\nWhile a great deal of warriors, nobles, and other people of means often recieve some level of basic magical training, usually over a period of a few years, mages and wizards are trained from childhood until middle-age in the ways of magic.  Unbound magic takes decades of training to safely use, and this difficult, lengthy journey to mastery means that there are never enough mages, and that the mages who do make it are highly respected, well-paid, and always busy.\n\nSome mages go on to learn more than one form of magic.  These mages are generally granted the unofficial title of wizard.  Wizards are incredibly rare.\n\nMost wizards find themselves employed by royalty, teaching nobles and royal children bound magic, weaving spells of protection and healing for the king and his castle, and advising in all matters that involve or can be affected by magic.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Bound and Unbound Magic&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexmag&quot;&gt;&gt;\n''Bound and Unbound Magic''\n\nBound magic is a simplified form of magic that can be learned relatively quickly.  Easy-to-manage, widely applicable spells are taught to individuals, usually without any great deal of context or understanding of the wider implications of the discipline.  Bound magic generally pales in comparison to the true potential of a given school.\n\nUnbound magic, on the other hand, is magic as it is meant to be.  Most mages do not cast discreet spells.  Instead, through pure mastery of their discipline, they craft spells and alter them on the fly, as needed.  Unbound magic is unrivaled in power, but the dedication required to learn it and the decades of training required to safely utilize it means that even fairly ordinary mages are rare outside the halls of power.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n[[Back|codex_menu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combatexplanation4menu" tags="menu" created="201612181745" modifier="twee">&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut4][combatexplanation5menu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;combatexplanation5menu&quot;&gt;&gt;</div><div tiddler="Update History" tags="menu" created="201612131613" modifier="twee" twine-position="1690,290">!!!Version 0.7.3\n* Second prototype release.\n&lt;&lt;silently&gt;&gt;/%!!!Version 0.7.5:\n*Demo version (initial).\n&lt;&lt;if $debug is 1&gt;&gt;%/\n!!!Version 0.7.4-2 (Demo Release Candidate)\n*Last minute fixes and adjustments.\n*Finalizations.\n*Prepped repo.\n\n!!!Version 0.7.4-1 (Demo Release Candidate)\n*Bug fixes and stability improvements.\n*Corrected grammar errors and typos.\n*Improved combat balance.\n*Finalized intallable release builds.\n*Finalized web-build.\n\n!!!Version 0.7.4 (Demo Release Candidate)\n*Finished chapter 1, now in beta.\n*Readjusted combat balance.\n*Multiple improvements to the code base.\n*Improved initial load times and efficiency.\n\n!!!Version 0.7.3 (Internal)\n*Made improvements to the boss fight system.\n*Improved the interface of the QTEs.\n*Repaired some asset piping that was lost in translation to the new system.\n*Balance adjustments and improvements.\n*General fixes for bugs and typos.\n*Laid groundwork for Intense Mode.\n*Added enemy agression as a factor in combat, based on the selected difficulty mode.\n*Improved enemy combat AI.\n\n!!!Version 0.7.2 (Internal)\n*Created and implemented boss fight system; now in beta.\n*Improved visuals of QTE system.\n*Rebalanced some combat encounters to be slightly easier.\n*Titles system is now fully implemented and in beta.\n*Optimized image loading; first time load may be somewhat longer for some users.\n*Made adjustments to the QTE balance.\n*Made several improvements to the map system.\n*Fixed several bugs in the hook system.\n*Fixed other bugs and typos.\n\n!!!Version 0.7.0:  (Internal)\n*Created and implemented hook system.\n*Improved CSS of various systems.\n*Implemented complete combat tutorial system.\n*Created titles system.\n*Continued working on chapter 1.\n*General improvements and optimizations.\n*Fixed critical bug in the browser-version fullscreen option.\n*Fixed bugs and typos.\n\n!!!Version 0.6.8: (Internal)\n*Migrated all base-64 internal images to external resources--a data-structure in the {{{setup}}} object now handles image pathing.\n*Pared down and refocused audio.\n*Fully integrated the balance object, $bal, into most relevant systems, including M_Combat, M_Stats, O_Enemies, and O_SpecialAbilities.\n*Implemented a number of new features to the engine.\n*Removed some deprecated code.\n*Rewrote some code to make the engine more efficent.\n*Various back-end updates and upgrades, including new macros, systems, and scripting.\n*Desperation attack damage is now based on power ($power * _despMod * $bal.desp; where _despMod is a weighted random modifier and $bal.desp refers to the balance object).\n*Fixed a series of major bugs in the Prologue that were caused by the migration to the {{{&lt;&lt;ctrlClick&gt;&gt;}}} and {{{&lt;&lt;ctrlCon&gt;&gt;}}} macros.\n*Improved the logic and efficency of various widget and macro definitions.\n*Improved easy mode (it now uses the balance object).\n*Added new sounds to combat.\n*Improved combat visuals.\n*A combat explanation now exists.\n*General improvements and optimization.\n*Fixed bugs and typos.\n\n!!!Version 0.6.5:  (Internal)\n*Adjusted combat balance.\n*Added new sound effects and music.\n*Rage build-up is now carried over from combat to combat, but is reduced slightly in between.\n*Created credits HTML file and implemented it in the &quot;about&quot; page.\n*Migrated some features to the dialog API.\n*Quest system implemented (needs more testing and patching).\n*Adjustable volume slider implemented in settings menu.\n*Ajusted appearance of settings menu.\n*Added unicode icons to menu options.\n*Added real-time combat gauges for boss battles (not yet fully implemented).\n*Title screen created (not yet implemented).\n*Fixed bugs and typos.\n''Web Version''\n*Improved cross-browser support for audio and animations.\n*Added MP3 options for all audio.\n''Executable Version''\n*Improved load times and optimization.\n\n!!!Version 0.6.0:  (Internal)\n*Added Ripley's rage transformations (currently in beta).\n*Removed mobile mode (needs rewritten from ground-up).\n*Changed default dock options.\n*Added full keyboard and handler support.\n*Started chapter 1.\n*Added nav-box interface.\n*Adjusted help menus and tutorials to reflect keyboard support.\n*Fixed critical error in &quot;Combat Off&quot; mode.\n\n!!!Version 0.5.1: (Alpha Test Build)\n*Fixed a bug that caused enemy spells to unequip player spells.\n*Fixed an unrelated but equally silly bug that prevented the dispel spell from working anyway.\n*Fixed a number of minor bugs and typos in various systems.\n*Added new settings to change the functionality of the information dock, and changed its default functionality.\n*Dramatically increased the opacity of the information dock.\n*Made improvements to the appearance and organization of the combat screen.\n*Improved the appearance of some menus.\n\n!!!Version 0.5.0: (Alpha Test Build)\n*First public version.\n\n!!!Version 0.5.0: (Prototype)\n*Final audio added.\n*Status effects added and implemented.\n*Added journal-link system to scenes.\n*Various improvements to CSS and UI implemented.\n*Save data updater added.\n\n!!!Version 0.4.8: (Prototype)\n*Enemy AI improved.\n*Combat balance improved.\n*Enemy combat features added.\n*Imporved look and organization of UI and menus.\n\n!!!Version 0.4.6: (Prototype)\n*Bug code unpacker fully implemented.\n*Prologue content added.\n*Enemy AI improved.\n\n!!!Version 0.4.5:  (Prototype)\n*Fixed bug that caused the desperation attack to become available one round later than intended.\n*Fixed bug where sound would not start on reload of a save file.\n*Improved appearance and organization of CSS.\n*Added the settings menu and settings functionality.\n*Added bug reporting features.\n*Improved combat tutorials.\n\n!!!Version 0.4.1: (Prototype)\n*Inummerable bugs fixed.\n*Image and sound support implemented.\n*Combat design improved.\n\n!!!Version 0.3: (Prototype)\n*First playable build.\n/%&lt;&lt;endif&gt;&gt;%/&lt;&lt;/silently&gt;&gt;\n&lt;&lt;if $gamestart is 0&gt;&gt;&lt;&lt;link &quot;Back&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\nDialog.setup(&quot;About&quot;);\nDialog.wiki(Story.get(&quot;about&quot;).processText());\nDialog.open();\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;</div><div tiddler="0choice1door" tags="dock" created="201701140607" modifier="twee">The door didn’t come off its hinges--it shattered to splinters.  Ripley is a decent fighter, but her best asset by far is that she was at least three times stronger than the average, well-trained soldier.</div><div tiddler="notifyCSS" tags="stylesheet" created="201711271903" modifier="twee">#notify {\n\tposition : fixed;\n\tdisplay : block;\n\twidth : 16em;\n\tright : -20em; top : 2em;\n\tpadding : 0.5em;\n\tbackground-color : #fff;\n\tcolor : #000;\n\t-webkit-transition-duration : 0.3s;\n\t-moz-transition-duration : 0.3s;\n\t-o-transition-duration : 0.3s;\n\ttransition-duration : 0.3s;\n}\n#notify.open {\n\tright : 0;\n}</div><div tiddler="what are hooks?" tags="annotation" created="201707091830" modifier="twee">Hooks are defined via macros and are related to titles, and are also used by the tutorial system.  Hooks occur at certain, definite points throughout combat and run the code contained in these passages silently--they can do things like add a chance to restore hearts on criticals, improve desperation attack damage, and add increased dispel chances.  These changes will not be reflected in the payer's stats.\n\nNote that hooks are not a replacement for the balance object.  You can access hooks in the IDE via {{{$hook[hookName]}}}.  Each hook is an array.</div><div tiddler="combat_intro_1_2" tags="comcall" created="201708282116" modifier="twee">You’re about to fight &lt;&lt;print $enemyname&gt;&gt;.</div><div tiddler="stainfo" tags="" created="201612151724" modifier="twee">\nCertain combat actions require stamina to perform.  Characters can continue performing a variety of actions until they no longer have enough stamina, at which point, their turn ends.  Ending a turn with excess stamina restores grit.\n\n</div><div tiddler="Plate Armor" tags="menu" created="201612131636" modifier="twee">&lt;&lt;display &quot;plate_ui&quot;&gt;&gt;\nEquip this armor?\n\n[[Yes|changearmor][$change to &quot;plate&quot;]]\n[[No|armorswap]]</div><div tiddler="status_effects_help" tags="menu" created="201701250211" modifier="twee">Some enemies are capable of casting unbound magic, which can have a variety of effects.  In addition to spells that simply do damage or heal, certain spells may also cause status effects, damaging your abilities until they end.  You can see which status effect (if any) is currently effecting you in the character window during combat.\n\nPossible Status Effects:\n*&lt;&lt;dock &quot;Slowed&quot; &quot;slowed_help&quot;&gt;&gt;\n*&lt;&lt;dock &quot;Burned&quot; &quot;burned_help&quot;&gt;&gt;\n*&lt;&lt;dock &quot;Blunted&quot; &quot;blunted_help&quot;&gt;&gt;\n*&lt;&lt;dock &quot;Shattered&quot; &quot;shattered_help&quot;&gt;&gt;\n*&lt;&lt;dock &quot;Weighted&quot; &quot;weighted_help&quot;&gt;&gt;\n*&lt;&lt;dock &quot;Held&quot; &quot;held_help&quot;&gt;&gt;\n\n\n[[Return to the Journal|journalmenu]]\n\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="0choice2rough" tags="scene" created="201701250455" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;Do you hate them?&quot; Elesun asks, squatting down in front of Ripley.\n\n&quot;What?&quot;\n\n&quot;Do you hate them?  Aesil.  Akatosh.&quot;\n\nRipley stares hard at Elesun for a few seconds in silence.  &quot;You know I do.&quot;\n\n&quot;We can't get back what we've lost, but every step that you take--every time you decide to keep going--you're shortening their lives.  So get up.  We'll mourn the dead when they stop piling up.&quot;\n\nRipley dries her eyes and stands.  &quot;All right,&quot; she says, choking back tears.\n\n&quot;I'm proud of you,&quot; Elesun says.  &quot;Come on.&quot;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0wall3&quot;&gt;&gt;</div><div tiddler="weighted_help" tags="dock" created="201701250217" modifier="twee">&lt;&lt;print $character&gt;&gt;'s body itself becomes wreathed in neutral magic that attempts to pull her to the ground.\n\nMild penalty to Move actions.  Attacks cost more Stamina than normal.  Large penalty to total Stamina.</div><div tiddler="ch1-7" tags="scene" created="201701282008" modifier="twee"></div><div tiddler="Aesil_Prol" tags="nobr" created="201701260128" modifier="twee">&lt;&lt;set $enemyname to &quot;Dark Mage Aesil&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 6&gt;&gt;\n&lt;&lt;set $enemypower to 1366&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme[&quot;NME_aes2&quot;]&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 250&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 10&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 63&gt;&gt;\n&lt;&lt;set $nmedef to 62&gt;&gt;\n&lt;&lt;set $nmemov to 58&gt;&gt;\n&lt;&lt;set $nmemagic to 65&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;break&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 7&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 9&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.9&gt;&gt;\n&lt;&lt;set $nmespellpower to 100&gt;&gt;\n&lt;&lt;set $nmeacc to 100&gt;&gt;\n&lt;&lt;set $nmebaseregen to 17&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 5&gt;&gt;\n&lt;&lt;set $nmetype to 1&gt;&gt;\n\n&lt;&lt;set $nmexp to 100&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;</div><div tiddler="ch1-1" tags="scene save" created="201612182012" modifier="twee">&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Irelith comes to stand next to Elesun in the bailey.\n\n&quot;How'd you and Rip get anything done around here?&quot; she asks.\n&lt;&lt;set $stoneLoc to 0&gt;&gt;\n&quot;What?&quot;\n&lt;&lt;set $relax to 0&gt;&gt;\n&quot;You two must have interesting thoughts to get wrapped up in them so much,&quot; &lt;&lt;journallink &quot;Irelith&quot; &quot;codex_Irelith&quot;&gt;&gt; says.  &quot;Interesting like a mess, that is.&quot;\n\n&quot;You have something you want me to do?&quot; Elesun asks.\n\n&quot;No.  Doing anything is better than nothing, though, so look busy--it's bad for the men to see you slacking.  Find something to patrol.  And if you feel like doing some training or running some drills, come talk to me.&quot;\n\n&quot;Yes, sir,&quot; Elesun says, grinning.  &quot;I'll get right to work.&quot;\n\n&quot;Harlaus was asking after you, by the way. He's in the main hall with &lt;&lt;journallink &quot;Folsom&quot; &quot;codex_Folsom&quot;&gt;&gt;.&quot;\n\n&quot;Okay.&quot;\n\n//Journal updated.//&lt;&lt;set $storystage to 1&gt;&gt;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;1bailey&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="ch1-2" tags="save scene menu" created="201803171230" modifier="twee">!! You've completed the demo.\n\nThere's not much left for you here...\n\nHowever, if you want, you can try out a boss fight before you go.\n\n&lt;&lt;include 'bossAdjust'&gt;&gt;\n\n&lt;&lt;link 'Start Over'&gt;&gt;&lt;&lt;run UI.restart()&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n</div><div tiddler="ch1-3" tags="scene save" created="201701281958" modifier="twee">Elesun always was better at fighting and killing than tracking, but Folsom had taught her the basics.  The darkness made it more difficult, but Aesil was not known for subtlety.  Broken branches--and indeed a few broken trees, litter his wake.\n\nShe also knew the lay of the land.  Aesil was unlikely to pass to close to the castle for fear of running across Folsom, and if he was already heading this way, he had to be heading toward Merac, a fairly large town just within the borderlands.\n&lt;&lt;set $mercyKill to 0&gt;&gt;\nAs strong as Aesil is, Ripley's bangles could protect her from his magic almost indefinitely.  If it came to a physical fight, she is smart enough and strong enough to escape.  Elesun had time; some time anyway.\n\n&lt;&lt;ctrlCon '1onroad'&gt;&gt;</div><div tiddler="0aesFight" tags="scene" created="201701250407" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;Stay behind me,&quot; Elesun says.\n\nElesun draws her sword, but with a flick of Aesil's wrist, it becomes stained with black.  The sword wrenches out of her hands and rises to the ceiling, where it clatters to rest as it might have to the ground.\n\n&quot;Damn it.&quot;\n\nAesil charges toward Ripley.\n\n&lt;&lt;ctrlClick &quot;Save her!&quot; &quot;0aesil_rescue&quot;&gt;&gt;</div><div tiddler="control-ref" tags="menu" created="201612121956" modifier="twee" twine-position="1970,10">!!!Control Reference\n\n[img[setup.gen.controls]]\n\n&lt;&lt;ctrlClick &quot;Click here&quot; &quot;main menu&quot;&gt;&gt; or press CTRL to continue.</div><div tiddler="1EleTry2" tags="scene" created="201701282007" modifier="twee"></div><div tiddler="1EleTry1" tags="scene" created="201701282007" modifier="twee"></div><div tiddler="0mainhall1inspect" tags="dock" created="201701252352" modifier="twee">It's huge room with several rows of tables and chairs and two large fireplaces, one on each side.  Neither one is lit tonight.  The massive gate that leads outside is still shut.\n\nOn the other side, another massive set of wooden  doors leads into the throne room.  It's also shut.</div><div tiddler="quest-setup" tags="init" created="201707082158" modifier="twee" twine-position="850,150">/%stone collection%/\n&lt;&lt;set $stoneOne to {\n\tdescr: &quot;A small, boxy black stone.  Found in the courtyard by Elesun in chapter 1.&quot;,\n\tname: &quot;Square Stone&quot;,\n\tnum: 1,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneTwo to {\n\tdescr: &quot;Almost perfectly round, and whititsh.  Found by Elesun in the Druid grove in chapter 1.&quot;,\n\tname: &quot;Egg-shaped Stone&quot;,\n\tnum: 2,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneThree to {\n\tdescr: &quot;Lop-sided, but shaped a little like a heart.  Chalky and black in color.  Found by Ripley in chapter 2.&quot;,\n\tname: &quot;Heart-shaped Stone&quot;,\n\tnum: 3,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneFour to {\n\tdescr: &quot;Glossy, flat, and shiny.  Gray but speckled with lighter gray.  Found by Ripley in chapter 2.&quot;,\n\tname: &quot;Flat Stone&quot;,\n\tnum: 4,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneFive to {\n\tdescr: &quot;A rock that was shaped by one of Carthus's firey attacks.  Beatiful, smooth, and shiny.  Found by Ripley in chapter 4.&quot;,\n\tname: &quot;Fire-forged Stone&quot;,\n\tnum: 5,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneSix to {\n\tdescr: &quot;A purple pebble.  Jagged and sharp.  Found by Ripley in chapter 4.&quot;,\n\tname: &quot;Puple Pebble&quot;,\n\tnum: 6,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneSeven to {\n\tdescr: &quot;A small glassy pebble--almost like a bead.  Found by the queen in 5.&quot;,\n\tname: &quot;Shiny Pebble&quot;,\n\tnum: 7,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneEight to {\n\tdescr: &quot;A large, fist-sized rock shaped like a dome.  Heavy.  Found by Ripley in chapter 6.&quot;,\n\tname: &quot;Dome Rock&quot;,\n\tnum: 8,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneNine to {\n\tdescr: &quot;A small smooth, white speckled rock.  Found by Ripley in chapter 6.&quot;,\n\tname: &quot;Speckled Rock&quot;,\n\tnum: 9,\n\thave: 0\n  }&gt;&gt;\n&lt;&lt;set $stoneTen to {\n\tdescr: &quot;Almost perfectly spherical, but otherwise completely average.  Found by Ripley in the Otherworld.&quot;,\n\tname: &quot;Globe Stone&quot;,\n\tnum: 10,\n\thave: 0\n  }&gt;&gt;\n\n/%array of multiple questlines.%/\n&lt;&lt;set $sq to [], $sqDone to []&gt;&gt;\n&lt;&lt;set $quTitle to [], $quDescr to [], $quCompl to [], $quProg to [], $quStatus to []&gt;&gt;\n/%progress: 0=not yet found, 1=start, 10=complete(turn in), 100=complete(removed)%/\n&lt;&lt;set $sq0 to {\n    title: &quot;Example Quest Title&quot;,\n    descrPass: &quot;Passage describing quest goals, with if statements to show var.progress steps.&quot;,\n    complPass: &quot;Passage to display on completion, with variable changes/rewards; placed in the 'Turn in!' button.  Also pops $sq# out of $sq array.&quot;,\n    progress: 0,\n    code: 0\n  }&gt;&gt;\n&lt;&lt;set $sq1 to {\n    title: &quot;Buy the Blacksmith Time&quot;,\n    descrPass: &quot;sq1descr&quot;,\n    complPass: &quot;sq1compl&quot;,\n    progress: 0,\n    code: 1\n  }&gt;&gt;\n\n&lt;&lt;set $index to 0&gt;&gt;</div><div tiddler="rageBar" tags="" created="201702091648" modifier="twee">&lt;span id=&quot;rager&quot;&gt;\s\n&lt;span id=&quot;journallink&quot;&gt;&lt;&lt;link &quot;''Rage'':&quot;&gt;&gt;&lt;&lt;popup &quot;rageUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;\n&lt;&lt;print $rageCurrent&gt;&gt;%\n[img[$rageDisplay]]\n&lt;&lt;if $rageCurrent gte 100 and $devilForm is 0 and $formUnlock gt 0 and $playerturn is 1&gt;&gt;&lt;center&gt;&lt;span id=&quot;transformbutton2&quot;&gt;&lt;span id=&quot;trsOpt&quot;&gt;&lt;&lt;link &quot;''-TRANSFORM-''&quot;&gt;&gt;&lt;&lt;display &quot;rage_trans&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;/span&gt;\nPress Space&lt;/center&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;</div><div tiddler="title_onNMEspell_UnyieldingOne" tags="hook title" created="201707101759" modifier="twee">&lt;&lt;if $titles.has('Unyielding One')&gt;&gt;\n\t&lt;&lt;if $dispCheck lte $dispel&gt;&gt;\n\t\t&lt;&lt;set $dispCheck to random(1, ($nmespellpower - 10))&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="0choice1target" tags="dock" created="201701140607" modifier="twee">Ripley, “the child of promise,” had been dogged by Akatosh all her life.  But she isn’t a child anymore.</div><div tiddler="title_onRegen_AngelSlayer" tags="hook title" created="201707101743" modifier="twee">&lt;&lt;if $titles.has('Angel Slayer')&gt;&gt;\n\t&lt;&lt;set _max to $maxgrit&gt;&gt;\n\t&lt;&lt;set _curr to $grit&gt;&gt;\n\t&lt;&lt;if _curr lt _max&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 20&gt;&gt;\n\t\t\t&lt;&lt;set _reg to 30 + ($lvl * 5)&gt;&gt;\n\t\t\t&lt;&lt;set _reg to _reg - _odds&gt;&gt;\n\t\t\t&lt;&lt;set $grit to Math.trunc($grit + _reg)&gt;&gt;\n\t\t\t&lt;&lt;if $grit gte $maxgrit&gt;&gt;\n\t\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1HarlRip_fond" tags="dock" created="201707110058" modifier="twee">&quot;Did she say that?&quot;\n\nElesun nods.\n\n&quot;When?  At the seige?  Did she say anything else?&quot;\n\nElesun grins.\n\n&quot;Hm.  Well, we are very good friends.  Don't you have work to do?&quot;</div><div tiddler="docksettings" tags="" created="201701120451" modifier="twee">&lt;&lt;if $dockmode is 1&gt;&gt;* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockmode&quot; 1 checked&gt;&gt; Normal:  All dock links will appear throughout the text.  Recommended.&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockmode&quot; 0&gt;&gt; Clean:  Shows only important dock links (for those who are a bit overwhelmed by all the links).&lt;/label&gt;&lt;&lt;else&gt;&gt;* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockmode&quot; 1&gt;&gt; Normal:  All dock links will appear throughout the text.  Recommended.&lt;/label&gt;\n* &lt;label&gt;&lt;&lt;radiobutton &quot;$dockmode&quot; 0 checked&gt;&gt; Clean:  Shows only important dock links (for those who are a bit overwhelmed by all the links).&lt;/label&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="HarlChat1" tags="chitchat" created="201707110029" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set _HarlChat1 to either(\n&quot;You're getting along with my father, right?&quot;, \n&quot;I heard you encountered Aesil at the siege.  You're all lucky to be alive.&quot;,\n&quot;Keep your wits about you; the enemy has shown us they'll stop at nothing.&quot;,\n&quot;It's been so long.  It's so good to see you and Ripley again.&quot;,\n&quot;Irelith probably won't admit it, but she's missed you and Ripley these last few months.&quot;,\n&quot;Don't forget to rest up before you set out.&quot;\n)&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;&lt;&lt;print '&quot;' + _HarlChat1 + '&quot;'&gt;&gt;</div><div tiddler="boss_1_Aesil" tags="comcall" created="201701282006" modifier="twee"></div><div tiddler="Akatosh-3-1" tags="" created="201707262254" modifier="twee"></div><div tiddler="sq1init" tags="dock" created="201704221629" modifier="twee">The castle's head blacksmith wants Elesun to talk to the king on his behalf, to request more time for repairing the armor of the troops.\n\n&lt;&lt;link &quot;Accept his request.&quot;&gt;&gt;\n  &lt;&lt;set $sq1.progress to 1&gt;&gt;\n  &lt;&lt;run $sq.push($sq1)&gt;&gt;\n  &lt;&lt;run Dialog.close()&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Deny his request.&quot;&gt;&gt;\n  &lt;&lt;run Dialog.close()&gt;&gt;\n&lt;&lt;/link&gt;&gt;</div><div tiddler="Healing" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;heal_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;heal&quot;]]\n[[No|spellswap]]</div><div tiddler="title_onCrit_Protector" tags="hook title" created="201707101756" modifier="twee">&lt;&lt;if $titles.has('Protector')&gt;&gt;\n\t&lt;&lt;set $damagetoNME to Math.trunc($damagetoNME * 1.2)&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1arGuards" tags="dock" created="201708281823" modifier="twee">&quot;Lady Elesun,&quot; one of the guards says.  &quot;We're just finishing loading supplies.  Won't be much longer.  Climb aboard whenever you're ready to depart.&quot;\n\n&quot;Alright, thanks,&quot; Elesun says.</div><div tiddler="heal" tags="nobr" created="201701241646" modifier="twee">/%  10  %/\n&lt;&lt;set $specialMult to 0.7&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,0)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Heal&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="bless_ui" tags="" created="201702021710" modifier="twee">Blessing grants a wide variety of small benefits with no drawbacks.  It will provide bonuses to nearly everything you do.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="weaponswap" tags="menu char" created="201612131459" modifier="twee">Current Weapon: &lt;&lt;print $weaponname&gt;&gt;\n\nSelect a weapon:\n[[Unarmed]]  (Level &lt;&lt;print $unarmedtraining&gt;&gt;)\n[[Longsword]]  (Level &lt;&lt;print $longswordtraining&gt;&gt;)\n&lt;&lt;if $gswordhave is 1&gt;&gt;[[Great Sword]]  (Level &lt;&lt;print $greatswordtraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $katanahave is 1&gt;&gt;[[Katana]]  (Level &lt;&lt;print $katanatraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $spearhave is 1&gt;&gt;[[Spear]]  (Level &lt;&lt;print $speartraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $sswordhave is 1&gt;&gt;[[Side Sword]]  (Level &lt;&lt;print $sideswordtraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $gauntletshave is 1&gt;&gt;[[Clawed Gauntlets]]  (Level &lt;&lt;print $gauntletstraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $scythehave is 1&gt;&gt;[[Scythe]]  (Level &lt;&lt;print $scythetraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $saberhave is 1&gt;&gt;[[Saber]]  (Level &lt;&lt;print $sabertraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $axehave is 1&gt;&gt;[[Battle Axe]]  (Level &lt;&lt;print $battleaxetraining&gt;&gt;)&lt;&lt;endif&gt;&gt;\n\n[[Back|equipmenu]]\n\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="dock1" tags="test" created="201612191508" modifier="twee" twine-position="1690,850">This is a little bit of text.</div><div tiddler="Fable-7-1" tags="" created="201707262300" modifier="twee"></div><div tiddler="Rage" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;rage_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;rage&quot;]]\n[[No|spellswap]]</div><div tiddler="changeweapon" tags="menu" created="201612131513" modifier="twee">&lt;&lt;audio &quot;equip&quot; play&gt;&gt;Equipment changed!\n\n[[Okay.|equipmenu]]\n\n&lt;&lt;if $change eq &quot;spear&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spear&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;axe&quot;&gt;&gt;\n\t&lt;&lt;display &quot;battleaxe&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;unarm&quot;&gt;&gt;\n\t&lt;&lt;display &quot;unarmed&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;gaunt&quot;&gt;&gt;\n\t&lt;&lt;display &quot;gauntlets&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;side&quot;&gt;&gt;\n\t&lt;&lt;display &quot;sidesword&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;scyt&quot;&gt;&gt;\n\t&lt;&lt;display &quot;scythe&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;katn&quot;&gt;&gt;\n\t&lt;&lt;display &quot;katana&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;great&quot;&gt;&gt;\n\t&lt;&lt;display &quot;greatsword&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;long&quot;&gt;&gt;\n\t&lt;&lt;display &quot;longsword&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;sabr&quot;&gt;&gt;\n\t&lt;&lt;display &quot;saber&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;stats&gt;&gt;</div><div tiddler="helpstones" tags="help" created="201701281951" modifier="twee">You've found an interesting-looking stone.  Ripley keeps a rock collection; you should show her your find.</div><div tiddler="sbr_ui" tags="" created="201702020418" modifier="twee">A curved blade often used by calvalry.\n\nA well-balanced weapon, slightly weaker than the longsword in hand-to-hand combat, but much stronger when used as a skirmishing weapon.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Low|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Moderate|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|High|\n*__Finesse__: High\n*__Stamina__: Moderate</div><div tiddler="armorsmith2" tags="menu" created="201612141604" modifier="twee">\n\nUpgrade complete!\n\n\n[[Okay.|$exitpassage][$gamestart to 1]]</div><div tiddler="menu_help" tags="annotation" created="201701230936" modifier="twee">$gamestart to 2: display [return to game] in menu\n$gamestart to 1: normal menu\n$gamestart to 0: only [mute sound] in menu\n\n$return: stores &lt;passage()&gt; on link click\n\nno saves on [menu] tagged passages</div><div tiddler="example spell" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n/%training%/</div><div tiddler="GreenKnight-E-3" tags="" created="201707262301" modifier="twee"></div><div tiddler="fshr_ui" tags="" created="201702021726" modifier="twee">Flameshroud provides a significant boost to defense, dispel, and dodge, but slightly reduces critical attack chance.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_down]]|//Moderate//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_up]]|//Moderate//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_up]]|//Moderate//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="1dcGrove" tags="dock" created="201708282018" modifier="twee">Elesun is kinking herself for not noticing it earlier--the deafening silence.</div><div tiddler="0wall2" tags="space" created="201701242252" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;As Elesun runs across the wall with &lt;span id=&quot;goneA&quot;&gt;&lt;&lt;dock &quot;Ripley&quot; &quot;0wall2Rip&quot;&gt;&gt;&lt;/span&gt; close behind, Ripley suddenly stops in front of the door to a &lt;&lt;action &quot;storeroom&quot; &quot;0wall2door&quot;&gt;&gt;.\n\nThey're getting close to the &lt;&lt;if $helpServants is 1&gt;&gt;&lt;&lt;action &quot;throne room&quot; &quot;0wall2continue&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;span id=&quot;gone&quot;&gt;throne room.&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n\nThere isn't much &lt;&lt;weak &quot;time&quot; &quot;0wall2time&quot;&gt;&gt;.\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpdecisions2&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="0wall3" tags="space" created="201701250431" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;if $choice2 is 0&gt;&gt;Elesun and Ripley run along the wall.  They're getting close now.  Ripley suddenly breaks away.  She leans over the side of the wall and vomits.  When she's finished, she sits down and cries softly.\n\n&lt;&lt;endif&gt;&gt;&lt;&lt;if $choice2 is 0&gt;&gt;It's &lt;&lt;action &quot;hard to see her like that&quot; &quot;0wall3Rip&quot;&gt;&gt;.  &lt;&lt;else&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; time 25 loop play&gt;&gt;&lt;&lt;set $song to 0&gt;&gt;&lt;&lt;weak &quot;Ripley&quot; &quot;0wall3Rip&quot;&gt;&gt; seems to be feeling a bit better now.&lt;&lt;endif&gt;&gt;\n\nFortunately, with &lt;&lt;weak &quot;Folsom&quot; &quot;0wall3Folsom&quot;&gt;&gt; keeping &lt;&lt;weak &quot;Aesil&quot; &quot;0wall3Aes&quot;&gt;&gt; busy, they shouldn't need to worry too much now.\n\nThe throne room is just &lt;&lt;action &quot;up ahead&quot; &quot;0wall3south&quot;&gt;&gt;.\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n</div><div tiddler="VampireQueen-4-1" tags="" created="201707262254" modifier="twee"></div><div tiddler="1mainhall" tags="space" created="201701281953" modifier="twee">&lt;&lt;image &quot;HarlSmKid&quot;&gt;&gt;&lt;&lt;image &quot;FolsomSm&quot;&gt;&gt;The main hall &lt;&lt;weak 'took a beating' '1mainWitch'&gt;&gt; during the siege, and wooden scaffolding is still in place under parts of the ceiling.  It's still a stately place in spite.  Young Prince &lt;&lt;action 'Harlaus' '1mainHarl'&gt;&gt; is off in the corner of the room, speaking quietly with &lt;&lt;action 'Folsom' '1mainFolsom'&gt;&gt;.\n\nThe &lt;&lt;action 'door' '1mainDoor'&gt;&gt; to the throne room is open.\n\n&lt;span id=&quot;navbox&quot;&gt;&lt;&lt;mapHarlan $now&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="1tocamp3" tags="scene" created="201701281955" modifier="twee">&lt;&lt;image 'AesSm3'&gt;&gt;&lt;&lt;image 'RipSmKid'&gt;&gt;Aesil just smiles.\n\n&quot;Shit,&quot; Elesun says.  She hears a muffled shout from behind, and turns to see a group of sellswords descending upon the guards.\n\n&quot;Get Ripley,&quot; one of the guards shouts.\n\nElesun turns and runs toward Ripley as fast as she can, but Aesil's dark magic is already swirling around her.  Ripley is gasping, both arms outstretched, her bangles shining as she resists.\n\nElesun leaps and brings her sword around, slashing at Aesil, and cleaving off his outstretched arm.  Aesil stumbles back, but the arm is already regrowing.  He fires a blast of magic at Elesun, forcing her to dive out of the way.\n\nElesun jumps back up and only has a moment to react before a blade slashes at her.  She blocks it, and finds herself crossing swords with a sell sword.\n\n&quot;Out of my way!&quot; Elesun shouts.\n\n&lt;&lt;ctrlCon 'combat_call_1_1'&gt;&gt;</div><div tiddler="0mainhall1alone" tags="dock" created="201701252352" modifier="twee">The king loved Ripley, and being apart from her was probably hard for him--he thought of her as a daughter.  Irelith and Elesun had convinced him that her training and safety was more important, though, and the king gave Elesun leave to bring Ripley here, to Harlan Castle.  The place was also occupied by a minor local noble, but the king persuaded him to give up the fief.</div><div tiddler="0nearvillage" tags="scene" created="201701260052" modifier="twee">&lt;&lt;set $song to -1&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;herat7&quot; loop play&gt;&gt;&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;image &quot;FolsomSm&quot;&gt;&gt;Before Elesun can take a step, &lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; comes careening through the air past her, and goes scattering across the ground.\n\n&quot;Hello&lt;&lt;if $helpServants is 1&gt;&gt; again&lt;&lt;endif&gt;&gt;, Elesun,&quot; a voice says.  She looks over to see Folsom standing there, looking rather exhausted.\n\n&lt;&lt;if $helpServants is 1&gt;&gt;&quot;He's still not dying I see,&quot; Elesun says.&lt;&lt;else&gt;&gt;&quot;Folsom?&quot; Elesun says.  &quot;It's good to see you.  So Aesil's here, too.  Great.&quot;&lt;&lt;endif&gt;&gt;\n\n&quot;How are things over here?&quot;\n\n&quot;Not great.  &lt;&lt;journallink &quot;Irelith&quot; &quot;codex_Irelith&quot;&gt;&gt;'s pretty hurt.  She could use your expertise.&quot;\n\n&lt;&lt;journallink &quot;Folsom&quot; &quot;codex_Folsom&quot;&gt;&gt; frowns.  &quot;I'm worried that if I stop hitting Aesil with my magic, he'll kill us all.&quot;\n\n&quot;I'll take over for a minute then.&quot;\n\n&quot;Last time you barely lasted ten seconds.&quot;\n\n&quot;Then you'd better be fast.&quot;\n\nFolsom sighs.  &quot;Very well.  Don't die.  It'd break poor Ripley's heart.&quot;\n\nWith that, Folsom runs off toward the throne room.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0aesil4&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="combat_outro_1_1" tags="comcall" created="201708281939" modifier="twee">The soldier falls before Elesun.&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;mx&quot; loop play&gt;&gt;\n\nNearby, the remaining two guards finish off the last of the sellswords.  Elesun looks around, but doesn't see Ripley or Aesil anymore.\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|1atcamp1][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="swamp" tags="nobr" created="201612141716" modifier="twee">/%  1  %/\n&lt;&lt;set $specialMult to 0.5&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;Slowed&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,1)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 0.7&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 0.9&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 0.9&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n/%additional casts increase time:%/\n&lt;&lt;set $SpEffTimeRecast to either(1,1,2)&gt;&gt;\n\n&lt;&lt;set $specialname to &quot;Swamp&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="combatNME_fake0" tags="" created="201701260135" modifier="twee">&lt;span id=&quot;enemystatupdate&quot;&gt;&lt;&lt;display &quot;nmegritbar&quot;&gt;&gt;&lt;&lt;display &quot;nmeheartbreaker&quot;&gt;&gt;&lt;&lt;if $combatimages is 1 and $mobile neq 1&gt;&gt;&lt;span id=&quot;nmeport&quot;&gt;[img[$enemyimg]]&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;print $enemyname&gt;&gt; (&lt;&lt;print $enemypower&gt;&gt;)\n\n&lt;&lt;if $combatimages is 1&gt;&gt;[img[$NMEgritdisplay]]&lt;&lt;else&gt;&gt;Grit: &lt;&lt;print $nmegrit&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $combatimages is 1&gt;&gt;[img[$NMEheartdisplay]]&lt;&lt;else&gt;&gt;Health: &lt;&lt;print $nmehealth&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;span id=&quot;oneAct&quot;&gt;[[1. Attack|0aesil4Rip][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="cloth_ui" tags="" created="201702020419" modifier="twee">A suit of lightly padded cloth.  &lt;&lt;if $clothplus is 1&gt;&gt;Or so it seems.  Though this armor may not seem like much, it's been forged by the legendary blacksmiths of the Elysian realm, and should not be underestimated.&lt;&lt;endif&gt;&gt;\n\nCloth armor doesn't restrict movement, but offers minimal protection.\n\n|[img[setup.ui.icons.ui_def]]|Defense Bonus:|Very Low|\n|[img[setup.ui.icons.ui_mov]]|Encumberance:|None|</div><div tiddler="trans_end" tags="nobr" created="201702080731" modifier="twee">&lt;&lt;if $devilForm is 1&gt;&gt;\n\t&lt;&lt;payload 'onRevert'&gt;&gt;\n\t&lt;&lt;set $rageCurrent to $rageCurrent - $rageDecay&gt;&gt;\n\n\t&lt;&lt;if $rageCurrent lte 1&gt;&gt;\n\t\t&lt;&lt;set $devilForm to 0&gt;&gt;\n\t\t&lt;&lt;set $rageCurrent to 0&gt;&gt;\n\t\t&lt;&lt;display &quot;transform_updater&quot;&gt;&gt;\n\t\t&lt;&lt;set $rageCurrent to 1&gt;&gt;\n\t\t&lt;&lt;set $rager to either(1,2,3,4,5)&gt;&gt;\n\n\t\t&lt;&lt;switch $rager&gt;&gt;\n\t\t&lt;&lt;case 1&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;rage-drop1&quot; play&gt;&gt;\n\t\t&lt;&lt;case 2&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;rage-drop2&quot; play&gt;&gt;\n\t\t&lt;&lt;case 3&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;rage-drop3&quot; play&gt;&gt;\n\t\t&lt;&lt;case 4&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;rage-drop4&quot; play&gt;&gt;\n\t\t&lt;&lt;case 5&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;rage-drop5&quot; play&gt;&gt;\n\t\t&lt;&lt;default&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;rage-drop1&quot; play&gt;&gt;\n\t\t&lt;&lt;/switch&gt;&gt;\n\t\t&lt;&lt;if $characterHide is 0&gt;&gt;\n\t\t&lt;&lt;dialog&gt;&gt;\n\n\t\t\tRipley has reverted to her normal form.\n\n\t\t&lt;&lt;/dialog&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t\t/%&lt;&lt;replace &quot;#tray&quot;&gt;&gt;\n\t\t\t&lt;&lt;display &quot;combat_portrait&quot;&gt;&gt;\n\t\t&lt;&lt;/replace&gt;&gt;%/\n\t\t&lt;&lt;comUpdate&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="ch1-5" tags="scene save" created="201701282003" modifier="twee">&lt;&lt;first&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio 'summer' loop play&gt;&gt;&lt;&lt;/first&gt;&gt;&lt;&lt;image 'manSm'&gt;&gt;&lt;&lt;thumb&gt;&gt;</div><div tiddler="1baileyCastle" tags="dock" created="201702121100" modifier="twee">Harlan Castle was built by the third king of Juno, Harlan, a few hundred years ago--Elesun was never very good with dates.  About fifty years ago it was restored, and the old fortress still holds together well, all things considered.</div><div tiddler="bomb" tags="nobr" created="201701241624" modifier="twee">/%  3  %/\n&lt;&lt;set $specialMult to 1.2&gt;&gt;/%damage of spell%/\n&lt;&lt;set $SpEffName to &quot;&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,0)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Hellfire Bomb&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="helpgameflow" tags="help" created="201701110806" modifier="twee">As you progress through the game, you will encounter different gameplay elements.  In __spaces__, you will be able to explore your surroundings and perform actions using the information dock.  In __scenes__, you’ll either have the option to continue or be asked to make a decision.</div><div tiddler="arkan_stats" tags="nobr" created="201612132345" modifier="twee">Stats based on Ripley's.  Summonable.\n\n&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="bossAdjust" tags="test menu" created="201707262207" modifier="twee" twine-position="1410,1130">&lt;&lt;link 'Fight Aesil as Elesun Lv 5'&gt;&gt;&lt;&lt;set $lvl to 5, $strrank to 4, $agirank to 2, $endrank to 2&gt;&gt;&lt;&lt;stats&gt;&gt;&lt;&lt;display 'Aesil-boss-1-1'&gt;&gt;&lt;&lt;goto 'combat_test_2'&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link 'Fight Aesil as Ripley Lv 6'&gt;&gt;&lt;&lt;display 'switchtoRipley'&gt;&gt;&lt;&lt;set $lvl to 6, $strrank to 4, $agirank to 3, $endrank to 2&gt;&gt;&lt;&lt;stats&gt;&gt;&lt;&lt;display 'Aesil-boss-1-1'&gt;&gt;&lt;&lt;goto 'combat_test_2'&gt;&gt;&lt;&lt;/link&gt;&gt;</div><div tiddler="com_Aes_fake" tags="placeholder" created="201701260052" modifier="twee">!Player's Turn\n&lt;&lt;nobr&gt;&gt;\n&lt;&lt;set $playerturn to 1&gt;&gt;\n&lt;&lt;display &quot;cominfo_fake0&quot;&gt;&gt;&lt;&lt;if $combatimages is 1&gt;&gt;&lt;&lt;comPt&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;span id=&quot;combatNME&quot;&gt;&lt;&lt;display &quot;combatNME_fake0&quot;&gt;&gt;&lt;/span&gt;\n\n\n&lt;&lt;endnobr&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="spell_dispel" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Dispel&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Neutral&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Dispel&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;dispel_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 5&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 30&gt;&gt;\n\n&lt;&lt;if $neutraltraining is 1&gt;&gt;\n\t&lt;&lt;set $spelldispel to 35&gt;&gt;\n&lt;&lt;elseif $neutraltraining is 2&gt;&gt;\n\t&lt;&lt;set $spelldispel to 40&gt;&gt;\n&lt;&lt;elseif $neutraltraining is 3&gt;&gt;\n\t&lt;&lt;set $spelldispel to 50&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1orUnsteady" tags="dock" created="201701281959" modifier="twee">The horse's breathing is labored, and he's swaying a bit as he runs.\n\nElesun pats the die of his neck.  &quot;Hang in there, boy.&quot;</div><div tiddler="1tothecrossroads" tags="scene" created="201701282005" modifier="twee"></div><div tiddler="combat_intro_0_4" tags="comcall" created="201701140727" modifier="twee">You’re about to fight &lt;&lt;print $enemyname&gt;&gt;.\n\n&lt;&lt;help &quot;helpNMEspells&quot;&gt;&gt;</div><div tiddler="longsword" tags="nobr" created="201612131435" modifier="twee">&lt;&lt;set $weaponname to &quot;Long Sword&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;lswd_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.0&gt;&gt;\n&lt;&lt;set $wdef to 1.0&gt;&gt;\n&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;set $critrange to 100&gt;&gt;\n\n&lt;&lt;set $wStaUse to 5&gt;&gt;\n\n&lt;&lt;if $longswordtraining gte 1&gt;&gt;\n\t&lt;&lt;set $watk to 1.1&gt;&gt;\n&lt;&lt;elseif $longswordtraining is 2&gt;&gt;\n\t&lt;&lt;set $watk to 1.1&gt;&gt;\n\t&lt;&lt;set $wdef to 1.1&gt;&gt;\n&lt;&lt;elseif $longswordtraining is 3&gt;&gt;\n\t&lt;&lt;set $watk to 1.1&gt;&gt;\n\t&lt;&lt;set $wdef to 1.1&gt;&gt;\n\t&lt;&lt;set $wmov to 1.1&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="combat_tutorials" tags="option" created="201707101829" modifier="twee" twine-position="710,990">Combat Tutorials: &lt;span id='comTutOpt' style='color:#B10DC9;'&gt;On &lt;/span&gt; &lt;&lt;button 'Change'&gt;&gt;\n\t&lt;&lt;if setup.comTut&gt;&gt;\n\t\t&lt;&lt;display 'pull_tut_hooks'&gt;&gt;\n\t\t&lt;&lt;replace '#comTutOpt'&gt;&gt;Off&lt;&lt;/replace&gt;&gt;\n\t\t&lt;&lt;set setup.comTut to false&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;display 'place_tut_hooks'&gt;&gt;\n\t\t&lt;&lt;replace '#comTutOpt'&gt;&gt;On &lt;&lt;/replace&gt;&gt;\n\t\t&lt;&lt;set setup.comTut to true&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/button&gt;&gt;</div><div tiddler="1RipQuarters" tags="space" created="201701281954" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;action 'Ripley' '1ripqRip'&gt;&gt; appears to be &lt;&lt;weak 'meditating' '1ripqMed'&gt;&gt; when Elesun enters, sitting on the floor, legs folded, hands together in her lap in the Druid way.  She doesn't seem to notice Elesun.\n\nOn display in the room's far side, near the &lt;&lt;weak 'window' '1ripqWindow'&gt;&gt; is a small box with a handful of &lt;&lt;dock 'strangely shaped rocks' '1ripqRocks'&gt;&gt;.\n\n&lt;span id=&quot;navbox&quot;&gt;&lt;&lt;mapHarlan $now&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="title" tags="menu" created="201702120627" modifier="twee">&lt;&lt;set $gamestart to 0&gt;&gt;\n\n\n\n&lt;div class=&quot;text-focus-in&quot;&gt;&lt;div class=&quot;titleText&quot;&gt;+Holy Land&lt;/div&gt;&lt;/div&gt;\n&lt;&lt;timed 2.5s t8n&gt;&gt;&lt;center&gt;\n!!!A choice-driven narrative adventure game.\n&lt;/center&gt;&lt;&lt;/timed&gt;&gt;\n\n&lt;&lt;timed 5s&gt;&gt;\n&lt;&lt;goto &quot;title2&quot;&gt;&gt;\n&lt;&lt;/timed&gt;&gt;&lt;span id=&quot;ctrlClick&quot;&gt;@@display: none;[[skip|title2]]@@&lt;/span&gt;\n</div><div tiddler="held_help" tags="dock" created="201701250217" modifier="twee">Dark tendrils materialize and attempt to pin &lt;&lt;print $character&gt;&gt; and root her in place.\n\nMassive penalty to Move actions and total Stamina.  Moderate penalties to Attack actions and damage dealt.</div><div tiddler="0iwlever3" tags="dock" created="201701070321" modifier="twee">Elesun already pulled the lever.</div><div tiddler="tut_onFirstAtk" tags="hook tutorial" created="201707101334" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has attacked the enemy.\n\n&lt;&lt;name&gt;&gt; can continue attacking until she is out of stamina (stamina is displayed in the status window near the bottom of the screen).  Each weapon costs a different amount of stamina to use.  Heavier weapons deal more damage, but cost more stamina.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onFirstAtk'&gt;&gt;</div><div tiddler="spell_blessing" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Blessing&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Light&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Blessing&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;bless_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 5&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.1&gt;&gt;\n&lt;&lt;set $spelldodge to 5&gt;&gt;\n&lt;&lt;set $spellgrit to 10&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 5&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 5&gt;&gt;\n\n&lt;&lt;if $lighttraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcrit to 10&gt;&gt;\n&lt;&lt;elseif $lighttraining is 2&gt;&gt;\n\t&lt;&lt;set $spelldodge to 10&gt;&gt;\n\t&lt;&lt;set $spellcrit to 10&gt;&gt;\n&lt;&lt;elseif $lighttraining is 3&gt;&gt;\n\t&lt;&lt;set $spelldispel to 10&gt;&gt;\n\t&lt;&lt;set $spelldodge to 10&gt;&gt;\n\t&lt;&lt;set $spellcrit to 10&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="helpTalking" tags="help" created="201702191119" modifier="twee">When you talk to characters, you'll use the links presented to ask different questions and recieve responses in the information dock, similar to navigating a space.  Also like a space, asking certain things may lead to new or different things to ask about.\n\nThere are also a few special options you may find:\n*''Chit-chat'': Select chit-chat to hear about whatever happens to be on the character's mind at the moment.  You can keep clicking it for new lines.  Chatting can help you learn about lore, hints, and leads for new quests.\n*''Services'': Some characters offer services, like training or renting rooms.  You can talk to them to use these services.\n*''Quests'': Some characters will give you specific tasks and side-quests that you can optionally choose to complete.</div><div tiddler="example_wpn" tags="nobr" created="201702022254" modifier="twee">&lt;&lt;set $weaponname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.0&gt;&gt;\n&lt;&lt;set $wdef to 1.0&gt;&gt;\n&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;set $critrange to 100&gt;&gt;\n\n&lt;&lt;set $wStaUse to 0&gt;&gt;\n\n/%training%/</div><div tiddler="version" tags="init" created="201707082100" modifier="twee" twine-position="150,150">&lt;&lt;set $version to 73&gt;&gt;\n&lt;&lt;set $versionnumber to &quot;0.7.3&quot;&gt;&gt;\n&lt;&lt;set $webversion to 1&gt;&gt;/% 1-browser, 0-exe %/\n\n&lt;&lt;set $debug to 0&gt;&gt;/% access debug features %/\n&lt;&lt;set $demomode to 0&gt;&gt;/% locks off unfinished parts %/\n&lt;&lt;set $release to 1&gt;&gt;/% 0-pw protected launch %/\n\n/% launch options %/\n&lt;&lt;set $combatimages to 1&gt;&gt;\n&lt;&lt;set setup.audioswitch to 1&gt;&gt;\n&lt;&lt;set setup.masteraudioswitch to 1&gt;&gt;\n&lt;&lt;set $dockmode to 1&gt;&gt;\n&lt;&lt;set $dockdisp to 1&gt;&gt;\n&lt;&lt;set $characterHide to 0&gt;&gt;\n\n/% level caps %/\n&lt;&lt;if $demomode is 1&gt;&gt;\n\t&lt;&lt;set setup.lvlcap to 8&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set setup.lvlcap to 20&gt;&gt;/%level cap%/\n&lt;&lt;endif&gt;&gt;</div><div tiddler="dock3" tags="test" created="201612191508" modifier="twee" twine-position="1970,850">This is a normal amount of text. This is a normal amount of text. This is a normal amount of text. \n\nThis is a normal amount of text. This is a normal amount of text. \n\nThis is a normal amount of text. </div><div tiddler="blunted_help" tags="dock" created="201701250217" modifier="twee">&lt;&lt;print $character&gt;&gt;'s weapon is wreathed in neutral magic, blunting it temporarily\n\nMassive penalies to Attack actions and damage dealt.</div><div tiddler="combat_call_0_5" tags="nobr comcall" created="201701260108" modifier="twee">&lt;&lt;combat &quot;rank5lvl3_witch&quot; &quot;combat_intro_0_3&quot; &quot;combat_outro_0_5&quot;&gt;&gt;</div><div tiddler="example_armor" tags="nobr" created="201702022255" modifier="twee">&lt;&lt;set $armorname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $aatk to 1.0&gt;&gt;\n&lt;&lt;set $adef to 1.0&gt;&gt;\n&lt;&lt;set $amov to 1.0&gt;&gt;\n\n/%upgrade%/</div><div tiddler="1HarlRip_pretty" tags="dock" created="201707110058" modifier="twee">&quot;I'm not discussing this with you Elesun.  Between you and Irelith, I've had quite enough of the match-making.&quot;</div><div tiddler="next_passage" tags="example" created="201612180832" modifier="twee">OOOOOOOHHHHOHOHOH\n\nSPOOKY GHOSTS</div><div tiddler="cube settings" tags="script" created="201612122016" modifier="twee" twine-position="10,290">$(document.head).append(&quot;&lt;link rel='icon' href='assets/img/ic.png' /&gt;&quot;);\n\nConfig.passages.start = &quot;Start&quot;;\nConfig.history.controls = false;\nConfig.history.maxStates = 1;\nconfig.saves.autosave = &quot;save&quot;;\nconfig.saves.id = &quot;holy-land&quot;;\nConfig.saves.version = &quot;0.5.0&quot;;\nConfig.loadDelay = 1000;\nConfig.saves.onLoad = function () {\n\tpostrender['restore-audio'] = function (_, taskName) {\n\t\tdelete postrender[taskName];\n\t\tnew Wikifier(null, Story.get('AudioLoad').text);\n\t};\n\nprerender['save-update'] = function (_, taskName) {\n\t\tdelete postrender[taskName];\n\t\tnew Wikifier(null, Story.get('updater').text);\n\t};\n\n};\nconfig.saves.isAllowed = function () {\n\tif (tags().includesAny(&quot;combat&quot;, &quot;menu&quot;, &quot;nosave&quot;)) {\n\t\t$(document).one('tw:dialogclosed', function () {\n\t\t\tUI.alert(&quot;You can't save right now.&quot;);\n\t\t});\n\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\nConfig.saves.autoload = function () {\n  var autoLoad = &quot;prompt&quot;;\n  if (State.variables.holyLandAutoLoad === 1) {\n    return autoLoad;\n  } else {\n    return false;\n  }\n};\n\nConfig.passages.descriptions = function () { \n    var ch = State.variables.chapter;\n    var stage = State.variables.storystage;\n    var locCode = ch * 10 + stage;\n    var descr = &quot;&quot;\n\n    switch (ch) {\n        case 0:\n            descr = &quot;Prologue&quot;;\n            break;\n        case 1:\n            descr = &quot;Chapter 1&quot;;\n            break;\n        case 2:\n            descr = &quot;Chapter 2&quot;;\n            break;\n        case 3:\n            descr = &quot;Chapter 3&quot;;\n            break;\n        case 4:\n            descr = &quot;Chapter 4&quot;;\n            break;\n        case 5:\n            descr = &quot;Chapter 5&quot;;\n            break;\n        case 6:\n            descr = &quot;Chapter 6&quot;;\n            break;\n        case 7:\n            descr = &quot;Chapter 7&quot;;\n            break;\n        default:\n            descr = &quot;&quot;;\n    }\n\n    if (stage === 0) {\n        descr = descr + &quot;: Introduction&quot;;\n    } else {\n        descr = descr + &quot;: Part &quot; + stage;\n    }\n\n    if (tags().includes(&quot;space&quot;)) {\n        descr = descr + &quot;: Space&quot;;\n    } else if (tags().includes(&quot;scene&quot;)) {\n        descr = descr + &quot;: Scene&quot;;\n    } else if (tags().includes(&quot;choice&quot;)) {\n        descr = descr + &quot;: Choice&quot;;\n    } else if (tags().includes(&quot;save&quot;)) {\n        descr = descr + &quot;: Checkpoint&quot;;\n    }\n\n    return descr;\n};\n</div><div tiddler="plate_ui" tags="" created="201702020428" modifier="twee">A suit of ornate plate armor.  &lt;&lt;if $clothplus is 1&gt;&gt;Or so it seems.  Though this armor may not seem like much, it's been forged by the legendary blacksmiths of the Elysian realm, and should not be underestimated.&lt;&lt;endif&gt;&gt;\n\nPlate armor is heavy, even to the point of hampering attacks.  However, it's protective qualities are unrivaled.\n\n|[img[setup.ui.icons.ui_def]]|Defense Bonus:|High|\n|[img[setup.ui.icons.ui_mov]]|Encumberance:|High|</div><div tiddler="combat_upkeep" tags="nobr" created="201612160717" modifier="twee">&lt;&lt;if $playeraction is 3&gt;&gt;&lt;&lt;set $movbonus to $sta&gt;&gt;&lt;&lt;payload 'onMov'&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;set $movbonus to 0&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $rgn to Math.trunc($regen+($sta*$regenmult)+$spellregen)&gt;&gt;\n&lt;&lt;set $healing to $spellhealing+Math.trunc($rgn*1.5)&gt;&gt;\n&lt;&lt;if $spellhealing gt 0 and $playeraction is 2&gt;&gt;\n\t&lt;&lt;set $rgn to 0&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $playeraction is 2 and $spellhealing gt 0&gt;&gt;\n\t&lt;&lt;set $temp_healing to 0&gt;&gt;\n\t&lt;&lt;payload 'onHeal'&gt;&gt;\n\t&lt;&lt;if $sta lt $maxsta/4&gt;&gt;\n\t\t&lt;&lt;set $temp_healing to Math.trunc($healing*0.3)&gt;&gt;\n\t&lt;&lt;elseif $sta lt $maxsta/2&gt;&gt;\n\t\t&lt;&lt;set $temp_healing to Math.trunc($healing*0.7)&gt;&gt;\n\t&lt;&lt;elseif $sta lt $maxsta*0.75&gt;&gt;\n\t\t&lt;&lt;set $temp_healing to Math.trunc($healing*0.9)&gt;&gt;\n\t&lt;&lt;elseif $sta eq $maxsta&gt;&gt;\n\t\t&lt;&lt;set $temp_healing to Math.trunc($healing*1.1)&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;if $devilForm is 1&gt;&gt;\n\t\t&lt;&lt;set $temp_healing to Math.trunc($temp_healing/2)&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;set $endrndm1 to $character + &quot; heals herself for &quot; + $temp_healing + &quot; points.&quot;&gt;&gt;\n\t&lt;&lt;set $grit to $grit+$temp_healing&gt;&gt;\n\t&lt;&lt;if $grit gt $maxgrit&gt;&gt;\n\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $playeraction is 2&gt;&gt;&lt;&lt;payload 'onDef'&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $rgn gt 0 and $devilForm is 0&gt;&gt;\n\t&lt;&lt;payload 'onRegen'&gt;&gt;\n\t&lt;&lt;set $endrndm1 to $character + &quot; has regenerated &quot; + $rgn + &quot; grit.&quot;&gt;&gt;\n\t&lt;&lt;set $grit to Math.trunc($grit+$rgn)&gt;&gt;\n\t&lt;&lt;if $grit gt $maxgrit&gt;&gt;\n\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmeregen gt 0&gt;&gt;\n\t&lt;&lt;set $nmeluck to either(1.0,1.0,1.2,1.5,1.1,1.2,0.9)&gt;&gt;\n\t&lt;&lt;set $nmegrit to Math.trunc($nmegrit+($nmeregen*$nmeluck))&gt;&gt;\n\t&lt;&lt;set $endrndm2 to $enemyname + &quot; has regenerated &quot; + Math.trunc($nmeregen*$nmeluck) + &quot; grit.&quot;&gt;&gt;\n\t&lt;&lt;if $nmegrit gt $nmemaxgrit&gt;&gt;\n\t\t&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $specialOn is 1&gt;&gt;\n\t&lt;&lt;if $round gt $SpEffEnd + 1&gt;&gt;\n\t\t&lt;&lt;set $specialOn to 0&gt;&gt;\n\t\t&lt;&lt;set $NMESpMov to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMESpDef to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMESpDam to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMEStaUse to 0&gt;&gt;\n\t\t&lt;&lt;set $NMEStaLmt to 0&gt;&gt;\n\t\t&lt;&lt;set $SpEffDisplay to &quot;&quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;elseif $specialOn is 0&gt;&gt;\n\t&lt;&lt;set $NMESpMov to 1.0&gt;&gt;\n\t&lt;&lt;set $NMESpDef to 1.0&gt;&gt;\n\t&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;\n\t&lt;&lt;set $NMESpDam to 1.0&gt;&gt;\n\t&lt;&lt;set $NMEStaUse to 0&gt;&gt;\n\t&lt;&lt;set $NMEStaLmt to 0&gt;&gt;\n\t&lt;&lt;set $SpEffDisplay to &quot;&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;display &quot;trans_end&quot;&gt;&gt;\n\n&lt;&lt;set $sta to $maxsta - $NMEStaLmt&gt;&gt;\n&lt;&lt;display &quot;health_checker&quot;&gt;&gt;\n&lt;&lt;if $health gt 0 and $nmehealth gt 0&gt;&gt;\n\t&lt;&lt;set $combatnext to &quot;highway1&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $flinched to false&gt;&gt;</div><div tiddler="0choice3" tags="choice" created="201701140728" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Ripley is sitting on the floor near one of the fireplaces out in the main hall.  She isn't crying--she isn't making a sound at all.  That's worse than crying, in Elesun's experience.\n\nElesun approaches, but Ripley doesn't move or look up.\n\n&lt;span class='action-link'&gt;[[Give her some space.|0choice3leavealone][$ripleyscars++]]&lt;/span&gt;\n\n&lt;span class='action-link'&gt;[[Try to comfort her.|0choice3comfort][$ripleytp++]]&lt;/span&gt;</div><div tiddler="Keen" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;keen_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;keen&quot;]]\n[[No|spellswap]]</div><div tiddler="codex_menu_creatures" tags="menu" created="201612141349" modifier="twee">!Creatures\n&lt;span id=&quot;codexcre&quot;&gt;\nThe world is populated by many stange and wonderful things.&lt;/span&gt;\n\n&lt;&lt;link &quot;Human Beings&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Humans''\n\nThough they share the world with all manner of other intelligent creatures: trolls, vampires, dragons, demonkin, and occasionally Elysians, humans have managed to make it to the top.  While they may not be as strong as some of the other races of the world, humanity’s obsession with building, organizing, and conquering has cemented them as the most powerful and numerous race in the world, and their civilizations can be found in every corner of every continent.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Elysians&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Elysians''\n\nElysians hail from the other world--the holy land.  Though generally regarded as good by humans, the Elysians’ strange ways, riddle-like mannerisms, and terrifying appearance tend to cause unease, sometimes even panic, when one does show up.  What is known is that the Elysians seem to consider human beings, even on an individual level, worthy of concern and care, and they frequently appear during large scale natural catastrophes and other such events and lend aid.\n\nElysians are powerful.  Whether they can be killed or even hurt isn’t readily known, and their physical strength dwarfs the raw brawn of even the dragons.  Their magic, though similar to the typical schools practiced by humans, is similarly powerful.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Vampires&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Vampires''\n\nSometimes called darkkin or nightkin, vampires subside off the blood of other creatures.  Their ranks are made up of converted humans, and if other creatures can be made vampires, it’s certainly rare.  Vampires themselves are all a member of the same bloodline, and carry the curse of their progenitor, the mythical vampire lord, in their blood.\n\nThe process of turning a human into a vampire is more ritualistic and intentional than most realize--simply fighting a vampire poses no risk of contracting the curse.  Vampire society is notable for its lack of any kind of individual expression.  Though marginally self-sufficient, every vampire in the world is in most ways a slave to the vampire that made him or her, and this goes up the chain all the way to the vampire lord himself.  This slavery is speculated by some scholars to be related to the Vow Logic.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Dragons&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Dragons''\n\nMassive winged beasts resembling reptiles, dragons were the first beings made by the gods, and share a special connection to the Hellish Flame.  The power of the flame is shared and split between the dragons, and when one dies, his power is redistributed amongst the survivors.\n\nAs a dragon ages, or grows wounded, his connection with the Flame begins to fade, and once it fades completely, the dragon turns to stone and shatters.  The piece of stone that forms from its heart becomes an &quot;egg,&quot; and after a period of time, a new dragon can be called forth, fully grown, from it by another dragon or dragonkin.  Some dragons can also generate these stones during their lives without dying, though this is rare.\n\nDragons all share a connection to a communal memory and have telepathic powers.  That said, they are rarely, if ever, of one mind, and have as personalities as varied as humans.  Akatosh, and some devastating in-fighting, have left dragons nearly extinct.\n\nNo creatures alive today have as strong a connection to the Vow Logic as dragons.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Demons&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Demons''\n\nDemons are specualted to exist as a sort of balanced opposite to the Elysians.  While conclusive proof has never been found, many consider Akatosh to be some kind of demon.  Akatosh's exact nature is difficult to pin down, but most scholars agree that he is something else--neither Elysian nor Demonkin, nor human, and it seems likely that other, simmilar beings should exist somewhere.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Demonkin&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Demonkin''\n\nThough the moniker &quot;demonkin&quot; is very likely inaccurate, it's remained for simple want of an appropriate alternative term.  The demonkin begin being born into the world shortly after the arrival of Akatosh.  When Akatosh arrives every few centuries, he indwells the body of a living human and sets about destroying the world.  The demonkin, all female, are born to normal, unsuspecting parents and rise up to challenge him.  Demonkin are significantly stronger and more resilient than ordinary humans, but otherwise are not much different.\n\nOne particular demonkin in each generation is known as the Child of Promise.  She is born on a certain day, when the stars are in a certain place, and is given more power than the others.  She is the only one born with enough power to rival Akatosh, and is &quot;destined&quot; to face him.\n\nThe Child of Promise is not always successful.  When she fails, Akatosh generally destroys a near apocalyptic portion of the human race before vanishing for another few hundred years.\n\nScholars estimate that the Child of Promise is successful only slightly more often than she is unsuccessful, and specualte that Akatosh's next incarnation becomes much more powerful every time she succeeds until she eventually fails.  The current incarnation of Akatosh comes on the heels two consecutive defeats.&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Dragonkin&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''Dragonkin''\n\nDescription of the Dragonkin&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;The Gods&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexcre&quot;&gt;&gt;\n''The Gods''\n\nDescription of the Gods&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n[[Back|codex_menu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="1RipTalk" tags="talk" created="201707110030" modifier="twee">&lt;&lt;image 'RipPtKid'&gt;&gt;Elesun knocks gently on the wall.  Ripley turns to look.\n\n&quot;What's up, Elesun?&quot; she asks.\n\n&lt;&lt;dock &quot;Chit-chat.&quot; &quot;RipChat1&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Ask about Harlaus.&quot; &quot;1RipHarl&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Ask how she's doing.&quot; &quot;1RipHow&quot;&gt;&gt;\n\n&lt;&lt;if $HarlScene&gt;&gt;&lt;&lt;dock &quot;Ask about visiting the Druids.&quot; &quot;1RipDruids&quot;&gt;&gt;\n\n&lt;&lt;endif&gt;&gt;&lt;&lt;if $stoneOne.have is 1&gt;&gt;[[Show her the stone.|1RipStone1]]\n\n&lt;&lt;endif&gt;&gt;&lt;&lt;dock &quot;Never mind.&quot; &quot;1RipNVM&quot;&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n</div><div tiddler="Chain Armor" tags="menu" created="201612131636" modifier="twee">&lt;&lt;display &quot;chain_ui&quot;&gt;&gt;\nEquip this armor?\n\n[[Yes|changearmor][$change to &quot;chain&quot;]]\n[[No|armorswap]]</div><div tiddler="0aesil_escape" tags="scene" created="201701242341" modifier="twee">&lt;&lt;timed 3s t8n&gt;&gt;&lt;&lt;image &quot;FolsomPt&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;&quot;Elesun!  Ripley!&quot;  A familiar voice is calling...\n&lt;&lt;timed 3s t8n&gt;&gt;\n&quot;&lt;&lt;journallink &quot;Folsom&quot; &quot;codex_Folsom&quot;&gt;&gt;?&quot; Elesun says.  &quot;what are you doing here?&quot;\n\n&quot;I heard Aesil was nearby.&quot;\n\n&quot;He is.  He's--&quot;\n\nBefore Elesun can finish, &lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; bursts through the door.  He notices Folsom, and grins.  &quot;Wizard,&quot; he hisses.\n\n&quot;Shit!&quot; Folsom shouts.  &quot;Clear out!&quot;  Folsom raises his hands, and a reddish orb of magical energy forms before him.\n\n&quot;Oh shit.&quot;  Elesun grabs Ripley by the shoulders and tackles her to the ground.\n\nA beam of pure hellish energy erupts from Folsom's hands, sending Aesil flying back.\n\n&quot;I've got him,&quot; Folsom says.  &quot;You two get out of here.&quot;\n\n&lt;&lt;ctrlClick &quot;Get moving.&quot; &quot;0wall3&quot; &quot;leave&quot;&gt;&gt;\n&lt;&lt;/timed&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="tips" tags="nobr" created="201701182240" modifier="twee" twine-position="850,710">&lt;&lt;set $tips to [\n&quot;If you encounter any bugs, you can report them from the settings menu.&quot;, \n&quot;Change your equipment to confront new challenges.&quot;, \n&quot;The game autosaves after every handful of scenes and events.  Still, it's wise to save the game yourself occasionally.&quot;, \n&quot;If the number of links in the game text distracts you, try turning the dock mode to clean in the settings menu.&quot;, \n&quot;Some fights can be avoided based on the decisions you make.&quot;, \n&quot;You can keep attacking until you're out of stamina.&quot;, \n&quot;The 'power' of an enemy, relative to the power of your character, is an indicator of how good a fight they'll put up.&quot;, \n&quot;You can change the appearance and behavior of the information dock from the settings menu.&quot;, \n&quot;Each attribute is capped at 10, while your character's overall level is capped at 20.&quot;, \n&quot;Winning fights is not the only way to earn experience and level up.&quot;, \n&quot;There are many solutions to a given problem.  There are no best choices.&quot;, \n&quot;Never underestimate moving and defending, as tempting as an all-out attack might be.&quot;,  \n&quot;You will be given the chance to adjust the difficulty before starting the game and after the prologue.  After that, you'll have to live with your decision.&quot;,\n&quot;Explore your surrounding with the information dock.  You'll get more context for the story, and may even find some new equipment or items.&quot;, \n&quot;Ripley has quite a collection of smooth and strange-shaped stones.  Keep an eye out and help add to her collection.&quot;, \n&quot;Side quests aren't logged in the journal, but can be quite important.  They can lead to new equipment and abilities.&quot;, \n&quot;Not all enemies fight the same way--many enemies have powerful spells and abilities at their disposal, and even ordinary enemies can score critical hits.&quot;, \n&quot;Elesun's vows, and how you choose to approach and interpret them, will have a major effect on how people view her.&quot;,\n&quot;There is no tip here.&quot;, \n&quot;Review the codex (found in the journal menu) for background information on the world and context for the story.  It's not required reading, but it may enhance your enjoyment of the game.&quot;, \n&quot;Double click the information dock to collapse it.  Click on a link or press the space bar to bring it back.&quot;,\n&quot;You can review the help menu from the journal for information and instructions.&quot;, \n&quot;Make no vows.&quot;,\n&quot;You can double click on the information dock to collapse it, and press space to reset it.&quot;,\n&quot;Most menus and sub-menus can be accessed through keyboard shortcuts.  Press H to bring up the help menu, and find out more there.&quot;\n]&gt;&gt;\n&lt;&lt;if ndef _tipIdx&gt;&gt;\n\t&lt;&lt;set _tipIdx to random($tips.length-1)&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;if _tipIdx lt ($tips.length - 1)&gt;&gt;\n\t\t&lt;&lt;set _tipIdx++&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set _tipIdx to 0&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $tip to $tips[_tipIdx]&gt;&gt;</div><div tiddler="rank5lvl5_witch" tags="nobr" created="201701241752" modifier="twee">&lt;&lt;set $enemyname to &quot;Forest Witch&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 4&gt;&gt;\n&lt;&lt;set $enemypower to 375&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme[&quot;ghostwoman&quot;]&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 195&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 5&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 66&gt;&gt;\n&lt;&lt;set $nmedef to 68&gt;&gt;\n&lt;&lt;set $nmemov to 61&gt;&gt;\n&lt;&lt;set $nmemagic to 75&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;swamp&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 1&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 10&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.9&gt;&gt;\n&lt;&lt;set $nmespellpower to 100&gt;&gt;\n&lt;&lt;set $nmeacc to 90&gt;&gt;\n&lt;&lt;set $nmebaseregen to 10&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 3&gt;&gt;\n&lt;&lt;set $nmetype to 3&gt;&gt;\n\n&lt;&lt;set $nmexp to 20&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;</div><div tiddler="1eleqRest" tags="menu" created="201708281406" modifier="twee">&lt;&lt;rest&gt;&gt;&lt;&lt;first&gt;&gt;\n\n&lt;&lt;message&gt;&gt;Elesun has earned a new scar and her health has increased by one point.\n\nThe odds of earning a new scar when resting are increased for every wound she suffers, but are reset after a new scar is earned.  It is possible to earn more than one scar per rest if she has taken an exceptional number of wounds between rests.  For every five scars she earns, she gains one additional heart of health, up to a maximum of six total hearts.&lt;&lt;/message&gt;&gt;&lt;&lt;/first&gt;&gt;\n\n&lt;&lt;if $HarlScene&gt;&gt;&lt;&lt;ctrlCon '1AfterRest'&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;ctrlCon '1EleQuarters'&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="notifyTWS" tags="widget nobr" created="201711271904" modifier="twee">/% journal %/\n&lt;&lt;widget 'notifyJournal'&gt;&gt;\n\t&lt;&lt;first&gt;&gt;\n\t\t&lt;&lt;notify 'journal-update'&gt;&gt;\n\t\t\tJournal Updated!\n\t\t&lt;&lt;/notify&gt;&gt;\n\t&lt;&lt;/first&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% inventory %/\n&lt;&lt;widget 'notifyInventory'&gt;&gt;\n\t&lt;&lt;first&gt;&gt;\n\t\t&lt;&lt;set _gear to $args[0]&gt;&gt; /% spell, weapon, armor %/\n\t\t&lt;&lt;notify 'inventory-update'&gt;&gt;\n\t\t\tNew _gear obtained!\n\t\t&lt;&lt;/notify&gt;&gt;\n\t&lt;&lt;/first&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% vows %/\n&lt;&lt;widget 'notifyVow'&gt;&gt;\n\t&lt;&lt;first&gt;&gt;\n\t\t&lt;&lt;set _result to $args[0]&gt;&gt; /% broken, complete, taken %/\n\t\t&lt;&lt;notify 'vows-update'&gt;&gt;\n\t\t\tVow _result!\n\t\t&lt;&lt;/notify&gt;&gt;\n\t&lt;&lt;/first&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% title %/\n&lt;&lt;widget 'notifyTitle'&gt;&gt;\n\t&lt;&lt;first&gt;&gt;\n\t\t&lt;&lt;set _title to $args[0]&gt;&gt;\n\t\t&lt;&lt;notify 'title-update'&gt;&gt;\n\t\t\t&lt;&lt;if _title&gt;&gt;\n\t\t\t\tNew title: _title!\n\t\t\t&lt;&lt;else&gt;&gt;\n\t\t\t\tNew title earned!\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;/notify&gt;&gt;\n\t&lt;&lt;/first&gt;&gt;\n&lt;&lt;/widget&gt;&gt;</div><div tiddler="lvlinfo" tags="" created="201612172041" modifier="twee">\nLevel is a representation of a character's experience, skill, and knowledge.  As it increases, the character will grow more powerful.  Levels are earned by accumulating experience points from combat, quests, and exploration.\n\n</div><div tiddler="0choice1dress" tags="dock" created="201701140609" modifier="twee">Ripley is wearing the white dress that Harlaus, the king’s son and heir to the throne, had commissioned for her last year.  Harlaus was clever like his father, maybe even cleverer, and Elesun couldn’t tell if he fancied Ripley or not.\n\nIt’s sleeveless, and goes down to the knee.  Ripley wears a red cloak over it, a common accessory worn by the king’s personal guard.  Ripley’s exposed limbs are lined with lean, powerful muscles from years of intense training; first as a druid warrior, then as one of the king’s guard, and now as the pupil of Elesun and Irelith.</div><div tiddler="PlayerPortrait" tags="" created="201701050449" modifier="twee" twine-position="150,850">&lt;span id=&quot;portrait&quot;&gt;&lt;&lt;if $character is &quot;Elesun&quot;&gt;&gt;[img[setup.img.ElePt]]&lt;&lt;else&gt;&gt;[img[setup.img.RipPt]]&lt;&lt;endif&gt;&gt;&lt;/span&gt;</div><div tiddler="1throneKing" tags="dock" created="201708112309" modifier="twee">&lt;&lt;if !$HarlScene&gt;&gt;\s\n\t&quot;Come to air more opinions?&quot; the King asks.\n\n\t&lt;&lt;ctrlClick 'Talk to the King.' '1KingScene'&gt;&gt;\s\n&lt;&lt;else&gt;&gt;\s\n\tElesun steps closer to the King.\n\n\t&lt;&lt;ctrlClick 'Speak to him.' '1KingTalk'&gt;&gt;\s\n&lt;&lt;endif&gt;&gt;</div><div tiddler="content-warning" tags="splash" created="201707271728" modifier="twee">&lt;div id='splash'&gt;\n&lt;center&gt;&lt;h1 style='color:red;'&gt;Warning&lt;/h1&gt;\n\n&lt;span&gt;//Holy Land// contains strong language and written depicitons of intense violence and gore.&lt;/span&gt;\n\n&lt;&lt;timed 2s t8n&gt;&gt;\n&lt;&lt;button 'Okay'&gt;&gt;&lt;&lt;run $('#splash').fadeOut();&gt;&gt;&lt;&lt;/button&gt;&gt;\n&lt;&lt;/timed&gt;&gt;\n&lt;/center&gt;\n&lt;/div&gt;</div><div tiddler="tut_onFightEnd" tags="hook tutorial" created="201707101340" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\nCongratulations!  &lt;&lt;name&gt;&gt; has defeated the enemy.\n\nAfter combat ends, &lt;&lt;name&gt;&gt; will earn some XP and possibly level up.  There are other ways to earn XP, too.  The game will autosave immediately before and after every fight.  &lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt; will regenerate completely between every fight, but hearts will not.  To restore your hearts, you'll need to find a place to ''rest''.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onFightEnd'&gt;&gt;</div><div tiddler="vow-list-completed" tags="" created="201710230747" modifier="twee" twine-position="710,1130">&lt;&lt;if $vows.complete.length lte 0&gt;&gt;\s\n\tNo completed vows.\s\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;for _i to 0; _i lt $vows.complete.length; _i++&gt;&gt;\s\n\t\t&lt;&lt;set _v to $vows.complete[_i]&gt;&gt;\s\n\t\t&lt;&lt;capture _v&gt;&gt;\s\n\t\t\t&lt;&lt;link setup.vows.list[_v].title&gt;&gt;\n\t\t\t\t&lt;&lt;dialog `'Vow: ' + setup.vows.list[_v].title` 'vow'&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;- setup.vows.list[_v].descr&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;if setup.vows.list[_v].outc&gt;&gt;\n\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;&lt;- setup.vows.list[_v].outc&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\s\n\t\t\t\t&lt;&lt;/dialog&gt;&gt;\n\t\t\t&lt;&lt;/link&gt;&gt;\n\t\t&lt;&lt;/capture&gt;&gt;\s\n\t&lt;&lt;/for&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="helpjournal" tags="help" created="201701070313" modifier="twee">You can access your journal from the menu on the left, or by pressing Tab or J on the keyboard.  Your journal tells you what your current goal is.\n\nIt also includes a codex which gives background information on the world.  You can view the codex from the journal menu, or by pressing Shift+Tab or Z on the keyboard.  You can leave an menu by clicking on the &quot;Return to Game&quot; link or by pressing Q or Esc on the keyboard.</div><div tiddler="rage_unpack" tags="nobr" created="201703200030" modifier="twee">&lt;&lt;set $rageCurrent to $rageStock&gt;&gt;\n&lt;&lt;if typeof $rageCurrent != 'number'&gt;&gt;\n\t&lt;&lt;set $rageCurrent to 0&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="tut_onMov" tags="hook tutorial" created="201707101336" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\nBy ending her turn by moving, &lt;&lt;name&gt;&gt; sacrifices defense to gain a better position.  Her attacks on the next turn after moving deal increased damage.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onMov'&gt;&gt;</div><div tiddler="1mainFolsom" tags="dock" created="201707110037" modifier="twee">Healing Irelith's wounds took a toll on Folsom.  His back wasn't that hunched a few weeks ago.\n\n&lt;&lt;ctrlClick 'Talk to him.' '1FolsomTalk'&gt;&gt;</div><div tiddler="reaper_summon_stats" tags="nobr" created="201612132348" modifier="twee">Comes and goes.  Special summon.\n\n&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 30&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="Regeneration" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display 'rgn_ui'&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;regn&quot;]]\n[[No|spellswap]]</div><div tiddler="1Map1Ele" tags="dock map" created="201702180709" modifier="twee">Head west to Elesun's quarters?\n\n&lt;&lt;ctrlClick &quot;Go to Elesun's quarters.&quot; &quot;1EleQuarters&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="Vital" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;vigr_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;vigr&quot;]]\n[[No|spellswap]]</div><div tiddler="0kingsquarters" tags="space" created="201701252156" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;dock &quot;Ripley&quot; &quot;0kingsRip&quot;&gt;&gt; and Elesun are standing in &lt;&lt;weak &quot;the king&quot; &quot;0kingsKings&quot;&gt;&gt;'s quarters in the castle's main hall.\n\nThere are a handful of &lt;&lt;weak &quot;portraits&quot; &quot;0kingsPort&quot;&gt;&gt; hanging on the wall nearby, while the wall behind them is...&lt;&lt;weak &quot;melted&quot; &quot;0kingsWall&quot;&gt;&gt;, for lack of a better term.\n\nElesun can hear &lt;&lt;weak &quot;fighting&quot; &quot;0kingsListen&quot;&gt;&gt; somewhere below them--probably outside.  They should &lt;&lt;action &quot;get moving&quot; &quot;0kingsContinue&quot;&gt;&gt;.\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n</div><div tiddler="combat_trainer2" tags="menu" created="201612132200" modifier="twee">&lt;&lt;if $tpcost gt $tp&gt;&gt;Not enough TP.&lt;&lt;else&gt;&gt;\n\n&lt;&lt;if $choice is &quot;unarm&quot;&gt;&gt;&lt;&lt;set $unarmedtraining to $unarmedtraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with unarmed increased to &lt;&lt;print $unarmedtraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;lsword&quot;&gt;&gt;&lt;&lt;set $longswordtraining to $longswordtraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with longsword increased to &lt;&lt;print $longswordtraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;gsword&quot;&gt;&gt;&lt;&lt;set $greatswordtraining to $greatswordtraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with great sword increased to &lt;&lt;print $greatswordtraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;katana&quot;&gt;&gt;&lt;&lt;set $katanatraining to $katanatraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with katana increased to &lt;&lt;print $katanatraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;spear&quot;&gt;&gt;&lt;&lt;set $speartraining to $speartraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with spear increased to &lt;&lt;print $speartraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;ssword&quot;&gt;&gt;&lt;&lt;set $sideswordtraining to $sideswordtraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with side sword increased to &lt;&lt;print $sideswordtraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;gaunt&quot;&gt;&gt;&lt;&lt;set $gauntletstraining to $gauntletstraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with clawed gauntlets increased to &lt;&lt;print $gauntletstraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;scythe&quot;&gt;&gt;&lt;&lt;set $scythetraining to $scythetraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with scythe increased to &lt;&lt;print $scythetraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;saber&quot;&gt;&gt;&lt;&lt;set $sabertraining to $sabertraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with saber increased to &lt;&lt;print $sabertraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;axe&quot;&gt;&gt;&lt;&lt;set $battleaxetraining to $battleaxetraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with battle axe increased to &lt;&lt;print $battleaxetraining&gt;&gt;.&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n[[Back to training.|combat_trainer]]\n[[Quit training.|$exitpassage][$gamestart to 1]]</div><div tiddler="helplevelup" tags="help" created="201701140636" modifier="twee">You've earned enough experience to level up.  Click the link below and follow the instructions.  You'll be able to increase one of your attribute ranks by one point, and you'll also earn TP, which you can spend at trainers later.\n\nLeveling up will restore your health, but it won't guve you a chance to form new ''scars''.\n\nYou can review your current level, abilities, and stats from the character menu on the left, or by pressing C or Shift+Spacebar on the keyboard.</div><div tiddler="0aesil_rescue" tags="scene" created="201701250410" modifier="twee">&lt;&lt;timed 3s t8n&gt;&gt;&lt;&lt;image &quot;FolsomPt&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;&quot;Who's down there?&quot;  A familiar voice is calling from the storeroom above...\n&lt;&lt;timed 3s t8n&gt;&gt;\n&quot;&lt;&lt;journallink &quot;Folsom&quot; &quot;codex_Folsom&quot;&gt;&gt;?&quot; Elesun calls back.  &quot;Is that you?  Hurry!&quot;\n\nA moment later, Folsom comes sprinting down the stairs.\n\n&lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; stops short upon seeing him.  &quot;Wizard,&quot; he hisses.\n\n&quot;I thought I might find you here,&quot; Folsom says.  A beam of pure hellish energy erupts from his hands, sending Aesil flying back into the wall.\n\n&quot;I'll handle this from here, Elesun.  Get Ripley out of here.&quot;\n\n&quot;You got it,&quot; Elesun replies.  She grabs Ripley by the hand, and the two run back up and out onto the wall.\n\n&lt;&lt;ctrlClick &quot;Get moving.&quot; &quot;0wall3&quot; &quot;leave&quot;&gt;&gt;\n&lt;&lt;/timed&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="imagesettings" tags="" created="201701120453" modifier="twee">&lt;&lt;if $combatimages is 1&gt;&gt;* &lt;&lt;radiobutton &quot;$combatimages&quot; 1 checked&gt;&gt; On: Display combat portraits and UI elements.  Recommended.\n* &lt;&lt;radiobutton &quot;$combatimages&quot; 0&gt;&gt; Off: Turn off combat images.  May help improve performance and appearance on some browsers and devices.&lt;&lt;else&gt;&gt;* &lt;&lt;radiobutton &quot;$combatimages&quot; 1&gt;&gt; On: Display combat portraits and UI elements.  Recommended.\n* &lt;&lt;radiobutton &quot;$combatimages&quot; 0 checked&gt;&gt; Off: Turn off combat images.  May help improve performance and appearance on some browsers and devices.&lt;&lt;endif&gt;&gt;</div><div tiddler="fullscreen" tags="script" created="201701230743" modifier="twee" twine-position="710,290">setup.fullscreen = function (element) {\n    if(element.requestFullScreen) {\n        element.requestFullScreen();\n    } else if(element.mozRequestFullScreen) {\n        element.mozRequestFullScreen();\n    } else if(element.webkitRequestFullScreen) {\n        element.webkitRequestFullScreen();\n    }\n}\n\n// &lt;&lt;fullscreen&gt;&gt; macro\nMacro.add('fullscreen', {\n    handler : function() { \n\n        var bg = $('body').css('background-color');\n        $('html').css('background-color', bg);\n\n        setup.fullscreen(document.documentElement);\n\n    }\n});\n\npostdisplay['fullscreen-fix'] = function (t) {\n\tvar bg = $('body').css('background-color');\n\t$('html').css('background-color', bg);\n};</div><div tiddler="combat_intro_0_3" tags="comcall" created="201701242353" modifier="twee">You’re about to fight &lt;&lt;print $enemyname&gt;&gt;.\n\n&lt;&lt;message &quot;Help: Enemy Magic&quot;&gt;&gt;&lt;&lt;display &quot;helpNMEspells&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;</div><div tiddler="combat_intro_0_2" tags="comcall" created="201701110819" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Elesun rushes to Ripley’s aid.\n&lt;&lt;set $ripFight to 0&gt;&gt;\n“I’ve got this, Ripley.”\n\n“Elesun?”</div><div tiddler="combat_intro_0_1" tags="comcall" created="201701070324" modifier="twee">You’re about to fight &lt;&lt;print $enemyname&gt;&gt;.</div><div tiddler="StoryMenu" tags="" created="201612122021" modifier="twee" twine-position="710,10">&lt;&lt;if $gamestart eq 1&gt;&gt;[[&quot;\su00a0\su2629\su00a0\su00a0\s Character\su00a0\su00a0\su00a0&quot;|charmenu][$return to passage()]]\n\n[[&quot;\su00a0\su2694\su00a0\su00a0\s Equipment\su00a0&quot;|equipmenu][$return to passage()]]\n\n[[&quot;\su270E\su00a0\s Journal\su00a0\su00a0\su00a0\su00a0\su00a0&quot;|journalmenu][$return to passage()]]\n\n[[&quot;\su00a0\su2699\su00a0\su00a0\s Settings\su00a0\su00a0\su00a0\su00a0\su00a0&quot;|player_settings][$return to passage()]]\n\n&lt;&lt;if $debug is 1&gt;&gt;[[~Test|debug_features][$return to passage(), $exitpassage to passage()]]&lt;&lt;endif&gt;&gt;&lt;&lt;elseif $gamestart eq 2&gt;&gt;[[&quot;\su25c4\s Return to Game&quot;|$return][$gamestart to 1]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $debug is 1&gt;&gt;&lt;&lt;click &quot;~Generate Report&quot;&gt;&gt;&lt;&lt;bugreport&gt;&gt;&lt;&lt;/click&gt;&gt;\n&lt;&lt;link 'FORCE MENU'&gt;&gt;&lt;&lt;set $gamestart to 1&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;/link&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;display &quot;audiomute&quot;&gt;&gt;\n</div><div tiddler="fists_ui" tags="" created="201702020408" modifier="twee">Simple bare fists.\n\nThough training can make unarmed combat deadly, it still comes with great risks.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Very Low|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Very Low|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|High|\n*__Finesse__: High\n*__Stamina__: Very Low</div><div tiddler="playerstats" tags="" created="201612172121" modifier="twee">&lt;&lt;display &quot;heartbreaker&quot;&gt;&gt;&lt;&lt;display &quot;gritbar&quot;&gt;&gt;&lt;&lt;if $character is &quot;Ripley&quot;&gt;&gt;&lt;&lt;display &quot;rabbleRouser&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $characterHide is 0&gt;&gt;&lt;&lt;print $character&gt;&gt;&lt;&lt;else&gt;&gt;???&lt;&lt;endif&gt;&gt;, Power: &lt;&lt;print $power&gt;&gt;, Stamina: &lt;&lt;print $sta&gt;&gt;/&lt;&lt;print $maxsta&gt;&gt;&lt;&lt;if $character is &quot;Ripley&quot;&gt;&gt;&lt;&lt;display &quot;rageBar&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n[img[setup.ui.icons.grit2]] &lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;: &lt;&lt;print Math.trunc($grit)&gt;&gt;&lt;&lt;if $combatimages is 0&gt;&gt;/&lt;&lt;print $maxgrit&gt;&gt;&lt;&lt;else&gt;&gt; [img[$gritdisplay]]&lt;&lt;endif&gt;&gt;   Health: &lt;&lt;if $combatimages is 0&gt;&gt;&lt;&lt;print $health&gt;&gt;/&lt;&lt;print $maxhealth&gt;&gt;&lt;&lt;else&gt;&gt;[img[$heartdisplay]]&lt;&lt;endif&gt;&gt;</div><div tiddler="1KingNVM" tags="dock" created="201707110121" modifier="twee">&quot;Goodbye, Elesun.&quot;\n\n&lt;&lt;ctrlClick '&quot;Goodbye.&quot;' '1throne'&gt;&gt;</div><div tiddler="PassageDone" tags="nobr" created="201701171633" modifier="twee" twine-position="1270,150">&lt;&lt;if $gamestart is 1&gt;&gt;\n\t&lt;&lt;switch $chapter&gt;&gt;\n\t&lt;&lt;case 0&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Prologue&quot;&gt;&gt;\n\t&lt;&lt;case 1&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 1&quot;&gt;&gt;\n\t&lt;&lt;case 2&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 2&quot;&gt;&gt;\n\t&lt;&lt;case 3&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 3&quot;&gt;&gt;\n\t&lt;&lt;case 4&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 4&quot;&gt;&gt;\n\t&lt;&lt;case 5&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 5&quot;&gt;&gt;\n\t&lt;&lt;case 6&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 6&quot;&gt;&gt;\n\t&lt;&lt;case 7&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Chapter 7&quot;&gt;&gt;\n\t&lt;&lt;case 8&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;Holy Land: Epilogue&quot;&gt;&gt;\n\t&lt;&lt;default&gt;&gt;\n\t\t&lt;&lt;set document.title = &quot;+ Holy Land&quot;&gt;&gt;\n\t&lt;&lt;/switch&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set document.title = &quot;+ Holy Land&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="magic_trainer2" tags="menu" created="201612132224" modifier="twee">&lt;&lt;if $tpcost gt $tp&gt;&gt;Not enough TP.&lt;&lt;else&gt;&gt;\n\n&lt;&lt;if $choice is &quot;neut&quot;&gt;&gt;&lt;&lt;set $neutraltraining to $neutraltraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with neutral magic increased to &lt;&lt;print $neutraltraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;nat&quot;&gt;&gt;&lt;&lt;set $naturaltraining to $naturaltraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with natural magic increased to &lt;&lt;print $naturaltraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;lt&quot;&gt;&gt;&lt;&lt;set $lighttraining to $lighttraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with light magic increased to &lt;&lt;print $lighttraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;dk&quot;&gt;&gt;&lt;&lt;set $darktraining to $darktraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with dark magic increased to &lt;&lt;print $darktraining&gt;&gt;.&lt;&lt;elseif $choice is &quot;hell&quot;&gt;&gt;&lt;&lt;set $hellishtraining to $hellishtraining+1&gt;&gt;&lt;&lt;set $tp to $tp-$tpcost&gt;&gt;Skill with hellish magic increased to &lt;&lt;print $hellishtraining&gt;&gt;.&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n[[Back to training.|magic_trainer]]\n[[Quit training.|$exitpassage][$gamestart to 1]]</div><div tiddler="combatinfodock" tags="" created="201612172118" modifier="twee">&lt;span id=&quot;cominfo&quot;&gt;&lt;span id=&quot;playerstats&quot;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playerstatsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playerstats&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;\n&lt;span id=&quot;combatmessages&quot;&gt;&lt;&lt;display &quot;combat_report&quot;&gt;&gt;&lt;/span&gt;\n&lt;span id=&quot;combatactions&quot;&gt;&lt;&lt;if $mobile is 1&gt;&gt;&lt;&lt;display &quot;playeractionsMobile&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;display &quot;playeractions&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;\n&lt;/span&gt;</div><div tiddler="balanceObj" tags="init" created="201704242041" modifier="twee" twine-position="290,150">/%\n\n -&gt; &lt;&lt;display&gt;&gt;ed in StoryInit\n\n -&gt;use the balance object to make blanket balance adjustments to combat, transformation, and xp requirements/earnings\n\n -&gt; the base $bal object represents &quot;normal&quot; difficulty\n\n%/\n\n&lt;&lt;set setup.bal to {\n     pgrit : 1.0,\n  pstagger : 1.0,\n      patk : 1.0,\n      pdef : 1.0,\n      pmov : 1.0,\n      desp : 1.0,\n  critOdds : 1.0,\n  critical : 1.0,\n   ddgOdds : 1.0,\n  dispOdds : 1.0,\n     rageB : 1.0,\n     rageD : 1.0,\n     egrit : 1.0,\n      eatk : 1.0,\n      edef : 1.0,\n      emov : 1.0,\n  estagger : 1.0,\n   ebossSt : 1.5,\n    espell : 1.0,\n    xpEarn : 1.0,\n    xpNeed : 1.0,\n agression : 1\n  }&gt;&gt;\n\n/%\n\n -&gt; in engine example:\n&lt;&lt;set $atk to $atk * $bal.atk&gt;&gt;, etc\n\n -&gt; Properties Key:\n---------------------------------------\nPlayer (General)\n---------------------------------------\npgrit     -player grit\npatk      -player attack\npdef      -player defense\npmov      -player move\n---------------------------------------\nPlayer (Special)\n---------------------------------------\ndesp      -desperation attack damage\ncritOdds  -critical chance\ncritical  -critical damage\nddgOdds   -dodge chance\ndispOdds  -dispel chance\n---------------------------------------\nPlayer (Transformation)\n---------------------------------------\nrageB     -rage build-up\nrageD     -rage decay\n---------------------------------------\nEnemy\n---------------------------------------\negrit     -enemy grit\neatk      -enemy attack\nedef      -enemy defense\nemov      -enemy move\nespell    -enemy special damage\nagression -global enemy agression\n---------------------------------------\nGrowth\n---------------------------------------\nxpEarn    -XP earned from enemy kill\nxpNeed    -XP required for level up\n---------------------------------------\n%/</div><div tiddler="muter" tags="nobr" created="201704231516" modifier="twee">&lt;&lt;button &quot;Mute&quot;&gt;&gt;\n  &lt;&lt;if $audioswitch is 1&gt;&gt;\n    &lt;&lt;masteraudio mute&gt;&gt;\n    &lt;&lt;set $audioswitch to 0&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;masteraudio unmute&gt;&gt;\n    &lt;&lt;set $audioswitch to 1&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;/button&gt;&gt;</div><div tiddler="focus_ui" tags="" created="201702021700" modifier="twee">Focus grants small boosts to attack, defense, movement, and &lt;&lt;= setup.words.grit&gt;&gt; with no downsides.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="gswd_ui" tags="" created="201702020417" modifier="twee">A heavy two-handed sword.\n\nIdeal for unseating calvary, cleaving people in half, and crashing through an opponent's guard.  Less ideal for a measured approach.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|High|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|High|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Low|\n*__Finesse__: Low\n*__Stamina__: High</div><div tiddler="0levelupcheck2" tags="xpcheck" created="201701252214" modifier="twee">&lt;&lt;set $exitpassage to &quot;prol5&quot;&gt;&gt;&lt;&lt;set $storystage to 3&gt;&gt;&lt;&lt;xp&gt;&gt;</div><div tiddler="combat_call_0_4" tags="nobr comcall" created="201701140726" modifier="twee">&lt;&lt;combat &quot;rank4lvl4_knight_akatosh&quot; &quot;combat_intro_0_4&quot; &quot;combat_outro_0_4&quot;&gt;&gt;</div><div tiddler="combat_portrait" tags="" created="201701241125" modifier="twee">&lt;&lt;if $character is &quot;Elesun&quot;&gt;&gt;&lt;div id=&quot;comele&quot;&gt;&lt;div class=&quot;switch&quot;&gt;\n\n&lt;div class=&quot;comDisp&quot;&gt;&lt;center&gt;&lt;span id=&quot;comtext&quot;&gt;\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_weapon]]&gt;&gt;&lt;&lt;popup &quot;wpn_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $weaponname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_atk]]&gt;&gt;&lt;&lt;popup &quot;atk_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__ATK__:|&lt;&lt;print $atk&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_armor]]&gt;&gt;&lt;&lt;popup &quot;arm_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $armorname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_def]]&gt;&gt;&lt;&lt;popup &quot;def_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__DEF__:|&lt;&lt;print $def&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_spell]]&gt;&gt;&lt;&lt;popup &quot;spl_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $p_spellname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_mov]]&gt;&gt;&lt;&lt;popup &quot;mov_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__MOV__:|&lt;&lt;print $mov&gt;&gt;|\n&lt;&lt;if $SpEffEnd gt $round and $spEffDisplay neq &quot;&quot;&gt;&gt;''&lt;&lt;print $SpEffDisplay&gt;&gt;''\nRounds remaining: &lt;&lt;print $SpEffEnd-$round&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;&lt;/center&gt;&lt;/div&gt;\n\n&lt;/div&gt;&lt;/div&gt;&lt;&lt;else&gt;&gt;&lt;&lt;if $devilForm is 0&gt;&gt;&lt;div id=&quot;comrip&quot;&gt;&lt;&lt;if $rageCurrent gte 100 and $playerturn is 1&gt;&gt;&lt;span id=&quot;transformbutton&quot;&gt;&lt;center&gt;&lt;&lt;link &quot;''-TRANSFORM-''&quot;&gt;&gt;&lt;&lt;display &quot;rage_trans&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/center&gt;&lt;/span&gt;&lt;&lt;endif&gt;&gt;&lt;div class=&quot;switch&quot;&gt;\n\n&lt;div class=&quot;comDisp&quot;&gt;&lt;center&gt;&lt;span id=&quot;comtext&quot;&gt;\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_weapon]]&gt;&gt;&lt;&lt;popup &quot;wpn_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $weaponname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_atk]]&gt;&gt;&lt;&lt;popup &quot;atk_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__ATK__:|&lt;&lt;print $atk&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_armor]]&gt;&gt;&lt;&lt;popup &quot;arm_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $armorname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_def]]&gt;&gt;&lt;&lt;popup &quot;def_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__DEF__:|&lt;&lt;print $def&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_spell]]&gt;&gt;&lt;&lt;popup &quot;spl_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $p_spellname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_mov]]&gt;&gt;&lt;&lt;popup &quot;mov_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__MOV__:|&lt;&lt;print $mov&gt;&gt;|\n&lt;&lt;if $SpEffEnd gt $round and $spEffDisplay neq &quot;&quot;&gt;&gt;''&lt;&lt;print $SpEffDisplay&gt;&gt;''\nRounds remaining: &lt;&lt;print $SpEffEnd-$round&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;&lt;/center&gt;&lt;/div&gt;\n\n&lt;/div&gt;&lt;/div&gt;&lt;&lt;elseif $devilForm is 1 and $formUnlock is 1&gt;&gt;&lt;div id=&quot;comripDvl&quot;&gt;&lt;div class=&quot;switch&quot;&gt;\n\n&lt;div class=&quot;comDisp&quot;&gt;&lt;center&gt;&lt;span id=&quot;comtext&quot;&gt;\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_weapon]]&gt;&gt;&lt;&lt;popup &quot;wpn_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $weaponname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_atk]]&gt;&gt;&lt;&lt;popup &quot;atk_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__ATK__:|&lt;&lt;print $atk&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_armor]]&gt;&gt;&lt;&lt;popup &quot;arm_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $armorname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_def]]&gt;&gt;&lt;&lt;popup &quot;def_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__DEF__:|&lt;&lt;print $def&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_spell]]&gt;&gt;&lt;&lt;popup &quot;spl_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $p_spellname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_mov]]&gt;&gt;&lt;&lt;popup &quot;mov_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__MOV__:|&lt;&lt;print $mov&gt;&gt;|\n&lt;&lt;if $SpEffEnd gt $round and $spEffDisplay neq &quot;&quot;&gt;&gt;''&lt;&lt;print $SpEffDisplay&gt;&gt;''\nRounds remaining: &lt;&lt;print $SpEffEnd-$round&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;&lt;/center&gt;&lt;/div&gt;\n\n&lt;/div&gt;&lt;/div&gt;&lt;&lt;elseif $devilForm is 1 and $formUnlock is 2&gt;&gt;&lt;div id=&quot;comripFnl&quot;&gt;&lt;div class=&quot;switch&quot;&gt;\n\n&lt;div class=&quot;comDisp&quot;&gt;&lt;center&gt;&lt;span id=&quot;comtext&quot;&gt;\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_weapon]]&gt;&gt;&lt;&lt;popup &quot;wpn_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $weaponname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_atk]]&gt;&gt;&lt;&lt;popup &quot;atk_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__ATK__:|&lt;&lt;print $atk&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_armor]]&gt;&gt;&lt;&lt;popup &quot;arm_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $armorname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_def]]&gt;&gt;&lt;&lt;popup &quot;def_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__DEF__:|&lt;&lt;print $def&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_spell]]&gt;&gt;&lt;&lt;popup &quot;spl_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;print $p_spellname&gt;&gt;|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_mov]]&gt;&gt;&lt;&lt;popup &quot;mov_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|__MOV__:|&lt;&lt;print $mov&gt;&gt;|\n&lt;&lt;if $SpEffEnd gt $round and $spEffDisplay neq &quot;&quot;&gt;&gt;''&lt;&lt;print $SpEffDisplay&gt;&gt;''\nRounds remaining: &lt;&lt;print $SpEffEnd-$round&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;/span&gt;&lt;/center&gt;&lt;/div&gt;\n\n&lt;/div&gt;&lt;/div&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="combat_call_0_1" tags="nobr comcall" created="201701070324" modifier="twee">&lt;&lt;combat &quot;rank3lvl5_soldier_akatosh&quot; &quot;combat_intro_0_1&quot; &quot;combat_outro_0_1&quot;&gt;&gt;</div><div tiddler="combat_call_0_2" tags="nobr comcall" created="201701110818" modifier="twee">&lt;&lt;combat &quot;rank3lvl3_assassin&quot; &quot;combat_intro_0_2&quot; &quot;combat_outro_0_2&quot;&gt;&gt;</div><div tiddler="combat_call_0_3" tags="nobr comcall" created="201701242342" modifier="twee">&lt;&lt;combat &quot;rank5lvl3_witch&quot; &quot;combat_intro_0_3&quot; &quot;combat_outro_0_3&quot;&gt;&gt;</div><div tiddler="dispel_ui" tags="" created="201702021657" modifier="twee">Dispel gives a massive boost to your chance to dispel enemy magic and a small boost to dodge chance.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="combat_intro_1_1" tags="comcall" created="201708281939" modifier="twee">You’re about to fight &lt;&lt;print $enemyname&gt;&gt;.</div><div tiddler="hooks" tags="script" created="201707091828" modifier="twee" twine-position="10,990">postdisplay['combat-ui'] = function (t) {\n\tif ( $('#ui-dialog').hasClass('tutDlg') &amp;&amp;\n\t\t!tags().includes('combat') ) {\n\t\t$('#ui-dialog').removeClass('tutDlg');\n\t}\n\tif ( tags().includes('combat') ) {\n\t\t$('#ui-dialog').addClass('tutDlg');\n\t}\n};\n\n// hookset.js, HLE, chapel\n\n// create namespace\nState.variables.hook = {};\nsetup.hook = {};\nsetup.hook.prot = {};\n\n// list of all hooks\nsetup.hook.list = [\n\t'onCrit', \n\t'onDodge', \n\t'onFirstAtk', \n\t'onEachAtk', \n\t'onHeartDam', \n\t'onGritDam',\n\t'onMov',\n\t'onDef',\n\t'onDespAtk',\n\t'onDispel',\n\t'onNMEatk',\n\t'onNMEspell',\n\t'onRegen',\n\t'onHeal',\n\t'onFightEnd',\n\t'onTransform',\n\t'onRevert',\n\t'onNMEheartDam',\n\t'onNMEgritDam'\n];\n\n// initialize all hooks\n(function () {\n\tvar task = State.variables.hook,\n\t\tlist = setup.hook.list,\n\t\thook,\n\t\ti;\n\t\n\tfor (i = 0; i &lt; list.length; i++) {\n\t\thook = list[i];\n\t\tState.variables.hook[hook] = [];\n\t}\n\t\n}());\n\nsetup.hook.add = function (hookName, passage) {\n\t// create new hook functionality\n\tvar task = State.variables.hook;\n\t\n\tif (typeof task[hookName] == 'undefined') {\n\t\t\ttask[hookName] = [];\n\t}\n\n\tif ( !passage || !Story.has(passage) ) {\n\t\tnew TypeError ('invalid args in setup.hook.add() ' +\n\t\t'function or hook macro');\n\t}\n  \n\t// push TwineScript into hook array\n\tvar obj = Story.get(passage).title;\n\tvar txt = Story.get(passage).text;\n\tsetup.hook.prot[obj] = {\n\t\ttitle: obj,\n\t\ttext:  txt\n\t}; \n\ttask[hookName].push(clone(setup.hook.prot[obj]));\n\tsetup.hook.prot = {};\n};\n\nsetup.hook.fire = function (hookName) {\n\t// fire hooks code silently\n\tvar task = State.variables.hook;\n\tvar code = '';\n\t\n\tif (task[hookName] != null &amp;&amp; task[hookName].length !== 0) {\n\t\ttask[hookName].forEach( function (hook) {\n\t\t\tcode = code + ' \sn\sn ' + hook.text;\n\t\t});\n\t\tnew Wikifier (null, code);\n\t}\n};\n\nsetup.hook.log = function (hookName) {\n\t// log hook's array of code to the console\n\tvar task = State.variables.hook;\n\t\n\tif (task[hookName] != null) {\n\t\tconsole.log(task[hookName]);\n\t}\n};\n\nsetup.hook.strip = function (hookName) {\n\t// delete/initialize hook code\n\tvar task = State.variables.hook;\n\t\n\ttask[hookName] = [];\n};\n\nsetup.hook.del = function (hookName, passage) {\n\tvar task = State.variables.hook;\n\tvar i, hook;\n\t\n\tfor (i = 0; i &lt; task[hookName].length; i++) {\n\t\thook = task[hookName][i];\n\t\tif (hook.title === passage) {\n\t\t\ttask[hookName].deleteAt(i);\n\t\t}\n\t}\n};\n\n// hookset add macros, keyword 'strip' to gut hooks\n// hookset list as macro names and args for function\nMacro.add(setup.hook.list, {\n\thandler: function () {\n\t\t\n\t\tvar psg;\n\t\t\n\t\tif (!this.args[0] || typeof this.args[0] != 'string') {\n\t\t\treturn this.error('invalid args');\n\t\t} else {\n\t\t\tpsg = this.args[0].trim();\n\t\t}\n\t\t\n\t\tif (psg !== 'strip' &amp;&amp; psg !== 'init')\t{\t\n\t\t\tsetup.hook.add(this.name, psg);\n\t\t} else {\n\t\t\tsetup.hook.strip(this.name);\n\t\t}\n\t\t\n\t}\n});\n\n// payload: fire hooks on events as an array of TwineScript code\nMacro.add('payload', {\n\thandler: function () {\n\n\t\tvar hook;\n\t\t\n\t\tif (this.args.length !== 1 || typeof this.args[0] != 'string') {\n\t\t\treturn this.error('incorrect args');\n\t\t} else {\n\t\t\thook = this.args[0].trim();\n\t\t}\n\t\t\n\t\tsetup.hook.fire(hook);\n\n\t}\n\t\n});\n\nMacro.add('deleteHook', {\n\thandler: function () {\n\t\tvar hookN, psg;\n\n\t\t/*if (this.args.length !== 2 || \n\t\t\ttypeof this.arg[0] != 'string' || \n\t\t\ttypeof this.arg[1] != 'string') {\n\t\t\treturn this.error('incorrect args');\n\t\t}*/\n\t\thookN = this.args[0].trim();\n\t\tpsg   = this.args[1].trim();\n\t\tsetup.hook.del(hookN, psg);\n\t\t\n\t}\n});</div><div tiddler="burned_help" tags="dock" created="201701250217" modifier="twee">Explosion of fire sets the area around &lt;&lt;print $character&gt;&gt; alight, burning her and creating smoke for a time.\n\nMild penalties to defense and damage.  Attacks cost more Stamina until the smoke clears.</div><div tiddler="rabbleRouser" tags="nobr" created="201702091624" modifier="twee">&lt;&lt;if $rageCurrent lt 5&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-1'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 10&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-5'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 15&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-10'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 20&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-15'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 25&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-20'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 30&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-25'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 35&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-30'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 40&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-35'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 45&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-40'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 50&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-45'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 55&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-50'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 60&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-55'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 65&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-60'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 70&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-65'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 75&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-70'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 80&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-75'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 85&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-80'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 90&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-85'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 95&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-90'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 100&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-95'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 102&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage0-100'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 105&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-1'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 110&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-5'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 115&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-10'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 120&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-15'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 125&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-20'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 130&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-25'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 135&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-30'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 140&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-35'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 145&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-40'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 150&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-45'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 155&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-50'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 160&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-55'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 165&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-60'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 170&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-65'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 175&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-70'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 180&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-75'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 185&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-70'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 190&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-85'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 195&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-90'])&gt;&gt;\n&lt;&lt;elseif $rageCurrent lt 200&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-95'])&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $rageDisplay to clone(setup.ui.rage['rage1-100'])&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="journalmenu" tags="menu" created="201612122026" modifier="twee">&lt;&lt;set $gamestart to 2&gt;&gt;\s\n&lt;h1&gt;&lt;&lt;print &quot;\su270E&quot;&gt;&gt; Journal&lt;/h1&gt;\n&lt;&lt;if $chapter is 0&gt;&gt;&lt;&lt;display &quot;prologuejournal&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;if $chapter is 1&gt;&gt;&lt;&lt;display &quot;ch1journal&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;vowbox&gt;&gt;\n\n@@#journal-menu-buttons;&lt;&lt;button [[View the Codex|codex_menu]]&gt;&gt;&lt;&lt;/button&gt;&gt;\n\n&lt;&lt;button [[View the Help Menu|helpmenu]]&gt;&gt;&lt;&lt;/button&gt;&gt;@@\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;\n\nTime: &lt;&lt;playtime&gt;&gt;</div><div tiddler="1baileySiege" tags="dock" created="201702121100" modifier="twee">Sometimes, all's well that ends well.  Sometimes not.\n\nRegardless, the defense of the castle was a success, and a costly one.  Elesun doesn't want to dwell on it, though.  At the end of the day, the Child of Promise and the King were both safe, and that was enough.</div><div tiddler="browserSupport" tags="" created="201702281002" modifier="twee" twine-position="1550,290">//Holy Land// will run fine on most modern browsers, including most versions of:\n*Google Chrome (and Chromium)\n*Mozilla Firefox\n*Microsoft Edge\n*Apple Safari\n\nLimited support (some visual issues may occur, but nothing game-breaking) is available for:\n*Opera\n*Internet Explorer 9 and 10\n*Mobile browsers of any kind.\n\n//Holy Land// explicitly does not support:\n*Internet Explorer 8 or earlier.\n*Very old/outdated browsers and browser versions.\n\nTo get the most out of //Holy Land//, adjust the following browser settings (the default settings of most browsers should already be fine):\n*Allow local data/cache/cookies.\n*Allow images, sound, and other media/HTML5 features.\n*Allow JavaScript.\n*Allow handlers/handler protocols.\n\nNote:  //Holy Land// may require some load time on start-up.  If load time seems excessive:\n*Try updating your browser.\n*Try a different browser and see if the problem persists.\n*Confirm that caching and cookies are fully enabled.\n*Download the application version.</div><div tiddler="0choice1pacifism" tags="dock" created="201701140608" modifier="twee">The soldier on the floor is unconscious, but alive.\n\nRipley, as a druid, believes that all life is sacred, and that human lives are irreplaceable.  Though she never actually took her druidic vows, she does her damnedest not to kill.  Kid’s got a real talent for maiming, though.</div><div tiddler="Focus" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;focus_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;focs&quot;]]\n[[No|spellswap]]</div><div tiddler="1mainWitch" tags="dock" created="201707110037" modifier="twee">Probably that witch Elesun had fought--her magic softened stone.  Hopefully not too soft...</div><div tiddler="statupdater" tags="nobr" created="201612131159" modifier="twee">&lt;&lt;set $statbase to setup.base + Math.trunc($rageCurrent/4)&gt;&gt;\n&lt;&lt;if $formUnlock is 2&gt;&gt;\n\t&lt;&lt;if $statbase gte 100&gt;&gt;\n\t\t&lt;&lt;set $statbase to 100&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;if $statbase gte 80&gt;&gt;\n\t\t&lt;&lt;set $statbase to 80&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $strval to ($statbase*($strrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $agival to ($statbase*($agirank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $endval to ($statbase*($endrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $wilval to ($statbase*($wilrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $cngval to ($statbase*($cngrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n\n&lt;&lt;set $atkbase to Math.trunc($strval*0.5+$cngval*0.2)&gt;&gt;\n&lt;&lt;set $atk to Math.trunc($atkbase*$watk*$aatk*$satk*$modeatk)&gt;&gt;\n&lt;&lt;set $defbase to Math.trunc($endval*0.5+$strval*0.2)&gt;&gt;\n&lt;&lt;set $def to Math.trunc($defbase*$wdef*$adef*$sdef)&gt;&gt;\n&lt;&lt;set $movbase to Math.trunc($agival*0.5+$cngval*0.2)&gt;&gt;\n&lt;&lt;set $mov to Math.trunc($movbase*$wmov*$amov*$smov)&gt;&gt;\n\n&lt;&lt;set $critchance to Math.trunc(($agival/10+$cngrank)+$spellcrit)&gt;&gt;\n&lt;&lt;set $critmult to $agival/100+1&gt;&gt;\n&lt;&lt;set $critdam to Math.trunc($atk*$critmult*$spellcritdam)&gt;&gt;\n&lt;&lt;set $dodge to Math.trunc(((5+$agirank*2.5)+$cngrank)+$spelldodge)&gt;&gt;\n\n&lt;&lt;set $maxsta to Math.trunc($endval/10+$wilrank+8)&gt;&gt;\n&lt;&lt;set $sta to $maxsta&gt;&gt;\n&lt;&lt;set $maxgrit to 100+$endval+$spellgrit&gt;&gt;\n&lt;&lt;set $grit to $maxgrit&gt;&gt;\n&lt;&lt;set $maxhealth to Math.trunc(3+$scars/5)&gt;&gt;\n&lt;&lt;if $maxhealth gt 6&gt;&gt;&lt;&lt;set $maxhealth to 6&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $bangles eq 1&gt;&gt;&lt;&lt;set $regenmult to 1.2&gt;&gt;&lt;&lt;set $basedispel to 10&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $dispel to $basedispel+$spelldispel+$wilrank&gt;&gt;\n\n&lt;&lt;set $power to $lvl*$statbase+(($maxhealth*$maxhealth*$maxhealth)+$maxhealth*7)+$lvl+1&gt;&gt;\n&lt;&lt;set $regen to Math.trunc($wilrank/2)&gt;&gt;\n\n&lt;&lt;set $rageBuild to $wilrank + 9&gt;&gt;\n&lt;&lt;set $rageDecay to 20 - $endrank&gt;&gt;\n\n&lt;&lt;display &quot;bal-adjust&quot;&gt;&gt;</div><div tiddler="keyboard shortcuts" tags="annotation" created="201702100359" modifier="twee" twine-position="1550,430">Exploration:\nE = equipment\nC/shift Space = character\nA = armor\nS = spells\nW = weapons\nJ/Tab = journal\nX/shift S = settings\nZ/shift Tab = codex\nH = help\nM = mute\nF = fullscreen\nD = dismiss pop-up\n\nMenus:\nQ/Esc = return to game from menu\n\nCombat:\n1 = Attack\n2 = Defend\n3 = Move\n4 = End Turn\nSpace = Continue\nSpace = Transform\n\nDev:\nshift ~ = debug tools</div><div tiddler="poss_ui" tags="" created="201702021715" modifier="twee">Possessed gives a massive increase to attack and critical attack damage, but at a significant cost to grit, defense, and movement.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_down]]|//Large//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_down]]|//Large//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_down]]|//Moderate//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="1RipCross" tags="scene" created="201701282006" modifier="twee"></div><div tiddler="0wall3Rip" tags="dock" created="201701250432" modifier="twee">&lt;&lt;if $choice2 is 0&gt;&gt;Maybe you should say something to her.\n\n&lt;&lt;ctrlClick &quot;Comfort Ripley.&quot; &quot;0choice2&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&quot;I'm with you,&quot; Ripley says.&lt;&lt;endif&gt;&gt;</div><div tiddler="scarsinfo" tags="" created="201612151720" modifier="twee">\nTaking health damage in combat has a chance to give &lt;&lt;print $character&gt;&gt; a scar.  Gaining a certain number of scars increases her maximum health by one point permanently.\n\n</div><div tiddler="0mainhall1" tags="space" created="201701250544" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;The &lt;&lt;weak &quot;main hall&quot; &quot;0mainhall1inspect&quot;&gt;&gt;.  While &lt;&lt;dock &quot;Ripley&quot; &quot;0mainhall1Rip&quot;&gt;&gt; and Elesun were &lt;&lt;weak &quot;alone here&quot; &quot;0mainhall1alone&quot;&gt;&gt;, it went unused; they never entertained anyone, and had no use of the &lt;&lt;action &quot;throne room&quot; &quot;0mainhall1throne&quot;&gt;&gt;.\n\nThe king arrived &lt;&lt;weak &quot;last month&quot; &quot;0mainhall1lastmo&quot;&gt;&gt; with an entourage--Folsom and his other advisors--and plans to move the whole court here.  &lt;span id=&quot;gone&quot;&gt;&lt;&lt;weak &quot;Prince Harlaus&quot; &quot;0mainhall1Harl&quot;&gt;&gt;&lt;/span&gt; was to arrive in the coming weeks.  Thank God he wasn't here yet.\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="0protectking2Rip" tags="dock" created="201701260031" modifier="twee">&lt;&lt;if $process lte 3&gt;&gt;&lt;&lt;set $process++&gt;&gt;&lt;&lt;endif&gt;&gt;Ripley has her hand on Irelith's shoulder, and tears are streaming down her cheeks--likely as much for concern for Irelith as sadness for the dead all around them.  &quot;She needs a healer,&quot; Ripley says.\n\n&quot;I know,&quot; the king says.  &quot;She'll be fine, we'll get her help soon.&quot;</div><div tiddler="spear" tags="nobr" created="201612131445" modifier="twee">&lt;&lt;set $weaponname to &quot;Spear&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;spr_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.0&gt;&gt;\n&lt;&lt;set $wdef to 1.3&gt;&gt;\n&lt;&lt;set $wmov to 0.8&gt;&gt;\n&lt;&lt;set $critrange to 100&gt;&gt;\n\n&lt;&lt;set $wStaUse to 6&gt;&gt;\n\n&lt;&lt;if $speartraining is 1&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n&lt;&lt;elseif $speartraining is 2&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n\t&lt;&lt;set $watk to 1.1&gt;&gt;\n&lt;&lt;elseif $speartraining is 3&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n\t&lt;&lt;set $watk to 1.1&gt;&gt;\n\t&lt;&lt;set $wdef to 1.4&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="finalforminfo" tags="" created="201702081037" modifier="twee">\nRipley has trained endlessly to master magic, combat, and herself.  Finally, that training pays off.  Fully in control of her rage, Ripley has perfected the devil form, and the upper limit of the bonuses provided by transforming are removed.  Ripley must have at least 100% rage to transform.\n\n</div><div tiddler="KingChat1" tags="chitchat" created="201707110030" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set _KingChat1 to either(\n&quot;Make sure to see Harlaud if you haven't yet&quot;, \n&quot;These are trying times, Elesun.  Be careful.&quot;,\n&quot;We've got to deal with Aesil soon.  He'll be the death of us all.&quot;,\n&quot;Ripley needs a break from all this madness and death.&quot;,\n&quot;It is good to see you again, Elesun.  Ripley has really grown stronger these last few months.  You've done very well.&quot;\n)&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;&lt;&lt;print '&quot;' + _KingChat1 + '&quot;'&gt;&gt;</div><div tiddler="ch1-6" tags="scene save" created="201701282005" modifier="twee"></div><div tiddler="rage_trans" tags="nobr" created="201702080730" modifier="twee">&lt;&lt;set $devilForm to 1&gt;&gt;\n\n&lt;&lt;payload 'onTransform'&gt;&gt;\n\n&lt;&lt;display &quot;transform_updater&quot;&gt;&gt;\n&lt;&lt;replace &quot;#tray&quot;&gt;&gt;\n\t&lt;&lt;display &quot;combat_portrait&quot;&gt;&gt;\n&lt;&lt;/replace&gt;&gt;\n\n&lt;&lt;set $rager to either(1,2,3,4,5,6,7,8,9,10)&gt;&gt;\n&lt;&lt;switch $rager&gt;&gt;\n&lt;&lt;case 1&gt;&gt;\n\t&lt;&lt;audio &quot;rage&quot; play&gt;&gt;\n&lt;&lt;case 2&gt;&gt;\n\t&lt;&lt;audio &quot;rage2&quot; play&gt;&gt;\n&lt;&lt;case 3&gt;&gt;\n\t&lt;&lt;audio &quot;rage3&quot; play&gt;&gt;\n&lt;&lt;case 4&gt;&gt;\n\t&lt;&lt;audio &quot;rage4&quot; play&gt;&gt;\n&lt;&lt;case 5&gt;&gt;\n\t&lt;&lt;audio &quot;rage5&quot; play&gt;&gt;\n&lt;&lt;case 6&gt;&gt;\n\t&lt;&lt;audio &quot;rage6&quot; play&gt;&gt;\n&lt;&lt;case 7&gt;&gt;\n\t&lt;&lt;audio &quot;rage7&quot; play&gt;&gt;\n&lt;&lt;case 8&gt;&gt;\n\t&lt;&lt;audio &quot;rage8&quot; play&gt;&gt;\n&lt;&lt;case 9&gt;&gt;\n\t&lt;&lt;audio &quot;rage9&quot; play&gt;&gt;\n&lt;&lt;case 10&gt;&gt;\n\t&lt;&lt;audio &quot;rage10&quot; play&gt;&gt;\n&lt;&lt;default&gt;&gt;\n\t&lt;&lt;audio &quot;rage&quot; play&gt;&gt;\n&lt;&lt;/switch&gt;&gt;\n&lt;&lt;if $characterHide is 0&gt;&gt;\n&lt;&lt;dialog '...'&gt;&gt;\s\n\n\tRipley is losing control!\n\n\tRipley transforms!\n\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;else&gt;&gt;\n&lt;&lt;dialog '...'&gt;&gt;\n\n\tSomething's happening!\n\n&lt;&lt;/dialgo&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;comUpdate&gt;&gt;\n\n</div><div tiddler="1dcHorse" tags="dock" created="201708282019" modifier="twee">Unfortunately, this horse isn't one of the strong ones from the royal stables; they sacrificed speed for blending in, after all. It'll do, though.\n\n&lt;&lt;ctrlClick 'Get on the horse and ride.' 'ch1-3'&gt;&gt;</div><div tiddler="1ripqRocks" tags="dock" created="201708232057" modifier="twee">Ripley started collecting rocks a few years ago.  The soldiers and courtiers always got a kick out of giving her some strange or pretty rocks they found.  &lt;&lt;if $stoneOne.have is 1&gt;&gt;Elesun found a pretty neat looking rock earlier...&lt;&lt;endif&gt;&gt;</div><div tiddler="critmaker" tags="nobr" created="201612160713" modifier="twee">&lt;&lt;set $critcheck to random(1, $critrange)&gt;&gt;\n&lt;&lt;if $critcheck lte $critchance&gt;&gt;\n\t&lt;&lt;if $devilForm is 0&gt;&gt;\n\t\t&lt;&lt;set $damagetoNME to $critdam&gt;&gt;\n\t\t&lt;&lt;payload 'onCrit'&gt;&gt;\n\t\t&lt;&lt;if $formUnlock gte 1&gt;&gt;\n\t\t&lt;&lt;set $rage to Math.trunc($rageBuild*0.5)&gt;&gt;\n\t\t&lt;&lt;set $rageCurrent to $rageCurrent + $rage&gt;&gt;\n\t\t\t&lt;&lt;if $rageCurrent gt 200&gt;&gt;\n\t\t\t\t&lt;&lt;set $rageCurrent to 200&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;set $crityes to 1&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1Map1Rip" tags="dock map" created="201702180659" modifier="twee">Head north to Ripley's quarters?\n\n&lt;&lt;ctrlClick &quot;Go to Ripley's quarters.&quot; &quot;1RipQuarters&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="onlineguide" tags="menu" created="201701120740" modifier="twee">&lt;iframe src=&quot;https://drive.google.com/file/d/0BwajEyPGkn0yX1RKdEhLajA2ZDA/preview&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;&lt;/iframe&gt;\n\n[[Back|helpmenu]]</div><div tiddler="0throneroomInspect" tags="dock" created="201701260222" modifier="twee">Elesun isn't sure what they're going to do about the wall.  Or the corpses.\n\nShe frowns.  This day hasn't been great.</div><div tiddler="0cygate" tags="dock" created="201701070315" modifier="twee">&lt;&lt;if $courtyardgate is 0&gt;&gt;Elesun steps up to the gate.  It's shut.\n\nShe suspects that the lever that controls the gate is nearby.&lt;&lt;else&gt;&gt;The gate is open now.\n\n&lt;&lt;ctrlClick &quot;Go through the gate.&quot; &quot;prol2&quot; &quot;leave&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="map styles" tags="stylesheet" created="201705180338" modifier="twee" twine-position="150,570">#map-descr {\n\tdisplay: block;\n\tposition: relative;\n\twidth: 100%;\n\tbottom: 0; top: 0; left: 0; right: 0;\n\tbackground-color: #fff;\n\theight: 1em;\n\tcolor: #000;\n\tfont-weight: bold;\n}\n\n#map-descr.ele::after {\n\tpadding: 2em 3em;\n\tcontent: &quot;Elesun's Quarters&quot;;\n}\n#map-descr.rip::after {\n\tpadding: 2em 3em;\n\tcontent: &quot;Ripley's Quarters&quot;;\n}\n#map-descr.srv::after {\n\tpadding: 2em 3em;\n\tcontent: &quot;Servants' Quarters&quot;;\n}\n#map-descr.bly::after {\n\tpadding: 2em 3em;\n\tcontent: &quot;The Bailey&quot;;\n}\n#map-descr.mhl::after {\n\tpadding: 2em 3em;\n\tcontent: &quot;The Main Hall&quot;;\n}</div><div tiddler="infobox" tags="" created="201612151535" modifier="twee" twine-position="570,710">&lt;span id=&quot;info&quot;&gt;&lt;center&gt;&lt;&lt;if $gamestart is 1&gt;&gt;&lt;&lt;closeup&gt;&gt;&lt;&lt;else&gt;&gt;Information&lt;&lt;endif&gt;&gt;&lt;/center&gt;&lt;/span&gt;</div><div tiddler="1EleDies" tags="scene" created="201701282008" modifier="twee"></div><div tiddler="shad_ui" tags="" created="201702021717" modifier="twee">Shadow Veil dramatically increases both dodge and dispel chances, but at the cost of small penalties to &lt;&lt;= setup.words.grit&gt;&gt;, attack, and defense.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_down]]|//Moderate//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_down]]|//Moderate//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_up]]|//Moderate//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_down]]|//Slight//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="publishing" tags="annotation" created="201701172319" modifier="twee" twine-position="990,290">To web (devbuild): save to Documents/GitHub/hlproto/index.html\n\t-set variables:\n\t\t$webversion: 1\n\t\t$release: 0\n\t\t$debug: 0\n\nTo web (published): save to Documents/GitHub/holy-land/index.html\n\t-set variables:\n\t\t$webversion: 1\n\t\t$release: 1\n\t\t$debug: 0\n\nTo executable: save to nodebob-master/apps/index.html\n\t-set variables:\n\t\t$webversion: 0\n\t\t$release: 1\n\t\t$debug: 0\n\n</div><div tiddler="Untitled Annotation 1" tags="annotation" created="201612132353" modifier="twee">About 16 unique allies.</div><div tiddler="0cydoor" tags="dock" created="201701070316" modifier="twee">Elesun steps up to the door.  It's open.\n\n&lt;&lt;ctrlClick &quot;Go through the door.&quot; &quot;0insidethewall&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="vow-list-broken" tags="" created="201710230747" modifier="twee" twine-position="850,1130">&lt;&lt;if $vows.broken.length lte 0&gt;&gt;\s\n\tNo broken vows.\s\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;for _i to 0; _i lt $vows.broken.length; _i++&gt;&gt;\s\n\t\t&lt;&lt;set _v to $vows.broken[_i]&gt;&gt;\s\n\t\t&lt;&lt;capture _v&gt;&gt;\s\n\t\t\t&lt;&lt;link setup.vows.list[_v].title&gt;&gt;\n\t\t\t\t&lt;&lt;dialog `'Vow: ' + setup.vows.list[_v].title` 'vow'&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;- setup.vows.list[_v].descr&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;if setup.vows.list[_v].outc&gt;&gt;\n\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;&lt;- setup.vows.list[_v].outc&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\s\n\t\t\t\t&lt;&lt;/dialog&gt;&gt;\n\t\t\t&lt;&lt;/link&gt;&gt;\n\t\t&lt;&lt;/capture&gt;&gt;\s\n\t&lt;&lt;/for&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="helpNMEspells" tags="help" created="201701252112" modifier="twee">Some enemies can use unbound magic to cast powerful spells that have a variety of effects.  Some spells simply deal damage, usually in large amounts.  Some spells can heal the caster, giving the enemy a large boost to grit regen at the end of the round.  Still other spells inflict temporary status effects.  You can review the status effects and their associated penalties on &lt;&lt;name&gt;&gt;'s abilities from the ''help menu'' in the ''journal''.\n\nMagic is deadly, but &lt;&lt;name&gt;&gt; has a chance to dispel every spell casted by her enemies.  \n\nWhile &lt;&lt;name&gt;&gt; is herself incapable of casting unbound spells, she can equip bound spells that work like charms and enhance her abilities passively.  You may want to try equipping the ''Dispel'' spell in the ''Equipment'' menu to make the upcoming fight easier.</div><div tiddler="gritinfo" tags="" created="201612151718" modifier="twee">\nGrit represents &lt;&lt;print $character&gt;&gt;'s ability to avoid a deadly hit in combat--a combination of luck, skill, and experience.  When her grit runs out, she takes a point of health damage, which represents an actual injury.  Grit is restored after losing a health point and after every battle.  Grit is represented by a bar--that changes color from green to yellow to red--on the combat screen.\n\n</div><div tiddler="spell_vigor" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Vital&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Natural&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Vital&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;vigr_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 50&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 5&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $naturaltraining is 1&gt;&gt;\n\t&lt;&lt;set $spellgrit to 55&gt;&gt;\n&lt;&lt;elseif $naturaltraining is 2&gt;&gt;\n\t&lt;&lt;set $spellregen to 10&gt;&gt;\n\t&lt;&lt;set $spellgrit to 55&gt;&gt;\n&lt;&lt;elseif $naturaltraining is 3&gt;&gt;\n\t&lt;&lt;set $spellgrit to 60&gt;&gt;\n\t&lt;&lt;set $spellregen to 10&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="strinfo" tags="" created="201612151656" modifier="twee">\nA measure of raw physical power.  Strength greatly influences attack, and to a lesser extent defense.\n\n</div><div tiddler="TheDreadQueen-7-2" tags="" created="201707262300" modifier="twee"></div><div tiddler="miles_stats" tags="nobr" created="201612132347" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="IrelithChat1" tags="chitchat" created="201702120819" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set _IreChat1 to either(&quot;Ripley's rock collection is coming on nicely.  I found a few more for her.&quot;, &quot;I should've said this earlier, Ele, but you did well during the siege.  Good work. I know, I know.  Just doing your job right?&quot;, &quot;How are you?  You look tired.  Go take a rest in your quarters.&quot;, &quot;Harlaus was asking after you.  Go see him.&quot;, &quot;Ripley's been desperate to go visit the druid grove.  I bet you could persuade the King to let you take her.  It'd be good to get her out of here for a while...&quot;, &quot;Got a nasty scar from that scuffle in the throne room.  I'm not back at one-hundred percent yet, but hey, 'that which doesn't kill you,' right?&quot;, &quot;It was pretty awesome how Folsom handled Aesil.  He's the only one who can hold that bastard off.&quot;, &quot;I'm buying tonight, if you're in.  We both need to unwind.&quot;)&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;&lt;&lt;print '&quot;' + _IreChat1 + '&quot;'&gt;&gt;</div><div tiddler="quDone" tags="menu" created="201704221812" modifier="twee">&lt;&lt;print $sqDone.join(&quot;\sn&quot;)&gt;&gt;</div><div tiddler="Aesil-hook-pull" tags="boss hook" created="201707261429" modifier="twee">&lt;&lt;deleteHook 'onNMEgritDam' 'Aesil_phase'&gt;&gt;\n&lt;&lt;deleteHook 'onDespAtk' 'Aesil_phase'&gt;&gt;\n&lt;&lt;deleteHook 'onEachAtk' 'Aesil_phase'&gt;&gt;\n&lt;&lt;deleteHook 'onNMEgritDam' 'Aesil_phase'&gt;&gt;</div><div tiddler="ch1-jump" tags="test menu" created="201705030336" modifier="twee" twine-position="2250,710">Choices:\n&lt;&lt;set $gswordhave to 1&gt;&gt;\nHave greatsword: &lt;span class=&quot;help&quot; id=&quot;p-1&quot;&gt;YES&lt;/span&gt; \s\n&lt;&lt;button &quot;Toggle Choice&quot;&gt;&gt;\n  &lt;&lt;if $gswordhave is 1&gt;&gt;\n    &lt;&lt;set $gswordhave to 0&gt;&gt;\n    &lt;&lt;replace &quot;#p-1&quot;&gt;&gt;\s\n      NO \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;set $gswordhave to 1&gt;&gt;\n    &lt;&lt;replace &quot;#p-1&quot;&gt;&gt;\s\n      YES \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;/button&gt;&gt;\n&lt;&lt;set $ripFight to 1, _ripscar1 to 1, _riptp1 to 0&gt;&gt;\nLet Rip fight assassin: &lt;span class=&quot;help&quot; id=&quot;p-2&quot;&gt;YES&lt;/span&gt; \s\n&lt;&lt;button &quot;Toggle Choice&quot;&gt;&gt;\n  &lt;&lt;if $ripFight is 1&gt;&gt;\n    &lt;&lt;set $ripFight to 0, _ripscar1 to 0, _riptp1 to 1&gt;&gt;\n    &lt;&lt;replace &quot;#p-2&quot;&gt;&gt;\s\n      NO \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;set $ripFight to 1, _ripscar1 to 1, _riptp1 to 0&gt;&gt;\n    &lt;&lt;replace &quot;#p-2&quot;&gt;&gt;\s\n      YES \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;/button&gt;&gt;\n&lt;&lt;set $helpServants to 1, _riptp2 to 1; _ripXP1 to 20, _ripscar2 to 0&gt;&gt;\nHelped servants: &lt;span class=&quot;help&quot; id=&quot;p-3&quot;&gt;YES&lt;/span&gt; \s\n&lt;&lt;button &quot;Toggle Choice&quot;&gt;&gt;\n  &lt;&lt;if $helpServants is 1&gt;&gt;\n    &lt;&lt;set $helpServants to 0, _ripscar2 to 1, _riptp2 to 0&gt;&gt;\n    &lt;&lt;replace &quot;#p-3&quot;&gt;&gt;\s\n      NO \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;set $helpServants to 1, _ripscar2 to 0, _riptp2 to 1&gt;&gt;\n    &lt;&lt;replace &quot;#p-3&quot;&gt;&gt;\s\n      YES \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;/button&gt;&gt;\n&lt;&lt;set $comfortRip to 1; _riptp3 to 1, _ripscar3 to 0&gt;&gt;\nComfort Ripley: &lt;span class=&quot;help&quot; id=&quot;p-4&quot;&gt;YES&lt;/span&gt; \s\n&lt;&lt;button &quot;Toggle Choice&quot;&gt;&gt;\n  &lt;&lt;if $comfortRip is 1&gt;&gt;\n    &lt;&lt;set $comfortRip to 0, _ripscar3 to 1, _riptp3 to 0&gt;&gt;\n    &lt;&lt;replace &quot;#p-4&quot;&gt;&gt;\s\n      NO \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;set $comfortRip to 1, _ripscar3 to 0, _riptp3 to 1&gt;&gt;\n    &lt;&lt;replace &quot;#p-4&quot;&gt;&gt;\s\n      YES \s\n    &lt;&lt;/replace&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;/button&gt;&gt;\n\n&lt;&lt;link &quot;Go to chapter 1.&quot;&gt;&gt;\n  &lt;&lt;set $ripleyscars += (_ripscar3 + _ripscar2 + _ripscar3)&gt;&gt;\n  &lt;&lt;set $ripleytp += (_riptp3 + _riptp2 + _riptp3)&gt;&gt;\n  &lt;&lt;set $ripleyxp += (_ripXP1)&gt;&gt;\n  &lt;&lt;set $gamestart to 1&gt;&gt;\n  &lt;&lt;goto &quot;toch1&quot;&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\nGood luck, tester!</div><div tiddler="item_unpacker" tags="test nobr" created="201701132004" modifier="twee" twine-position="1690,710">&lt;&lt;set $x to 0&gt;&gt;\n/%weapons%/\n&lt;&lt;set $x to parseInt($item[0], 10)&gt;&gt;\n&lt;&lt;set $unarmedtraining to $x-1&gt;&gt;\n&lt;&lt;set $x to parseInt($item[1], 10)&gt;&gt;\n&lt;&lt;set $longswordtraining to $x-1&gt;&gt;\n&lt;&lt;set $x to parseInt($item[2], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $gswordhave to 1&gt;&gt;\n\t&lt;&lt;set $greatswordtraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[3], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $katanahave to 1&gt;&gt;\n\t&lt;&lt;set $katanatraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[4], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $spearhave to 1&gt;&gt;\n\t&lt;&lt;set $speartraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[5], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $sswordhave to 1&gt;&gt;\n\t&lt;&lt;set $sideswordtraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[6], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $gauntletshave to 1&gt;&gt;\n\t&lt;&lt;set $gauntletstraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[7], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $scythehave to 1&gt;&gt;\n\t&lt;&lt;set $scythetraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[8], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $saberhave to 1&gt;&gt;\n\t&lt;&lt;set $sabertraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[9], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $axehave to 1&gt;&gt;\n\t&lt;&lt;set $battleaxetraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n/%spells%/\n&lt;&lt;set $x to parseInt($item[10], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $neutralhave to 1&gt;&gt;\n\t&lt;&lt;set $neutraltraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[11], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $naturalhave to 1&gt;&gt;\n\t&lt;&lt;set $natrualtraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[12], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $lighthave to 1&gt;&gt;\n\t&lt;&lt;set $lighttraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[13], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $darkhave to 1&gt;&gt;\n\t&lt;&lt;set $darktraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[14], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $hellishhave to 1&gt;&gt;\n\t&lt;&lt;set $shellishtraining to $x-1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n/%armor%/\n&lt;&lt;set $x to parseInt($item[15], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $clothhave to 1&gt;&gt;\n\t&lt;&lt;if $x is 2&gt;&gt;\n\t\t&lt;&lt;set $clothplus to 1&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[16], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $leatherhave to 1&gt;&gt;\n\t&lt;&lt;if $x is 2&gt;&gt;\n\t\t&lt;&lt;set $leatherplus to 1&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[17], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $chainhave to 1&gt;&gt;\n\t&lt;&lt;if $x is 2&gt;&gt;\n\t\t&lt;&lt;set $chainplus to 1&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $x to parseInt($item[18], 10)&gt;&gt;\n&lt;&lt;if $x gte 1&gt;&gt;\n\t&lt;&lt;set $platehave to 1&gt;&gt;\n\t&lt;&lt;if $x is 2&gt;&gt;\n\t\t&lt;&lt;set $plateplus to 1&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n/%other%/\n&lt;&lt;set $x to parseInt($item[19], 10)&gt;&gt;\n&lt;&lt;set $bangles to $x&gt;&gt;\n\n&lt;&lt;set $x to 0&gt;&gt;</div><div tiddler="boss-fight-debug" tags="test" created="201702231824" modifier="twee" twine-position="1970,990">&lt;&lt;link 'Aesil'&gt;&gt;&lt;&lt;display 'Aesil-boss-1-1'&gt;&gt;&lt;&lt;goto 'combat_test_2'&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;display 'bossAdjust'&gt;&gt;\n\n[[Cancel|debug_features]]</div><div tiddler="combat_init" tags="combat" created="201612160716" modifier="twee">&lt;&lt;if $mode neq 0&gt;&gt;Prepare to fight.\n&lt;&lt;set $playerturn to 1&gt;&gt;&lt;&lt;set $round to 1&gt;&gt;&lt;&lt;set $despatk to 0&gt;&gt;&lt;&lt;set $sta to $maxsta&gt;&gt;\nEnemy:  &lt;&lt;print $enemyname&gt;&gt;\n\n&lt;&lt;if $debug is 1&gt;&gt;[[Begin.|highway1][ $battlethemepicker to 0]]&lt;&lt;else&gt;&gt;[[Begin.|highway1][$gamestart to 0; $battlethemepicker to 0]]&lt;&lt;endif&gt;&gt;\n&lt;&lt;anchorswitch&gt;&gt;\n&lt;&lt;else&gt;&gt;You have combat turned off...\n&lt;&lt;anchorswitch&gt;&gt;\n&lt;&lt;name&gt;&gt; defeats $enemyname!\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|combat_end]]&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n\n''This is an unfinished combat build.''\n*Enemy AI: 85% (playable).\n*Features: 90% (playable).\n*Presentation: 99% (playable).\n*Balance:  50% (playable).\n&lt;&lt;nobr&gt;&gt;\n\t&lt;&lt;display &quot;heartbreaker&quot;&gt;&gt;\n\t&lt;&lt;display &quot;gritbar&quot;&gt;&gt;\n\t&lt;&lt;display &quot;nmegritbar&quot;&gt;&gt;\n\t&lt;&lt;display &quot;nmeheartbreaker&quot;&gt;&gt;\n&lt;&lt;if $battlethemepicker is 0&gt;&gt;\n\t&lt;&lt;masteraudio stop&gt;&gt;\n\t&lt;&lt;set $battlethemepicker to 1&gt;&gt;\n\t&lt;&lt;if $bossFight and $theme&gt;&gt;\n\t\t&lt;&lt;display $theme&gt;&gt;\n\t\t&lt;&lt;set $theme to ''&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $battletheme to either(1,2,3,4,5,6,7,8)&gt;&gt;\n\t\t&lt;&lt;switch $battletheme&gt;&gt;\n\t\t&lt;&lt;case 1&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle1&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 2&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle2&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 3&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle3&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 4&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle4&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 5&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle5&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 6&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle6&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 7&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle7&quot; loop play&gt;&gt;\n\t\t&lt;&lt;case 8&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle8&quot; loop play&gt;&gt;\n\t\t&lt;&lt;default&gt;&gt;\n\t\t\t&lt;&lt;audio &quot;battle9&quot; loop play&gt;&gt;\n\t\t&lt;&lt;/switch&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $SpEffEnd to -1&gt;&gt;\n&lt;&lt;set $specialOn to 0&gt;&gt;\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;\n&lt;&lt;set $SpEffDisplay to &quot;&quot;&gt;&gt;\n&lt;&lt;set $rageCurrent to 0&gt;&gt;\n&lt;&lt;display &quot;rage_unpack&quot;&gt;&gt;\n&lt;&lt;display &quot;rabbleRouser&quot;&gt;&gt;\n&lt;&lt;set $baseStaggerOdds to Math.trunc((($nmemaxgrit + $nmedef) / 2) * setup.bal.estagger)&gt;&gt;\n&lt;&lt;if $bossFight&gt;&gt;\n\t&lt;&lt;set $baseStaggerOdds to $baseStaggerOdds * setup.bal.ebossSt&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $staggerOdds to $baseStaggerOdds&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;</div><div tiddler="AudioInit" tags="init" created="201706111419" modifier="twee" twine-position="1130,150">/% sound effects %/\n&lt;&lt;set _loader to setup.assets.effects&gt;&gt;\n&lt;&lt;cacheaudio &quot;attack&quot; \n\t`_loader + &quot;attack.ogg&quot;`\n\t`_loader + &quot;attack.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;fast-atk&quot; \n\t`_loader + &quot;fast-atk.ogg&quot;`\n\t`_loader + &quot;fast-atk.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;defend&quot; \n\t`_loader + &quot;defend.ogg&quot;`\n\t`_loader + &quot;defend.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;critical&quot; \n\t`_loader + &quot;critical.ogg&quot;`\n\t`_loader + &quot;critical.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;equip&quot; \n\t`_loader + &quot;equip.ogg&quot;`\n\t`_loader + &quot;equip.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;click&quot; \n\t`_loader + &quot;mouseclick.ogg&quot;`\n\t`_loader + &quot;mouseclick.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;shortclick&quot; \n\t`_loader + &quot;shortclick.ogg&quot;`\n\t`_loader + &quot;shortclick.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;beep&quot; \n\t`_loader + &quot;yesbeep.ogg&quot;`\n\t`_loader + &quot;yesbeep.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;steps&quot; \n\t`_loader + &quot;steps.ogg&quot;`\n\t`_loader + &quot;steps.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;page&quot; \n\t`_loader + &quot;page.ogg&quot;`\n\t`_loader + &quot;page.mp3&quot;`&gt;&gt;\n\n/% voice %/\n&lt;&lt;cacheaudio &quot;hurt1&quot; \n\t`_loader + &quot;hurt1.ogg&quot;`\n\t`_loader + &quot;hurt1.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;hurt2&quot; \n\t`_loader + &quot;hurt2.ogg&quot;`\n\t`_loader + &quot;hurt2.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;hurt3&quot; \n\t`_loader + &quot;hurt3.ogg&quot;`\n\t`_loader + &quot;hurt3.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;damage&quot; \n\t`_loader + &quot;damage.ogg&quot;`\n\t`_loader + &quot;damage.mp3&quot;`&gt;&gt;\n\n&lt;&lt;cacheaudio &quot;rage&quot; \n\t`_loader + &quot;rage.ogg&quot;`\n\t`_loader + &quot;rage.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage2&quot; \n\t`_loader + &quot;rage2.ogg&quot;`\n\t`_loader + &quot;rage2.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage3&quot; \n\t`_loader + &quot;rage3.ogg&quot;`\n\t`_loader + &quot;rage3.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage4&quot; \n\t`_loader + &quot;rage4.ogg&quot;`\n\t`_loader + &quot;rage4.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage5&quot; \n\t`_loader + &quot;rage5.ogg&quot;`\n\t`_loader + &quot;rage5.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage6&quot; \n\t`_loader + &quot;rage6.ogg&quot;`\n\t`_loader + &quot;rage6.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage7&quot; \n\t`_loader + &quot;rage7.ogg&quot;`\n\t`_loader + &quot;rage7.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage-drop1&quot; \n\t`_loader + &quot;rage-drop1.ogg&quot;`\n\t`_loader + &quot;rage-drop1.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage-drop2&quot; \n\t`_loader + &quot;rage-drop2.ogg&quot;`\n\t`_loader + &quot;rage-drop2.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage-drop3&quot; \n\t`_loader + &quot;rage-drop3.ogg&quot;`\n\t`_loader + &quot;rage-drop3.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage-drop4&quot; \n\t`_loader + &quot;rage-drop4.ogg&quot;`\n\t`_loader + &quot;rage-drop4.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage-drop5&quot; \n\t`_loader + &quot;rage-drop5.ogg&quot;`\n\t`_loader + &quot;rage-drop5.mp3&quot;`&gt;&gt;\n&lt;&lt;set _loader to setup.assets.voice&gt;&gt;\n&lt;&lt;cacheaudio &quot;rip-careful&quot; \n\t`_loader + &quot;Rip-careful.ogg&quot;`\n\t`_loader + &quot;Rip-careful.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rip-good&quot; \n\t`_loader + &quot;Rip-good.ogg&quot;`\n\t`_loader + &quot;Rip-good.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rip-good2&quot; \n\t`_loader + &quot;Rip-good2.ogg&quot;`\n\t`_loader + &quot;Rip-good2.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rip-insist&quot; \n\t`_loader + &quot;Rip-insist.ogg&quot;`\n\t`_loader + &quot;Rip-insist.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rip-hiyah&quot; \n\t`_loader + &quot;Rip-hiyah.ogg&quot;`\n\t`_loader + &quot;Rip-hiyah.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rip-die&quot; \n\t`_loader + &quot;rip-die.ogg&quot;`\n\t`_loader + &quot;rip-die.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;damage2&quot; \n\t`_loader + &quot;Rip-cant-do-this.ogg&quot;`\n\t`_loader + &quot;Rip-cant-do-this.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage8&quot; \n\t`_loader + &quot;Rip-alright.ogg&quot;`\n\t`_loader + &quot;Rip-alright.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage9&quot; \n\t`_loader + &quot;Rip-easy.ogg&quot;`\n\t`_loader + &quot;Rip-easy.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;rage10&quot; \n\t`_loader + &quot;Rip-lets-do-this.ogg&quot;`\n\t`_loader + &quot;Rip-lets-do-this.mp3&quot;`&gt;&gt;\n\n/% desperation attack playlists %/\n&lt;&lt;createplaylist &quot;desp-atk-1&quot;&gt;&gt;\n  &lt;&lt;track &quot;critical&quot; volume 1&gt;&gt;\n  &lt;&lt;track &quot;rip-good&quot; volume 1&gt;&gt;\n&lt;&lt;/createplaylist&gt;&gt;\n&lt;&lt;createplaylist &quot;desp-atk-2&quot;&gt;&gt;\n  &lt;&lt;track &quot;critical&quot; volume 1&gt;&gt;\n  &lt;&lt;track &quot;rip-good2&quot; volume 1&gt;&gt;\n&lt;&lt;/createplaylist&gt;&gt;\n&lt;&lt;createplaylist &quot;desp-atk-3&quot;&gt;&gt;\n  &lt;&lt;track &quot;critical&quot; volume 1&gt;&gt;\n  &lt;&lt;track &quot;rage8&quot; volume 1&gt;&gt;\n&lt;&lt;/createplaylist&gt;&gt;\n&lt;&lt;createplaylist &quot;desp-atk-4&quot;&gt;&gt;\n  &lt;&lt;track &quot;critical&quot; volume 1&gt;&gt;\n  &lt;&lt;track &quot;rage9&quot; volume 1&gt;&gt;\n&lt;&lt;/createplaylist&gt;&gt;\n&lt;&lt;createplaylist &quot;desp-atk-5&quot;&gt;&gt;\n  &lt;&lt;track &quot;rip-die&quot; volume 1&gt;&gt;\n  &lt;&lt;track &quot;critical&quot; volume 1&gt;&gt;\n&lt;&lt;/createplaylist&gt;&gt;\n&lt;&lt;createplaylist &quot;desp-atk-R&quot;&gt;&gt;\n  &lt;&lt;track &quot;rip-hiyah&quot; volume 1&gt;&gt;\n  &lt;&lt;track &quot;critical&quot; volume 1&gt;&gt;\n&lt;&lt;/createplaylist&gt;&gt;\n\n/% music initial %/\n&lt;&lt;set _loader to setup.assets.music&gt;&gt;\n&lt;&lt;cacheaudio &quot;anticipation&quot; \n\t`_loader + &quot;anticipation.ogg&quot;`\n\t`_loader + &quot;anticipation.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;snowfall&quot; \n\t`_loader + &quot;snowfall.ogg&quot;`\n\t`_loader + &quot;snowfall.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;expressions-of-the-mind&quot; \n\t`_loader + &quot;expressions-of-the-mind.ogg&quot;`\n\t`_loader + &quot;expressions-of-the-mind.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;herat7&quot; \n\t`_loader + &quot;herat7.ogg&quot;`\n\t`_loader + &quot;herat7.mp3&quot;`&gt;&gt;\n\n/% OST 2 %/\n&lt;&lt;cacheaudio &quot;alhambra&quot; \n\t`_loader + &quot;alhambra.ogg&quot;`\n\t`_loader + &quot;alhambra.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'another'\n\t`_loader + &quot;another.ogg&quot;`\n\t`_loader + &quot;another.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'asked'\n\t`_loader + &quot;asked.ogg&quot;`\n\t`_loader + &quot;asked.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;breath&quot; \n\t`_loader + &quot;breath.ogg&quot;`\n\t`_loader + &quot;breath.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;cell&quot; \n\t`_loader + &quot;cell.ogg&quot;`\n\t`_loader + &quot;cell.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'cibelle'\n\t`_loader + &quot;cibelle.ogg&quot;`\n\t`_loader + &quot;cibelle.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'desperate'\n\t`_loader + &quot;desperate.ogg&quot;`\n\t`_loader + &quot;desperate.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'dope'\n\t`_loader + &quot;dope.ogg&quot;`\n\t`_loader + &quot;dope.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'dunno'\n\t`_loader + &quot;dunno.ogg&quot;`\n\t`_loader + &quot;dunno.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'escape'\n\t`_loader + &quot;escape.ogg&quot;`\n\t`_loader + &quot;escape.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'milan'\n\t`_loader + &quot;milan.ogg&quot;`\n\t`_loader + &quot;milan.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'mx'\n\t`_loader + &quot;mx.ogg&quot;`\n\t`_loader + &quot;mx.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'oh'\n\t`_loader + &quot;oh.ogg&quot;`\n\t`_loader + &quot;oh.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'ophelia'\n\t`_loader + &quot;ophelia.ogg&quot;`\n\t`_loader + &quot;ophelia.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'red'\n\t`_loader + &quot;red.ogg&quot;`\n\t`_loader + &quot;red.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'rhodes'\n\t`_loader + &quot;rhodes.ogg&quot;`\n\t`_loader + &quot;rhodes.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'sleeping'\n\t`_loader + &quot;sleeping.ogg&quot;`\n\t`_loader + &quot;sleeping.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'slow'\n\t`_loader + &quot;slow.ogg&quot;`\n\t`_loader + &quot;slow.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'space'\n\t`_loader + &quot;space.ogg&quot;`\n\t`_loader + &quot;space.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'spin'\n\t`_loader + &quot;spin.ogg&quot;`\n\t`_loader + &quot;spin.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'stand'\n\t`_loader + &quot;stand.ogg&quot;`\n\t`_loader + &quot;stand.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'summer'\n\t`_loader + &quot;summer.ogg&quot;`\n\t`_loader + &quot;summer.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'un'\n\t`_loader + &quot;un.ogg&quot;`\n\t`_loader + &quot;un.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'what'\n\t`_loader + &quot;what.ogg&quot;`\n\t`_loader + &quot;what.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'you'\n\t`_loader + &quot;you.ogg&quot;`\n\t`_loader + &quot;you.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio 'wa'\n\t`_loader + &quot;wa.ogg&quot;`\n\t`_loader + &quot;wa.mp3&quot;`&gt;&gt;\n\n/% OST 3 %/\n&lt;&lt;cacheaudio &quot;eyes-fire&quot; \n\t`_loader + &quot;eyes-fire.ogg&quot;`\n\t`_loader + &quot;eyes-fire.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;nothing-left&quot; \n\t`_loader + &quot;nothing-left.ogg&quot;`\n\t`_loader + &quot;nothing-left.mp3&quot;`&gt;&gt;\n\n/% battle themes %/\n&lt;&lt;set _loader to setup.assets.battle&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle1&quot; \n\t`_loader + &quot;battle1.ogg&quot;`\n\t`_loader + &quot;battle1.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle2&quot; \n\t`_loader + &quot;battle2.ogg&quot;`\n\t`_loader + &quot;battle2.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle3&quot; \n\t`_loader + &quot;battle3.ogg&quot;`\n\t`_loader + &quot;battle3.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle4&quot; \n\t`_loader + &quot;battle4.ogg&quot;`\n\t`_loader + &quot;battle4.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle5&quot; \n\t`_loader + &quot;battle5.ogg&quot;`\n\t`_loader + &quot;battle5.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle6&quot; \n\t`_loader + &quot;battle6.ogg&quot;`\n\t`_loader + &quot;battle6.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle7&quot; \n\t`_loader + &quot;battle7.ogg&quot;`\n\t`_loader + &quot;battle7.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle8&quot; \n\t`_loader + &quot;battle8.ogg&quot;`\n\t`_loader + &quot;battle8.mp3&quot;`&gt;&gt;\n&lt;&lt;cacheaudio &quot;battle9&quot; \n\t`_loader + &quot;battle9.ogg&quot;`\n\t`_loader + &quot;battle9.mp3&quot;`&gt;&gt;\n</div><div tiddler="sidequest_1" tags="scene" created="201701282009" modifier="twee"></div><div tiddler="ch1-8" tags="scene save" created="201701282009" modifier="twee"></div><div tiddler="0wallSouth" tags="dock" created="201701242247" modifier="twee">Continue on?\n\n&lt;&lt;ctrlClick &quot;Proceed along the wall.&quot; &quot;0wall2&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="custom-load-html" tags="nobr" created="201707071832" modifier="twee" twine-position="10,710">&lt;div id=&quot;crosses&quot;&gt;\n&lt;div class=&quot;cssload-top&quot;&gt;\n\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;&lt;div class=&quot;cssload-square&quot;&gt;\n\n\t\t\t\t\t&lt;/div&gt;&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&lt;div class=&quot;cssload-bottom&quot;&gt;\n\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;/div&gt;&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&lt;div class=&quot;cssload-left&quot;&gt;\n\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;/div&gt;&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&lt;div class=&quot;cssload-right&quot;&gt;\n\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;div class=&quot;cssload-square&quot;&gt;&lt;div class=&quot;cssload-square&quot;&gt;\n\t\t\t\t\t&lt;/div&gt;&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;</div><div tiddler="0wall3Aes" tags="dock" created="201701250432" modifier="twee">Aesil and Akatosh had been working together for a while now.  Before that, Aesil was an ordinary, if not perverted, dark mage.  Whatever deal he made with Akatosh turned him into something else.\n\nSomething very hard to kill.  Folsom's magic could hold him at bay, though.  Maybe even drive him off.</div><div tiddler="bugrep" tags="stylesheet" created="201612151922" modifier="twee" twine-position="570,570">/*! &lt;&lt;bugreport&gt;&gt; macro for SugarCube 2.x */\n#ui-dialog-body.bugreport #bugreport-info{margin-bottom:1em}#ui-dialog-body.bugreport #bugreport-data{display:block;overflow:auto;font-family:monospace,monospace;background-color:transparent;border:1px solid #444;margin:0;padding:6px;height:auto;min-height:200px;white-space:normal}#ui-dialog-body.bugreport .scroll-pad{margin:0;padding:0}\n</div><div tiddler="tut_onDef" tags="hook tutorial" created="201707101336" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\nWhen &lt;&lt;name&gt;&gt; ends her turn by defending, she gains darmatically increased defense until her next turn.  Defending also increases her end-of-round &lt;&lt;= setup.words.grit&gt;&gt; regeneration and causes healing spells to fire.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onDef'&gt;&gt;</div><div tiddler="1eleqBed" tags="dock" created="201708281401" modifier="twee">Rest for a bit?\n\n&lt;&lt;ctrlClick 'Rest now.' '1eleqRest'&gt;&gt;</div><div tiddler="oldsave" tags="menu" created="201701110200" modifier="twee" twine-position="850,850">You are using an outdated save game from an early prototype build.  It is recommended that you delete your saves and start over.  If you do not wish to do so, note that you may encounter odd or game-breaking bugs.\n\nDelete your saves and &lt;&lt;link &quot;restart the game&quot;&gt;&gt;&lt;&lt;script&gt;&gt;UI.restart();&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;, or [[click here to start the prologue over again|prol1]] and take your chances with your current saved data.</div><div tiddler="Carthus-4-2" tags="" created="201707262257" modifier="twee"></div><div tiddler="Dispel" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;dispel_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;disp&quot;]]\n[[No|spellswap]]</div><div tiddler="debug_mode_activation" tags="menu test" created="201701132241" modifier="twee">You've stumbled across the debug tools!\n\nWhile messing with these features can certainly be fun, we can't recommend it.  Activation of the debug features will almost certainly break your game, so make sure you have a save to go back to if you decide to risk it.\n\n[[Activate debug tools.|$return][$gamestart to 1, $debug to 1]]\n\n[[Deactivate debug tools.|$return][$gamestart to 1, $debug to 0]]\n\n&lt;span id=&quot;return&quot;&gt;[[Do nothing.|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combatcall" tags="example" created="201612180830" modifier="twee">&lt;&lt;if $anchor is 0&gt;&gt; /%anchor always needs to return to 0; the combat flips it to 1 %/\n\t\t&lt;&lt;display “an enemy”&gt;&gt; /%initialize enemy stats%/\n\t\t&lt;&lt;anchor&gt;&gt; /%drops the anchor%/\n\t\tYou’re about to fight &lt;&lt;print $enemyname&gt;&gt;! /%a message before the combat%/\n\t\t[[Continue|combat_init]]  /%call the [combat_init] passage%/\n\t&lt;&lt;else&gt;&gt; /%return to the anchor; combat sets the $anchor variable to 1%/\n\t\t&lt;&lt;anchorkill&gt;&gt; /%reset $anchor to 0%/\n\t\tYou defeated $enemyname! /%an exit message%/\n\t\t[[Continue|next_passage]] /%continue the game; remember to reset the anchor%/\n\t&lt;&lt;endif&gt;&gt;\n</div><div tiddler="rageUI" tags="" created="201702091707" modifier="twee">Ripley needs {{{100%}}} rage to transform.  She can build rage up to {{{200%}}}.  The more rage Ripley has when she transforms, the stronger she'll become and the longer she'll be able to maintain the transformation.\n\nRage Build: &lt;&lt;print Math.trunc($rageBuild)&gt;&gt;\nRage Decay: &lt;&lt;print Math.trunc($rageDecay)&gt;&gt;\n\nTransforming dramatically lowers Ripley's defenses, dodge, and dispel.\n\nWhile transformed, Ripley cannot perform Desperation Attacks or Critical Hits.</div><div tiddler="devilforminfo" tags="" created="201702081037" modifier="twee">\nWhen Ripley gets angry, she can tap into her deepest powers and take on a demonic form for a massive boost to almost every attribute and stat.  Ripley must have at least 100% Rage to transform.\n\n</div><div tiddler="notifyJS" tags="script" created="201711271903" modifier="twee">// nofity.js\n$(document.body).append(&quot;&lt;div id='notify'&gt;&lt;/div&gt;&quot;);\n$(document).on(':notify', function (e) {\n\tif (e.message &amp;&amp; typeof e.message === 'string') {\n\t\t// trim message\n\t\te.message.trim();\n\t\t// classes\n\t\tif (e.class) {\n\t\t\tif (typeof e.class === 'string') {\n\t\t\t\te.class = 'open ' + e.class;\n\t\t\t} else if (Array.isArray(e.class)) {\n\t\t\t\te.class = 'open macro-notify ' + e.class.join(' ');\n\t\t\t} else {\n\t\t\t\te.class = 'open macro-notify';\n\t\t\t}\n\t\t} else {\n\t\t\te.class = 'open macro-notify';\n\t\t}\n\t\t\n\t\t// delay\n\t\tif (e.delay) {\n\t\t\tif (typeof e.delay !== 'number') {\n\t\t\t\te.delay = Number(e.delay)\n\t\t\t}\n\t\t\tif (Number.isNaN(e.delay)) {\n\t\t\t\te.delay = 2000;\n\t\t\t}\n\t\t} else {\n\t\t\te.delay = 2000;\n\t\t}\n\t\t\n\t\tpostdisplay['notification-task'] = function (t) {\n\t\t\tdelete postdisplay[t];\n\t\t\tconsole.log(e);\n\t\t\t$('#notify')\n\t\t\t\t.empty()\n\t\t\t\t.wiki(e.message)\n\t\t\t\t.addClass(e.class)\n\t\t\t\t\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('#notify').removeClass();\n\t\t\t}, e.delay);\n\t\t};\n\t}\n});\n\n// &lt;&lt;notify delay 'classes'&gt;&gt; message &lt;&lt;/notify&gt;&gt;\nMacro.add('notify', {\n\t   tags : null,\n\thandler : function () {\n\t\t\n\t\t// set up\n\t\tvar msg     = this.payload[0].contents, \n\t\t\ttime    = false, \n\t\t\tclasses = false, i;\n\t\t\n\t\t// arguments\n\t\tif (this.args.length &gt; 0) {\n\t\t\tif (typeof this.args[0] === 'number') {\n\t\t\t\ttime    = this.args[0];\n\t\t\t\tclasses = (this.args.length &gt; 1) ? this.args.slice(1).flatten() : false;\n\t\t\t} else {\n\t\t\t\tclasses = this.args.flatten().join(' ');\n\t\t\t}\n\t\t}\n\t\t\n\t\t// fire event\n\t\t$(document).trigger({\n\t\t\ttype    : ':notify',\n\t\t\tmessage : msg,\n\t\t\tdelay   : time,\n\t\t\tclass   : classes\n\t\t});\n\t\t\n\t}\n});</div><div tiddler="1RipHow" tags="dock" created="201708260036" modifier="twee">&quot;So,&quot; Elesun says.  &quot;How are you holding up.&quot;\n\nRipley's jaw gets a little tighter, and she doesn't make eye contact with Elesun.  &quot;I just keep reminding myself like you told me to.&quot;\n\n&quot;Let me hear it then.&quot;\n\n&quot;It's not my fault.&quot;\n\n&quot;That's right.  Whose fault is it?&quot;\n\n&quot;Akatosh.&quot;\n\n&quot;Good girl.&quot;</div><div tiddler="spellswap" tags="menu char" created="201612131459" modifier="twee">Current &lt;&lt;= setup.words.spell.toUpperFirst()&gt;&gt;: &lt;&lt;print $p_spellname&gt;&gt;\n\nSelect a &lt;&lt;= setup.words.spell&gt;&gt;:\n\n&lt;&lt;if $neutralhave is 1&gt;&gt;Neutral Magic:  (Level &lt;&lt;print $neutraltraining&gt;&gt;)\n[[Protect]]\n[[Rage]]\n[[Dispel]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $naturalhave is 1&gt;&gt;Natural Magic:  (Level &lt;&lt;print $naturaltraining&gt;&gt;)\n[[Focus]]\n[[Vital]]\n[[Keen]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $lighthave is 1&gt;&gt;Light Magic:  (Level &lt;&lt;print $lighttraining&gt;&gt;)\n[[Regeneration]]\n[[Healing]]\n[[Blessing]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $darkhave is 1&gt;&gt;Dark Magic:  (Level &lt;&lt;print $darktraining&gt;&gt;)\n[[Ghost]]\n[[Possessed]]\n[[Shadow Veil]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $hellishhave is 1&gt;&gt;Hellish Magic:  (Level &lt;&lt;print $hellishtraining&gt;&gt;)\n[[Flame Shroud]]\n[[Explosion]]\n[[Inferno]]&lt;&lt;endif&gt;&gt;\n\n[[Back|equipmenu]]\n\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="info macro test" tags="test menu" created="201612191505" modifier="twee" twine-position="1550,850">\n&lt;&lt;dock &quot;Give me a little bit of text.&quot; &quot;dock1&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Give me a whole lot of text.&quot; &quot;dock2&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Give me a normal amount of text.&quot; &quot;dock3&quot;&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n[[Back|debug_features]]</div><div tiddler="blah" tags="annotation" created="201701051205" modifier="twee">Desperation attacks tringerring one turn late-Fixed\n\nEnemy attacks still not truncating-Fixed\n\nNeed critical alert box-Fixed\n\nUpdated character elements-Added\n\nStatus display sometimes shits itself-Fixed\n\nAdd rage/transform mechanic-Done</div><div tiddler="0mainhall1Harl" tags="dock" created="201701252352" modifier="twee">&quot;Hey, Ripley,&quot; Elesun says.\n\n&quot;What?&quot;\n\n&quot;Do you fancy Harlaus?  I think he might fancy you.&quot;\n\n&quot;We're practically siblings,&quot; Ripley says.\n\n&quot;Fair point.  You didn't answer the question, though.&quot;\n\n&quot;Shut up.&quot;&lt;&lt;timed 500ms&gt;&gt;&lt;&lt;replace &quot;#gone&quot;&gt;&gt;Prince Harlaus&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;</div><div tiddler="NoCharacter" tags="menu" created="201702220107" modifier="twee">&lt;&lt;set $gamestart to 2&gt;&gt;{{{&lt;Searching for object $character.Elesun[...]&gt;}}}\n\n&lt;div class=&quot;time-bar&quot;&gt;&lt;span class=&quot;w0&quot;&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;&lt;timed 4500ms&gt;&gt;\n{{{&lt;Error: Not found.  !Redirecting&gt;}}}&lt;&lt;next 1s&gt;&gt;\n\n{{{&lt;}}}&lt;span id=&quot;cutebar&quot;&gt;{{{-------------}}}&lt;/span&gt;{{{&gt;}}}&lt;&lt;next 100ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{=------------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 100ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{==-----------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 300ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{===----------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 500ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{====---------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 200ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{=====--------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 400ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{======-------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 500ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{=======------}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 500ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{========-----}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 100ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{============-}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 500ms&gt;&gt;&lt;&lt;replace &quot;#cutebar&quot;&gt;&gt;{{{=============}}}&lt;&lt;/replace&gt;&gt;&lt;&lt;next 500ms&gt;&gt;\n\n{{{&lt;Fatal Error&gt;  !Catch.error.return(@@$character.Elesun[] is dead)();}}}&lt;&lt;next 1s&gt;&gt;\n\n&lt;span id=&quot;scaryCode&quot;&gt;{{{al-error&quot;,function(t){i(&quot;ierr&quot;,[t,(new Date).getTime(),!0])})},{}],3:[function(t,e,n){t(&quot;loader&quot;).features.ins=!0},{}],4:[function(t,e,n){function r(){j++,S=y.hash,this[u]=Date.now()}function o(){j--,y.hash!==S&amp;&amp;i(0,!0);var t=Date.now();this[l]=~~this[l]+t-this[u],this[h]=t}function i(t,e){x.emit(&quot;newURL&quot;,[&quot;&quot;+y,e])}function a(t,e){t.on(e,function(){this[e]=Date.now()})}var c=&quot;-start&quot;,s=&quot;-end&quot;,f=&quot;-body&quot;,u=&quot;fn&quot;+c,h=&quot;fn&quot;+s,d=&quot;cb&quot;+c,p=&quot;cb&quot;+s,l=&quot;jsTime&quot;,m=&quot;fetch&quot;,v=&quot;addEventListener&quot;,w=window,y=w.location;if(w[v]){var g=t(9),b=t(10),x=t(8),E=t(6),T=t(12),O=t(7),R=t(13),P=t(&quot;ee&quot;),D=P.get(&quot;tracer&quot;);t(14),t(&quot;loader&quot;).features.spa=!0;var S,N=w[v],j=0;P.on(u,r),P.on(d,r),P.on(h,o),P.on(p,o),P.buffer([u,h,&quot;xhr-done&quot;,&quot;xhr-resolved&quot;]),E.buffer([u]),T.buffer([&quot;setTimeout&quot;+s,&quot;clearTimeout&quot;+c,u]),R.buffer([u,&quot;new-xhr&quot;,&quot;send-xhr&quot;+c]),O.buffer([m+c,m+&quot;-done&quot;,m+f+c,m+f+s]),x.buffer([&quot;newURL&quot;]),g.buffer([u]),b.buffer([&quot;propagate&quot;,d,p,&quot;executor-err&quot;,&quot;resolve&quot;+c]),D.buffer([u,&quot;no-&quot;+u]),a(R,&quot;send-xhr&quot;+c),a(P,&quot;xhr-resolved&quot;),a(P,&quot;xhr-done&quot;),a(O,m+c),a(O,m+&quot;-done&quot;),x.on(&quot;pushState-end&quot;,i),x.on(&quot;replaceState-end&quot;,i),N(&quot;hashchange&quot;,i,!0),N(&quot;load&quot;,i,!0),N(&quot;popstate&quot;,function(){i(0,j&gt;1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&amp;&amp;window.performance.timing&amp;&amp;window.performance.getEntriesByType){var o=t(&quot;ee&quot;),i=t(&quot;handle&quot;),a=t(12),c=t(11),s=&quot;learResourceTimings&quot;,f=&quot;addEventListener&quot;,u=&quot;resourcetimingbufferfull&quot;,h=&quot;bstResource&quot;,d=&quot;resource&quot;,p=&quot;-start&quot;,l=&quot;-end&quot;,m=&quot;fn&quot;+p,v=&quot;fn&quot;+l,w=&quot;bstTimer&quot;,y=&quot;pushState&quot;;t(&quot;loader&quot;).features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&amp;&amp;(this.bstStart=Date.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&amp;&amp;i(&quot;bst&quot;,[n,e,this.bstStart,Date.now()])}),a.on(m,function(t,e,n){this.bstStart=Date.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,Date.now(),this.bstType])}),c.on(m,function(){this.bstStart=Date.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,Date.now(),&quot;requestAnimationFrame&quot;])}),o.on(y+p,function(t){this.time=Date.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i(&quot;bstHist&quot;,[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&amp;&amp;(window.performance[&quot;c&quot;+s]?window.performance[f](u,function(t){i(h,[window.performance.getEntriesByType(d)]),window.performance[&quot;c&quot;+s]()},!1):window.performance[f](&quot;webkit&quot;+u,function(t){i(h,[window.performance.getEntriesByType(d)]),window.performance[&quot;webkitC&quot;+s]()},!1)),document[f](&quot;scroll&quot;,r,{passive:!0}),document[f](&quot;keypress&quot;,r,!1),document[f](&quot;click&quot;,r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&amp;&amp;!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&amp;&amp;o(e)}function o(t){c.inPlace(t,[u,h],&quot;-&quot;,i)}function i(t,e){return t[1]}var a=t(&quot;ee&quot;).get(&quot;events&quot;),c=t(21)(a,!0),s=t(&quot;gos&quot;),f=XMLHttpRequest,u=&quot;addEventListener&quot;,h=&quot;removeEventListener&quot;;e.exports=a,&quot;getPrototypeOf&quot;in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&amp;&amp;(o(window),o(f.prototype)),a.on(u+&quot;-start&quot;,function(t,e){var n=t[1],r=s(n,&quot;nr@wrapped&quot;,function(){function t(){if(&quot;function&quot;==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,&quot;function&quot;:n}[typeof n];return e?c(e,&quot;fn-&quot;,null,e.name||&quot;anonymous&quot;):n});this.wrapped=t[1]=r}),a.on(h+&quot;-start&quot;,function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];&quot;function&quot;==typeof r&amp;&amp;(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+&quot;start&quot;,arguments,t),t.then(function(e){return o.emit(n+&quot;end&quot;,[null,e],t),e},function(e){throw o.emit(n+&quot;end&quot;,[e],t),e})})}var o=t(&quot;ee&quot;).get(&quot;fetch&quot;),i=t(19);e.exports=o;var a=window,c=&quot;fetch-&quot;,s=c+&quot;body-&quot;,f=[&quot;arrayBuffer&quot;,&quot;blob&quot;,&quot;json&quot;,&quot;text&quot;,&quot;formData&quot;],u=a.Request,h=a.Response,d=a.fetch,p=&quot;prototype&quot;;u&amp;&amp;h&amp;&amp;d&amp;&amp;(i(f,function(t,e){r(u[p],e,s),r(h[p],e,s)}),r(a,&quot;fetch&quot;,c),o.on(c+&quot;end&quot;,function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+&quot;done&quot;,[null,e],n)}):o.emit(c+&quot;done&quot;,[t],n)}))},{}],8:[function(t,e,n){var r=t(&quot;ee&quot;).get(&quot;history&quot;),o=t(21)(r);e.exports=r,o.inPlace(window.history,[&quot;pushState&quot;,&quot;replaceState&quot;],&quot;-&quot;)},{}],9:[function(t,e,n){var r=t(&quot;ee&quot;).get(&quot;mutation&quot;),o=t(21)(r),i=NREUM.o.MO;e.exports=r,i&amp;&amp;(window.MutationObserver=function(t){return this instanceof i?new i(o(t,&quot;fn-&quot;)):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],10:[function(t,e,n){function r(t){var e=a.context(),n=c(t,&quot;executor-&quot;,e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit(&quot;new-promise&quot;,[r,e],e),r}function o(t,e){return e}var i=t(21),a=t(&quot;ee&quot;).get(&quot;promise&quot;),c=i(a),s=t(19),f=NREUM.o.PR;e.exports=a,f&amp;&amp;(window.Promise=r,[&quot;all&quot;,&quot;race&quot;].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit(&quot;propagate&quot;,[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r(&quot;all&quot;===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),[&quot;resolve&quot;,&quot;reject&quot;].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&amp;&amp;a.emit(&quot;propagate&quot;,[t,!0],n),n}}),f.prototype[&quot;catch&quot;]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on(&quot;executor-start&quot;,function(t){t[0]=c(t[0],&quot;resolve-&quot;,this),t[1]=c(t[1],&quot;resolve-&quot;,this)}),a.on(&quot;executor-err&quot;,function(t,e,n){t[1](n)}),c.inPlace(f.prototype,[&quot;then&quot;],&quot;then-&quot;,o),a.on(&quot;then-start&quot;,function(t,e){this.promise=e,t[0]=c(t[0],&quot;cb-&quot;,this),t[1]=c(t[1],&quot;cb-&quot;,this)}),a.on(&quot;then-end&quot;,function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit(&quot;propagate&quot;,[r,!0],n)}),a.on(&quot;cb-end&quot;,function(t,e,n){a.emit(&quot;propagate&quot;,[n,!0],this.nextPromise)}),a.on(&quot;propagate&quot;,function(t,e,n){this.getCtx&amp;&amp;!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&amp;&amp;e.getCtx?e.getCtx():this})}),r.toString=function(){return&quot;&quot;+f})},{}],11:[function(t,e,n){var r=t(&quot;ee&quot;).get(&quot;raf&quot;),o=t(21)(r),i=&quot;equestAnimationFrame&quot;;e.exports=r,o.inPlace(window,[&quot;r&quot;+i,&quot;mozR&quot;+i,&quot;webkitR&quot;+i,&quot;msR&quot;+i],&quot;raf-&quot;),r.on(&quot;raf-start&quot;,function(t){t[0]=o(t[0],&quot;fn-&quot;)})},{}],12:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],&quot;fn-&quot;,null,n)}function o(t,e,n){this.method=n,this.timerDuration=&quot;number&quot;==typeof t[1]?t[1]:0,t[0]=a(t[0],&quot;fn-&quot;,this,n)}var i=t(&quot;ee&quot;).get(&quot;timer&quot;),a=t(21)(i),c=&quot;setTimeout&quot;,s=&quot;setInterval&quot;,f=&quot;clearTimeout&quot;,u=&quot;-start&quot;,h=&quot;-&quot;;e.exports=i,a.inPlace(window,[c,&quot;setImmediate&quot;],c+h),a.inPlace(window,[s],s+h),a.inPlace(window,[f,&quot;clearImmediate&quot;],f+h),i.on(s+u,r),i.on(c+u,o)},{}],13:[function(t,e,n){function r(t,e){h.inPlace(e,[&quot;onreadystatechange&quot;],&quot;fn-&quot;,c)}function o(){var t=this,e=u.context(t);t.readyState&gt;3&amp;&amp;!e.resolved&amp;&amp;(e.resolved=!0,u.emit(&quot;xhr-resolved&quot;,[],t)),h.inPlace(t,v,&quot;fn-&quot;,c)}function i(t){w.push(t),l&amp;&amp;(g=-g,b.data=g)}function a(){for(var t=0;t&lt;w.length;t++)r([],w[t]);w.length&amp;&amp;(w=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t(&quot;ee&quot;),u=f.get(&quot;xhr&quot;),h=t(21)(u),d=NREUM.o,p=d.XHR,l=d.MO,m=&quot;readystatechange&quot;,v=[&quot;onload&quot;,&quot;onerror&quot;,&quot;onabort&quot;,&quot;onloadstart&quot;,&quot;onloadend&quot;,&quot;onprogress&quot;,&quot;ontimeout&quot;],w=[];e.exports=u;var y=window.XMLHttpRequest=function(t){var e=new p(t);try{u.emit(&quot;new-xhr&quot;,[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit(&quot;internal-error&quot;,[n])}catch(r){}}return e};if(s(p,y),y.prototype=p.prototype,h.inPlace(y.prototype,[&quot;open&quot;,&quot;send&quot;],&quot;-xhr-&quot;,c),u.on(&quot;send-xhr-start&quot;,function(t,e){r(t,e),i(e)}),u.on(&quot;open-xhr-start&quot;,r),l){var g=1,b=document.createTextNode(g);new l(a).observe(b,{characterData:!0})}else f.on(&quot;fn-end&quot;,function(t){t[0]&amp;&amp;t[0].type===m||a()})},{}],14:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r&lt;h;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=(new Date).getTime()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&amp;&amp;(n.rxSize=i),this.sameOrigin){var a=t.getResponseHeader(&quot;X-NewRelic-App-Data&quot;);a&amp;&amp;(e.cat=a.split(&quot;, &quot;).pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit(&quot;xhr-done&quot;,[t],t),c(&quot;xhr&quot;,[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if(&quot;json&quot;===n&amp;&amp;null!==e)return e;var r=&quot;arraybuffer&quot;===n||&quot;blob&quot;===n||&quot;json&quot;===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+&quot;:&quot;+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t(&quot;loader&quot;);if(a.xhrWrappable){var c=t(&quot;handle&quot;),s=t(15),f=t(&quot;ee&quot;),u=[&quot;load&quot;,&quot;error&quot;,&quot;abort&quot;,&quot;timeout&quot;],h=u.length,d=t(&quot;id&quot;),p=t(18),l=t(17),m=window.XMLHttpRequest;a.features.xhr=!0,t(13),f.on(&quot;new-xhr&quot;,function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,p&amp;&amp;(p&gt;34||p&lt;10)||window.opera||t.addEventListener(&quot;progress&quot;,function(t){e.lastSize=t.loaded},!1)}),f.on(&quot;open-xhr-start&quot;,function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on(&quot;open-xhr-end&quot;,function(t,e){&quot;loader_config&quot;in NREUM&amp;&amp;&quot;xpid&quot;in NREUM.loader_config&amp;&amp;this.sameOrigin&amp;&amp;e.setRequestHeader(&quot;X-NewRelic-ID&quot;,NREUM.loader_config.xpid)}),f.on(&quot;send-xhr-start&quot;,function(t,e){var n=this.metrics,r=t[0],o=this;if(n&amp;&amp;r){var i=l(r);i&amp;&amp;(n.txSize=i)}this.startTime=(new Date).getTime(),this.listener=function(t){try{&quot;abort&quot;===t.type&amp;&amp;(o.params.aborted=!0),(&quot;load&quot;!==t.type||o.called===o.totalCbs&amp;&amp;(o.onloadCalled||&quot;function&quot;!=typeof e.onload))&amp;&amp;o.end(e)}catch(n){try{f.emit(&quot;internal-error&quot;,[n])}catch(r){}}};for(var a=0;a&lt;h;a++)e.addEventListener(u[a],this.listener,!1)}),f.on(&quot;xhr-cb-time&quot;,function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&amp;&amp;&quot;function&quot;==typeof n.onload||this.end(n)}),f.on(&quot;xhr-load-added&quot;,function(t,e){var n=&quot;&quot;+d(t)+!!e;this.xhrGuids&amp;&amp;!this.xhrGuids[n]&amp;&amp;(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on(&quot;xhr-load-removed&quot;,function(t,e){var n=&quot;&quot;+d(t)+!!e;this.xhrGuids&amp;&amp;this.xhrGuids[n]&amp;&amp;(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on(&quot;addEventListener-end&quot;,function(t,e){e instanceof m&amp;&amp;&quot;load&quot;===t[0]&amp;&amp;f.emit(&quot;xhr-load-added&quot;,[t[1],t[2]],e)}),f.on(&quot;removeEventListener-end&quot;,function(t,e){e instanceof m&amp;&amp;&quot;load&quot;===t[0]&amp;&amp;f.emit(&quot;xhr-load-removed&quot;,[t[1],t[2]],e)}),f.on(&quot;fn-start&quot;,function(t,e,n){e instanceof m&amp;&amp;(&quot;onload&quot;===n&amp;&amp;(this.onload=!0),(&quot;load&quot;===(t[0]&amp;&amp;t[0].type)||this.onload)&amp;&amp;(this.xhrCbStart=(new Date).getTime()))}),f.on(&quot;fn-end&quot;,function(t,e){this.xhrCbStart&amp;&amp;f.emit(&quot;xhr-cb-time&quot;,[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{}],15:[function(t,e,n){e.exports=function(t){var e=document.createElement(&quot;a&quot;),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split(&quot;://&quot;);!r.port&amp;&amp;o[1]&amp;&amp;(r.port=o[1].split(&quot;/&quot;)[0].split(&quot;@&quot;).pop().split(&quot;:&quot;)[1]),r.port&amp;&amp;&quot;0&quot;!==r.port||(r.port=&quot;https&quot;===o[0]?&quot;443&quot;:&quot;80&quot;),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],&quot;/&quot;!==r.pathname.charAt(0)&amp;&amp;(r.pathname=&quot;/&quot;+r.pathname);var i=!e.protocol||&quot;:&quot;===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&amp;&amp;e.port===n.port;return r.sameOrigin=i&amp;&amp;(!e.hostname||a),r}},{}],16:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[(new Date).getTime()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t(&quot;handle&quot;),a=t(19),c=t(20),s=t(&quot;ee&quot;).get(&quot;tracer&quot;),f=NREUM;&quot;undefined&quot;==typeof window.newrelic&amp;&amp;(newrelic=f);var u=[&quot;setPageViewName&quot;,&quot;setCustomAttribute&quot;,&quot;setErrorHandler&quot;,&quot;finished&quot;,&quot;addToTrace&quot;,&quot;inlineHit&quot;,&quot;addRelease&quot;],h=&quot;api-&quot;,d=h+&quot;ixn-&quot;;a(u,function(t,e){f[e]=o(h+e,!0,&quot;api&quot;)}),f.addPageAction=o(h+&quot;addPageAction&quot;,!0),f.setCurrentRouteName=o(h+&quot;routeName&quot;,!0),e.exports=newrelic,f.interaction=function(){return(new r).get()};var p=r.prototype={createTracer:function(t,e){var n={},r=this,o=&quot;function&quot;==typeof e;return i(d+&quot;tracer&quot;,[Date.now(),t,n],r),function(){if(s.emit((o?&quot;&quot;:&quot;no-&quot;)+&quot;fn-}}}&lt;/span&gt;\n&lt;&lt;next 500ms&gt;&gt;&lt;&lt;replace &quot;#scaryCode&quot;&gt;&gt;&lt;span id=&quot;return&quot;&gt;[[Return to Game.|$return][$gamestart to 1]]&lt;/span&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;\n\n</div><div tiddler="1servqServ" tags="dock" created="201708260113" modifier="twee">Most of the castle's servants are amateurs and refugees.  The King had a habit of staffing his needs with people who had otherwise run out of luck.  The desperate were often easily inspired to loyalty, sure, but she suspected the King hadn't even realized how wise a choice it truly was; that it was kind was likely enough for him.</div><div tiddler="chainarmor" tags="nobr" created="201612131619" modifier="twee">&lt;&lt;set $armorname to &quot;Chain Armor&quot;&gt;&gt;\n&lt;&lt;set $armor_ui to &quot;chain_ui&quot;&gt;&gt;\n\n&lt;&lt;set $aatk to 1.0&gt;&gt;\n&lt;&lt;set $adef to 1.1&gt;&gt;\n&lt;&lt;set $amov to 0.9&gt;&gt;\n\n&lt;&lt;if $chainplus eq 1&gt;&gt;\n\t&lt;&lt;set $adef to 1.2&gt;&gt;\n\t&lt;&lt;set $amov to 1.0&gt;&gt;\n\t&lt;&lt;set $armorname to &quot;Chain Armor+&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="menu_directory1" tags="annotation" created="201701230932" modifier="twee">^\n|_-armor\n\n&lt;-character\n\nequipment-&gt;</div><div tiddler="numberpool-style" tags="stylesheet" created="201702242336" modifier="twee" twine-position="430,570">/*! &lt;&lt;numberpool&gt;&gt; macro set for SugarCube 2.x */\ndiv[id|=&quot;numberbox-body&quot;] {\n\tdisplay: inline-block;\n}\ndiv[id|=&quot;numberbox-body&quot;] input {\n\tmin-width: 3em;\n\twidth: 3em;\n\ttext-align: center;\n}\ndiv[id|=&quot;numberbox-body&quot;] button {\n\tfont-family: &quot;tme-fa-icons&quot;;\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\ttext-transform: none;\n\tline-height: normal;\n\tspeak: none;\n\tpadding: 0.4em 0.6em;\n}\ndiv[id|=&quot;numberbox-body&quot;] button[id|=&quot;numberbox-minus&quot;] {\n\tmargin-right: 0.4em;\n}\ndiv[id|=&quot;numberbox-body&quot;] button[id|=&quot;numberbox-plus&quot;] {\n\tmargin-left: 0.4em;\n}\n\ndiv[id|=&quot;numberslider-body&quot;] {\n\tdisplay: inline-block;\n}\ndiv[id|=&quot;numberslider-body&quot;] span {\n\tdisplay: inline-block;\n\t/*font-size: 1.25em;*/\n\tmargin-left: 0.25em;\n\tmin-width: 3em;\n\ttext-align: center;\n\tvertical-align: middle;\n}\ndiv[id|=&quot;numberslider-body&quot;] input {\n\t-webkit-appearance: none;\n\tcursor: pointer;\n\theight: 1.25em;\n\tmin-width: 20em;\n\tvertical-align: middle;\n}\ndiv[id|=&quot;numberslider-body&quot;] input:focus {\n\toutline: none;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-webkit-slider-runnable-track {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 10px;\n\twidth: 100%;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-webkit-slider-thumb {\n\t-webkit-appearance: none;\n\tbackground: #35a;\n\tborder: 1px solid #57c;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 18px;\n\tmargin-top: -5px;\n\twidth: 33px;\n}\ndiv[id|=&quot;numberslider-body&quot;] input:focus::-webkit-slider-runnable-track {\n\tbackground: #222;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-moz-range-track {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 10px;\n\twidth: 100%;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-moz-range-thumb {\n\tbackground: #35a;\n\tborder: 1px solid #57c;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 18px;\n\twidth: 33px;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-ms-track {\n\tbackground: transparent;\n\tborder-color: transparent;\n\tcolor: transparent;\n\tcursor: pointer;\n\theight: 10px;\n\twidth: 99%; /* fallback for MS browsers without support for calc() */\n\twidth: calc(100% - 1px);\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-ms-fill-lower {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-ms-fill-upper {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n}\ndiv[id|=&quot;numberslider-body&quot;] input::-ms-thumb {\n\tbackground: #35a;\n\tborder: 1px solid #57c;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 16px;\n\twidth: 33px;\n}\n</div><div tiddler="0cyinspect" tags="dock" created="201701070315" modifier="twee">Elesun takes a quick look around.\n\nThe courtyard is strangely removed from what's happening in the rest of the castle--it looks the same as it always does.  It's grassy and populated by squat trees, with a dirt pathway leading from the door in the wall behind her to the gate.</div><div tiddler="0choice3comfort" tags="scene" created="201701242357" modifier="twee">&lt;&lt;image &quot;RipPtKid&quot;&gt;&gt;&quot;How are you holding up?&quot; Elesun asks, sitting on the floor next to Ripley.\n&lt;&lt;set $comfortRip to 1&gt;&gt;\nShe doesn't reply.\n\n&quot;You don't have to talk to me.  I just want to tell you that I'm impressed with how you handled yourself out there.  I don't give you enough credit.&quot;\n\nElesun sits there for a while in silence, and Ripley finally speaks up.  &quot;I thought you were going to die, too,&quot; she whispers.\n\n&quot;I'm not going anywhere,&quot; Elesun says, putting an arm around her and squeezing her.  &quot;I need to go talk to the king.  Hang in there, girl.&quot;\n\nRipley nods, and Elesun stands up and head back to the throne room.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;prol6&quot;&gt;&gt;</div><div tiddler="ch1-2-real" tags="scene save" created="201701281955" modifier="twee">September 16, 1101: ''Two day later.''\n&lt;&lt;set $drawOrNot to 0&gt;&gt;\n&quot;We're here,&quot; one of the guards says.\n\nIt's late in the evening, and the grove is dark save for a fire burning in its senter, though Elesun can't see anyone tending it from where she is.  The Druids were particular, and wouldn't have appreciated the horses and wagon trampling too much closer.\n\nAll things considered, they made pretty good time.  Stops to water, rest, and feed the horses went by without a hitch, and they only passed the ocassional traveler or caravan on the road.  No one paid them any mind.\n\n&quot;I'll tie up the horses,&quot; the driver says, climbing down.  Elesun, Ripely, and the guards step out, stretching.  &quot;Should we unload now, Lady Elesun?&quot; one of the guards asks.\n\n&quot;Yes, thanks.  Ripley and I will go and let the Druids know we're here then come back to help.\n\n&quot;Let's go,&quot; Ripley says, jogging toward the grove.\n\nElesun follows behind.\n\n&lt;&lt;ctrlCon '1tocamp1'&gt;&gt;</div><div tiddler="irelith15_stats" tags="nobr" created="201612132246" modifier="twee">&lt;&lt;set $allyname to &quot;Irelith&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 2.2&gt;&gt;\n\n&lt;&lt;set $allylvl to 15&gt;&gt;\n&lt;&lt;set $allymaxhealth to 4&gt;&gt;\n&lt;&lt;set $allymaxgrit to 275&gt;&gt;\n&lt;&lt;set $allyatk to 101&gt;&gt;\n&lt;&lt;set $allydef to 117&gt;&gt;\n&lt;&lt;set $allymov to 91&gt;&gt;\n&lt;&lt;set $allymagic to 91&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;guard&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Guard&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 1&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="0protectking2wall" tags="dock" created="201701260031" modifier="twee">&lt;&lt;if $helpServants is 0&gt;&gt;No doubt the work of that witch.  No need for the gate.&lt;&lt;else&gt;&gt;Elesun has seen magic like this before--it turns stone to mud.  That woman in black she saw on the wall must've been a witch.&lt;&lt;endif&gt;&gt;</div><div tiddler="healthinfo" tags="" created="201612151717" modifier="twee">\nWhen grit is reduced to 0, you lose a health point (represented by a heart on the combat screen) and grit is refilled.  Unlike grit, which heals after every combat, health can only be restored by resting.\n\n</div><div tiddler="1cyRelax" tags="scene" created="201702191109" modifier="twee">Elesun sits down on the grass and relaxes for a few minutes.  The breeze feels nice, and she can smell the trees and the grass.  She shuts her eyes, feels the warm sun on her skin.\n\nShe stands back up feeling refreshed.\n&lt;&lt;set $relax to 1&gt;&gt;\n&lt;&lt;ctrlCon &quot;1courtyard&quot;&gt;&gt;</div><div tiddler="effecttester" tags="test menu" created="201701070608" modifier="twee" twine-position="2250,850">&lt;&lt;link &quot;Attack&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;attack&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Critical Hit&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;critical&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Damage 1&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;hurt1&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Damage 2&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;hurt2&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Damage 3&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;hurt3&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Health Damage 1&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;damage&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Health Damage 2&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;damage2&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Interact&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;equip&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Walking&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;steps&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Beep&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;beep&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Turn Page&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;page&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 1&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 2&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage2&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 3&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage3&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 4&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage4&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 5&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage5&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 6&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage6&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 7&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage7&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 8&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage8&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 9&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage9&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Transform 10&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage10&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Lose Rage 1&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage-drop1&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Lose Rage 2&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage-drop2&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Lose Rage 3&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage-drop3&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Lose Rage 4&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage-drop4&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Lose Rage 5&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rage-drop5&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Line: Good&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rip-good&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Line: Good (Alt)&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rip-good2&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Line: Careful!&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rip-careful&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Line: If you insist.&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rip-insist&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Line: Die!&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;rip-die&quot; play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Desperation Attack 1&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-1&quot; stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-1&quot; unloop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Desperation Attack 2&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-2&quot; stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-2&quot; unloop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Desperation Attack 3&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-3&quot; stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-3&quot; unloop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Desperation Attack 4&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-4&quot; stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-4&quot; unloop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Desperation Attack 5&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-5&quot; stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-5&quot; unloop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Desperation Attack (Ripley special)&quot;&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-R&quot; stop&gt;&gt;&lt;&lt;playlist &quot;desp-atk-R&quot; unloop play&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n[[Music|musictester]]\n\n[[Back|debug_features]]\n\n\n\n\n\n\n</div><div tiddler="bugcodegen" tags="nobr deprecated" created="201701120458" modifier="twee">/%&lt;&lt;set $strtrue to $strrank + &quot;&quot;&gt;&gt;\n&lt;&lt;if $strrank is 10&gt;&gt;\n\t&lt;&lt;set $strtrue to &quot;10&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $strtrue to &quot;0&quot; + $strrank&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $agitrue to $agirank + &quot;&quot;&gt;&gt;\n&lt;&lt;if $agirank is 10&gt;&gt;\n\t&lt;&lt;set $agitrue to &quot;10&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $agitrue to &quot;0&quot; + $agirank&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $endtrue to $endrank + &quot;&quot;&gt;&gt;\n&lt;&lt;if $endrank is 10&gt;&gt;\n\t&lt;&lt;set $endtrue to &quot;10&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $endtrue to &quot;0&quot; + $endrank&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $wiltrue to $wilrank + &quot;&quot;&gt;&gt;\n&lt;&lt;if $wilrank is 10&gt;&gt;\n\t&lt;&lt;set $wiltrue to &quot;10&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $wiltrue to &quot;0&quot; + $wilrank&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $cngtrue to $cngrank + &quot;&quot;&gt;&gt;\n&lt;&lt;if $cngrank is 10&gt;&gt;\n\t&lt;&lt;set $cngtrue to &quot;10&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $cngtrue to &quot;0&quot; + $cngrank&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $lvltrue to $lvl + &quot;&quot;&gt;&gt;\n&lt;&lt;if $lvl lt 10&gt;&gt;\n\t&lt;&lt;set $lvltrue to &quot;0&quot; + $lvltrue&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $lvltrue to &quot;&quot; + $lvltrue&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $xptrue to $xp + &quot;&quot;&gt;&gt;\n&lt;&lt;if $xp lt 100 and $xp gte 10&gt;&gt;\n\t&lt;&lt;set $xptrue to &quot;0&quot; + $xptrue&gt;&gt;\n&lt;&lt;elseif $xp lt 10 and $xp gte 1&gt;&gt;\n\t&lt;&lt;set $xptrue to &quot;00&quot; + $xptrue&gt;&gt;\n&lt;&lt;elseif $xp is 0&gt;&gt;\n\t&lt;&lt;set $xptrue to &quot;000&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $tptrue to $tp + &quot;&quot;&gt;&gt;\n&lt;&lt;if $tp gt 100&gt;&gt;\n\t&lt;&lt;set $tptrue to &quot;0&quot; + $tptrue&gt;&gt;\n&lt;&lt;elseif $tp lt 100 and $tp gte 10&gt;&gt;\n\t&lt;&lt;set $tptrue to &quot;00&quot; + $tptrue&gt;&gt;\n&lt;&lt;elseif $tp lt 10 and $tp gte 1&gt;&gt;\n\t&lt;&lt;set $tptrue to &quot;000&quot; + $tptrue&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $tptrue to &quot;0000&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $scarstrue to $scars + &quot;&quot;&gt;&gt;\n&lt;&lt;if $scars gte 100&gt;&gt;\n\t&lt;&lt;set $scarstrue to 99&gt;&gt;\n&lt;&lt;elseif $scars lt 100 and $scars gte 10&gt;&gt;\n\t&lt;&lt;set $scarstrue to $scarstrue&gt;&gt;\n&lt;&lt;elseif $scars lt 10 and $scars gte 1&gt;&gt;\n\t&lt;&lt;set $scarstrue to &quot;0&quot; + $scarstrue&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $scarstrue to &quot;00&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $character is &quot;Elesun&quot;&gt;&gt;\n\t&lt;&lt;set $chartrue to &quot;Ele&quot;&gt;&gt;\n&lt;&lt;elseif $character is &quot;Ripley&quot;&gt;&gt;\n\t&lt;&lt;set $chartrue to &quot;Rip&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $chartrue to &quot;Unk&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $statstrue to &quot;.&quot; + $strtrue + $agitrue + $endtrue + $wiltrue + $cngtrue + $statbase&gt;&gt;\n\n&lt;&lt;set $unarmedtrue to 1 + $unarmedtraining&gt;&gt;\n&lt;&lt;set $longswordtrue to 1 + $longswordtraining&gt;&gt;\n&lt;&lt;set $greatswordtrue to $gswordhave + $greatswordtraining&gt;&gt;\n&lt;&lt;set $katanatrue to $katanahave + $katanatraining&gt;&gt;\n&lt;&lt;set $speartrue to $spearhave + $speartraining&gt;&gt;\n&lt;&lt;set $sideswordtrue to $sswordhave + $sideswordtraining&gt;&gt;\n&lt;&lt;set $gauntletstrue to $gauntletshave + $gauntletstraining&gt;&gt;\n&lt;&lt;set $scythetrue to $scythehave + $scythetraining&gt;&gt;\n&lt;&lt;set $sabertrue to $saberhave + $sabertraining&gt;&gt;\n&lt;&lt;set $axetrue to $axehave + $battleaxetraining&gt;&gt;\n\n&lt;&lt;set $weaponstrue to $unarmedtrue + &quot;.&quot; + $longswordtrue + &quot;.&quot; + $greatswordtrue + &quot;.&quot; + $katanatrue + &quot;.&quot; + $speartrue + &quot;.&quot; + $sideswordtrue + &quot;.&quot; + $gauntletstrue + &quot;.&quot; + $scythetrue + &quot;.&quot; + $sabertrue + &quot;.&quot; + $axetrue&gt;&gt;\n\n&lt;&lt;set $neutraltrue to $neutralhave + $neutraltraining&gt;&gt;\n&lt;&lt;set $naturaltrue to $naturalhave + $naturaltraining&gt;&gt;\n&lt;&lt;set $lighttrue to $lighthave + $lighttraining&gt;&gt;\n&lt;&lt;set $darktrue to $darkhave + $darktraining&gt;&gt;\n&lt;&lt;set $hellishtrue to $hellishhave + $hellishtraining&gt;&gt;\n\n&lt;&lt;set $spellstrue to $neutraltrue + &quot;.&quot; + $naturaltrue + &quot;.&quot; + $lighttrue + &quot;.&quot; + $darktrue + &quot;.&quot; + $hellishtrue&gt;&gt;\n\n&lt;&lt;set $clothtrue to $clothhave + $clothplus&gt;&gt;\n&lt;&lt;set $leathertrue to $leatherhave + $leatherplus&gt;&gt;\n&lt;&lt;set $chaintrue to $chainhave + $chainplus&gt;&gt;\n&lt;&lt;set $platetrue to $platehave + $plateplus&gt;&gt;\n\n&lt;&lt;set $armortrue to $clothtrue + &quot;.&quot; + $leathertrue + &quot;.&quot; + $chaintrue + &quot;.&quot; + $platetrue&gt;&gt;\n\n&lt;&lt;set $banglestrue to $bangles + &quot;&quot;&gt;&gt;\n\n&lt;&lt;set $inventorytrue to $weaponstrue + &quot;-&quot; + $spellstrue + &quot;-&quot; + $armortrue + &quot;-&quot; + $banglestrue&gt;&gt;\n\n&lt;&lt;set $bugcode to $versionnumber + &quot;c&quot; + $chapter + &quot;.&quot; + $storystage + &quot;:&quot; + $dockmode + $mobile + $combatimages + $audioswitch + $masteraudioswitch + $demomode + $debug + &quot;:&quot; + $lvltrue + &quot;-&quot; + $xptrue + &quot;-&quot; + $tptrue + &quot;-&quot; + $scarstrue + &quot;.&quot; + $chartrue + $statstrue + &quot;:&quot; + $inventorytrue + &quot;:&quot; + $return&gt;&gt;%/\n\n\n\n\n\n\n\n\n</div><div tiddler="1cyStone" tags="scene" created="201702191101" modifier="twee">Elesun picks up the stone.&lt;&lt;set $stoneOne.have to 1&gt;&gt;\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpstones&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;ctrlCon &quot;1courtyard&quot;&gt;&gt;</div><div tiddler="gritbar" tags="nobr" created="201701051148" modifier="twee">&lt;&lt;set $truegrit to Math.trunc(($grit/$maxgrit)*100)&gt;&gt;\n\n&lt;&lt;if $truegrit lt 5&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['0grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 10&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['5grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 15&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['10grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 20&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['15grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 25&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['20grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 30&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['25grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 35&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['30grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 40&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['35grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 45&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['40grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 50&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['45grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 55&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['50grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 60&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['55grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 65&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['60grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 70&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['65grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 75&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['70grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 80&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['75grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 85&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['80grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 90&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['85grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 95&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['90grit'])&gt;&gt;\n&lt;&lt;elseif $truegrit lt 100&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['95grit'])&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $gritdisplay to clone(setup.ui.grit['100grit'])&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n\n\n</div><div tiddler="allyai" tags="nobr" created="201612160711" modifier="twee"></div><div tiddler="0aesil4Rip2" tags="scene" created="201701260155" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;Ripley lunges at Aesil with a punch as Elesun climbs back to her feet.\n\nRipley's arm sinks into Aesil's chest and keeps going, tearing through it until her fist explodes out the other side.  Aesil screams and starts swinging, and manages to knock Ripley to the ground.\n\n&lt;&lt;journallink &quot;The king&quot; &quot;codex_King&quot;&gt;&gt; and Folsom rush from the throne room next.  Folsom hits Aesil with a beam of hellish energy, sending him flying back, and the king rushes to Ripley, scoops her up, and takes her back inside.\n\nElesun stands still, amazed at Ripley's strength.\n\n&quot;She managed to hurt him,&quot; &lt;&lt;journallink &quot;Folsom&quot; &quot;codex_Folsom&quot;&gt;&gt; says.  &quot;He may not come back.  And the sell swords are fleeing.  The day is ours.&quot;\n\n&quot;I don't believe it,&quot; Elesun says.\n\n&quot;Guard them.  I'll make sure we've driven &lt;&lt;journallink &quot;Aesil&quot; &quot;codex_Aesil&quot;&gt;&gt; away.&quot;\n\n&quot;Yeah, you got it.&quot;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0backtothrone&quot; &quot;leave&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="rank5lvl3_witch" tags="nobr" created="201701242349" modifier="twee">&lt;&lt;set $enemyname to &quot;Wicked Witch&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 5&gt;&gt;\n&lt;&lt;set $enemypower to 275&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme[&quot;ghostwoman&quot;]&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 180&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 2&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 50&gt;&gt;\n&lt;&lt;set $nmedef to 56&gt;&gt;\n&lt;&lt;set $nmemov to 51&gt;&gt;\n&lt;&lt;set $nmemagic to 54&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;swamp&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 1&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 8&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.75&gt;&gt;\n&lt;&lt;set $nmespellpower to 85&gt;&gt;\n&lt;&lt;set $nmeacc to 80&gt;&gt;\n&lt;&lt;set $nmebaseregen to 7&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 3&gt;&gt;\n&lt;&lt;set $nmetype to 3&gt;&gt;\n\n&lt;&lt;set $nmexp to 20&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;</div><div tiddler="sq1descr" tags="menu" created="201704221625" modifier="twee">/%open as alert/popup%/&lt;&lt;if $sq1.progress lt 9&gt;&gt;\s\nThe castle's head blacksmith needs more time to complete his repairs of the soldiers' equipment, and isn't quite sure how to bring it up to his Majesty.  Maybe Elesun could talk to the king on his behalf?\n&lt;&lt;else&gt;&gt;\s\n/%open as alert/popup%/Elesun convinced the king to give the head blacksmith more time.  Visit the journal to complete this quest!\s\n&lt;&lt;endif&gt;&gt;</div><div tiddler="0wall3Folsom" tags="dock" created="201701250433" modifier="twee">Folsom was the king's court sorcerer and most trusted advisor.  He taught crown prince Harlaus and Ripley law, bound magic, and mathematics.  He was getting older now, but in his younger days, he apparently used to be quite dashing.\n\nHe was kind, but also a master of hellish magic and by far the most powerful wizard Elesun had ever met.</div><div tiddler="Shadow Veil" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;shad_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;shad&quot;]]\n[[No|spellswap]]</div><div tiddler="Battle Axe" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;baxe_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;axe&quot;]]\n[[No|weaponswap]]</div><div tiddler="Aesil-boss-1-1" tags="nobr" created="201707261209" modifier="twee">/% Aesil's stats %/\n&lt;&lt;set $enemyname to &quot;Dark Mage Aesil&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 6&gt;&gt;\n&lt;&lt;set $enemypower to 1366&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme[&quot;NME_aes2&quot;]&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 250&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 10&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 63&gt;&gt;\n&lt;&lt;set $nmedef to 62&gt;&gt;\n&lt;&lt;set $nmemov to 58&gt;&gt;\n&lt;&lt;set $nmemagic to 65&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;break&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 7&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 9&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.9&gt;&gt;\n&lt;&lt;set $nmespellpower to 100&gt;&gt;\n&lt;&lt;set $nmeacc to 100&gt;&gt;\n&lt;&lt;set $nmebaseregen to 17&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 5&gt;&gt;\n&lt;&lt;set $nmetype to 1&gt;&gt;\n\n&lt;&lt;set $nmexp to 100&gt;&gt;\n\n&lt;&lt;set $bossFight to true&gt;&gt;\n&lt;&lt;set $theme to 'AesBossTheme'&gt;&gt;\n&lt;&lt;set $hookPull to 'Aesil-hook-pull'&gt;&gt;\n&lt;&lt;set $phase to 0&gt;&gt;\n&lt;&lt;set $bossPoints to 0&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;\n\n/% setup hooks for fight %/\n&lt;&lt;onNMEheartDam 'Aesil_phase'&gt;&gt;\n&lt;&lt;onDespAtk 'Aesil_phase'&gt;&gt;\n&lt;&lt;onEachAtk 'Aesil_phase'&gt;&gt;\n&lt;&lt;onNMEgritDam 'Aesil_phase'&gt;&gt;</div><div tiddler="char-setup" tags="init" created="201707082153" modifier="twee" twine-position="570,150">&lt;&lt;set $tp to 3&gt;&gt;\n&lt;&lt;set $xp to 0&gt;&gt;\n\n&lt;&lt;set $basedispel to 5&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Protect&quot;&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n\n&lt;&lt;set $spellcrit to 0&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 5&gt;&gt;\n&lt;&lt;set $spellgrit to 10&gt;&gt;\n&lt;&lt;set $spelldispel to 10&gt;&gt;\n\n&lt;&lt;set $spellname to &quot;Protect&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Neutral&quot;&gt;&gt;\n\n&lt;&lt;set $scars to 4&gt;&gt;\n\n&lt;&lt;set $regenmult to 1.0&gt;&gt;\n&lt;&lt;set $bangles to 0&gt;&gt;\n\n&lt;&lt;set $wStaUse to 5&gt;&gt;\n&lt;&lt;set $weaponname to &quot;Longsword&quot;&gt;&gt;\n&lt;&lt;set $armorname to &quot;Leather Armor&quot;&gt;&gt;\n&lt;&lt;set $critrange to 100&gt;&gt;\n\n&lt;&lt;set $armorname to &quot;Leather Armor&quot;&gt;&gt;\n\n&lt;&lt;set $character to &quot;Elesun&quot;&gt;&gt;\n\n&lt;&lt;set $lvl to 2&gt;&gt;\n\n&lt;&lt;set $firstRest to false&gt;&gt;</div><div tiddler="1tocamp1" tags="scene" created="201701281955" modifier="twee">Ripley has stopped in the center of the grove.  She isn't moving, just standing there, with her back to Elesun.\n\n&quot;Ripley?&quot; Elesun calls.\n\nRipley doesn't move.\n\n[[Draw and run to her side.|1tocamp2][$drawOrNot to 1]]\n\n[[Stay calm, but trot over to her.|1tocamp2][$drawOrNot to 0]]</div><div tiddler="deserter_captain" tags="nobr" created="201702120558" modifier="twee">&lt;&lt;set $enemyname to &quot;Deserter Captain&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 7&gt;&gt;\n&lt;&lt;set $enemypower to 158&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme[&quot;NME_warrior&quot;]&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 148&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 2&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 33&gt;&gt;\n&lt;&lt;set $nmedef to 33&gt;&gt;\n&lt;&lt;set $nmemov to 31&gt;&gt;\n&lt;&lt;set $nmemagic to 0&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 0&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 5&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.4&gt;&gt;\n&lt;&lt;set $nmespellpower to 0&gt;&gt;\n&lt;&lt;set $nmeacc to 100&gt;&gt;\n&lt;&lt;set $nmebaseregen to 3&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 3&gt;&gt;\n&lt;&lt;set $nmetype to 1&gt;&gt;\n\n&lt;&lt;set $nmexp to 15&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;</div><div tiddler="agiinfo" tags="" created="201612151656" modifier="twee">\nA measure of speed and nimbleness.  Agility greatly influences movement, as well as critical chance, critical damage, and dodge chance.\n\n</div><div tiddler="vow-list-current" tags="" created="201710230747" modifier="twee" twine-position="570,1130">&lt;&lt;if $vows.current.length lte 0&gt;&gt;\s\n\tNo current vows.\s\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;for _i to 0; _i lt $vows.current.length; _i++&gt;&gt;\s\n\t\t&lt;&lt;set _v to $vows.current[_i]&gt;&gt;\s\n\t\t&lt;&lt;capture _v&gt;&gt;\s\n\t\t\t&lt;&lt;link setup.vows.list[_v].title&gt;&gt;\n\t\t\t\t&lt;&lt;dialog `'Vow: ' + setup.vows.list[_v].title` 'vow'&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;- setup.vows.list[_v].descr&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;if setup.vows.list[_v].outc&gt;&gt;\n\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;&lt;- setup.vows.list[_v].outc&gt;&gt;\s\n\t\t\t\t\t&lt;&lt;endif&gt;&gt;\s\n\t\t\t\t&lt;&lt;/dialog&gt;&gt;\n\t\t\t&lt;&lt;/link&gt;&gt;\n\t\t&lt;&lt;/capture&gt;&gt;\s\n\t&lt;&lt;/for&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="combatexplanation3menu" tags="menu" created="201612181745" modifier="twee">&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut3][combatexplanation4menu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;combatexplanation4menu&quot;&gt;&gt;</div><div tiddler="volSetting1" tags="depr" created="201704222240" modifier="twee">Volume: &lt;span id=&quot;vol&quot;&gt;&lt;&lt;print $volStr&gt;&gt;&lt;/span&gt; \s\n&lt;&lt;button &quot;-&quot;&gt;&gt;&lt;&lt;silently&gt;&gt;\n  &lt;&lt;if $vol lte 1&gt;&gt;\n    &lt;&lt;set $vol to 1&gt;&gt;\n    &lt;&lt;masteraudio volume 0.05&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;set $vol--&gt;&gt;\n    &lt;&lt;switch $vol&gt;&gt;\n    &lt;&lt;case 1&gt;&gt;\n      &lt;&lt;masteraudio volume 0.10&gt;&gt;\n    &lt;&lt;case 2&gt;&gt;\n      &lt;&lt;masteraudio volume 0.20&gt;&gt;\n    &lt;&lt;case 3&gt;&gt;\n      &lt;&lt;masteraudio volume 0.30&gt;&gt;\n    &lt;&lt;case 4&gt;&gt;\n      &lt;&lt;masteraudio volume 0.40&gt;&gt;\n    &lt;&lt;case 5&gt;&gt;\n      &lt;&lt;masteraudio volume 0.50&gt;&gt;\n    &lt;&lt;case 6&gt;&gt;\n      &lt;&lt;masteraudio volume 0.60&gt;&gt;\n    &lt;&lt;case 7&gt;&gt;\n      &lt;&lt;masteraudio volume 0.70&gt;&gt;\n    &lt;&lt;case 8&gt;&gt;\n      &lt;&lt;masteraudio volume 0.80&gt;&gt;\n    &lt;&lt;case 9&gt;&gt;\n      &lt;&lt;masteraudio volume 0.90&gt;&gt;\n    &lt;&lt;case 10&gt;&gt;\n      &lt;&lt;masteraudio volume 1.00&gt;&gt;\n    &lt;&lt;default&gt;&gt;\n      &lt;&lt;masteraudio volume 1.00&gt;&gt;\n    &lt;&lt;/switch&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n  &lt;&lt;set $volStr to $vol&gt;&gt;\n  &lt;&lt;if $vol lt 10&gt;&gt;\n    &lt;&lt;set $volStr to &quot;0&quot; + $volStr&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n  &lt;&lt;replace &quot;#vol&quot;&gt;&gt;\s\n    &lt;&lt;print $volStr&gt;&gt;\s\n  &lt;&lt;/replace&gt;&gt;\n&lt;&lt;endsilently&gt;&gt;&lt;&lt;/button&gt;&gt; \s\n&lt;&lt;button &quot;+&quot;&gt;&gt;&lt;&lt;silently&gt;&gt;\n  &lt;&lt;if $vol gte 10&gt;&gt;\n    &lt;&lt;set $vol to 10&gt;&gt;\n    &lt;&lt;masteraudio volume 1.00&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;set $vol++&gt;&gt;\n    &lt;&lt;switch $vol&gt;&gt;\n    &lt;&lt;case 1&gt;&gt;\n      &lt;&lt;masteraudio volume 0.10&gt;&gt;\n    &lt;&lt;case 2&gt;&gt;\n      &lt;&lt;masteraudio volume 0.20&gt;&gt;\n    &lt;&lt;case 3&gt;&gt;\n      &lt;&lt;masteraudio volume 0.30&gt;&gt;\n    &lt;&lt;case 4&gt;&gt;\n      &lt;&lt;masteraudio volume 0.40&gt;&gt;\n    &lt;&lt;case 5&gt;&gt;\n      &lt;&lt;masteraudio volume 0.50&gt;&gt;\n    &lt;&lt;case 6&gt;&gt;\n      &lt;&lt;masteraudio volume 0.60&gt;&gt;\n    &lt;&lt;case 7&gt;&gt;\n      &lt;&lt;masteraudio volume 0.70&gt;&gt;\n    &lt;&lt;case 8&gt;&gt;\n      &lt;&lt;masteraudio volume 0.80&gt;&gt;\n    &lt;&lt;case 9&gt;&gt;\n      &lt;&lt;masteraudio volume 0.90&gt;&gt;\n    &lt;&lt;case 10&gt;&gt;\n      &lt;&lt;masteraudio volume 1.00&gt;&gt;\n    &lt;&lt;default&gt;&gt;\n      &lt;&lt;masteraudio volume 1.00&gt;&gt;\n    &lt;&lt;/switch&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n  &lt;&lt;set $volStr to $vol&gt;&gt;\n  &lt;&lt;if $vol lt 10&gt;&gt;\n    &lt;&lt;set $volStr to &quot;0&quot; + $volStr&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n  &lt;&lt;replace &quot;#vol&quot;&gt;&gt;\s\n    &lt;&lt;print $volStr&gt;&gt;\s\n  &lt;&lt;/replace&gt;&gt;\n&lt;&lt;endsilently&gt;&gt;&lt;&lt;/button&gt;&gt; \s</div><div tiddler="def_comUI" tags="dock" created="201702020322" modifier="twee">''Defense''\n\nDefense reduces the damage you take.  Using the &quot;defend&quot; action ends your turn and increases defense based on, among other things, how much stamina you have left.  Your current Defense Rating is &lt;&lt;print $def&gt;&gt;.\n\n[img[setup.ui.icons.ui_dodge]] Your dodge rating is: &lt;&lt;print Math.trunc($dodge)&gt;&gt;\n\n[img[setup.ui.icons.ui_disp]] Your dispel rating is: &lt;&lt;print Math.trunc($dispel)&gt;&gt;\n\n&lt;&lt;name&gt;&gt; will automatically dodge attacks and dispel spells.  She will do so with greater frequency the higher the respective rating is.\n</div><div tiddler="0iwlever2" tags="change" created="201701070320" modifier="twee">&lt;&lt;set $courtyardgate to 1&gt;&gt;Elesun pulls the lever.  It's heavy and hard to pull, but clicks into place.  She hears the clicking of a mechanism somewhere inside the stone wall, and then the creaking of the gate in the courtyard.\n\n&lt;&lt;ctrlClick &quot;Okay.&quot; &quot;0insidethewall&quot;&gt;&gt;</div><div tiddler="shakestyle" tags="stylesheet" created="201612172140" modifier="twee" twine-position="290,570">/*! &lt;&lt;shake&gt;&gt; macro set for SugarCube 2.x */\n@-webkit-keyframes shakeanim {\n\t0% { -webkit-transform: translate(2px, 1px) rotate(0deg); }\n\t10% { -webkit-transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { -webkit-transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { -webkit-transform: translate(0px, 2px) rotate(0deg); }\n\t40% { -webkit-transform: translate(1px, -1px) rotate(1deg); }\n\t50% { -webkit-transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { -webkit-transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { -webkit-transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { -webkit-transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { -webkit-transform: translate(2px, 2px) rotate(0deg); }\n\t100% { -webkit-transform: translate(1px, -2px) rotate(-1deg); }\n}\n@-o-keyframes shakeanim {\n\t0% { -o-transform: translate(2px, 1px) rotate(0deg); }\n\t10% { -o-transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { -o-transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { -o-transform: translate(0px, 2px) rotate(0deg); }\n\t40% { -o-transform: translate(1px, -1px) rotate(1deg); }\n\t50% { -o-transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { -o-transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { -o-transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { -o-transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { -o-transform: translate(2px, 2px) rotate(0deg); }\n\t100% { -o-transform: translate(1px, -2px) rotate(-1deg); }\n}\n@keyframes shakeanim {\n\t0% { transform: translate(2px, 1px) rotate(0deg); }\n\t10% { transform: translate(-1px, -2px) rotate(-1deg); }\n\t20% { transform: translate(-3px, 0px) rotate(1deg); }\n\t30% { transform: translate(0px, 2px) rotate(0deg); }\n\t40% { transform: translate(1px, -1px) rotate(1deg); }\n\t50% { transform: translate(-1px, 2px) rotate(-1deg); }\n\t60% { transform: translate(-3px, 1px) rotate(0deg); }\n\t70% { transform: translate(2px, 1px) rotate(-1deg); }\n\t80% { transform: translate(-1px, -1px) rotate(1deg); }\n\t90% { transform: translate(2px, 2px) rotate(0deg); }\n\t100% { transform: translate(1px, -2px) rotate(-1deg); }\n}\n.shake-block,\n.shake {\n\t-webkit-animation-duration: 0.8s;\n\t     -o-animation-duration: 0.8s;\n\t        animation-duration: 0.8s;\n\t-webkit-animation-iteration-count: infinite;\n\t     -o-animation-iteration-count: infinite;\n\t        animation-iteration-count: infinite;\n\t-webkit-animation-name: shakeanim;\n\t     -o-animation-name: shakeanim;\n\t        animation-name: shakeanim;\n\t-webkit-animation-timing-function: linear;\n\t     -o-animation-timing-function: linear;\n\t        animation-timing-function: linear;\n\t-webkit-transform-origin: 50% 50%;\n\t    -ms-transform-origin: 50% 50%;\n\t     -o-transform-origin: 50% 50%;\n\t        transform-origin: 50% 50%;\n}\n.shake-block {\n\tdisplay: block;\n}\n.shake {\n\tdisplay: inline-block;\n}\n</div><div tiddler="1arIre" tags="dock" created="201708281823" modifier="twee">&quot;Sleep good?&quot; Irelith asks as Elesun comes to stand next to her and Folsom.\n\n&quot;Well enough.  Here to see us off?&quot;\n\n&quot;The King wanted to be here too, but an important report has just come in from one of our scouts.&quot;\n\n&quot;Nothing bad?&quot; Elesun asks.\n\n&quot;The word he used was 'unusual,' so I don't so.  Nonetheless, stay vigilant.&quot;\n\n&quot;Okay,&quot; Elesun says.\n\n&quot;Be careful, Elesun,&quot; Irelith says.  &quot;See you in a few days.&quot;</div><div tiddler="rest_scars" tags="nobr" created="201612131835" modifier="twee">&lt;&lt;set $wounds to $wounds + ($health - $maxhealth)&gt;&gt;\n&lt;&lt;set $health to $maxhealth&gt;&gt;\n&lt;&lt;set $day to $day+1&gt;&gt;\n/%scar calculation%/\n&lt;&lt;set $scarReport to 0&gt;&gt;\n&lt;&lt;if $mode is 3&gt;&gt;\n\t&lt;&lt;set $scarchance to 20&gt;&gt;\n&lt;&lt;elseif $mode is 2&gt;&gt;\n\t&lt;&lt;set $scarchance to 30&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $scarchance to 25&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $scarchance to $scarchance + ($wounds * 5)&gt;&gt;\n&lt;&lt;if $wounds gte 5&gt;&gt;\n\t&lt;&lt;set $scarchancesAmt to 2&gt;&gt;\n&lt;&lt;elseif $wounds gte 1&gt;&gt;\n\t&lt;&lt;set $scarchancesAmt to 1&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $scarchancesAmt to 0&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;if !$firstRest&gt;&gt;\n\t&lt;&lt;set $scarchance to 100&gt;&gt;\n\t&lt;&lt;set $scarchancesAmt to 1&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;display &quot;scar_roulette&quot;&gt;&gt;\n\n&lt;&lt;if $scarReport is 0&gt;&gt;\n\t&lt;&lt;set $restScars to &quot;Thankfully, they didn't leave any scars.&quot;&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $restScars to &quot;You have &quot; + $scarReport + &quot;new scars...&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $restReport to &quot;You &quot; + either(&quot;slept well&quot;, &quot;didn't sleep so well&quot;, &quot;slept poorly&quot;, &quot;didn't get much sleep&quot;, &quot;wake up feeling great&quot;) + &quot;.  Some of your wounds have healed!  &quot; + $restScars&gt;&gt;\n\n&lt;&lt;stats&gt;&gt;</div><div tiddler="0towardthethrone" tags="branch save" created="201701140720" modifier="twee">&lt;&lt;set $helpServants to 0&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;Elesun grabs Ripley by the hand and drags her away from the storeroom.\n\n&quot;Elesun!&quot; she says.  &quot;We can't just leave them!&quot;\n\n&quot;You swore an oath to protect and serve your king.  So did I.&quot;\n\n&quot;But what if they need us?&quot;\n\nElesun stops and turns to face Ripley, and places places her hands on Ripley's shoulders.  &quot;Sometimes we have to make hard decisions.  When we can't help everyone, we have to choose who to help.  We're losing a lot of people, good people.  But each and every one of those people would want us to help the king.  Without the king, we have nothing.&quot;\n\nRipley is silent for a moment.  &quot;I know we can't save everyone,&quot; she says, finally.\n\n&quot;Come on, then.&quot;\n\nRipley takes one last look at the storeroom door.  &quot;Fine.&quot;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0mainhall&quot; &quot;leave&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n</div><div tiddler="splash-screen" tags="" created="201707070221" modifier="twee" twine-position="1690,10">&lt;div id='splash'&gt;&lt;span id='splash-title'&gt;\n&lt;h1 class='text-focus-in'&gt;+ Holy Land&lt;/h1&gt;\n&lt;&lt;timed 2s t8n&gt;&gt;Make no vows.&lt;&lt;/timed&gt;&gt;\n&lt;&lt;display 'custom-load-html'&gt;&gt;\n&lt;/span&gt;\n&lt;&lt;nobr&gt;&gt;\n&lt;&lt;script&gt;&gt;\npostdisplay['schlepaudio'] = function (t) {\n\tdelete postdisplay[t];\n\t$.wiki('&lt;&lt;schlepaudio&gt;&gt;');\n\t$(document).on(':schlepaudio', function (e) {\n\t\tvar perc = 100 - Math.trunc((e.leng / 100) * 100);\n\t\tif (perc = 100) {\n\t\t\t$('#load-perc').animate({ 'width' : '100%' }, \n\t\t\t\t5750);\n\t\t\tsetTimeout( function () {\n\t\t\t\t$(document).trigger(':audiofullyloaded');\n\t\t\t}, 6000);\n\t\t} else {\n\t\t\t$('#load-perc').css('width', perc + '%');\n\t\t}\n\t});\n};\n&lt;&lt;/script&gt;&gt;\n@@#load-perc;@@@@#load-perc-title;Loading...@@\n&lt;&lt;endnobr&gt;&gt;\n&lt;/div&gt;\n&lt;&lt;run $('#splash-title').hide().delay(3000).fadeIn('fast');&gt;&gt;</div><div tiddler="1cyInspect" tags="dock" created="201702191054" modifier="twee">Elesun takes a look around.  This is probably her favorite place in the castle, she decides.&lt;&lt;if $relax is 0&gt;&gt;\n\nRelax here for a few minutes?\n\n&lt;&lt;ctrlClick &quot;Sit down on the grass.&quot; &quot;1cyRelax&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="changespell" tags="menu" created="201612131736" modifier="twee">&lt;&lt;audio &quot;equip&quot; play&gt;&gt;Equipment changed!\n\n[[Okay.|equipmenu]]\n\n&lt;&lt;if $change eq &quot;bless&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_blessing&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;expl&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_explosion&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;keen&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_keen&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;poss&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_possessed&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;infr&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_inferno&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;shroud&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_flameshroud&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;disp&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_dispel&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;vigr&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_vigor&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;focs&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_focus&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;shad&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_shadow&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;prot&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_protect&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;gho&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_ghost&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;rage&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_rage&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;heal&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_healing&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;regn&quot;&gt;&gt;\n\t&lt;&lt;display &quot;spell_regeneration&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;stats&gt;&gt;</div><div tiddler="example_enemy" tags="nobr" created="201612141702" modifier="twee">&lt;&lt;set $enemyname to &quot;Enemy&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 0&gt;&gt;\n&lt;&lt;set $enemypower to 30&gt;&gt;\n&lt;&lt;set $enemyimg to &quot;NME_warrior&quot;&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 100&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 2&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 30&gt;&gt;\n&lt;&lt;set $nmedef to 30&gt;&gt;\n&lt;&lt;set $nmemov to 30&gt;&gt;\n&lt;&lt;set $nmemagic to 0&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 0&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 10&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.0&gt;&gt;\n&lt;&lt;set $nmespellpower to 0&gt;&gt;\n&lt;&lt;set $nmeacc to 100&gt;&gt;\n&lt;&lt;set $nmebaseregen to 3&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 3&gt;&gt;\n&lt;&lt;set $nmetype to 1&gt;&gt;\n\n&lt;&lt;set $nmexp to 15&gt;&gt;\n\n/%balanceObj%/\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;\n\n</div><div tiddler="1mainDoor" tags="dock" created="201707110037" modifier="twee">Through the door, the king is alone on his throne.  Must've throne out the advisors and attendants again.\n\n&lt;&lt;ctrlClick 'Go in.' '1throne' 'leave'&gt;&gt;</div><div tiddler="lswd_ui" tags="" created="201702020350" modifier="twee">An ordinary steel longsword.\n\nWell-crafted and balanced for all situations, the longsword is versatile and reliable.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Moderate|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Moderate|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Moderate|\n*__Finesse__: Moderate\n*__Stamina__: Moderate</div><div tiddler="0iwgreatsword2" tags="change" created="201701070319" modifier="twee">&lt;&lt;set $gswordhave to 1&gt;&gt;Elesun decides to take the great sword with her.  It’s better off helping her defend the castle than becoming some sell-sword’s trophy.\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpequip&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;ctrlClick &quot;Okay.&quot; &quot;0insidethewall&quot;&gt;&gt;\n&lt;&lt;notifyInventory 'weapon'&gt;&gt;</div><div tiddler="dock2" tags="test" created="201612191508" modifier="twee" twine-position="1830,850">This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. This is a lot of text. </div><div tiddler="combatexplanationmenu" tags="menu" created="201612181745" modifier="twee">&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut1][combatexplanation2menu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;combatexplanation2menu&quot;&gt;&gt;</div><div tiddler="combat_call_1_2" tags="nobr comcall" created="201701282003" modifier="twee">&lt;&lt;combat &quot;rank3lvl3_assassin&quot; &quot;combat_intro_1_1&quot; &quot;combat_outro_1_1&quot;&gt;&gt;</div><div tiddler="quotes" tags="annotation" created="201701070355" modifier="twee">double check quotation marks--text inside should be green in all code.</div><div tiddler="vow-style" tags="stylesheet" created="201710230800" modifier="twee" twine-position="150,1270">#vow-tray {\n\t/* entire box */\n\theight: 15em;\n\twidth: 30em;\n\tborder: 1px #111 solid;\n}\n\n#vow-title {\n\t/* heading */\n\tpadding: 0.5em;\n\tborder-bottom: 1px black solid;\n}\n\n#vow-tabs {\n\t/* the tabbed links box */\n\tpadding: 0.5em 2.5em;\n\tbackground: #111;\n}\n\n.v-tab {\n\t/* each tabbed link */\n\tpadding: 0.5em 2em;\n\tborder: 1px #fafafa solid;\n}\n\n.v-tab a {\n\tdisplay: inline-block;\n\tcolor: #eee !important;\n}\n\n.v-tab a:hover {\n\tcolor: #fff !important;\n}\n\n.v-tab.selected a {\n\tcolor: #111 !important;\n}\n\n.v-tab.selected a:hover {\n\tcolor: #111 !important;\n\ttext-decoration: none;\n}\n\n.v-tab.selected {\n\t/* change color and remove bottom border */\n\tbackground: #eee;\n}\n\n#vow-list {\n\t/* main component, where vows are listed */\n\tmargin: 1em;\n}</div><div tiddler="0kingsKings" tags="dock" created="201701252204" modifier="twee">As much as Elesun wants to ignore it, she knows that this is the king's fault.  All of it.  Staying here put Ripley in danger.  All the soldiers and servants and villagers that died--all blood on his hands.\n\nAnother part of her knows that isn't fair--he didn't want this, he couldn't have.  But coming here was foolish, it put a big target on the castle.</div><div tiddler="damagecalc_NME" tags="nobr" created="201612160711" modifier="twee">&lt;&lt;set $spellname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $spelldamReport to &quot;&quot;&gt;&gt;\n&lt;&lt;set $effectReport to &quot;&quot;&gt;&gt;\n/%calculate damage%/\n&lt;&lt;set $modifier to either(0.8,0.9,1.1,1.2)&gt;&gt;\n&lt;&lt;set $damagetoplayer to 0&gt;&gt;\n&lt;&lt;set $NMEcritrange to 100&gt;&gt;\n&lt;&lt;set $dodgedatks to 0&gt;&gt;\n&lt;&lt;set $i to 0&gt;&gt;\n&lt;&lt;set $hurtmaker to 0&gt;&gt;\n\n&lt;&lt;if $flinched&gt;&gt;\n\t&lt;&lt;set _flav to either('flinches', 'stumbles', 'staggers', 'is stunned', 'stumbles back', 'nearly falls over')&gt;&gt;\n\t&lt;&lt;set $enemyreport to $enemyname + ' ' + _flav + '.'&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\n&lt;&lt;if $playeraction is 2&gt;&gt;\n\t&lt;&lt;set $reduce to Math.trunc($def*1.5*$NMESpDef)&gt;&gt;\n&lt;&lt;elseif $playeraction is 3&gt;&gt;\n\t&lt;&lt;set $reduce to $mov*$NMESpMov&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $reduce to $def*$NMESpDef&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $damagetoplayerPRE to Math.trunc($nmeatk*$modifier)-($reduce*0.5)&gt;&gt;\n\n&lt;&lt;if $damagetoplayerPRE lt $nmeatk*0.4&gt;&gt;\n\t&lt;&lt;if $playeraction is 2&gt;&gt;\n\t\t&lt;&lt;if $damagetoplayerPRE lt $nmeatk*0.2&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoplayerPRE to Math.trunc($nmeatk*0.2)&gt;&gt;\n\t\t&lt;&lt;else&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoplayerPRE to Math.trunc($damagetoplayerPRE)&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;if $damagetoplayerPRE lt $nmeatk*0.4&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoplayerPRE to Math.trunc($nmeatk*0.4)&gt;&gt;\n\t\t&lt;&lt;else&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoplayerPRE to Math.trunc($damagetoplayerPRE)&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n\n&lt;&lt;if $nmeaction is 3 and $enemyspecial is 0&gt;&gt;\n\t&lt;&lt;set $nmeaction to 1&gt;&gt;\n\t&lt;&lt;set $NMEcritrange to 90&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n\n\n/%action resolution%/\n&lt;&lt;if $nmeaction lt 2&gt;&gt;\n\n\t&lt;&lt;if $nmeaction is 1&gt;&gt;\n\t\t&lt;&lt;set $atkcount to $nmemoveset&gt;&gt;\n\t&lt;&lt;elseif $nmeaction is 1.1&gt;&gt;\n\t\t&lt;&lt;set $atkcount to $nmemoveset-1&gt;&gt;\n\t&lt;&lt;elseif $nmeaction is 1.2&gt;&gt;\n\t\t&lt;&lt;set $atkcount to 1&gt;&gt;\n\t&lt;&lt;elseif $nmeaction is 1.3&gt;&gt;\n\t\t&lt;&lt;set $atkcount to 2&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if $atkcount gt 0&gt;&gt;\n\t\t&lt;&lt;set $hurtmaker to either(1,2,3)&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;for $i to 0; $i lte $atkcount; $i++&gt;&gt;\n\t\t&lt;&lt;set $dodgecheck to random(1, $nmeacc)&gt;&gt;\n\t\t&lt;&lt;payload 'onNMEatk'&gt;&gt;\n\t\t&lt;&lt;set $damagetoplayerPOST to $damagetoplayerPRE&gt;&gt;\n\n\t\t&lt;&lt;if $enemyspecial is 0&gt;&gt;\n\t\t\t&lt;&lt;set $nmecritcheck to random(1, $NMEcritrange)&gt;&gt;\n\t\t\t&lt;&lt;if $nmecritcheck lte $nmecritchance&gt;&gt;\n\t\t\t\t&lt;&lt;set $damagetoplayerPOST to Math.trunc($damagetoplayerPOST*$nmecritdam)&gt;&gt;\n\t\t\t\t/%&lt;&lt;set alert(&quot;The enemy scored a critical hit against you...&quot;)&gt;&gt;%/\n\t\t\t\t&lt;&lt;dialog 'That hurt...'&gt;&gt;\n\nThe enemy scored a critical hit...\n\n&lt;&lt;/dialog&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\n\t\t&lt;&lt;if $dodgecheck lte $dodge&gt;&gt;\n\t\t\t&lt;&lt;set $dodgedatks to $dodgedatks+1&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoplayerPOST to 0&gt;&gt;\n\t\t&lt;&lt;else&gt;&gt;\n\t\t\t&lt;&lt;set $grit to Math.trunc($grit-$damagetoplayerPOST)&gt;&gt;\n\t\t\t&lt;&lt;if $devilForm is 0 and $formUnlock gte 1&gt;&gt;\n\t\t\t&lt;&lt;set $rage to Math.trunc($rageBuild*$modifier*0.5)&gt;&gt;\n\t\t\t&lt;&lt;set $rageCurrent to $rageCurrent + $rage&gt;&gt;\n\t\t\t&lt;&lt;if $rageCurrent gt 200&gt;&gt;\n\t\t\t\t&lt;&lt;set $rageCurrent to 200&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;set $damagetoplayer to $damagetoplayer+$damagetoplayerPOST&gt;&gt;\n\t\t\t&lt;&lt;if $grit lte 0&gt;&gt;\n\t\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t\t\t&lt;&lt;set $health to $health-1&gt;&gt;\n\t\t\t\t&lt;&lt;set $hurtmaker to 4&gt;&gt;\n\t\t\t\t&lt;&lt;if $health lte 0&gt;&gt;\n\t\t\t\t\t&lt;&lt;set $health to 0&gt;&gt;\n\t\t\t\t\t&lt;&lt;display &quot;health_checker&quot;&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t\t&lt;&lt;if $devilForm is 0&gt;&gt;\n\t\t\t\t\t&lt;&lt;display &quot;desperation_atk&quot;&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endfor&gt;&gt;\n\n\t&lt;&lt;if $atkcount is 1&gt;&gt;\n\t\t&lt;&lt;set $words to &quot; attack &quot;&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $words to &quot; attacks &quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if $dodgedatks gte $atkcount&gt;&gt;\n\t\t&lt;&lt;set $dodgereport to &quot;, and &quot; + $character + &quot; dodged them all.&quot;&gt;&gt;\n\t&lt;&lt;elseif $dodgedatks gt 0&gt;&gt;\n\t\t&lt;&lt;set $dodgereport to &quot;.  &quot; + $character + &quot; managed to dodge &quot; + $dodgedatks + &quot; of them.  However, the enemy still hits for &quot; + Math.trunc($damagetoplayer) + &quot; damage.&quot;&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $dodgereport to &quot; and hits for &quot; + Math.trunc($damagetoplayer) + &quot; damage in total.&quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;set $enemyreport to $enemyname + &quot; performed &quot; + $atkcount + &quot; &quot; + $words + $dodgereport&gt;&gt;\n\n\t&lt;&lt;if $nmeaction is 1.2 or $nmeaction is 1.3&gt;&gt;\n\t\t&lt;&lt;set $enemyreport to $enemyreport + &quot;  Enemy defends.&quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmeaction is 1.1&gt;&gt;\n\t&lt;&lt;set $nmedefboost to 1.1&gt;&gt;\n\t&lt;&lt;set $nmeregen to $nmebaseregen&gt;&gt;\n&lt;&lt;elseif $nmeaction is 1.2&gt;&gt;\n\t&lt;&lt;set $nmedefboost to 1.3&gt;&gt;\n\t&lt;&lt;set $nmeregen to $nmebaseregen+1&gt;&gt;\n&lt;&lt;elseif $nmeaction is 1.3&gt;&gt;\n\t&lt;&lt;set $nmedefboost to 1.2&gt;&gt;\n\t&lt;&lt;set $nmeregen to $nmebaseregen&gt;&gt;\n&lt;&lt;elseif $nmeaction is 2&gt;&gt;\n\t&lt;&lt;set $nmedefboost to 1.5&gt;&gt;\n\t&lt;&lt;set $nmeregen to $nmebaseregen+3&gt;&gt;\n\t&lt;&lt;set $enemyreport to $enemyname + &quot; defends.&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $nmeaction is 3 and $enemyspecial gt 0&gt;&gt;\n\t/%spell damage calc%/\n\t&lt;&lt;display $enemyspecialname&gt;&gt;\n\n\t&lt;&lt;set $dispSuccess to 0&gt;&gt;\n\n\t&lt;&lt;set $specialFloor to Math.trunc($nmemagic/2)&gt;&gt;\n\t&lt;&lt;set $specialTop to Math.trunc($nmemagic*1.0)&gt;&gt;\n\t&lt;&lt;set $specialRoll to random($specialFloor, $specialTop)&gt;&gt;\n\t&lt;&lt;set $specialDam1 to $nmespellpower-50&gt;&gt;\n\t&lt;&lt;set $specialDam2 to Math.trunc($nmespellpower/6)&gt;&gt;\n\t&lt;&lt;set $specialDam1 to $specialDam2*$specialDam1&gt;&gt;\n\t&lt;&lt;set $specialDam1 to $spBase + $specialDam1&gt;&gt;\n\t&lt;&lt;set $specialDam1 to $specialDam1 - $wilval&gt;&gt;\n\t&lt;&lt;set $specialDam1 to $specialDam1 - Math.trunc($def/2)&gt;&gt;\n\t&lt;&lt;set $specialDam1 to Math.trunc($specialDam1/10)&gt;&gt;\n\t&lt;&lt;set $specialBase to $specialDam1 + $specialRoll&gt;&gt;\n\t&lt;&lt;set $specialDam to Math.trunc($specialBase * $specialMult)&gt;&gt;\n\n\t&lt;&lt;set $dispCheck to random(1, $nmespellpower)&gt;&gt;\n\t&lt;&lt;payload 'onNMEspell'&gt;&gt;\n\t&lt;&lt;if $dispCheck lte $dispel&gt;&gt;\n\t\t&lt;&lt;payload 'onDispel'&gt;&gt;\n\t\t&lt;&lt;set $specialDam to 0&gt;&gt;\n\t\t&lt;&lt;set $dispSuccess to 1&gt;&gt;\n\t\t&lt;&lt;set $effectReport to &quot;&quot;&gt;&gt;\n\t\t&lt;&lt;set $specialOn to 0&gt;&gt;\n\t\t&lt;&lt;set $NMESpMov to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMESpDef to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMESpDam to 1.0&gt;&gt;\n\t\t&lt;&lt;set $NMEStaUse to 0&gt;&gt;\n\t\t&lt;&lt;set $NMEStaLmt to 0&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if $enemyspecialname neq &quot;heal&quot;&gt;&gt;\n\t\t&lt;&lt;set $grit to Math.trunc($grit-$specialDam)&gt;&gt;\n\t\t&lt;&lt;set $hurtmaker to either(1,2,3)&gt;&gt;\n\t\t&lt;&lt;if $grit lte 0&gt;&gt;\n\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t\t&lt;&lt;set $health to $health-1&gt;&gt;\n\t\t\t&lt;&lt;set $hurtmaker to 4&gt;&gt;\n\n\t\t\t&lt;&lt;if $health lte 0&gt;&gt;\n\t\t\t\t&lt;&lt;set $health to 0&gt;&gt;\n\t\t\t\t&lt;&lt;display &quot;health_checker&quot;&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;if $devilForm is 0&gt;&gt;\n\t\t\t\t&lt;&lt;display &quot;desperation_atk&quot;&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $nmeregen to $nmebaseregen+$specialDam&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if $specialDam gte 1 and $enemyspecialname neq &quot;heal&quot;&gt;&gt;\n\t\t&lt;&lt;set $spelldamReport to $character + &quot; took &quot; + $specialDam + &quot; damage.  &quot;&gt;&gt;\n\t\t&lt;&lt;if $devilForm is 0 and $formUnlock gte 1&gt;&gt;\n\t\t&lt;&lt;set $rage to Math.trunc($rageBuild*$modifier*1.5)&gt;&gt;\n\t\t&lt;&lt;set $rageCurrent to $rageCurrent + $rage&gt;&gt;\n\t\t\t&lt;&lt;if $rageCurrent gt 200&gt;&gt;\n\t\t\t\t&lt;&lt;set $rageCurrent to 200&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;elseif $specialDam gte 1 and $enemyspecialname is &quot;heal&quot;&gt;&gt;\n\t\t&lt;&lt;set $spelldamReport to $enemyname + &quot; casts a healing spell and begins to recover grit.  &quot;&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $spelldamReport to &quot;But &quot; + $character + &quot; dispelled it!  The spell does nothing.  &quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\t\t/%spell effect%/\n\t&lt;&lt;if $specialOn is 0&gt;&gt;\n\t\t&lt;&lt;if $SpEffName neq &quot;&quot; and $dispSuccess is 0&gt;&gt;\n\t\t\t&lt;&lt;set $SpEffTime to either(2,2,2,2,3,3,3,4,4,5)&gt;&gt;\n\t\t\t&lt;&lt;set $SpEffTime to $SpEffTime + $TimeAdj + 1&gt;&gt;\n\t\t\t&lt;&lt;set $SpEffDisplay to $SpEffName&gt;&gt;\n\t\t\t&lt;&lt;set $specialOn to 1&gt;&gt;\n\t\t\t&lt;&lt;set $SpEffStart to $round&gt;&gt;\n\t\t\t&lt;&lt;set $SpEffEnd to $round + $SpEffTime&gt;&gt;\n\t\t\t&lt;&lt;set $effectReport to $character + &quot; has been &quot; + $SpEffName + &quot;.&quot;&gt;&gt;\n\t\t&lt;&lt;else&gt;&gt;\n\t\t\t&lt;&lt;set $effectReport to &quot;&quot;&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;elseif $specialOn is 1 and $dispSuccess is 0&gt;&gt;\n\t\t&lt;&lt;set $SpEffEnd to $SpEffEnd + either(1,1,2) + $TimeAdj&gt;&gt;\n\t\t&lt;&lt;set $effectReport to $character + &quot; is further &quot; + $SpEffName + &quot;.&quot;&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $enemyreport to &quot;Enemy casted &quot; + $specialname + &quot;.  &quot; + $spelldamReport + $effectReport&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $hurtmaker&gt;&gt;\n\t&lt;&lt;if $hurtmaker lt 4&gt;&gt;\n\t\t&lt;&lt;payload 'onGritDam'&gt;&gt;\n\t&lt;&lt;elseif $hurtmaker is 4&gt;&gt;\n\t\t&lt;&lt;payload 'onHeartDam'&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if $hurtmaker is 1&gt;&gt;\n\t&lt;&lt;audio &quot;hurt1&quot; play&gt;&gt;\n&lt;&lt;elseif $hurtmaker is 2&gt;&gt;\n\t&lt;&lt;audio &quot;hurt2&quot; play&gt;&gt;\n&lt;&lt;elseif $hurtmaker is 3&gt;&gt;\n\t&lt;&lt;audio &quot;hurt3&quot; play&gt;&gt;\n&lt;&lt;elseif $hurtmaker is 4&gt;&gt;\n  &lt;&lt;set _damSel to random(1,100)&gt;&gt;\n  &lt;&lt;if _damSel lte 15 and $character is &quot;Ripley&quot;&gt;&gt;\n    &lt;&lt;audio &quot;damage2&quot; play&gt;&gt;\n  &lt;&lt;else&gt;&gt;\n    &lt;&lt;audio &quot;damage&quot; play&gt;&gt;\n  &lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;endif&gt;&gt;</div><div tiddler="equipswitcher" tags="nobr" created="201612131230" modifier="twee">\n&lt;&lt;set $atk to Math.trunc($atkbase*$watk*$aatk*$satk*$modeatk)&gt;&gt;\n&lt;&lt;set $def to Math.trunc($defbase*$wdef*$adef*$sdef)&gt;&gt;\n&lt;&lt;set $mov to Math.trunc($movbase*$wmov*$amov*$smov)&gt;&gt;\n\n&lt;&lt;if $bangles eq 1&gt;&gt;&lt;&lt;set $regenmult to 2.0&gt;&gt;&lt;&lt;set $basedispel to 20&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $critchance to Math.trunc(($agival/10+$cngrank)+$spellcrit)&gt;&gt;\n&lt;&lt;set $critdam to Math.trunc($atk*$critmult*$spellcritdam)&gt;&gt;\n&lt;&lt;set $dodge to Math.trunc(((5+$agirank*2.5)+$cngrank)+$spelldodge)&gt;&gt;\n&lt;&lt;set $maxgrit to 100+$endval+$spellgrit&gt;&gt;\n\n/%regen and healing calculated on the fly in combat--no need to change here%/\n&lt;&lt;display &quot;bal-adjust&quot;&gt;&gt;</div><div tiddler="equipmenu" tags="menu char" created="201612122026" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;&lt;&lt;endnobr&gt;&gt;&lt;&lt;if $characterHide is 0&gt;&gt;\n!!&lt;&lt;print &quot;\su2694&quot;&gt;&gt; Current Equipment:\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_weapon]]&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;wpninfo&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;link $weaponname&gt;&gt;&lt;&lt;popup &quot;wpn_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;button [[Change|weaponswap]]&gt;&gt;&lt;&lt;/button&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_armor]]&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;armrinfo&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;link $armorname&gt;&gt;&lt;&lt;popup &quot;arm_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;button [[Change|armorswap]]&gt;&gt;&lt;&lt;/button&gt;&gt;|\n|&lt;span class=&quot;comUIimg&quot;&gt;&lt;&lt;link [img[setup.ui.icons.ui_spell]]&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;display &quot;splinfo&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;|&lt;&lt;link $p_spellname&gt;&gt;&lt;&lt;popup &quot;spl_comUI&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;button [[Change|spellswap]]&gt;&gt;&lt;&lt;/button&gt;&gt;|\n\n&lt;span id =&quot;return&quot;&gt;[[Go back.|$return][$gamestart to 1]]&lt;/span&gt;\n\n&lt;&lt;display &quot;infobox&quot;&gt;&gt;&lt;&lt;else&gt;&gt;Nothing here right now...&lt;&lt;endif&gt;&gt;</div><div tiddler="death" tags="nobr" created="201701241626" modifier="twee">/%  4  %/\n&lt;&lt;if $NMEgrit gte 0.5*$NMEmaxgrit&gt;&gt;\n\t&lt;&lt;set $specialMult to 1.5&gt;&gt;/%damage of spell%/\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $specialMult to 1.0&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $NMEgrit to Math.trunc($NMEgrit/2)&gt;&gt;\n\n&lt;&lt;set $SpEffName to &quot;&quot;&gt;&gt;/%display on chracter sheet%/\n&lt;&lt;set $TimeAdj to either(0,0,0,0)&gt;&gt;/%time adjustment%/\n\n&lt;&lt;set $NMESpMov to 1.0&gt;&gt;/%mov debuff%/\n&lt;&lt;set $NMESpDef to 1.0&gt;&gt;/%def debuff%/\n&lt;&lt;set $NMESpAtk to 1.0&gt;&gt;/%atk debuff%/\n&lt;&lt;set $NMESpDam to 1.0&gt;&gt;/%damage debuff%/\n&lt;&lt;set $NMEStaUse to 0&gt;&gt;/%additional sta usage%/\n&lt;&lt;set $NMEStaLmt to 0&gt;&gt;/%subtract from sta at top of each turn%/\n\n&lt;&lt;set $specialname to &quot;Death Knell&quot;&gt;&gt;\n\n&lt;&lt;set $specialMult to $specialMult * setup.bal.espell&gt;&gt;</div><div tiddler="0protectking2lie" tags="dock" created="201701260031" modifier="twee">It's exactly as bad as it looks.</div><div tiddler="1KingRip" tags="dock" created="201707110121" modifier="twee">&quot;She's still a child.  She can't face Akatosh yet, not until she's ready.  We need to protect her until then.&quot;\n\nElesun looks away.\n\n&quot;You disapprove?  Should we send her to her death now?&quot;\n\n&quot;I don't want her to ever--&quot; Elesun stops short.  &quot;That's not what I want.&quot;\n\nThe King sighs.  &quot;Of course, I'm sorry.  I feel a great pressure; the world demands its hero.&quot;</div><div tiddler="Saber" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;sbr_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;sabr&quot;]]\n[[No|weaponswap]]</div><div tiddler="0choice1druid" tags="dock" created="201701140609" modifier="twee">Ripley was a druid--to some extent she still is.\n\nWhen the oracles of her tribe discovered what Ripley was, they made the decision to hand her over to the king of Juno, Elesun’s king.  The king, clever as always, engineered a claim to nobility for her by coaxing the druids into naming Ripley a princess.  As she was royalty, the king was able to fund a great deal of schooling, protection, and training for her, with or without the approval of his court.</div><div tiddler="dodge_machine" tags="nobr" created="201612160711" modifier="twee">&lt;&lt;set $dodgecheck to random(1, $nmeacc)&gt;&gt;\n\n&lt;&lt;if $dodgecheck lte $dodge&gt;&gt;\n\t&lt;&lt;set $damagetoplayerPOST to 0&gt;&gt;\n\t&lt;&lt;set $dodgedatks to $dodgedatks+1&gt;&gt;\n\t&lt;&lt;payload 'onDodge'&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="schlepppppp" tags="script" created="201801141729" modifier="twee" twine-position="290,1270">/*\n\t&lt;&lt;schlepaudio&gt;&gt;\n*/\nMacro.add('schlepaudio', {\n\tskipArgs : true,\n\tqueue    : [],\n\thandler  : function () {\n\t\tvar queue = this.self.queue;\n\t\tvar name = this.name;\n\t\tif (queue.length &gt; 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction processQueue() {\n\t\t\tif (queue.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar nextTrack = queue.shift();\n\n\t\t\tjQuery.event.trigger({\n                type  : ':' + name,\n                leng  : queue.length\n            });\n\n\t\t\tif (nextTrack.hasData()) {\n\t\t\t\treturn processQueue();\n\t\t\t}\n\n\t\t\tnextTrack\n\t\t\t\t.one('canplay.' + name + ' error.' + name, function () { // do not use an arrow function\n\t\t\t\t\tjQuery(this).off(':' + name);\n\t\t\t\t\tprocessQueue();\n\t\t\t\t})\n\t\t\t\t.load();\n\t\t}\n\n\t\tthis.self.fillQueue(queue);\n\n\t\tif (queue.length &gt; 0) {\n\t\t\tprocessQueue();\n\t\t}\n\t},\n\tfillQueue : function (queue) {\n\t\t// Gather all tracks from `&lt;&lt;cacheaudio&gt;&gt;`.\n\t\tvar tracks = Macro.get('cacheaudio').tracks;\n\t\tObject.keys(tracks).forEach(function (id) { queue.push(tracks[id]); });\n\n\t\t// Gather copied tracks from `&lt;&lt;createplaylist&gt;&gt;`.\n\t\tvar lists = Macro.get('createplaylist').lists;\n\t\tObject.keys(lists)\n\t\t\t.map(function (id) { return lists[id].tracks; })\n\t\t\t.flatten()\n\t\t\t.filter(function (trackObj) { return trackObj.copy; })\n\t\t\t.forEach(function (trackObj) { queue.push(trackObj.track); });\n\n\t\t/*\n\t\t\tGather all tracks from `&lt;&lt;setplaylist&gt;&gt;`, since they're all copies.\n\t\t\tNOTE: `&lt;&lt;setplaylist&gt;&gt;` is deprecated, so don't assume that it exists.\n\t\t*/\n\t\tif (Macro.has('setplaylist')) {\n\t\t\tvar list = Macro.get('setplaylist').list;\n\n\t\t\tif (list !== null) {\n\t\t\t\tlist.tracks.forEach(function (trackObj) { queue.push(trackObj.track); });\n\t\t\t}\n\t\t}\n\t}\n});</div><div tiddler="summonmenu" tags="" created="201612122026" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;&lt;&lt;endnobr&gt;&gt;</div><div tiddler="PlayerPortSmall" tags="" created="201701050452" modifier="twee" twine-position="430,850">&lt;span id=&quot;portrait&quot;&gt;&lt;&lt;if $character is &quot;Elesun&quot;&gt;&gt;[img[setup.img.EleSm]]&lt;&lt;else&gt;&gt;[img[setup.img.RipSm]]&lt;&lt;endif&gt;&gt;&lt;/span&gt;</div><div tiddler="Aes-boss-defend-1" tags="qte combat" created="201707261231" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;if $def_success&gt;&gt;\s\n\t&lt;&lt;nobr&gt;&gt;\s\n\t\t&lt;&lt;set $bossPoints++&gt;&gt;\n\t\t&lt;&lt;set _next to 'attack-bar'&gt;&gt;\n\t\t&lt;&lt;set $nextBoss to 'Aes-boss-attack-1'&gt;&gt;\n\t\t&lt;&lt;if $grit lt $maxgrit&gt;&gt;\n\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\s\n\t&lt;&lt;endnobr&gt;&gt;\n''Defend Event Successful''\n\nAesil throws himself at &lt;&lt;name&gt;&gt;, but she stops him mid-stride with a powerful kick to his chest, and he stumbles back.\n\n&lt;&lt;if $character is 'Elesun'&gt;&gt;&quot;You won't hurt her,&quot; &lt;&lt;name&gt;&gt; says.  &quot;You won't hurt anyone anymore.  You're going to die here today.&quot;&lt;&lt;else&gt;&gt;&quot;I'm stronger than you, Aesil!&quot; &lt;&lt;name&gt;&gt; shouts.  &quot;You're going to pay!&quot;&lt;&lt;endif&gt;&gt;\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;nobr&gt;&gt;\s\n\t\t&lt;&lt;set _next to 'highway1'&gt;&gt;\n\t\t&lt;&lt;set $grit to $grit - 30&gt;&gt;\n\t\t&lt;&lt;if $grit lt 1&gt;&gt;\n\t\t\t&lt;&lt;set $grit to 1&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\s\n\t&lt;&lt;endnobr&gt;&gt;\n''Defend Event Failed''\n\n&lt;&lt;name&gt;&gt; tries to slip under Aesil's attack, but he hits her with a glancing blow, and she reels back.\n\n&quot;Damn it,&quot; &lt;&lt;name&gt;&gt; spits.\n&lt;&lt;endif&gt;&gt;\s\n\n[[Get Ready!|_next]]</div><div tiddler="Aes-boss-defend-2" tags="qte combat" created="201707262010" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;if $def_success&gt;&gt;\s\n\t&lt;&lt;nobr&gt;&gt;\s\n\t\t&lt;&lt;set $bossPoints++&gt;&gt;\n\t\t&lt;&lt;set _next to 'attack-bar'&gt;&gt;\n\t\t&lt;&lt;if $grit lt $maxgrit&gt;&gt;\n\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\s\n\t&lt;&lt;endnobr&gt;&gt;\n''Defend Event Successful''\n\nAesil unleashes a blast of energy--it passes trees and grass on the way to &lt;&lt;name&gt;&gt;; leaves rain to the ground, the grass dries and browns.  An attack like this could destory the whole forest.\n\n&lt;&lt;if $character is 'Elesun'&gt;&gt;&quot;Fine!&quot; Elesun brings her sword back and follows through with a mighty swing.  Her blade meets the blast, and for an instant, both stop still.  Elesun yells out and brings her sword the rest of the way around.\n\nThe blast sails into the sky and explodes, spreading a dark haze into the sky and casting a gray shadow over the battlefield.\n\nShe feels her shoulder grow lighter and lets out a gasp.  Her right arm, sword and all, drop unceremoniously to the ground, and her skin tears like fabric.\n\nAesil laughs; it's a loud, haughty laugh.  Elesun reaches down with her other hand and takes up her sword as best she can in her broken fingers.  Aesil is still laughing.\n\n&quot;I'm not dead yet,&quot; she says softly.&lt;&lt;else&gt;&gt;Elesun extends her hands, and her bangles flash with light.  &quot;You're nothing!&quot; she shouts.  The instant the blast touches her hands, the blast of energy dissapates in smoke and floats away on the wind.&lt;&lt;endif&gt;&gt;\s\n&lt;&lt;else&gt;&gt;\s\n\t&lt;&lt;nobr&gt;&gt;\s\n\t\t&lt;&lt;set _next to 'highway1'&gt;&gt;\n\t\t&lt;&lt;set $grit to $grit - 30&gt;&gt;\n\t\t&lt;&lt;if $grit lt 1&gt;&gt;\n\t\t\t&lt;&lt;set $grit to 1&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\s\n\t&lt;&lt;endnobr&gt;&gt;\n''Defend Event Failed''\n\nAesil unleashes a blast of energy--it passes trees and grass on the way to &lt;&lt;name&gt;&gt;; leaves rain to the ground, the grass dries and browns.  An attack like this could destory the whole forest.\n\n&lt;&lt;name&gt;&gt; can't stop it, though.  She contiplates the attempt, but ultimately dives out of the way at the last moment as the blast continues on, drawing the life from everything in its wake.&lt;&lt;if $character is 'Elesun'&gt;&gt;\n\nElesun tries to climb back up off the ground, but when she puts her weight on her right arm, she hears her bones crack, and pain shoots through her.  Her arm splits outword, her bones paring through flesh, and as she rises, the weight of her sword strains against her weakening muscles.  It falls, taking her arm with it at the elbow, her skin ripping like fabric.\n\n&quot;Damn it,&quot; she breathes.  \n\nAesil laughs--a haughty, mocking laugh.  Elesun takes up her sword in the shattered bones of her left hand and rises.  Aesil is still laughing.\n\n&quot;I'm not dead yet,&quot; she says softly.&lt;&lt;endif&gt;&gt;\s\n&lt;&lt;endif&gt;&gt;\s\n\n&lt;&lt;ctrlCon 'highway1'&gt;&gt;</div><div tiddler="Aes-boss-defend-3" tags="qte combat" created="201707262059" modifier="twee">&lt;&lt;if $def_success&gt;&gt;\n\t&lt;&lt;set $defCon++&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $defCount++&gt;&gt;\n&lt;&lt;if $defCount lt 2&gt;&gt;\n\t&lt;&lt;set $nextBoss to 'Aes-boss-defend-3'&gt;&gt;\n\t&lt;&lt;goto 'defend-bar'&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $nextBoss to 'Aes-boss-defend-4'&gt;&gt;\n\t&lt;&lt;goto 'defend-bar'&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="Aes-boss-defend-4" tags="qte combat" created="201707262104" modifier="twee">&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;nobr&gt;&gt;\n&lt;&lt;if $defCon gte 2&gt;&gt;\n\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t&lt;&lt;if $defCon gte 3 and $health lt $maxhealth&gt;&gt;\n\t\t&lt;&lt;set $health++&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $grit -= 50&gt;&gt;\n\t&lt;&lt;if $defCon is 0&gt;&gt;\n\t\t&lt;&lt;set $grit -= 100&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;if $grit lt 1&gt;&gt;\n\t\t&lt;&lt;set $grit to 1&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;set $bossPoints += $defCon&gt;&gt;\n&lt;&lt;unset $defCon, $defCount&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;\s\nAesil seems to run out of power, as his final attack sends him clattering to the ground.  He rises quickly, terror drawn on his face.\n\n&quot;I can't lose can't lose, must kill,&quot; he rasps.\n\n&lt;&lt;if $character is 'Elesun'&gt;&gt;Elesun stumbles back, feeling her legs weakening.  &quot;Damn it all!&quot; she cries.  &quot;Keep it together, just a little more.&quot;&lt;&lt;else&gt;&gt;Ripley stands over him.  She lets him rise.  He slowly begins to back away.  He breaks out into a run, but she pounces on him, sending him clattering to the ground.\n\n&quot;You'll stand and fight, like she did,&quot; Ripley spits.  &quot;Now die!&quot;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;ctrlCon 'highway1'&gt;&gt;</div><div tiddler="vigr_ui" tags="" created="201702021702" modifier="twee">Vital dramatically increases &lt;&lt;= setup.words.grit&gt;&gt; and provides a bonus to &lt;&lt;= setup.words.grit&gt;&gt; regeneration.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="1HarlNVM" tags="dock" created="201707110051" modifier="twee">&quot;You may take your leave, then.&quot;\n\n&lt;&lt;ctrlClick '&quot;Thank you, Prince.&quot;' '1mainhall'&gt;&gt;</div><div tiddler="1KingFolsom" tags="dock" created="201707110121" modifier="twee">&quot;How is Folsom?&quot;\n\n&quot;He insists he's fine,&quot; Elesun replies.\n\n&quot;Yes, but how is he?&quot;\n\n&quot;He looks weak, frail.&quot;</div><div tiddler="0storeroom" tags="branch save" created="201701140720" modifier="twee">&lt;&lt;set $helpServants to 1&gt;&gt;&lt;&lt;set $ripleytp++&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;We really don't have time for this,&quot; Elesun says.  &quot;Let's hurry up and make sure they're okay.&quot;\n\n&quot;We can't leave them,&quot; Ripley replies.  She opens the door.  The odor hits them hard--smells of blood, urine, rotted flesh, sick. Ripley turns away and gags--her eyes water.  Still, she gathers herself and stakes a step.\n\n&quot;Wait,&quot; Elesun says, pulling her scarf up to cover her nose and mouth.  It smells of spice, to protect against such foul uses of dark magic.  &quot;Bodies don't decay that fast.&quot;\n\n&quot;Dark magic,&quot; Ripley says.\n\n&quot;Let me go first, and if I say run, run.&quot;\n\n&quot;No promises.&quot;\n\nElesun smirks.  When it came to Ripley, there never were, not with this sort of thing.  Her greatest strength and greatest weakness is her heart.\n\nElesun steps into the storeroom.  The moaning is louder in here--whimpering and crying.  It seems to be made up of a handful of voices, both male and female.\n\nIn the storeroom, everything appears in order; it's unmolested, aside from the odor.\n\nBut down below...\n\nA stone staircase leads down into the dark.  Behind Elesun, Ripley whispers a word, and casts a small white light in her hand using bound magic.\n\nThe darkness below is unimpressed, however, swallowing the edges of the her light.  They'll need to go down there to find the source of the sounds.\n\n&lt;&lt;ctrlClick &quot;Go deeper.&quot; &quot;0aesil1&quot; &quot;leave&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n</div><div tiddler="0wallRip" tags="dock" created="201701242246" modifier="twee">&quot;We're going to get through this, kid,&quot; Elesun says.\n\nRipley glances back over her shoulder at the village.  &quot;It's not us I'm worried about.&quot;\n\nElesun sighs.  &quot;Fair enough.&quot;&lt;&lt;timed 1s&gt;&gt;&lt;&lt;replace &quot;#gone&quot;&gt;&gt;Ripley&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;</div><div tiddler="custom-load" tags="stylesheet" created="201707071831" modifier="twee" twine-position="850,570">.cssload-square {\n\twidth: 8px;\n\theight: 29px;\n\tbackground: rgb(238,238,238);\n\tborder-radius: 10px;\n\tdisplay: block;\n\tanimation: cssload-turn 2.88s ease infinite;\n\t\t-o-animation: cssload-turn 2.88s ease infinite;\n\t\t-ms-animation: cssload-turn 2.88s ease infinite;\n\t\t-webkit-animation: cssload-turn 2.88s ease infinite;\n\t\t-moz-animation: cssload-turn 2.88s ease infinite;\n}\n.cssload-top {\n\tposition: absolute;\n\tleft: 40%;\n\ttop: 50%;\n\ttransform: rotate(90deg);\n\t\t-o-transform: rotate(90deg);\n\t\t-ms-transform: rotate(90deg);\n\t\t-webkit-transform: rotate(90deg);\n\t\t-moz-transform: rotate(90deg);\n}\n.cssload-bottom {\n\tposition: absolute;\n\tleft: 40%;\n\ttop: 50%;\n\ttransform: rotate(-90deg);\n\t\t-o-transform: rotate(-90deg);\n\t\t-ms-transform: rotate(-90deg);\n\t\t-webkit-transform: rotate(-90deg);\n\t\t-moz-transform: rotate(-90deg);\n}\n.cssload-left {\n\tposition: absolute;\n\tleft: 40%;\n\ttop: 50%;\n}\n.cssload-right {\n\tposition: absolute;\n\tleft: 40%;\n\ttop: 50%;\n\ttransform: rotate(-180deg);\n\t\t-o-transform: rotate(-180deg);\n\t\t-ms-transform: rotate(-180deg);\n\t\t-webkit-transform: rotate(-180deg);\n\t\t-moz-transform: rotate(-180deg);\n}\n\n\n@keyframes cssload-turn {\n\t0% {\n\t\ttransform: translateX(0) translateY(0) rotate(0);\n\t}\n\t50% {\n\t\ttransform: translateX(400%) translateY(100%) rotate(90deg);\n\t}\n\t100% {\n\t\ttransform: translateX(0) translateY(0) rotate(0);\n\t}\n}\n\n@-o-keyframes cssload-turn {\n\t0% {\n\t\t-o-transform: translateX(0) translateY(0) rotate(0);\n\t}\n\t50% {\n\t\t-o-transform: translateX(400%) translateY(100%) rotate(90deg);\n\t}\n\t100% {\n\t\t-o-transform: translateX(0) translateY(0) rotate(0);\n\t}\n}\n\n@-ms-keyframes cssload-turn {\n\t0% {\n\t\t-ms-transform: translateX(0) translateY(0) rotate(0);\n\t}\n\t50% {\n\t\t-ms-transform: translateX(400%) translateY(100%) rotate(90deg);\n\t}\n\t100% {\n\t\t-ms-transform: translateX(0) translateY(0) rotate(0);\n\t}\n}\n\n@-webkit-keyframes cssload-turn {\n\t0% {\n\t\t-webkit-transform: translateX(0) translateY(0) rotate(0);\n\t}\n\t50% {\n\t\t-webkit-transform: translateX(400%) translateY(100%) rotate(90deg);\n\t}\n\t100% {\n\t\t-webkit-transform: translateX(0) translateY(0) rotate(0);\n\t}\n}\n\n@-moz-keyframes cssload-turn {\n\t0% {\n\t\t-moz-transform: translateX(0) translateY(0) rotate(0);\n\t}\n\t50% {\n\t\t-moz-transform: translateX(400%) translateY(100%) rotate(90deg);\n\t}\n\t100% {\n\t\t-moz-transform: translateX(0) translateY(0) rotate(0);\n\t}\n}\n\n#load-perc {\n\tdisplay: block;\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\twidth: 1%;\n\theight: 3em;\n\tbackground: #fff;\n}\n#load-perc-title {\n\tdisplay: block;\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\twidth: 100%;\n\tcolor: #111;\n\ttext-align: center;\n\tfont-size: 1.5em;\n\tmargin: 0.5em auto;\n\ttext-shadow: 0px 0px 1px #eee;\n}</div><div tiddler="katana" tags="nobr" created="201612131447" modifier="twee">&lt;&lt;set $weaponname to &quot;Katana&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;kata_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.0&gt;&gt;\n&lt;&lt;set $wdef to 0.6&gt;&gt;\n&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;set $critrange to 90&gt;&gt;\n\n&lt;&lt;set $wStaUse to 5&gt;&gt;\n\n&lt;&lt;if $katanatraining is 1&gt;&gt;\n\t&lt;&lt;set $wdef to 0.7&gt;&gt;\n&lt;&lt;elseif $katanatraining is 2&gt;&gt;\n\t&lt;&lt;set $wdef to 0.7&gt;&gt;\n\t&lt;&lt;set $critrange to 88&gt;&gt;\n&lt;&lt;elseif $katanatraining is 3&gt;&gt;\n\t&lt;&lt;set $wdef to 0.7&gt;&gt;\n\t&lt;&lt;set $critrange to 88&gt;&gt;\n\t&lt;&lt;set $wmov to 1.1&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1Map1Serv" tags="dock map" created="201702180659" modifier="twee">Head north to the servants' quarters?\n\n&lt;&lt;ctrlClick &quot;Go to the servants' quarters.&quot; &quot;1servQuarters&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="0throneroom" tags="space" created="201701242356" modifier="twee">&lt;&lt;image &quot;KingSm&quot;&gt;&gt;Elesun is standing in the &lt;&lt;weak &quot;throne room&quot; &quot;0throneroomInspect&quot;&gt;&gt;.\n\nThe &lt;&lt;dock &quot;king&quot; &quot;0throneroomKing&quot;&gt;&gt; is sitting on his throne.  &lt;&lt;weak &quot;Irelith&quot; &quot;0throneroomIre&quot;&gt;&gt; is slumped in the corner.\n\n&lt;span id=&quot;gone&quot;&gt; &lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n</div><div tiddler="codex_Ripley" tags="menu" created="201701261836" modifier="twee">&lt;&lt;image &quot;RipPtKid&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Ripley''\n\nLady Ripley, &quot;princess&quot; of the Druids and ward of King Harmon of Juno.  Like Irelith and Elesun, Ripley is demonkin--and the Child of Promise, destined to face the monstrous Akatosh.\n\nAs a child, Ripley was born and raised as a druid, but when the oracles of her tribe discovered what she was, they placed her in the care of King Harmon.  The King manufactured her a claim to royalty and raised her alongside his son, Harlaus.\n\nThough still young, Ripley is incredibly strong, stronger even than Irelith and Elesun.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="combat_call_1_1" tags="nobr comcall" created="201708281938" modifier="twee">&lt;&lt;combat &quot;rank3lvl5_soldier_akatosh&quot; &quot;combat_intro_1_1&quot; &quot;combat_outro_1_1&quot;&gt;&gt;</div><div tiddler="combat_call_1_3" tags="comcall" created="201701282005" modifier="twee"></div><div tiddler="sswd_ui" tags="" created="201702020415" modifier="twee">A small thrusting sword with an intricate guard.\n\nIt's sharp, and ideal for making repeated attacks.  It's thursting attacks allow for deadly accuracy.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Low|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Low|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Very High|\n*__Finesse__: High\n*__Stamina__: Low</div><div tiddler="1arWagon" tags="dock" created="201708281823" modifier="twee">It's a simple-looking wagon, tied up to rather average-looking horses.  It's a wise choice; it's best not to draw attention.\n\n&lt;&lt;ctrlClick 'Get ready to leave.' '1wagon'&gt;&gt;</div><div tiddler="place_tut_hooks" tags="init" created="201707101831" modifier="twee" twine-position="430,990">&lt;&lt;onCrit 'tut_onCrit'&gt;&gt;\n&lt;&lt;onNMEspell 'tut_onNMEspell'&gt;&gt;\n&lt;&lt;onFirstAtk 'tut_onFirstAtk'&gt;&gt;\n&lt;&lt;onDespAtk 'tut_onDespAtk'&gt;&gt;\n&lt;&lt;onGritDam 'tut_onGritDam'&gt;&gt;\n&lt;&lt;onHeartDam 'tut_onHeartDam'&gt;&gt;\n&lt;&lt;onMov 'tut_onMov'&gt;&gt;\n&lt;&lt;onNMEheartDam 'tut_onNMEheartDam'&gt;&gt;\n&lt;&lt;onDef 'tut_onDef'&gt;&gt;\n&lt;&lt;onDispel 'tut_onDispel'&gt;&gt;\n&lt;&lt;onDodge 'tut_onDodge'&gt;&gt;\n&lt;&lt;onTransform 'tut_onTransform'&gt;&gt;\n&lt;&lt;onRevert 'tut_onRevert'&gt;&gt;\n&lt;&lt;onFightEnd 'tut_onFightEnd'&gt;&gt;</div><div tiddler="transform_updater" tags="nobr" created="201702080839" modifier="twee">&lt;&lt;set $statbase to setup.base + Math.trunc($rageCurrent/4)&gt;&gt;\n&lt;&lt;if $formUnlock is 2&gt;&gt;\n\t&lt;&lt;if $statbase gte 100&gt;&gt;\n\t\t&lt;&lt;set $statbase to 100&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;if $statbase gte 80&gt;&gt;\n\t\t&lt;&lt;set $statbase to 80&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $strval to ($statbase*($strrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $agival to ($statbase*($agirank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $endval to ($statbase*($endrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $wilval to ($statbase*($wilrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n&lt;&lt;set $cngval to ($statbase*($cngrank/10+1))+($statbase*($lvl/10))&gt;&gt;\n\n&lt;&lt;set $atkbase to Math.trunc($strval*0.5+$cngval*0.2)&gt;&gt;\n&lt;&lt;set $atk to Math.trunc($atkbase*$watk*$aatk*$satk*$modeatk)&gt;&gt;\n&lt;&lt;set $defbase to Math.trunc($endval*0.5+$strval*0.2)&gt;&gt;\n&lt;&lt;set $def to Math.trunc($defbase*$wdef*$adef*$sdef)&gt;&gt;\n&lt;&lt;set $movbase to Math.trunc($agival*0.5+$cngval*0.2)&gt;&gt;\n&lt;&lt;set $mov to Math.trunc($movbase*$wmov*$amov*$smov)&gt;&gt;\n\n&lt;&lt;set $critchance to Math.trunc(($agival/10+$cngrank)+$spellcrit)&gt;&gt;\n&lt;&lt;set $critmult to $agival/100+1&gt;&gt;\n&lt;&lt;set $critdam to Math.trunc($atk*$critmult*$spellcritdam)&gt;&gt;\n&lt;&lt;set $dodge to Math.trunc(((5+$agirank*2.5)+$cngrank)+$spelldodge)&gt;&gt;\n\n&lt;&lt;set $maxsta to Math.trunc($endval/10+$wilrank+8)&gt;&gt;\n&lt;&lt;set $sta to $maxsta&gt;&gt;\n\n&lt;&lt;if $bangles eq 1&gt;&gt;&lt;&lt;set $regenmult to 1.2&gt;&gt;&lt;&lt;set $basedispel to 10&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $dispel to $basedispel+$spelldispel+$wilrank&gt;&gt;\n\n&lt;&lt;set $power to $lvl*$statbase+(($maxhealth*$maxhealth*$maxhealth)+$maxhealth*7)+$lvl+1&gt;&gt;\n&lt;&lt;set $regen to Math.trunc($wilrank/2)&gt;&gt;\n\n&lt;&lt;set $rageBuild to $wilrank + 9&gt;&gt;\n&lt;&lt;set $rageDecay to 20 - $endrank&gt;&gt;\n\n&lt;&lt;if $devilForm is 1&gt;&gt;\n\t&lt;&lt;set $dispel to Math.trunc($dispel*0.7)&gt;&gt;\n\t&lt;&lt;set $dodge to Math.trunc($dodge*0.7)&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;display &quot;bal-adjust&quot;&gt;&gt;</div><div tiddler="1RipStone1" tags="scene" created="201702121121" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;What's that?&quot; Ripley asks.\n\n&quot;I found it in the courtyard,&quot; Elesun says.  She hands Ripley the stone.\n\nRipley looks at it and turns it over in her hands.  &quot;It's so smooth.  Thanks, Elesun, it's perfect for my collection.&quot;\n&lt;&lt;set $stoneOne.have to 2&gt;&gt;\n&lt;&lt;ctrlClick &quot;You're welcome.&quot; &quot;1RipQuarters&quot;&gt;&gt;</div><div tiddler="1AfterRest" tags="space save" created="201708281742" modifier="twee">Elesun heads to the courtyard after getting herself together. The sun is barely up, and its light is still gray this early.\n&lt;&lt;first&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio 'un' loop play&gt;&gt;&lt;&lt;/first&gt;&gt;\n&lt;&lt;dock 'Three guards' '1arGuards'&gt;&gt; are loading a &lt;&lt;action 'wagon' '1arWagon'&gt;&gt; when Elesun arrives in the courtyard.\n&lt;&lt;set $xpearned to $xpearned + 30&gt;&gt;\n&lt;&lt;dock 'Ripley and Harlaus' '1arRip'&gt;&gt; are standing a few dozen feet away talking quietly.  &lt;&lt;dock 'Irelith and Folsom'  '1arIre'&gt;&gt; are also there.  &lt;&lt;weak 'The King' '1arKing'&gt;&gt; is conspicuously missing.\n\n&lt;&lt;message&gt;&gt;This is the real beginning of your adventure, and you won't be recieving any more hints or help for quite a while. Remember, if you're lost or confused, or need to refresh your memory on some of the mechanics or systems, you can check your journal for tips on what to do next, and get to the help menu from your journal to review information on how to play the game.\n\nGet on the wagon to start your journey.\n\nGood luck!&lt;&lt;/message&gt;&gt;\n\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n</div><div tiddler="balance properties annotation" tags="annotation" created="201704280236" modifier="twee" twine-position="1270,290"> -&gt; Properties Key for Balance Object:\n---------------------------------------\nPlayer (General)\n---------------------------------------\npgrit     -player grit\npatk      -player attack\npdef      -player defense\npmov      -player move\n---------------------------------------\nPlayer (Special)\n---------------------------------------\ndesp      -desperation attack damage\ncritOdds  -critical chance\ncritical  -critical damage\nddgOdds   -dodge chance\ndispOdds  -dispel chance\n---------------------------------------\nPlayer (Transformation)\n---------------------------------------\nrageB     -rage build-up\nrageD     -rage decay\n---------------------------------------\nEnemy\n---------------------------------------\negrit     -enemy grit\neatk      -enemy attack\nedef      -enemy defense\nemov      -enemy move\nespell    -enemy special damage\n---------------------------------------\nGrowth\n---------------------------------------\nxpEarn    -XP earned from enemy kill\nxpNeed    -XP required for level up\n---------------------------------------</div><div tiddler="1wagon" tags="scene" created="201701281954" modifier="twee">&lt;&lt;image 'RipSmKid'&gt;&gt;&lt;&lt;thumb&gt;&gt;//Journal updated.//&lt;&lt;set $storystage to 3&gt;&gt;\n\nSoon after Elesun steps into the wagon and gets settled, Ripley comes in and sits down next to her.  The three guards also file in and take their seats.\n\n&quot;I've never been to Druid grove&quot; one of the guards says, &quot;but I'm excited to see it.  Irelith's said it's lovely.&quot;\n\n&quot;I think you'll like it,&quot; Ripley says. &quot;I'm excited to see everyone again.&quot;\n\n&quot;It's a two-day journey,&quot; Elesun says.  &quot;Once we're there we'll be able to relax.  Let's keep our wits about us until then.  That means you too, Ripley.&quot;\n\n&quot;Know something we don't?&quot; another of the guard's asks.\n\n&quot;The King apparently had an urgent meeting with a scout.  Something unusual was found; unusual enough that he didn't see Ripley off.&quot;\n\n&quot;He wouldn't let us go if he thought it might be a problem,&quot; Ripley says.\n\nElesun shoots Ripley a scowl.\n\n&quot;Not that caution ever hurt anyone,&quot; Ripley replies.\n\n&quot;Elesun's right,&quot; one of the guards says.  &quot;Stay sharp until we're in the grove.&quot;\n\n&lt;&lt;ctrlCon 'ch1-2'&gt;&gt;</div><div tiddler="scythe" tags="nobr" created="201612131444" modifier="twee">&lt;&lt;set $weaponname to &quot;Scythe&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;scyt_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 1.1&gt;&gt;\n&lt;&lt;set $wdef to 1.1&gt;&gt;\n&lt;&lt;set $wmov to 0.8&gt;&gt;\n&lt;&lt;set $critrange to 105&gt;&gt;\n\n&lt;&lt;set $wStaUse to 6&gt;&gt;\n\n&lt;&lt;if $scythetraining is 1&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n&lt;&lt;elseif $scythetraining is 2&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n\t&lt;&lt;set $watk to 1.2&gt;&gt;\n&lt;&lt;elseif $scythetraining is 3&gt;&gt;\n\t&lt;&lt;set $critrange to 100&gt;&gt;\n\t&lt;&lt;set $wmov to 0.9&gt;&gt;\n\t&lt;&lt;set $watk to 1.2&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1RipScene" tags="scene save" created="201702121118" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;Ripley,&quot; Elesun says.\n\nRipley opens her eyes and turns her head.  &quot;Hi, Elesun.&quot;\n\n&quot;Everyone seems to think it'd be a good idea for us to get out of here for a few days.  What do you think?  Want to go visit the grove?&quot;\n\n&quot;That sounds wonderful,&quot; Ripley says.  &quot;You always hated that place, though.&quot;\n\n&quot;I don't hate it, I just don't understand your customs and your people are--they can be pushy.&quot;\n\nRipley grins.  &quot;You're always so out of balance, Elesun, that balance seems alien to you.&quot;\n\n&quot;I'll smack you.&quot;\n\nRipley laughs.  &quot;Well, they like you, trust me.&quot;\n\n&quot;I'll behave.  And the grove is beautiful, I think we've both earned a chance to relax.&quot;\n\n&quot;When do we leave?&quot;\n\n&quot;A carriage will take us in the morning.  Get some rest.&quot;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;1RipQuarters&quot;&gt;&gt;</div><div tiddler="endinfo" tags="" created="201612151656" modifier="twee">\nA measure of wellness and conditioning.  Endurance greatly influences defense, and also influences grit and stamina.  &lt;&lt;if $character is &quot;Ripley&quot;&gt;&gt;It also determines how long Ripley can maintain her transformations.&lt;&lt;endif&gt;&gt;\n\n</div><div tiddler="baxe_ui" tags="" created="201702020410" modifier="twee">A strong steel battleaxe.\n\nHits hard, but requires a great deal of energy to swing.\n\n|[img[setup.ui.icons.ui_atk]]|Attack Rating:|Very High|\n|[img[setup.ui.icons.ui_def]]|Defense Rating:|Low|\n|[img[setup.ui.icons.ui_mov]]|Move Rating:|Very Low|\n*__Finesse__: Very Low\n*__Stamina__: Very High</div><div tiddler="0wall3south" tags="dock" created="201701250435" modifier="twee">&lt;&lt;if $choice2 is 0&gt;&gt;The throne room is close.\n\nElesun can't leave without Ripley, though.&lt;&lt;else&gt;&gt;Not much farther now.\n\n&lt;&lt;ctrlClick &quot;Head to the throne room.&quot; &quot;0transition1&quot; &quot;leave&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="rank3lvl5_soldier_akatosh" tags="nobr" created="201612181020" modifier="twee">&lt;&lt;set $enemyname to &quot;Soldier of Fortune&quot;&gt;&gt;\n&lt;&lt;set $enemynumber to 1&gt;&gt;\n&lt;&lt;set $enemypower to 158&gt;&gt;\n&lt;&lt;set $enemyimg to setup.nme['NME_warrior']&gt;&gt;\n\n/%stats for active enemies%/\n&lt;&lt;set $nmemaxgrit to 148&gt;&gt;\n&lt;&lt;set $nmegrit to $nmemaxgrit&gt;&gt;\n&lt;&lt;set $nmemaxhealth to 2&gt;&gt;\n&lt;&lt;set $nmehealth to $nmemaxhealth&gt;&gt;\n\n&lt;&lt;set $nmeatk to 33&gt;&gt;\n&lt;&lt;set $nmedef to 33&gt;&gt;\n&lt;&lt;set $nmemov to 31&gt;&gt;\n&lt;&lt;set $nmemagic to 0&gt;&gt;\n\n&lt;&lt;set $enemyspecialname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $enemyspecial to 0&gt;&gt;\n\n&lt;&lt;set $nmecritchance to 5&gt;&gt;\n&lt;&lt;set $nmecritdam to 1.4&gt;&gt;\n&lt;&lt;set $nmespellpower to 0&gt;&gt;\n&lt;&lt;set $nmeacc to 100&gt;&gt;\n&lt;&lt;set $nmebaseregen to 3&gt;&gt;\n\n&lt;&lt;set $nmemoveset to 3&gt;&gt;\n&lt;&lt;set $nmetype to 1&gt;&gt;\n\n&lt;&lt;set $nmexp to 15&gt;&gt;\n\n&lt;&lt;display &quot;bal-adj-nme&quot;&gt;&gt;\n</div><div tiddler="combat_test_2" tags="test" created="201701131708" modifier="twee" twine-position="1830,990">&lt;&lt;display &quot;combat_init&quot;&gt;&gt;</div><div tiddler="1ripqRip" tags="dock" created="201708232057" modifier="twee">Ripley doesn't appear to notice Elesun.\n\n&lt;&lt;if !$RipScene and $HarlScene&gt;&gt;&lt;&lt;ctrlClick 'Get her attention.' '1RipScene'&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;ctrlClick 'Get her attention.' '1RipTalk'&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="0kingsContinue" tags="dock" created="201701252208" modifier="twee">Head downstairs?\n\n&lt;&lt;ctrlClick &quot;Proceed.&quot; &quot;0transition2&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="codex_menu_places" tags="menu" created="201612141348" modifier="twee">!Places\n\n&lt;span id=&quot;codexpla&quot;&gt;Description of Places&lt;/span&gt;\n\n&lt;&lt;link &quot;The Planet&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;Earth&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Cosmos&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;Space&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Other World&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;Elysium&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Juno&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;Juno&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;Valne&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;Valne&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Northern Mountains&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;North&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n&lt;&lt;link &quot;The Stalm Sea&quot;&gt;&gt;\n\t&lt;&lt;replace &quot;#codexpla&quot;&gt;&gt;South&lt;&lt;/replace&gt;&gt;\n&lt;&lt;/link&gt;&gt;\n\n[[Back|codex_menu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/%[[&quot;\su00A0\su00A0\su00A0\su00A0\su00A0&quot;|debug_mode_activation]]%/\n</div><div tiddler="1cyWell" tags="dock" created="201702191054" modifier="twee">&lt;&lt;if $stoneLoc is 1 and $stoneOne.have is 0&gt;&gt;Elesun spots a small, boxy black stone near the base of the well.  Ripley might like it.\n\n&lt;&lt;ctrlClick &quot;Pick up the stone.&quot; &quot;1cyStone&quot; &quot;interact&quot;&gt;&gt;&lt;&lt;else&gt;&gt;This well serves the whole castle.  &lt;&lt;print either(&quot;Elesun draws up some water and has a drink.  She feels refreshed.&quot;, &quot;Elesun isn't thirsty right now.&quot;)&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="irelith18_stats" tags="nobr" created="201612132246" modifier="twee">&lt;&lt;set $allyname to &quot;Irelith&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 2.3&gt;&gt;\n\n&lt;&lt;set $allylvl to 18&gt;&gt;\n&lt;&lt;set $allymaxhealth to 5&gt;&gt;\n&lt;&lt;set $allymaxgrit to 290&gt;&gt;\n&lt;&lt;set $allyatk to 112&gt;&gt;\n&lt;&lt;set $allydef to 128&gt;&gt;\n&lt;&lt;set $allymov to 101&gt;&gt;\n&lt;&lt;set $allymagic to 101&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;guard&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Guard&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 1&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="Side Sword" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;sswd_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;side&quot;]]\n[[No|weaponswap]]</div><div tiddler="spell_keen" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Keen&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Natural&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Keen&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;keen_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 10&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.5&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $naturaltraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcrit to 15&gt;&gt;\n&lt;&lt;elseif $naturaltraining is 2&gt;&gt;\n\t&lt;&lt;set $spellcrit to 15&gt;&gt;\n\t&lt;&lt;set $spellcritdam to 1.8&gt;&gt;\n&lt;&lt;elseif $naturaltraining is 3&gt;&gt;\n\t&lt;&lt;set $spellcrit to 20&gt;&gt;\n\t&lt;&lt;set $spellcritdam to 1.8&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="spell_possessed" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Possessed&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Dark&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Possessed&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to&quot;poss_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to -10&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.5&gt;&gt;\n&lt;&lt;set $spelldodge to 0&gt;&gt;\n&lt;&lt;set $spellgrit to -30&gt;&gt;\n\n&lt;&lt;set $satk to 1.3&gt;&gt;\n&lt;&lt;set $sdef to 0.6&gt;&gt;\n&lt;&lt;set $smov to 0.6&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 0&gt;&gt;\n\n&lt;&lt;if $darktraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n&lt;&lt;elseif $darktraining is 2&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n\t&lt;&lt;set $spellgrit to -20&gt;&gt;\n&lt;&lt;elseif $darktraining is 3&gt;&gt;\n\t&lt;&lt;set $spellcrit to 0&gt;&gt;\n\t&lt;&lt;set $spellgrit to -20&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="gameover" tags="menu" created="201612141553" modifier="twee">!Game Over\n&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;set $gamestart to 0&gt;&gt;/%Standard game over.%/\n&lt;&lt;print $character&gt;&gt; has died.\n\n&lt;&lt;link &quot;Reload a saved game.&quot;&gt;&gt;&lt;&lt;script&gt;&gt;UI.saves();&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n&lt;&lt;link &quot;Restart the game.&quot;&gt;&gt;&lt;&lt;script&gt;&gt;UI.restart();&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;\n\n[&gt;img[setup.ui.gover]]\n\n</div><div tiddler="codex_characters" tags="menu" created="201701261828" modifier="twee">!!!Characters\n&lt;center&gt;\n|&lt;&lt;link &quot;Elesun&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Elesun&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;link &quot;Ripley&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Ripley&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;link &quot;Irelith&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Irelith&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;link &quot;Folsom&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Folsom&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|\n|&lt;&lt;link &quot;The King&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_King&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;link &quot;Akatosh&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Akatosh&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;link &quot;Aesil&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Aesil&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|&lt;&lt;link &quot;Harlaus&quot;&gt;&gt;&lt;&lt;replace &quot;#codexchar&quot;&gt;&gt;&lt;&lt;display &quot;codex_Harlaus&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;|\n&lt;/center&gt;\n\n&lt;span id=&quot;codexchar&quot;&gt; \n&lt;/span&gt;\n\n\n[[Back|codex_menu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="title_onCrit_DungeonMaster" tags="hook title" created="201707101727" modifier="twee">&lt;&lt;if $titles.has('Dungeon Master')&gt;&gt;\n\t&lt;&lt;set _max to $maxgrit&gt;&gt;\n\t&lt;&lt;set _curr to $grit&gt;&gt;\n\t&lt;&lt;if _curr lt _max&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 30&gt;&gt;\n\t\t\t&lt;&lt;set _reg to 30 + ($lvl * 5)&gt;&gt;\n\t\t\t&lt;&lt;set _reg to _reg - _odds&gt;&gt;\n\t\t\t&lt;&lt;set $grit to Math.trunc($grit + _reg)&gt;&gt;\n\t\t\t&lt;&lt;if $grit gte $maxgrit&gt;&gt;\n\t\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="AesBossTheme" tags="boss nobr music" created="201707261308" modifier="twee">&lt;&lt;audio 'nothing-left' loop play&gt;&gt;</div><div tiddler="0bysouth" tags="dock" created="201701110809" modifier="twee">The battle sounds close.\n\nThe king is probably holed up in the throne room to the south.  Akatosh’s men--scum and sellswords--they must be well inside the castle by now.\n\nIrelith went to protect the king, but she alone may not be enough.  Elesun knows she needs to hurry.</div><div tiddler="vowwidgets" tags="widget nobr" created="201710061919" modifier="twee" twine-position="150,1130">/% widgets for interfacing with the vow system %/\n\n/% &lt;&lt;addvow 'id'&gt;&gt; --- add to current / make a vow %/\n&lt;&lt;widget 'addvow'&gt;&gt;\n\t&lt;&lt;set _id to $args[0]&gt;&gt;\n\t&lt;&lt;if setup.vows.list[_id]&gt;&gt;\n\t\t&lt;&lt;run $vows.current.push(_id)&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;vowpoints 5&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;boost 'stat' 'val (defaults to 1)'&gt;&gt; --- add to stats %/\n&lt;&lt;widget 'boost'&gt;&gt;\n\t&lt;&lt;set _arrA to ['strict', 'letter', 'honor']&gt;&gt;\n\t&lt;&lt;set _arrB to ['loose', 'spirit', 'clever']&gt;&gt;\n\t&lt;&lt;set _arrC to _arrA.concat(_arrB)&gt;&gt;\n\t&lt;&lt;set _stat to $args[0]&gt;&gt;\n\t&lt;&lt;set _val to 1&gt;&gt;\n\t&lt;&lt;if $args[1]&gt;&gt;\n\t\t&lt;&lt;set _val to $args[1]&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n\n\t&lt;&lt;if _arrC.includes(_stat)&gt;&gt;\n\t\t&lt;&lt;if _arrA.includes(_stat)&gt;&gt;\n\t\t\t&lt;&lt;set _i to _arrA.indexOf(_stat)&gt;&gt;\n\t\t\t&lt;&lt;set $vows.stats[_arrA[_i]] to Math.clamp($vows.stats[_arrA[_i]] + _val, -10, 10)&gt;&gt;\n\t\t\t&lt;&lt;set $vows.stats[_arrB[_i]] to Math.clamp($vows.stats[_arrB[_i]] - _val, -10, 10)&gt;&gt;\n\t\t&lt;&lt;elseif _arrB.includes(_stat)&gt;&gt;\n\t\t\t&lt;&lt;set _i to _arrB.indexOf(_stat)&gt;&gt;\n\t\t\t&lt;&lt;set $vows.stats[_arrB[_i]] to Math.clamp($vows.stats[_arrB[_i]] + _val, -10, 10)&gt;&gt;\n\t\t\t&lt;&lt;set $vows.stats[_arrA[_i]] to Math.clamp($vows.stats[_arrA[_i]] - _val, -10, 10)&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;vowpoints value&gt;&gt; --- add or remove vp %/\n&lt;&lt;widget 'vowpoints'&gt;&gt;\n\t&lt;&lt;set $vows.points to Math.clamp($vows.points + $args[0], -40, 100)&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;upholdvow 'id'&gt;&gt; --- complete a vow %/\n&lt;&lt;widget 'upholdvow'&gt;&gt;\n\t&lt;&lt;set _id to $args[0]&gt;&gt;\n\n\t&lt;&lt;if $vows.current.includes(_id)&gt;&gt;\n\t\t&lt;&lt;run $vows.complete.push(_id)&gt;&gt;\n\t\t&lt;&lt;set _del to $vows.current.indexOf(_id)&gt;&gt;\n\t\t&lt;&lt;run $vows.current.deleteAt(_del)&gt;&gt;\n\t\t&lt;&lt;vowpoints 10&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;failvow 'id'&gt;&gt; --- break a vow %/\n&lt;&lt;widget 'failvow'&gt;&gt;\n\t&lt;&lt;set _id to $args[0]&gt;&gt;\n\n\t&lt;&lt;if $vows.current.includes(_id)&gt;&gt;\n\t\t&lt;&lt;run $vows.broken.push(_id)&gt;&gt;\n\t\t&lt;&lt;set _del to $vows.current.indexOf(_id)&gt;&gt;\n\t\t&lt;&lt;run $vows.current.deleteAt(_del)&gt;&gt;\n\t\t&lt;&lt;vowpoints -15&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;getvow&gt;&gt; --- return vow object as _vow %/\n&lt;&lt;widget 'getvow'&gt;&gt;\n\t&lt;&lt;set _id to $args[0]&gt;&gt;\n\t&lt;&lt;if setup.vows.list[_id]&gt;&gt;\n\t\t&lt;&lt;set _vow to setup.vows.list[_id]&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;outcome 'id' 'outcome'&gt;&gt; --- updates vow outcome %/\n&lt;&lt;widget 'outcome'&gt;&gt;\n\t&lt;&lt;set _id to $args[0]&gt;&gt;\n\t&lt;&lt;set _outc to $args[1]&gt;&gt;\n\t&lt;&lt;getvow _id&gt;&gt;\n\t&lt;&lt;set _vow.outc to _outc&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;orderstats&gt;&gt; --- return stats ordered highest to lowest %/\n&lt;&lt;widget 'orderstats'&gt;&gt;\n\t&lt;&lt;set _arr to clone(Object.keys($vows.stats))&gt;&gt;\n\t&lt;&lt;set _highest to ''&gt;&gt;\n\t&lt;&lt;set _ordered to []&gt;&gt;\n\t&lt;&lt;for _arr.length gt 0&gt;&gt;\n\t\t&lt;&lt;set _check to -11&gt;&gt;\n\t\t&lt;&lt;for _i to 0; _i &lt; _arr.length; _i++&gt;&gt;\n\t\t\t&lt;&lt;if $vows.stats[_arr[_i]] &gt;= _check&gt;&gt;\n\t\t\t\t&lt;&lt;if _check is $vows.stats[_arr[_i]]&gt;&gt;\n\t\t\t\t\t&lt;&lt;set _highest to either(_highest, _arr[_i])&gt;&gt;\n\t\t\t\t&lt;&lt;else&gt;&gt;\n\t\t\t\t\t&lt;&lt;set _check to $vows.stats[_arr[_i]]&gt;&gt;\n\t\t\t\t\t&lt;&lt;set _highest to _arr[_i]&gt;&gt;\n\t\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;/for&gt;&gt;\n\t\t/% delete highest and find next highest, etc %/\n\t\t&lt;&lt;run _ordered.push(_highest)&gt;&gt;\n\t\t&lt;&lt;set _del to _arr.indexOf(_highest)&gt;&gt;\n\t\t&lt;&lt;run _arr.deleteAt(_del)&gt;&gt;\n\t&lt;&lt;/for&gt;&gt;\n\t&lt;&lt;set $vows.ordered to _ordered&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;getname&gt;&gt; --- return the current vp name based on the list %/\n&lt;&lt;widget 'getname'&gt;&gt;\n\t&lt;&lt;if $vows.points is 0&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[3]&gt;&gt;\n\t&lt;&lt;elseif $vows.points gt 75&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[7]&gt;&gt;\n\t&lt;&lt;elseif $vows.points gt 60&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[6]&gt;&gt;\n\t&lt;&lt;elseif $vows.points gt 30&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[5]&gt;&gt;\n\t&lt;&lt;elseif $vows.points gt 0&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[4]&gt;&gt;\n\t&lt;&lt;elseif $vows.points gt -10&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[3]&gt;&gt;\n\t&lt;&lt;elseif $vows.points gt -20&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[2]&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $vows.name to setup.vows.names[1]&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;gettier&gt;&gt; --- return tier based on list %/\n&lt;&lt;widget 'gettier'&gt;&gt;\n\t&lt;&lt;orderstats&gt;&gt; /% refresh the list %/\n\t&lt;&lt;set _t to [$vows.ordered[0], $vows.ordered[1]]&gt;&gt;\n\t&lt;&lt;if _t.includesAll('clever', 'strict')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[1]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('clever', 'loose')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[2]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('clever', 'letter')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[3]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('clever', 'spirit')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[4]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('honor', 'strict')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[5]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('honor', 'loose')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[6]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('honor', 'letter')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[7]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('honor', 'spirit')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[8]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('strict', 'letter')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[9]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('strict', 'spirit')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[10]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('loose', 'letter')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[11]&gt;&gt;\n\t&lt;&lt;elseif _t.includesAll('loose', 'spirit')&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[12]&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;set $vows.tier to setup.vows.tiers[0]&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;processvows&gt;&gt; --- process all vow stats %/\n&lt;&lt;widget 'processvows'&gt;&gt;\n\t&lt;&lt;getname&gt;&gt;\n\t&lt;&lt;gettier&gt;&gt;\n\t&lt;&lt;set $vows.str to $vows.tier + ' ' + $vows.name&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;getstring (format)&gt;&gt; --- gets and prints vow string %/\n&lt;&lt;widget 'getstring'&gt;&gt;\n\t&lt;&lt;processvows&gt;&gt;\n\t&lt;&lt;if $args[0]&gt;&gt;\n\t\t&lt;&lt;= $vows.str.toUpperFirst()&gt;&gt;\n\t&lt;&lt;else&gt;&gt;\n\t\t&lt;&lt;= $vows.str&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;/widget&gt;&gt;\n\n/% &lt;&lt;vowbox&gt;&gt; --- display the vow log: for the journal %/\n&lt;&lt;widget 'vowbox'&gt;&gt; /% need some serious CSS... %/\n\t&lt;div id='vow-tray'&gt;\n\t\t&lt;div id='vow-title'&gt;&lt;&lt;include 'vow-title'&gt;&gt;&lt;/div&gt;\n\t\t&lt;div id='vow-tabs'&gt;\n\t\t\t&lt;span class='v-tab selected' id='vow-current'&gt;\n\t\t\t\t&lt;&lt;link 'Current'&gt;&gt;\n\t\t\t\t\t&lt;&lt;replace '#vow-list'&gt;&gt;&lt;&lt;include 'vow-list-current'&gt;&gt;&lt;&lt;/replace&gt;&gt;\n\t\t\t\t\t&lt;&lt;addclass '#vow-current' 'selected'&gt;&gt;\n\t\t\t\t\t&lt;&lt;removeclass '#vow-completed' 'selected'&gt;&gt;\n\t\t\t\t\t&lt;&lt;removeclass '#vow-broken' 'selected'&gt;&gt;\n\t\t\t\t&lt;&lt;/link&gt;&gt;\n\t\t\t&lt;/span&gt;\n\t\t\t&lt;span class='v-tab' id='vow-completed'&gt;\n\t\t\t\t&lt;&lt;link 'Completed'&gt;&gt;\n\t\t\t\t\t&lt;&lt;replace '#vow-list'&gt;&gt;&lt;&lt;include 'vow-list-completed'&gt;&gt;&lt;&lt;/replace&gt;&gt;\n\t\t\t\t\t&lt;&lt;addclass '#vow-completed' 'selected'&gt;&gt;\n\t\t\t\t\t&lt;&lt;removeclass '#vow-current' 'selected'&gt;&gt;\n\t\t\t\t\t&lt;&lt;removeclass '#vow-broken' 'selected'&gt;&gt;\n\t\t\t\t&lt;&lt;/link&gt;&gt;\n\t\t\t&lt;/span&gt;\n\t\t\t&lt;span class='v-tab' id='vow-broken'&gt;\n\t\t\t\t&lt;&lt;link 'Broken'&gt;&gt;\n\t\t\t\t\t&lt;&lt;replace '#vow-list'&gt;&gt;&lt;&lt;include 'vow-list-broken'&gt;&gt;&lt;&lt;/replace&gt;&gt;\n\t\t\t\t\t&lt;&lt;addclass '#vow-broken' 'selected'&gt;&gt;\n\t\t\t\t\t&lt;&lt;removeclass '#vow-completed' 'selected'&gt;&gt;\n\t\t\t\t\t&lt;&lt;removeclass '#vow-current' 'selected'&gt;&gt;\n\t\t\t\t&lt;&lt;/link&gt;&gt;\n\t\t\t&lt;/span&gt;\n\t\t&lt;/div&gt;\n\t\t&lt;div id='vow-list'&gt;\n\t\t\t&lt;&lt;include 'vow-list-current'&gt;&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;&lt;/widget&gt;&gt;</div><div tiddler="slash-script" tags="script" created="201708110213" modifier="twee">$(document).on('click', '.atk-bar button', function () {\n\tvar rnd = 'slash-' + random(1, 6);\n\t$('#slashes')\n\t\t.hide()\n\t\t.removeClass()\n\t\t.fadeIn(100)\n\t\t.addClass(rnd);\n});</div><div tiddler="scarcounter" tags="nobr" created="201612131232" modifier="twee">&lt;&lt;set $scars to $scars+1&gt;&gt;\n&lt;&lt;set $maxhealth to trunc(3+$scars/5)&gt;&gt;\n&lt;&lt;if $maxhealth gt 6&gt;&gt;&lt;&lt;set $maxhealth to 6&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="FolsomChat1" tags="chitchat" created="201707110030" modifier="twee">&lt;&lt;nobr&gt;&gt;&lt;&lt;set _FolsomChat1 to either(\n&quot;I'm fine, really.  You're looking at me like I'm a sick child.&quot;, \n&quot;Irelith ought to be resting still.  Damn her pride.&quot;,\n&quot;You've really taken to magic Elesun, but you still have much to learn.  When things settle down, let's practice some.&quot;,\n&quot;The king is in a foul mood.  Go easy on him.&quot;,\n&quot;Let me know if you need anything.&quot;\n)&gt;&gt;\n&lt;&lt;endnobr&gt;&gt;&lt;&lt;print '&quot;' + _FolsomChat1 + '&quot;'&gt;&gt;</div><div tiddler="Blessing" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;bless_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;bless&quot;]]\n[[No|spellswap]]</div><div tiddler="1Map1Hall" tags="dock map" created="201702180709" modifier="twee">Head south to the main hall?\n\n&lt;&lt;ctrlClick &quot;Go to the main hall.&quot; &quot;1mainhall&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="sq1adv" tags="nobr" created="201704221819" modifier="twee">&lt;&lt;set $sq1.progress to 10&gt;&gt;\n&lt;&lt;run $sq.pop($sq1), $sq.push($sq1)&gt;&gt;</div><div tiddler="ch7journal" tags="" created="201612141430" modifier="twee"></div><div tiddler="0throneroomKing" tags="dock" created="201701260221" modifier="twee">&quot;Are you okay?&quot; Elesun asks.\n\n&quot;Yeah, I'm fine,&quot; the king says.  &quot;So is Irelith--she'll survive anyway.&quot;\n\n&quot;Where's Ripley?&quot;\n\n&quot;Out in the main hall.&quot;&lt;&lt;timed 500ms&gt;&gt;&lt;&lt;replace &quot;#gone&quot;&gt;&gt;The &lt;&lt;action &quot;door&quot; &quot;0throneroomDoor&quot;&gt;&gt; to the main hall is cracked.&lt;&lt;/replace&gt;&gt;&lt;&lt;/timed&gt;&gt;</div><div tiddler="0iwdoor" tags="" created="201701070321" modifier="twee">This door leads back out to the courtyard.\n\n&lt;&lt;ctrlClick &quot;Go through the door.&quot; &quot;0courtyard&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="insert js" tags="script" created="201706290043" modifier="twee" twine-position="570,430">// insert macro set, by chapel; for sugarcube 2\n// version 1.0\n// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#insert-macros\n\n// &lt;&lt;insert&gt;&gt; macro\nMacro.add('insert', {\n\t   tags : null,\n\thandler : function () {\n\t\t\n\t\tvar $wrapper  = $(document.createElement('span'));\n\t\tvar content   = this.payload[0].contents;\n\t\tvar className = 'macro-' + this.name;\n\t\tvar el;\n\t\t\n\t\t// check args\n\t\tif (this.args.length !== 1) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t} else {\n\t\t\tel = this.args[0].trim();\n\t\t}\n\t\t\n\t\t// use a postdisplay to get at the fully-rendered DOM\n\t\tpostdisplay['insert-task-' + el] = function (taskName) {\n\t\t\t$(el).empty();  // clear target element\n\t\t\t\n\t\t\t// append payload\n\t\t\t$wrapper\n\t\t\t\t.wiki(content)\n\t\t\t\t.addClass(className)\n\t\t\t\t.appendTo(el);\n\t\t\t\t\n\t\t\tdelete postdisplay[taskName]; // single-use task\n\t\t};\n\t\n\t}\n});\n\n// &lt;&lt;insertappend&gt;&gt; macro\nMacro.add('insertappend', {\n\t   tags : null,\n\thandler : function () {\n\t\t\n\t\tvar $wrapper  = $(document.createElement('span'));\n\t\tvar content   = this.payload[0].contents;\n\t\tvar className = 'macro-' + this.name;\n\t\tvar el;\n\t\t\n\t\t// check args\n\t\tif (this.args.length !== 1) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t} else {\n\t\t\tel = this.args[0].trim();\n\t\t}\n\t\t\n\t\t// use a postdisplay to get at the fully-rendered DOM\n\t\tpostdisplay['insert-append-' + el] = function (taskName) {\n\t\t\t\n\t\t\t// append payload\n\t\t\t$wrapper\n\t\t\t\t.wiki(content)\n\t\t\t\t.addClass(className)\n\t\t\t\t.appendTo(el);\n\t\t\t\t\n\t\t\tdelete postdisplay[taskName]; // single-use task\n\t\t};\n\t\n\t}\n});\n\n// &lt;&lt;clearelement&gt;&gt; macro\nMacro.add('clearelement', {\n\thandler : function () {\n\n\t\tvar el;\n\t\t\n\t\t// check args\n\t\tif (this.args.length !== 1) {\n\t\t\treturn this.error('incorrect number of arguments');\n\t\t} else {\n\t\t\tel = this.args[0].trim();\n\t\t}\n\t\t\n\t\t// use a postdisplay to get at the fully-rendered DOM\n\t\tpostdisplay['clear-element-' + el] = function (taskName) {\n\t\t\t$(el).empty();  // clear target element\n\t\t\t\t\n\t\t\tdelete postdisplay[taskName]; // single-use task\n\t\t};\n\t\n\t}\n});</div><div tiddler="1dcGuards" tags="dock" created="201708282018" modifier="twee">The guards are making the rounds, but they look sicker with each place they check--Aesil probably got to all of them.</div><div tiddler="Possessed" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;poss_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;poss&quot;]]\n[[No|spellswap]]</div><div tiddler="demo_end" tags="menu" created="201701132346" modifier="twee" twine-position="2110,10">Thank you for playing this prototype version of Holy Land!\n\nPlease take a moment to fill out the form below and give us your feedback on the game.\n\n[[Give feedback.|https://docs.google.com/forms/d/e/1FAIpQLSezVS5I1fDT_jRFrCi0Qp5-RPJWL3e_CjuGE975CiWzqOoNHw/viewform]]\n\n&lt;&lt;link &quot;Restart the game.&quot;&gt;&gt;&lt;&lt;script&gt;&gt;UI.restart();&lt;&lt;/script&gt;&gt;&lt;&lt;/link&gt;&gt;\n\nThanks again for playing!</div><div tiddler="1KingScene" tags="scene" created="201702121115" modifier="twee">&lt;&lt;image 'KingSm'&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;set $KingScene to 1&gt;&gt;&quot;Have you spoken to Harlaus?&quot; the King asks.\n\n&lt;&lt;if $HarlScene&gt;&gt;&quot;I have.&quot;\n\n&quot;Get her away from here for a few days.&quot;\n\n&quot;Understood.&quot;&lt;&lt;else&gt;&gt;&quot;Not yet.&quot;\n\n&quot;He wants to talk to you.  He feels that Ripley needs to get out of the castle for a few days, and I agree.&quot;&lt;&lt;endif&gt;&gt;\n\n&quot;Your majesty,&quot; Elesun says.  &quot;Are you alright?&quot;\n\nThe King grins.  &quot;Are you worried about me?&quot;  He stands and walks over to her.  &quot;This is a rare day indeed.&quot;\n\n&quot;Normally you'd be swimming in advisors.&quot;\n\n&quot;I sent them away.  I think right now the most kingly thing I can do is mourn the men who fell.  So that's what I'm doing.  I'm sitting here thinking about them.&quot;\n\n&quot;What I said didn't come out right,&quot; Elesun says.\n\n&quot;But it did come out.  And it was right.  Make no mistake, I value your candor, I always have and always will.  I just wish you had better bedside manor.&quot;\n\n&lt;&lt;ctrlCon '1throne'&gt;&gt;</div><div tiddler="irelith10_stats" tags="nobr" created="201612132246" modifier="twee">&lt;&lt;set $allyname to &quot;Irelith&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 2.1&gt;&gt;\n\n&lt;&lt;set $allylvl to 10&gt;&gt;\n&lt;&lt;set $allymaxhealth to 4&gt;&gt;\n&lt;&lt;set $allymaxgrit to 225&gt;&gt;\n&lt;&lt;set $allyatk to 83&gt;&gt;\n&lt;&lt;set $allydef to 87&gt;&gt;\n&lt;&lt;set $allymov to 73&gt;&gt;\n&lt;&lt;set $allymagic to 73&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;guard&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Guard&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 1&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="map_1_1-pass" tags="map" created="201702180628" modifier="twee">&lt;&lt;button &quot;View List&quot;&gt;&gt;&lt;&lt;replace &quot;#navbox&quot;&gt;&gt;&lt;&lt;mapHarlan $now&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;div id='map-descr'&gt;&lt;/div&gt;\s\n&lt;img src=&quot;assets/img/maps/map_1_1.jpg&quot; alt=&quot;&quot; usemap=&quot;#Map&quot; /&gt;&lt;map name=&quot;Map&quot; id=&quot;Map&quot;&gt;\s\n&lt;area id='map1-1-bly' alt=&quot;&quot; title=&quot;Bailey&quot; data-passage=&quot;&quot; shape=&quot;poly&quot; coords=&quot;105,92,105,121,135,121,134,94&quot; /&gt;\s\n&lt;area id='map1-1-ele' alt=&quot;&quot; title=&quot;Elesun's Quarters&quot; data-passage=&quot;&quot; shape=&quot;poly&quot; coords=&quot;72,180,95,180,96,202,72,203&quot; /&gt;\s\n&lt;area id='map1-1-mhl' alt=&quot;&quot; title=&quot;Main Hall&quot; data-passage=&quot;&quot; shape=&quot;poly&quot; coords=&quot;132,237,159,237,158,259,133,259&quot; /&gt;\s\n&lt;area id='map1-1-srv' alt=&quot;&quot; title=&quot;Servant's Quarters&quot; data-passage=&quot;&quot; shape=&quot;poly&quot; coords=&quot;207,175,226,175,226,194,204,194&quot; /&gt;\s\n&lt;area id='map1-1-rip' alt=&quot;&quot; title=&quot;Ripley's Quarters&quot; data-passage=&quot;&quot; shape=&quot;poly&quot; coords=&quot;207,76,226,77,224,94,205,95&quot; /&gt;\s\n&lt;/map&gt;</div><div tiddler="title_onMov_DragonSlayer" tags="hook title" created="201707101752" modifier="twee">&lt;&lt;if $titles.has('Dragon Slayer')&gt;&gt;\n\t&lt;&lt;set $movbonus += Math.trunc($maxsta / 2)&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="title_onDodge_TrueDruid" tags="hook title" created="201707101739" modifier="twee">&lt;&lt;if $titles.has('True Druid')&gt;&gt;\n\t&lt;&lt;if $health lt $maxhealth&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 25&gt;&gt;\n\t\t\t&lt;&lt;set $health++&gt;&gt;\n\t\t\t&lt;&lt;if $health gte $maxhealth&gt;&gt;\n\t\t\t\t&lt;&lt;set $health to $maxhealth&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1HarlRip_queen" tags="dock" created="201707110058" modifier="twee">&quot;You mean //my// queen when you say that, don't you?  I suppose it's true enough.  I mean that she'd make a good queen.  An excellent one, I'm sure.\n\n&quot;...Stop grinning at me like that.&quot;\n</div><div tiddler="1guardPost" tags="scene" created="201701282004" modifier="twee"></div><div tiddler="about" tags="menu" created="201612122040" modifier="twee" twine-position="1690,150">Version 0.7.3 &lt;&lt;if $webversion is 1&gt;&gt;(Web)&lt;&lt;endif&gt;&gt; &lt;&lt;if $return is &quot;main menu&quot;&gt;&gt;&lt;&lt;link &quot;Update History&quot;&gt;&gt;\n&lt;&lt;script&gt;&gt;\nDialog.setup(&quot;Version History&quot;);\nDialog.wiki(Story.get(&quot;Update History&quot;).processText());\nDialog.open();\n&lt;&lt;/script&gt;&gt;\n&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n//Holy Land// was written, designed, and programmed by ChapelR.\n\n&lt;iframe src=&quot;A_hlCred.html&quot; width=&quot;900&quot; height=&quot;500&quot;&gt;Loading ... &lt;/iframe&gt;\n\n</div><div tiddler="1throneStone" tags="dock" created="201708112311" modifier="twee">It's fresh stonework--clean and off-color.  It's solid though.</div><div tiddler="attack-bar" tags="combat" created="201702222227" modifier="twee">&lt;center&gt;\n&lt;div id='slash'&gt;\s\n\t&lt;div id='slashes'&gt;&lt;div class='internal-slash'&gt;&lt;/div&gt;&lt;/div&gt;\s\n&lt;/div&gt;\n&lt;div class=&quot;battle-bar&quot;&gt;&lt;span class=&quot;w1&quot;&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class=&quot;time-btn atk-bar&quot;&gt;&lt;&lt;button &quot;Attack!&quot;&gt;&gt;&lt;&lt;audio &quot;fast-atk&quot; stop&gt;&gt;&lt;&lt;audio &quot;fast-atk&quot; play&gt;&gt;&lt;&lt;set $QTEatk++&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;/div&gt;\n&lt;&lt;script&gt;&gt;\npostdisplay['attack-timer'] = function (taskName) {\n\tdelete postdisplay[taskName];\n\t$('.battle-bar .w1').animate({ width : '0%' }, {\n\t\tduration : State.variables.attackSec * 1000,\n\t\teasing   : 'linear',\n\t\tcomplete : function () {\n\t\t\t$('.time-btn').hide();\n\t\t\tEngine.play(State.variables.nextBoss);\n\t\t}\n\t});\n};\n&lt;&lt;/script&gt;&gt;\n&lt;/center&gt;</div><div tiddler="1eleqMirror" tags="dock" created="201708281401" modifier="twee">&lt;&lt;portrait&gt;&gt;Elesun can see her reflection in the mirror.  She's fairly happy with what she sees.  Sure she's getting older, and her eyes look more tired every passing year, but </div><div tiddler="helpdecisions" tags="help" created="201701140606" modifier="twee">Some scenes include ''important decisions'' for you to make.  Decisions have far-reaching consequences, and they aren't always obvious.  You can use the links in the text to see Elesun's thoughts and make a better-informed choice.\n\nThere are no wrong choices, but keep in mind that Elesun is training Ripley--she needs to become a great warrior to achieve her destiny.  That said, if she gets wounded or killed, there won't be much of a destiny at all.\n\nHint: If you don’t see any links, try changing your dock mode in the settings menu.</div><div tiddler="ch6journal" tags="" created="201612141430" modifier="twee"></div><div tiddler="1servqClean" tags="dock" created="201708260113" modifier="twee">Elesun decides not to think about it.  Ever.</div><div tiddler="powinfo" tags="" created="201612172031" modifier="twee">\nFighthing power represents a given character's strength in combat.\n\n</div><div tiddler="prologueintro" tags="" created="201701070311" modifier="twee">!Prologue: Child of Promise&lt;&lt;portrait&gt;&gt;\nJune 5, 1101&lt;&lt;display &quot;spell_protect&quot;&gt;&gt;\n&lt;&lt;set $gamestart to 1&gt;&gt;&lt;&lt;if visited() is 1&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;oh&quot; loop play&gt;&gt;&lt;&lt;endif&gt;&gt;\nElesun wasn't surprised they attacked the castle.  In fact, she had been against housing Ripley and the King in the same place from the start--it was too big of a target--no matter how strong the walls, no matter how many guards.  The enemy knew that with just one battle, no matter how difficult, they could win this war.\n\nAnd lo and behold.\n\nThere was no siege--not really.  Their attacks on the outer walls happened fast, with overwhelming numbers.  The walls fell in hours.  But the enemy was losing many men and weakening as the battle dragged on.  Their morale was failing.\n\nHere in the inner walls, Elesun knew she could win this fight.\n\n&lt;&lt;ctrlClick &quot;Start&quot; &quot;prol1&quot;&gt;&gt;\n\n&lt;&lt;run $('#ui-bar').hide().delay(1000).fadeIn();&gt;&gt;\n&lt;&lt;display 'content-warning'&gt;&gt;\n&lt;&lt;run $('#splash h1').hide().fadeIn();&gt;&gt;\n&lt;&lt;run $('#splash span').hide().fadeIn();&gt;&gt;\n\n\n</div><div tiddler="scar_roulette" tags="nobr" created="201701230942" modifier="twee">&lt;&lt;if $scarchance gt 0 and $scatchancesAmt gt 0&gt;&gt;\n\t&lt;&lt;for _x to 0; _x lt $scarchancesAmt; _x++&gt;&gt;\n\t\t&lt;&lt;set $scartest to random(100)&gt;&gt;\n\t\t&lt;&lt;if $scartest is lte $scarchance&gt;&gt;\n\t\t\t&lt;&lt;set $scars++&gt;&gt;\n\t\t\t&lt;&lt;set $scarReport++&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;set $scarchance to $scarchance + 10&gt;&gt;\n\t&lt;&lt;/for&gt;&gt;\n\t&lt;&lt;if $scarReport gt 0&gt;&gt;\n\t\t&lt;&lt;set $wounds to 0&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;if !$firstRest&gt;&gt;\n\t&lt;&lt;set $firstRest to true&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n\t</div><div tiddler="combat_trainer" tags="menu" created="201612131950" modifier="twee">&lt;&lt;set $gamestart to 0&gt;&gt;TP: &lt;&lt;print $tp&gt;&gt;\n\nSelect a weapon to practice with:\n\nUnarmed: Current Level &lt;&lt;print $unarmedtraining&gt;&gt; &lt;&lt;if $unarmedtraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;unarm&quot;; $tpcost to ($unarmedtraining+1)*3]] (&lt;&lt;print ($unarmedtraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;\nLongsword: Current Level &lt;&lt;print $longswordtraining&gt;&gt; &lt;&lt;if $longswordtraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;lsword&quot;; $tpcost to ($longswordtraining+1)*3]] (&lt;&lt;print ($longswordtraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $gswordhave is 1&gt;&gt;Great Sword:  Current Level &lt;&lt;print $greatswordtraining&gt;&gt; &lt;&lt;if $greatswordtraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;gsword&quot;; $tpcost to ($greatswordtraining+1)*3]] (&lt;&lt;print ($greatswordtraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $katanahave is 1&gt;&gt;Katana:  Current Level &lt;&lt;print $katanatraining&gt;&gt; &lt;&lt;if $katanatraining lt 3&gt;&gt;[[Train|combat_trainer2][[$choice to &quot;katana&quot;; $tpcost to ($katanatraining+1)*3]] (&lt;&lt;print ($katanatraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $spearhave is 1&gt;&gt;Spear:  Current Level &lt;&lt;print $speartraining&gt;&gt; &lt;&lt;if $speartraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;spear&quot;; $tpcost to ($speartraining+1)*3]] (&lt;&lt;print ($speartraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $sswordhave is 1&gt;&gt;Side Sword:  Current Level &lt;&lt;print $sideswordtraining&gt;&gt; &lt;&lt;if $sideswordtraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;ssword&quot;; $tpcost to ($sideswordtraining+1)*3]] (&lt;&lt;print ($sideswordtraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $gauntlethave is 1&gt;&gt;Clawed Gauntlets:  Current Level &lt;&lt;print $gauntletstraining&gt;&gt; &lt;&lt;if $gauntletstraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;gaunt&quot;; $tpcost to ($gauntletstraining+1)*3]] (&lt;&lt;print ($gauntletstraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $scythehave is 1&gt;&gt;Scythe:  Current Level &lt;&lt;print $scythetraining&gt;&gt; &lt;&lt;if $scythetraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;scythe&quot;; $tpcost to ($scythetraining+1)*3]] (&lt;&lt;print ($scythetraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $saberhave is 1&gt;&gt;Saber:  Current Level &lt;&lt;print $sabertraining&gt;&gt; &lt;&lt;if $sabertraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;saber&quot;; $tpcost to ($sabertraining+1)*3]] (&lt;&lt;print ($sabertraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $axehave is 1&gt;&gt;Battle Axe:  Current Level &lt;&lt;print $battleaxetraining&gt;&gt; &lt;&lt;if $battleaxetraining lt 3&gt;&gt;[[Train|combat_trainer2][$choice to &quot;axe&quot;; $tpcost to ($battleaxetraining+1)*3]] (&lt;&lt;print ($battleaxetraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n[[Cancel|$exitpassage][$gamestart to 1]]</div><div tiddler="damagecalc_ally" tags="nobr" created="201612160712" modifier="twee"></div><div tiddler="collection_view" tags="menu" created="201702141932" modifier="twee" twine-position="850,990">!!!Ripley's Stone Collection\n&lt;&lt;set $gamestart to 2&gt;&gt;\n&lt;&lt;if $stoneOne.have is 1&gt;&gt;&lt;&lt;print $stoneOne.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneOne.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneOne.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneTwo.have is 1&gt;&gt;&lt;&lt;print $stoneTwo.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneTwo.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneTwo.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneThree.have is 1&gt;&gt;&lt;&lt;print $stoneThree.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneThree.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneThree.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneFour.have is 1&gt;&gt;&lt;&lt;print $stoneFour.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneFour.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneFour.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneFive.have is 1&gt;&gt;&lt;&lt;print $stoneFive.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneFive.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneFive.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneSix.have is 1&gt;&gt;&lt;&lt;print $stoneSix.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneSix.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneSix.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneSeven.have is 1&gt;&gt;&lt;&lt;print $stoneSeven.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneSeven.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneSeven.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneEight.have is 1&gt;&gt;&lt;&lt;print $stoneEight.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneEight.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneEight.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneNine.have is 1&gt;&gt;&lt;&lt;print $stoneNine.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneNine.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneNine.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $stoneTen.have is 1&gt;&gt;&lt;&lt;print $stoneTen.num + &quot;. &quot;&gt;&gt;&lt;&lt;link $stoneTen.name&gt;&gt;&lt;&lt;replace &quot;#info&quot;&gt;&gt;&lt;&lt;print $stoneTen.descr&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n[[Return to game.|$return]]\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="0bailey" tags="space" created="201701110806" modifier="twee">It’s getting on evening, and in the twilight, Elesun can see orange light--flames--coming from the &lt;&lt;weak &quot;village&quot; &quot;0byvillage&quot;&gt;&gt; just beyond the inner wall.  There won’t be much left to protect here soon; the &lt;&lt;weak &quot;enemy&quot; &quot;0byenemy&quot;&gt;&gt; is attacking in full force.\n\nRipley’s chambers will be to the &lt;&lt;action &quot;north&quot; &quot;0bynorth&quot;&gt;&gt;, and the path looks clear for now.\n\nThe battle is still raging on in the &lt;&lt;dock &quot;south&quot; &quot;0bysouth&quot;&gt;&gt;.\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n</div><div tiddler="1AndreScene" tags="scene save" created="201708260118" modifier="twee">&lt;&lt;image &quot;manSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;first&gt;&gt;&quot;What do you need?&quot; Elesun asks.\n\n&quot;Well, in the full version of the game, I'll be giving you a side quest.  You know, to introduce you to the concept.  Then I'd give you a reward afterward.&quot;\n\n&quot;Are you...what?  What does that mean?&quot;\n\n&quot;Well you see, dear, the creator of this game is still in the process of fully testing and implementing the side quest system.  So that really won't work, now will it?&quot;\n\n&quot;Don't call me 'dear.'&quot;\n\n&quot;The answer is no.  And it was a rhetorical question.&quot;\n\n&quot;Are you feeling alright, Andre?&quot;\n\n&quot;Anyway, I figure we could just cut out the middleman and go straight for that reward.  What do you say?&quot;\n\n&quot;What the hell is a 'side quest?'&quot;\n\n&quot;Her you go!&quot;\n\nAndre hands Elesun a beautifully forged spear, probably one of the King's own weapons.&lt;&lt;set $spearhave to 1&gt;&gt;\n\n//Recieved a new weapon//\n\n&quot;Why are you giving me a spear?&quot;\n\n&quot;You don't like it?&quot;\n\n&quot;I love it,&quot; Elesun says.\n\n&quot;Then what's wrong?&quot;\n\n&quot;Why does it seem like you're talking past me instead of to me.  Are you gaslighting me?&quot;\n\n&quot;I don't think so, no.  What does that mean?&quot;\n\n&quot;You know what, Andre.  Just sit back down.  Thank you for the spear.&quot;\n\n&quot;Anytime, dear.&quot;\n\n&quot;Don't call me 'dear.'&quot;&lt;&lt;finally&gt;&gt;&quot;How do you like the demo?&quot; Andre asks.\n\n&quot;You're really starting to freak me out.  Please stop.&quot;&lt;&lt;/first&gt;&gt;\n\n&lt;&lt;ctrlCon '1servQuarters'&gt;&gt;</div><div tiddler="helpFreedom" tags="help" created="201702120820" modifier="twee">From here on out, you'll be given a lot more freedom in how and when to do things.  When you find yourself able to access multiple spaces, you'll see a small navigation box that can help you get around.\n\nRemember, you can talk to people or inspect the environment multiple times to find new things to interact with.  And don't forget that you can press CTRL to quickly activate any links that appear in the dock.</div><div tiddler="1IreTrainerDone" tags="trainer" created="201702121034" modifier="twee">&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;The soldiers leave disappointed when Elesun and Irelith practice drills and give each other pointers instead of having a no-holds-barred contest.\n\nAll the same, Elesun feels stronger for it.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;1IreTalk&quot;&gt;&gt;</div><div tiddler="1IreTalk" tags="talk" created="201701281952" modifier="twee">&lt;&lt;image &quot;IrePt&quot;&gt;&gt;Elesun approaches Irelith.\n\n&quot;What is it, Elesun?&quot;\n\n&lt;&lt;dock &quot;Chit-chat.&quot; &quot;IrelithChat1&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Train with Irelith.&quot; &quot;1IreTrainerPre&quot;&gt;&gt;\n\n&lt;&lt;dock &quot;Never mind.&quot; &quot;1IreNVM&quot;&gt;&gt;\n\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpTalking&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;info&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="Lamia-E-4" tags="" created="201707262302" modifier="twee"></div><div tiddler="1maket" tags="scene" created="201701282004" modifier="twee"></div><div tiddler="0protectking1" tags="scene" created="201701252354" modifier="twee">&lt;&lt;portrait&gt;&gt;Elesun opens the door to the throneroom.  It's not locked, which is never a good sign...\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0protectking2&quot;&gt;&gt;</div><div tiddler="slowed_help" tags="dock" created="201701250217" modifier="twee">The ground beneath &lt;&lt;name&gt;&gt; becomes moist and swamp like, hampering footing.\n\nLarge penalty to Move actions, along with a mild penalty to Defense and Defense actions.</div><div tiddler="0protectking3" tags="scene save" created="201701260032" modifier="twee">&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;I'll go check it out,&quot; Elesun says.\n\n&quot;Careful,&quot; &lt;&lt;journallink &quot;Irelith&quot; &quot;codex_Irelith&quot;&gt;&gt; replies.\n\n&quot;Stay here and protect them, Ripley,&quot; Elesun says.\n\n&lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; nods.\n\n&lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; steps out through the wall.  Just down the hillside she can see the village--the fires are going out now, and it's evening--the sky is darkenening by the minute.\n\n&lt;&lt;if $helpServants is 0&gt;&gt;A sellsword knight, his armor adorned with Akatosh's coat-of-arms, is heading up the hill towards her, sword drawn.\n\n&lt;&lt;ctrlClick &quot;Fight him.&quot; &quot;combat_call_0_4&quot;&gt;&gt;&lt;&lt;else&gt;&gt;A woman in black is heading up the hill towards her--the witch.\n\n&quot;Hello, demonkin&quot; she says, drawing her sword.\n\n&lt;&lt;ctrlClick &quot;Fight her.&quot; &quot;combat_call_0_5&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n\n</div><div tiddler="0protectking2" tags="space" created="201701252355" modifier="twee">&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;image &quot;KingSm&quot;&gt;&gt;&lt;&lt;action &quot;Irelith&quot; &quot;0protectking2Ire&quot;&gt;&gt; is sitting in the corner, her sword is on the floor next to her.  She's got a nasty &lt;&lt;weak &quot;gash&quot; &quot;0protectking2wound&quot;&gt;&gt; across her gut, and the &lt;&lt;dock &quot;king&quot; &quot;0protectking2king&quot;&gt;&gt; is leaning over her, trying to keep pressure on the wound.  The corpses of several &lt;&lt;weak &quot;soldiers&quot; &quot;0protectking2soldier&quot;&gt;&gt; and &lt;&lt;weak &quot;sellswords&quot; &quot;0protectking2sellswords&quot;&gt;&gt; alike litter the room.  The wall behind the throne is &lt;&lt;weak &quot;melted&quot; &quot;0protectking2wall&quot;&gt;&gt;.\n\n&lt;&lt;dock &quot;Ripley&quot; &quot;0protectking2Rip&quot;&gt;&gt; steps in after Elesun, and gasps upon seeing Irelith and rushes to her.\n\n&quot;Hey kid,&quot; Irelith says. &quot;It's &lt;&lt;weak &quot;not as bad as it looks&quot; &quot;0protectking2lie&quot;&gt;&gt;.&quot;\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpspaces&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="ripley_emotes" tags="widget nobr" created="201701231136" modifier="twee" twine-position="710,850">/%&lt;&lt;emote &quot;emote code&quot; &quot;size&quot;&gt;&gt;%/\n/%example: &lt;&lt;emote &quot;grin&quot; &quot;pt&quot;&gt;&gt;%/\n&lt;&lt;widget &quot;emote&quot;&gt;&gt;\n\t&lt;&lt;set _imageSize to $args[1].toUpperFirst()&gt;&gt;\n\t&lt;&lt;set _emoteSubj to &quot;Rip&quot; + _imageSize + &quot;_&quot; + $args[0]&gt;&gt;\n\t&lt;&lt;set _emoteSubj to setup.img[_emoteSubj]&gt;&gt;\n\t&lt;span id=&quot;portrait&quot;&gt;[img[_emoteSubj]]&lt;/span&gt;\n&lt;&lt;/widget&gt;&gt;\n/%shortcuts:%/\n&lt;&lt;widget &quot;masked&quot;&gt;&gt;&lt;&lt;emote &quot;mask&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;happy&quot;&gt;&gt;&lt;&lt;emote &quot;hapy&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;confused&quot;&gt;&gt;&lt;&lt;emote &quot;conf&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;determined&quot;&gt;&gt;&lt;&lt;emote &quot;detr&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;grinning&quot;&gt;&gt;&lt;&lt;emote &quot;grin&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;excited&quot;&gt;&gt;&lt;&lt;emote &quot;exct&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;sad&quot;&gt;&gt;&lt;&lt;emote &quot;sadd&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;dolled-up&quot;&gt;&gt;&lt;&lt;emote &quot;doll&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;surprised&quot;&gt;&gt;&lt;&lt;emote &quot;surp&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;excited&quot;&gt;&gt;&lt;&lt;emote &quot;exct&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;dolled-up-angry&quot;&gt;&gt;&lt;&lt;emote &quot;dola&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;dolled-up-neutral&quot;&gt;&gt;&lt;&lt;emote &quot;doln&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;beatup&quot;&gt;&gt;&lt;&lt;emote &quot;beat&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;beatup-happy&quot;&gt;&gt;&lt;&lt;emote &quot;bthp&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;eating-dismissive&quot;&gt;&gt;&lt;&lt;emote &quot;edis&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;laughing&quot;&gt;&gt;&lt;&lt;emote &quot;lagh&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;hoping&quot;&gt;&gt;&lt;&lt;emote &quot;hope&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;eating&quot;&gt;&gt;&lt;&lt;emote &quot;eatn&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;toasting&quot;&gt;&gt;&lt;&lt;emote &quot;toas&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;eating-happy&quot;&gt;&gt;&lt;&lt;emote &quot;ehap&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;joyous&quot;&gt;&gt;&lt;&lt;emote &quot;joys&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;what&quot;&gt;&gt;&lt;&lt;emote &quot;what&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;sigh&quot;&gt;&gt;&lt;&lt;emote &quot;sigh&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;worried&quot;&gt;&gt;&lt;&lt;emote &quot;worr&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;devil-form&quot;&gt;&gt;&lt;&lt;emote &quot;devl&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;final-form&quot;&gt;&gt;&lt;&lt;emote &quot;finl&quot; &quot;pt&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n\t/%shortcuts for &quot;thumbs&quot;%/\n&lt;&lt;widget &quot;th-masked&quot;&gt;&gt;&lt;&lt;emote &quot;mask&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-happy&quot;&gt;&gt;&lt;&lt;emote &quot;hapy&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-confused&quot;&gt;&gt;&lt;&lt;emote &quot;conf&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-determined&quot;&gt;&gt;&lt;&lt;emote &quot;detr&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-grinning&quot;&gt;&gt;&lt;&lt;emote &quot;grin&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-excited&quot;&gt;&gt;&lt;&lt;emote &quot;exct&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-sad&quot;&gt;&gt;&lt;&lt;emote &quot;sadd&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-dolled-up&quot;&gt;&gt;&lt;&lt;emote &quot;doll&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-surprised&quot;&gt;&gt;&lt;&lt;emote &quot;surp&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-excited&quot;&gt;&gt;&lt;&lt;emote &quot;exct&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-dolled-up-angry&quot;&gt;&gt;&lt;&lt;emote &quot;dola&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-dolled-up-neutral&quot;&gt;&gt;&lt;&lt;emote &quot;doln&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-beatup&quot;&gt;&gt;&lt;&lt;emote &quot;beat&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-beatup-happy&quot;&gt;&gt;&lt;&lt;emote &quot;bthp&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-eating-dismissive&quot;&gt;&gt;&lt;&lt;emote &quot;edis&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-laughing&quot;&gt;&gt;&lt;&lt;emote &quot;lagh&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-hoping&quot;&gt;&gt;&lt;&lt;emote &quot;hope&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-eating&quot;&gt;&gt;&lt;&lt;emote &quot;eatn&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-toasting&quot;&gt;&gt;&lt;&lt;emote &quot;toas&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-eating-happy&quot;&gt;&gt;&lt;&lt;emote &quot;ehap&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-joyous&quot;&gt;&gt;&lt;&lt;emote &quot;joys&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-what&quot;&gt;&gt;&lt;&lt;emote &quot;what&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-sigh&quot;&gt;&gt;&lt;&lt;emote &quot;sigh&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-worried&quot;&gt;&gt;&lt;&lt;emote &quot;worr&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-devil-form&quot;&gt;&gt;&lt;&lt;emote &quot;devl&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;\n&lt;&lt;widget &quot;th-final-form&quot;&gt;&gt;&lt;&lt;emote &quot;finl&quot; &quot;sm&quot;&gt;&gt;&lt;&lt;endwidget&gt;&gt;</div><div tiddler="combatexplanation7menu" tags="menu" created="201704281529" modifier="twee">&lt;&lt;if not $gamestart is 0&gt;&gt;&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut7][helpmenu]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;helpmenu&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;div id=&quot;tutorial&quot;&gt;[img[setup.ui.tut.tut7][newgame3]]&lt;/div&gt;\n&lt;&lt;ctrlCon &quot;newgame3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="nw_fullscreen" tags="script" created="201701230806" modifier="twee" twine-position="850,290">// &lt;&lt;fullscreenNW&gt;&gt; -- for NW.js\nMacro.add('fullscreenNW', {\n    handler : function() { \n\n\t\tvar bg = $('body').css('background-color');\n        $('html').css('background-color', bg);\n\n\t\tvar ngui = require('nw.gui');\n\t\tvar nwin = ngui.Window.get();\n\t\tnwin.toggleFullscreen();\n\n    }\n});</div><div tiddler="1RipHarl" tags="dock" created="201708260039" modifier="twee">&quot;What about him?&quot;\n\n&quot;I figured you two would be together,&quot; Elesun says.  &quot;It's been months.&quot;\n\n&quot;He's been a bit distant lately.&quot;  Ripley shrugs.  &quot;Did you know the King told him to marry me?&quot;\n\n&quot;I didn't know that.&quot;\n\n&quot;I think he's just freaked out by it.&quot;\n\n&quot;Do you want to marry him?&quot;\n\n&quot;I don't want to plan too far ahead until I deal with Akatosh,&quot; Ripley says softly.\n\n&quot;Hey, we'll do it together.  I'll be right there with you every step of the way.  You're not going to die.  You have a bright, long future ahead of you.&quot;\n\n&quot;I know.  I might not die, but people are dying every day, waiting on me to be ready--&quot;\n\n&quot;I know.  But this is bigger than them--or even you.  We only get one chance to do this right.  And you're a person, Ripley.  You get to have a life, friends, family.  You're not just some world-saving tool.&quot;\n\n&quot;Yeah...&quot;\n\n&quot;According to Folsom, the last child of promise was pushing thirty when she fought Akatosh.  You're sixteen.  You're making excellent time, trust me.&quot;</div><div tiddler="Scythe" tags="menu" created="201612131505" modifier="twee">&lt;&lt;display &quot;scyt_ui&quot;&gt;&gt;\nEquip this weapon?\n\n[[Yes|changeweapon][$change to &quot;scyt&quot;]]\n[[No|weaponswap]]</div><div tiddler="0wall2time" tags="dock" created="201701242312" modifier="twee">If the enemy didn't attack Ripley in force, then they must be after the king.  Irelith is strong and skilled, but she wouldn't last long.</div><div tiddler="codex_Harlaus" tags="menu" created="201701261839" modifier="twee">&lt;&lt;image &quot;HarlPtKid&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Harlaus''\n\nPrince Harlaus is heir to the thrown of Juno and son of His Majesty King Harmon.  Harlaus is strong and smart, and popular with the people.  Some claim his wisdom rivals his father's.\n\nWhen Ripley was brought in to the King's house, she became fast friends with the Prince, and the two were raised, trained, and educated together.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="1Merac" tags="space" created="201701282004" modifier="twee"></div><div tiddler="codex_Folsom" tags="menu" created="201701261838" modifier="twee">&lt;&lt;image &quot;FolsomPt&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Folsom''\n\nLord Folsom is King Harmon's court wizard, most-trusted advisor, and closest friend.  Though now an old man, Folsom's mastery over many kinds of magic, expecially hellish magic, has made him a powerful ally.\n\nFolsom educated Prince Harlaus and Lady Ripley in politics, law, and mathematics, and has grown fond of the children.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="gauntlets" tags="nobr" created="201612131450" modifier="twee">&lt;&lt;set $weaponname to &quot;Clawed Gauntlets&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;gaun_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 0.8&gt;&gt;\n&lt;&lt;set $wdef to 0.8&gt;&gt;\n&lt;&lt;set $wmov to 1.0&gt;&gt;\n&lt;&lt;set $critrange to 90&gt;&gt;\n\n&lt;&lt;set $wStaUse to 3&gt;&gt;\n\n&lt;&lt;if $gauntletstraining is 1&gt;&gt;\n\t&lt;&lt;set $wdef to 0.9&gt;&gt;\n&lt;&lt;elseif $gauntletstraining is 2&gt;&gt;\n\t&lt;&lt;set $wdef to 0.9&gt;&gt;\n\t&lt;&lt;set $wmov to 1.1&gt;&gt;\n&lt;&lt;elseif $gauntletstraining is 3&gt;&gt;\n\t&lt;&lt;set $wdef to 0.9&gt;&gt;\n\t&lt;&lt;set $wmov to 1.1&gt;&gt;\n\t&lt;&lt;set $watk to 0.9&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="Warden-E-2" tags="" created="201707262301" modifier="twee"></div><div tiddler="magic_trainer" tags="menu" created="201612131951" modifier="twee">&lt;&lt;set $gamestart to 0&gt;&gt;TP: &lt;&lt;print $tp&gt;&gt;\n\nSelect a school of magic to practice:\n\n&lt;&lt;if $neutralhave is 1&gt;&gt;Neutral: Current Level &lt;&lt;print $neutraltraining&gt;&gt; &lt;&lt;if $neutraltraining lt 3&gt;&gt;[[Train|magic_trainer2][$choice to &quot;neut&quot;; $tpcost to ($neutraltraining+1)*3]] (&lt;&lt;print ($neutraltraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $naturalhave is 1&gt;&gt;Natural: Current Level &lt;&lt;print $naturaltraining&gt;&gt; &lt;&lt;if $naturaltraining lt 3&gt;&gt;[[Train|magic_trainer2][$choice to &quot;nat&quot;; $tpcost to ($naturaltraining+1)*3]] (&lt;&lt;print ($naturaltraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $lighthave is 1&gt;&gt;Light:  Current Level &lt;&lt;print $lighttraining&gt;&gt; &lt;&lt;if $lighttraining lt 3&gt;&gt;[[Train|magic_trainer2][$choice to &quot;lt&quot;; $tpcost to ($lighttraining+1)*3]] (&lt;&lt;print ($lighttraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $darkhave is 1&gt;&gt;Dark:  Current Level &lt;&lt;print $darktraining&gt;&gt; &lt;&lt;if $darktraining lt 3&gt;&gt;[[Train|magic_trainer2][[$choice to &quot;dk&quot;; $tpcost to ($darktraining+1)*3]] (&lt;&lt;print ($darktraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $hellishhave is 1&gt;&gt;Hellish:  Current Level &lt;&lt;print $hellishtraining&gt;&gt; &lt;&lt;if $hellishtraining lt 3&gt;&gt;[[Train|magic_trainer2][$choice to &quot;hell&quot;; $tpcost to ($hellishtraining+1)*3]] (&lt;&lt;print ($hellishtraining+1)*3&gt;&gt; TP)&lt;&lt;else&gt;&gt;Cannot train further.&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n[[Cancel|$exitpassage][$gamestart to 1]]</div><div tiddler="prologuejournal" tags="" created="201612131814" modifier="twee">&lt;&lt;if $storystage lt 1&gt;&gt;Nothing here yet.&lt;&lt;else&gt;&gt;''Prologue: Child of Promise''\n\nBreak the siege and protect the castle.\n\n&lt;&lt;if $storystage is 1&gt;&gt;Locate Ripley.&lt;&lt;elseif $storystage is 2&gt;&gt;Regroup with Irelith and the king.&lt;&lt;elseif $storystage is 3&gt;&gt;Protect the king.&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="1ripqWindow" tags="dock" created="201708232057" modifier="twee">Ripley had a great view of the village from here; it's not such a nice view anymore.  There are some burned out homes and buildings down there, and more gravestones than before.  But the sun is still shinging, and the villagers are still out--working, walking, living.</div><div tiddler="helpdecisions2" tags="help" created="201701242330" modifier="twee">Clicking on information dock links will sometimes make new links available and make old ones change or vanish.  Explore carefully.\n\nAlso, note that not all decisions happen in scenes, and not all decisions are accompanied by an obvious fanfare.\n\nJust remember, there are no right and wrong choices.</div><div tiddler="title_onDodge_VillageHero" tags="hook title" created="201707101751" modifier="twee">&lt;&lt;if $titles.has('Village Hero')&gt;&gt;\n\t&lt;&lt;set _max to $maxgrit&gt;&gt;\n\t&lt;&lt;set _curr to $grit&gt;&gt;\n\t&lt;&lt;if _curr lt _max&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 30&gt;&gt;\n\t\t\t&lt;&lt;set _reg to 30 + ($lvl * 5)&gt;&gt;\n\t\t\t&lt;&lt;set _reg to _reg - _odds&gt;&gt;\n\t\t\t&lt;&lt;set $grit to Math.trunc($grit + _reg)&gt;&gt;\n\t\t\t&lt;&lt;if $grit gte $maxgrit&gt;&gt;\n\t\t\t\t&lt;&lt;set $grit to $maxgrit&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="StorySubtitle" tags="" created="201702091743" modifier="twee" twine-position="430,10">&lt;&lt;print $versionnumber&gt;&gt;</div><div tiddler="ch3journal" tags="" created="201612141429" modifier="twee"></div><div tiddler="checkvariables" tags="script" created="201612151917" modifier="twee" twine-position="150,290">/*! &lt;&lt;checkvars&gt;&gt; macro for SugarCube 2.x */\n!function(){&quot;use strict&quot;;if(&quot;undefined&quot;==typeof version||&quot;undefined&quot;==typeof version.title||&quot;SugarCube&quot;!==version.title||&quot;undefined&quot;==typeof version.major||version.major&lt;2)throw new Error(&quot;&lt;&lt;checkvars&gt;&gt; macro requires SugarCube 2.0 or greater, aborting load&quot;);Macro.add(&quot;checkvars&quot;,{handler:function(){function toString(value,indent){var baseType=typeof value;switch(baseType){case&quot;number&quot;:return isNaN(value)?&quot;NaN&quot;:isFinite(value)?String(value):&quot;Infinity&quot;;case&quot;string&quot;:return JSON.stringify(value);case&quot;function&quot;:return&quot;(function)&quot;;default:if(&quot;object&quot;!==baseType||null==value)return String(value);var objType=Object.prototype.toString.call(value);if(&quot;[object Date]&quot;===objType)return'(object: Date, value: &quot;'+value.toISOString()+'&quot;)';if(&quot;[object RegExp]&quot;===objType)return&quot;(object: RegExp, value: &quot;+value.toString()+&quot;)&quot;;var opener,closer,result=[],indentText=&quot;  &quot;;return indent||(indent=&quot;&quot;),(&quot;[object Set]&quot;===objType||value instanceof Set)&amp;&amp;(value=Array.from(value)),Array.isArray(value)?(opener=&quot;[\sn&quot;,closer=&quot;\sn&quot;+indent+&quot;]&quot;,value.forEach(function(p,i){result.push(indent+indentText+i+&quot; ⇒ &quot;+toString(value[i],indent+indentText))}),Object.keys(value).forEach(function(p){/^\sd+$/.test(p)||result.push(indent+indentText+toString(p)+&quot; ⇒ &quot;+toString(value[p],indent+indentText))})):&quot;[object Map]&quot;===objType||value instanceof Map?(opener=&quot;{\sn&quot;,closer=&quot;\sn&quot;+indent+&quot;}&quot;,Array.from(value).map(function(kv){result.push(indent+indentText+toString(kv[0],indent+indentText)+&quot; ⇒ &quot;+toString(kv[1],indent+indentText))})):(opener=&quot;{\sn&quot;,closer=&quot;\sn&quot;+indent+&quot;}&quot;,Object.keys(value).forEach(function(p){result.push(indent+indentText+toString(p)+&quot; ⇒ &quot;+toString(value[p],indent+indentText))})),opener+result.join(&quot;,\sn&quot;)+closer}}var dialog,sv=State.variables,names=Object.keys(sv);if(dialog=UI.setup(&quot;Story $variables&quot;,&quot;checkvars&quot;),0===names.length)return dialog.innerHTML=&quot;&lt;h1&gt;Story $variables (&lt;code&gt;State.variables&lt;/code&gt;):&lt;/h1&gt;&lt;p&gt;&lt;em&gt;No $variables currently set…&lt;/em&gt;&lt;/p&gt;&quot;,void UI.open();dialog.innerHTML=&quot;&lt;h1&gt;Story $variables (&lt;code&gt;State.variables&lt;/code&gt;):&lt;/h1&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Value&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;+(/applewebkit|chrome/.test(Browser.userAgent)?&quot;&quot;:'&lt;div class=&quot;scroll-pad&quot;&gt;&amp;nbsp;&lt;/div&gt;');var tbody=dialog.querySelector(&quot;tbody&quot;);names.sort(function(a,b){return Util.isNumeric(a)&amp;&amp;Util.isNumeric(b)?Number(a)-Number(b):a.localeCompare(b)});for(var i=0;i&lt;names.length;i++){var tr=document.createElement(&quot;tr&quot;),tdName=document.createElement(&quot;td&quot;),tdValue=document.createElement(&quot;td&quot;);tdName.textContent=&quot;$&quot;+names[i],tdValue.textContent=toString(sv[names[i]]),tr.appendChild(tdName),tr.appendChild(tdValue),tbody.appendChild(tr)}UI.open()}})}();\n</div><div tiddler="expl_ui" tags="" created="201702021721" modifier="twee">Explosion grants a mild increase to attack power and critical attack chance, and a large boost to critical attack damage.\n\n|[img[setup.ui.icons.ui_atk]]|Attack:|[img[setup.ui.icons.ui_up]]|//Slight//|\n|[img[setup.ui.icons.ui_def]]|Defense:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_mov]]|Move:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_crit]]|Criticals:|[img[setup.ui.icons.ui_up]]|//Large//|\n|[img[setup.ui.icons.ui_dodge]]|Dodge:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_disp]]|Dispel:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_grit]]|&lt;&lt;= setup.words.grit.toUpperFirst()&gt;&gt;:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_regen]]|Regen:|[img[setup.ui.icons.ui_same]]|//None//|\n|[img[setup.ui.icons.ui_heal]]|Healing:|[img[setup.ui.icons.ui_same]]|//None//|</div><div tiddler="0bynorth" tags="dock" created="201701110810" modifier="twee">Ripley’s chambers are to the north.\n\n&lt;&lt;ctrlClick &quot;Proceed.&quot; &quot;0choice1&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="bug code example" tags="annotation" created="201701121108" modifier="twee" twine-position="1830,430">main:\n0.4.1c0.1:1011101:02-000-0003-04.Ele.020101010150\n0000000000111111111122222222223333333333444444444\n0123456789012345678901234567890123456789012345678\n\nitems:\n1.1.0.0.0.0.0.0.0.0-1.0.0.0.0-0.1.0.0-0\n000000000011111111112222222222333333333\n012345678901234567890123456789012345678\n\ncomplete code:\n0.4.1c0.1:1011101:02-000-0003-04.Ele.020101010150:1.1.1.0.0.0.0.0.0.0-1.0.0.0.0-0.1.0.0-0:0insidethewall\n\nOLD CSS\n\n#info a {\n\tcolor: #ff82ff;\n\tfont-weight: bold;\n}\n\n.combat #info a {\n\tcolor: 68d;\n\tfont-weight: normal;\n}\n</div><div tiddler="1EleQuarters" tags="space" created="201701281954" modifier="twee">&lt;&lt;thumb&gt;&gt;Elesun's quarters are simple and small.  In the far corner of the room is her &lt;&lt;action 'bed' '1eleqBed'&gt;&gt;.  There's a dresser and a &lt;&lt;dock 'mirror' '1eleqMirror'&gt;&gt; along the wall nearby, and in the room's corner, a &lt;&lt;weak 'closet' '1eleqCloset'&gt;&gt;.\n\n&lt;&lt;message 'About resting.'&gt;&gt;If Elesun can find a place to rest, she'll restore her health fully.  Additionally, resting gives her a chance to earn new ''scars''.\n\nResting may occasionally cause the story to move forward, so it's a good idea to do everything you can before resting.&lt;&lt;/message&gt;&gt;\n\n&lt;span id=&quot;navbox&quot;&gt;&lt;&lt;mapHarlan $now&gt;&gt;&lt;/span&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="spirit_flame_stats" tags="nobr" created="201612132347" modifier="twee">Story event.\n\n&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="0aesTry" tags="dock" created="201701250349" modifier="twee">&quot;Oh my God.&quot;  Ripley's voice is a sharp whisper.  &quot;What's wrong with them?&quot;\n\nThey're melted, for lack of a better turn--it's impossible to tell anymore where one starts and another begins.  A mass of flesh and skin and blood and bone and organs, all spilled on the floor, all unmade.\n\nElesun can't look away from it.  She can hear Ripley gasping and retching and gagging.\n\nIt's a mess.  Some of them are still alive, dying slowly, writhing with what little strength they have and crying and moaning and pleading.  And every time they move, something somewhere in the pile snaps or tears or--\n\n&lt;&lt;timed 2s t8n&gt;&gt;&lt;span id=&quot;ctrlClick&quot;&gt;&lt;&lt;link &quot;...Someone else is here.&quot;&gt;&gt;&lt;&lt;append &quot;#gone&quot;&gt;&gt;&lt;&lt;display &quot;0aesHere&quot;&gt;&gt;&lt;&lt;/append&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;/span&gt;&lt;&lt;/timed&gt;&gt;\n\n</div><div tiddler="codex_Akatosh" tags="menu" created="201701261839" modifier="twee">&lt;&lt;image &quot;AkaPt_grin&quot;&gt;&gt;&lt;&lt;set $gamestart to 2&gt;&gt;''Akatosh''\n\nAkatosh, sometimes called the Demon, arrives in the world every few centuries to destroy an apocolyptic number of people.  Though his motives and origin are unlcear, his nature is better understood.\n\nAkatosh indwells the body of a living human; gender, race, and age seem to mean little to him.  He then sets about gathering an army to himself, and uses his considerable power to bring war and death to the world.\n\nThe Child of Promise is born sometime after his arrival, and destined to face him.  The Child of Promise is as often successful as not.\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="codex_menu" tags="menu" created="201612141348" modifier="twee">&lt;&lt;if !$demomode&gt;&gt;!The Codex\n\n[[Characters|codex_characters]]\n[[People|codex_menu_people]]\n[[Places|codex_menu_places]]\n[[History|codex_menu_history]]\n[[Creatures|codex_menu_creatures]]\n[[Magic|codex_menu_magic]]\n\n\n[[Return to Journal|journalmenu]]\n\n&lt;span id=&quot;return&quot;&gt;[[Return to Game|$return][$gamestart to 1]]&lt;/span&gt;\n\n''Note:'' The Codex is not yet complete as of this prototype.&lt;&lt;else&gt;&gt;The Codex is not available in this demo.&lt;&lt;endif&gt;&gt;</div><div tiddler="tut_onTransfrom" tags="hook tutorial" created="201707101338" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\s\n&lt;&lt;name&gt;&gt; has the ability to transform.  You can trigger her transformation when her rage is over 100% by clicking the appropriate link, or by pressing space.\n\nIn her transformed state, &lt;&lt;name&gt;&gt; has dramatically increased power, but she can no longer score critical hits, dodge, dispel, or perform desperation attacks.  While she remains transformed, her rage will drop every round.  When it reaches 0%, she will revert to her base form.\n\n&lt;&lt;name&gt;&gt; can gain up to 200% rage.  Having more rage when she transforms will make the transformation more powerful and longer-lasting.  After combat ends, &lt;&lt;name&gt;&gt; will revert to her normal form, regardless of remaining rage.  Rage levels decrease when out of combat.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onTransfrom'&gt;&gt;</div><div tiddler="spl_comUI" tags="dock" created="201702020320" modifier="twee">&lt;center&gt;&lt;&lt;display $spell_ui&gt;&gt;&lt;/center&gt;</div><div tiddler="0kingsPort" tags="dock" created="201701252209" modifier="twee">There are a few paintings on the wall.  There's one of the king himself, and another of his late wife.  There's also a portrait of Harlaus, and next to it a portrait of Ripley.\n\nThe king loved Ripley like a daughter, and had her wear a cloak and circlet similar to his own son's.</div><div tiddler="spell_flameshroud" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Flame Shroud&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Hellish&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Flame Shroud&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;fshr_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to -10&gt;&gt;\n&lt;&lt;set $spellcritdam to 1.0&gt;&gt;\n&lt;&lt;set $spelldodge to 10&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.3&gt;&gt;\n&lt;&lt;set $smov to 1.0&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 10&gt;&gt;\n\n&lt;&lt;if $hellishtraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n&lt;&lt;elseif $hellishtraining is 2&gt;&gt;\n\t&lt;&lt;set $sdef to 1.5&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n&lt;&lt;elseif $hellishtraining is 3&gt;&gt;\n\t&lt;&lt;set $spelldispel to 15&gt;&gt;\n\t&lt;&lt;set $sdef to 1.5&gt;&gt;\n\t&lt;&lt;set $spellcrit to -5&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="tut_onDispel" tags="hook tutorial" created="201707101337" modifier="twee">&lt;&lt;dialog 'Tutorial' 'tut'&gt;&gt;\n&lt;&lt;name&gt;&gt; has dispelled an enemy spell.\n\nCertain enemies can cast spells.  Spells are incredibly dangerous, but &lt;&lt;name&gt;&gt; has a chance to dispel each one, based on her Will and equipment.  Dispelling an enemy spell causes it to have no effect.\s\n&lt;&lt;/dialog&gt;&gt;\n&lt;&lt;tutorialHook 'tut_onDispel'&gt;&gt;</div><div tiddler="0courtyard" tags="space" created="201701070313" modifier="twee">Elesun stands in a courtyard, surrounded by the inner walls of the castle.  She can &lt;&lt;weak &quot;hear&quot; &quot;0cylisten&quot;&gt;&gt; the sounds of battle nearby, but the &lt;&lt;weak &quot;courtyard&quot; &quot;0cyinspect&quot;&gt;&gt; itself remains eerily peaceful.\n\nA &lt;&lt;action &quot;gate&quot; &quot;0cygate&quot;&gt;&gt; on the far side of the courtyard &lt;&lt;if $courtyardgate is 0&gt;&gt;is closed&lt;&lt;else&gt;&gt;hangs open&lt;&lt;endif&gt;&gt;.  A &lt;&lt;action &quot;door&quot; &quot;0cydoor&quot;&gt;&gt; behind her leads inside the walls.\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpdock&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="0aesHere" tags="dock" created="201701250350" modifier="twee">&lt;&lt;timed 500ms&gt;&gt;&lt;&lt;image &quot;AesSm3&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;Elesun senses the movement before he speaks.\n\n&quot;Demonkin,&quot; he hisses.\n\nShe'd know that face anywhere.  \n\n&quot;Aesil.&quot;\n\n&lt;&lt;timed 2s t8n&gt;&gt;&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0aesil2&quot;&gt;&gt;&lt;&lt;/timed&gt;&gt;\n\n</div><div tiddler="generic combat call" tags="test" created="201701061911" modifier="twee" twine-position="1550,990">&lt;&lt;if $anchor is 0&gt;&gt;\n\t&lt;&lt;display $args[0]&gt;&gt;\n\t&lt;&lt;anchor&gt;&gt;\n\t&lt;&lt;display $args[1]&gt;&gt;\n\t[[Continue|combat_init]] \n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;snchorkill&gt;&gt;\n\t&lt;&lt;display $args[2]&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n</div><div tiddler="combatexplanation" tags="" created="201701070322" modifier="twee">A fight is about to begin.  &lt;&lt;if $mode is 0&gt;&gt;//We see that you have turned combat off.  If you'd like to try a fight, you can pick one of the links below to turn it on and try a fight.  You'll have the opportunity to turn it off again after the prologue ends.//&lt;&lt;endif&gt;&gt;\n\nTo see a brief explanation of combat, go to the journal and click on help.\n\n&lt;&lt;if $mode is 0&gt;&gt;&lt;&lt;link &quot;Try combat in easy mode.&quot;&gt;&gt;&lt;&lt;set $mode to 2&gt;&gt;&lt;&lt;display &quot;easy-bal-adj&quot;&gt;&gt;&lt;&lt;stats&gt;&gt;&lt;&lt;goto &quot;combat_call_0_1&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;\n[[Try combat in normal mode.|combat_call_0_1][$mode to 1;$modeatk to 1.0]]\n[[Leave combat off.|combat_call_0_1]]&lt;&lt;else&gt;&gt;&lt;span id=&quot;ctrlClick&quot;&gt;[[I'm ready.|combat_call_0_1]]&lt;/span&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="1baileyGate" tags="dock" created="201702121100" modifier="twee">Head to the courtyard?\n\n&lt;&lt;ctrlClick &quot;Proceed.&quot; &quot;1courtyard&quot; &quot;leave&quot;&gt;&gt;</div><div tiddler="volControl" tags="nobr deprecated" created="201704231403" modifier="twee">&lt;&lt;if $vol lte 1&gt;&gt;\n    &lt;&lt;masteraudio volume 0&gt;&gt;\n&lt;&lt;elseif $vol lte 2&gt;&gt;\n    &lt;&lt;masteraudio volume 0.20&gt;&gt;\n&lt;&lt;elseif $vol lte 3&gt;&gt;\n    &lt;&lt;masteraudio volume 0.30&gt;&gt;\n&lt;&lt;elseif $vol lte 4&gt;&gt;\n    &lt;&lt;masteraudio volume 0.40&gt;&gt;\n&lt;&lt;elseif $vol lte 5&gt;&gt;\n    &lt;&lt;masteraudio volume 0.50&gt;&gt;\n&lt;&lt;elseif $vol lte 6&gt;&gt;\n    &lt;&lt;masteraudio volume 0.60&gt;&gt;\n&lt;&lt;elseif $vol lte 7&gt;&gt;\n    &lt;&lt;masteraudio volume 0.70&gt;&gt;\n&lt;&lt;elseif $vol lte 8&gt;&gt;\n    &lt;&lt;masteraudio volume 0.80&gt;&gt;\n&lt;&lt;elseif $vol lte 9&gt;&gt;\n    &lt;&lt;masteraudio volume 0.90&gt;&gt;\n&lt;&lt;elseif $vol lte 10&gt;&gt;\n    &lt;&lt;masteraudio volume 1.00&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $vol lt 10&gt;&gt;\n  &lt;&lt;set $volStr to &quot;0&quot; + $vol&gt;&gt;\n&lt;&lt;else&gt;&gt;\n  &lt;&lt;set $volStr to $vol&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;replace &quot;#vol&quot;&gt;&gt;\s\n  &lt;&lt;print $volStr&gt;&gt;\s\n&lt;&lt;/replace&gt;&gt;</div><div tiddler="ripley15_stats" tags="nobr" created="201612132321" modifier="twee">&lt;&lt;set $allyname to &quot;Ripley&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 3.1&gt;&gt;\n\n&lt;&lt;set $allylvl to 15&gt;&gt;\n&lt;&lt;set $allymaxhealth to 3&gt;&gt;\n&lt;&lt;set $allymaxgrit to 230&gt;&gt;\n&lt;&lt;set $allyatk to 114&gt;&gt;\n&lt;&lt;set $allydef to 100&gt;&gt;\n&lt;&lt;set $allymov to 99&gt;&gt;\n&lt;&lt;set $allymagic to 92&gt;&gt;\n\n&lt;&lt;set $allyspecial to &quot;chain&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Co-op Attack&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 2&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="PassageHeader" tags="" created="201701311602" modifier="twee" twine-position="1270,10">&lt;&lt;if $dockdisp is 2&gt;&gt;&lt;span id=&quot;info3close&quot;&gt;&lt;&lt;button &quot;Close All Links&quot;&gt;&gt;&lt;&lt;script&gt;&gt;state.display(state.active.title, null, &quot;back&quot;)&lt;&lt;/script&gt;&gt;&lt;&lt;/button&gt;&gt;\n\n&lt;/span&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;set $now to passage()&gt;&gt;\s\n&lt;&lt;if tags().includes(&quot;char&quot;) and $characterHide is 1&gt;&gt;&lt;&lt;goto &quot;NoCharacter&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;\s</div><div tiddler="Explosion" tags="menu" created="201612131736" modifier="twee">&lt;&lt;display &quot;expl_ui&quot;&gt;&gt;\nEquip this &lt;&lt;= setup.words.spell&gt;&gt;?\n\n[[Yes|changespell][$change to &quot;expl&quot;]]\n[[No|spellswap]]</div><div tiddler="1sq1" tags="" created="201701282010" modifier="twee"></div><div tiddler="1eleqCloset" tags="dock" created="201708281401" modifier="twee">The closet is small, but has just enough room to house Elesun's clothes; a handful of nice dresses are pushed off to the right, and the rest of the closet is full of traveling clothes and other garments more suited to her day job.  Her eyes stop as they scan across the closet, hanging for a moment on a violet dress she hasn't worn in almost two years now.  She reaches out and touches the soft fabric gently.  Maybe she'll get a chance to wear it again soon.\n\nElesun shuts the door to the closet.</div><div tiddler="1IreNVM" tags="dock" created="201702121041" modifier="twee">&quot;I'll be around if you need me,&quot; Irelith says.\n\n&lt;&lt;set $need to '&quot;See you around.&quot;'&gt;&gt;&lt;&lt;ctrlClick $need &quot;1bailey&quot;&gt;&gt;</div><div tiddler="0kingsWall" tags="dock" created="201701252209" modifier="twee">The witch's spell softened the stone, causing Elesun to sink right through it.  She probably placed a charm on the door and set herself up here to catch intruders.  The second Elesun touched it, the spell triggered.\n\n&quot;How did you know about the spell?&quot; Elesun asks.\n\n&quot;I could feel it,&quot; Ripley replied.\n\n&quot;How?&quot;\n\n&quot;Do you think I don't wear shoes because I love to hurt my feet?&quot;\n\nElesun laughs.  &quot;Of course not.&quot;\n\n</div><div tiddler="newgame" tags="menu" created="201612122040" modifier="twee" twine-position="1830,10">\n\n\n\n\n\n\nYour autosave will be overwritten.\n\nStart a new game?\n\n&lt;&lt;if $webversion is 1&gt;&gt;[[Yes|newgame2]]&lt;&lt;else&gt;&gt;[[Yes|newgame3]]&lt;&lt;endif&gt;&gt;\n\n[[No|main menu]]</div><div tiddler="helpequip" tags="help" created="201701070319" modifier="twee">You found a new weapon.  You can change Elesun's equipment from the equipment menu on the left, or by pressing E on the keyboard.  She has three pieces of equipment: a weapon, a suit of armor, and a bound spell.  Changing equipment provides various bonuses and penalties to Elesun's stats.  You can use the keys W (for weapons), A (for armor), and S (for spells) to bring up the appropriate menus quickly.</div><div tiddler="0insidethewall" tags="space" created="201701070316" modifier="twee">Elesun steps through the door, and finds herself inside the wall, in a &lt;&lt;weak &quot;torch-lit&quot; &quot;0iwinspect&quot;&gt;&gt; hallway.  &lt;&lt;if $gswordhave is 0&gt;&gt;There's a &lt;&lt;action &quot;great sword&quot; &quot;0iwgreatsword1&quot;&gt;&gt; resting against the wall, but no sign of its owner.&lt;&lt;endif&gt;&gt;\n\nOn the far side of the room is a &lt;&lt;if $courtyardgate is 0&gt;&gt;&lt;&lt;action &quot;lever&quot; &quot;0iwlever1&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;dock &quot;lever&quot; &quot;0iwlever3&quot;&gt;&gt;&lt;&lt;endif&gt;&gt;.\n\nBehind her is the &lt;&lt;action &quot;door&quot; &quot;0iwdoor&quot;&gt;&gt; to the courtyard.\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="combat_outro_1_2" tags="comcall" created="201708282117" modifier="twee">The assasin falls.&lt;&lt;masteraudio stop&gt;&gt;\n\nElesun sheathes her sword and trots to Merac's gates.\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|ch1-5][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="1druidcamp" tags="space" created="201701281956" modifier="twee">The &lt;&lt;dock 'grove' '1dcGrove'&gt;&gt; is eerily quiet.\n\n&lt;&lt;dock 'The guards' '1dcGuards'&gt;&gt; are searching the nearby tents and huts for &lt;&lt;weak 'survivors' '1dcSurvivors'&gt;&gt;.\n\n&lt;&lt;action 'The remaining horse' '1dcHorse'&gt;&gt; is tied to a tree not far away.\n\n&lt;&lt;info&gt;&gt;</div><div tiddler="0backtothrone" tags="scene save" created="201701260100" modifier="twee">&lt;&lt;set $song to -2&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;expressions-of-the-mind&quot; loop play&gt;&gt;&lt;&lt;set $xpearned to $xpearned+75&gt;&gt;&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;image &quot;KingSm&quot;&gt;&gt;Elesun heads back into the throne room.&lt;&lt;set $comfortRip to 0&gt;&gt;\n\n&lt;&lt;journallink &quot;Irelith&quot; &quot;codex_Irelith&quot;&gt;&gt; is unconscious, propped up against the wall.  Her abdomen is wrapped in a bandage, and her breathing is even.\n\n&lt;&lt;journallink &quot;The king&quot; &quot;codex_King&quot;&gt;&gt; is sitting on his throne.\n\n&lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; doesn't see &lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; anywhere.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0throneroom&quot;&gt;&gt;</div><div tiddler="tallyxp" tags="menu" created="201612131837" modifier="twee">&lt;&lt;set $gamestart to 0&gt;&gt;You gained &lt;&lt;print $xpearned&gt;&gt; experience points.\n&lt;&lt;if $lvl lt setup.lvlcap&gt;&gt;&lt;&lt;if $xpearned gte setup.xpreq-$xp&gt;&gt;\nYou leveled up!\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|levelup]]&lt;/span&gt;\n\t&lt;&lt;set $xptemp to $xpearned-(setup.xpreq-$xp)&gt;&gt;\n\t&lt;&lt;set $xp to $xptemp&gt;&gt;\n&lt;&lt;else&gt;&gt;\n\t&lt;&lt;set $xp to $xp+$xpearned&gt;&gt;\nYou need &lt;&lt;print setup.xpreq-$xp&gt;&gt; experience points to reach the next level.\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|$exitpassage]]&lt;/span&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;else&gt;&gt;You have already reached the level cap of &lt;&lt;print setup.lvlcap&gt;&gt;.\n\n&lt;span id=&quot;ctrlClick&quot;&gt;[[Continue|$exitpassage]]&lt;/span&gt;&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;set $xpearned to 0&gt;&gt;</div><div tiddler="spell_ghost" tags="nobr" created="201612131655" modifier="twee">&lt;&lt;set $spellname to &quot;Ghost&quot;&gt;&gt;\n&lt;&lt;set $schoolname to &quot;Dark&quot;&gt;&gt;\n&lt;&lt;set $p_spellname to &quot;Ghost&quot;&gt;&gt;\n&lt;&lt;set $spell_ui to &quot;ghst_ui&quot;&gt;&gt;\n\n&lt;&lt;set $spellcrit to 15&gt;&gt;\n&lt;&lt;set $spellcritdam to 0.5&gt;&gt;\n&lt;&lt;set $spelldodge to 10&gt;&gt;\n&lt;&lt;set $spellgrit to 0&gt;&gt;\n\n&lt;&lt;set $satk to 1.0&gt;&gt;\n&lt;&lt;set $sdef to 1.0&gt;&gt;\n&lt;&lt;set $smov to 1.1&gt;&gt;\n\n&lt;&lt;set $spellregen to 0&gt;&gt;\n&lt;&lt;set $spellhealing to 0&gt;&gt;\n&lt;&lt;set $spelldispel to 10&gt;&gt;\n\n&lt;&lt;if $darktraining is 1&gt;&gt;\n\t&lt;&lt;set $spellcritdam to 0.6&gt;&gt;\n&lt;&lt;elseif $darktraining is 2&gt;&gt;\n\t&lt;&lt;set $spellcritdam to 0.7&gt;&gt;\n&lt;&lt;elseif $darktraining is 3&gt;&gt;\n\t&lt;&lt;set $spellcritdam to 0.8&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="debug_trainingdummy" tags="test" created="201612132315" modifier="twee">&lt;span id=&quot;trainingdummy&quot;&gt;Current TP: &lt;&lt;print $tp&gt;&gt;&lt;/span&gt;\n[[Combat training|combat_trainer]]\n[[Magic training|magic_trainer]]\n[[Armorer|armorsmith]]\n&lt;&lt;click &quot;Give TP&quot;&gt;&gt;&lt;&lt;set $tp++&gt;&gt;&lt;&lt;replace &quot;#trainingdummy&quot;&gt;&gt;Current TP: &lt;&lt;print $tp&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/click&gt;&gt;</div><div tiddler="prol1" tags="scene save" created="201701070312" modifier="twee">&lt;&lt;image &quot;IreSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;//The following scenes are accompanied by a tutorial to help you learn the basics of the game.  Click on the links labeled &quot;help&quot; to see various information and explanations.//\n\n&lt;&lt;set $storystage to 1&gt;&gt;&quot;Elesun!&quot;  Irelith is standing up on the wall above.  &quot;Where's &lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt;?&quot;\n\n&quot;I thought she was with you,&quot; &lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; calls.\n\n&quot;Damn it.  I got separated from the king.  Find Ripley and regroup with us.&quot;\n\n&quot;All right, be careful.&quot;\n\n&lt;&lt;journallink &quot;Irelith&quot; &quot;codex_Irelith&quot;&gt;&gt; just smiles her fakest smile and runs off.\n\nElesun is standing in the courtyard.  She can hear the sounds of battle all around.  The air is full of the sounds of sharp metal clashing into steel and paring flesh.  Shouts and screams.  War cries.  She smells smoke and the salt-metal scent of blood.\n\nShe takes off toward the northern side of the castle, where Ripley's quarters are.\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpjournal&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;ctrlClick &quot;Continue&quot; &quot;0courtyard&quot;&gt;&gt;\n&lt;&lt;notifyJournal&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="prol2" tags="save" created="201701070315" modifier="twee">&lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; steps through the gate.  The sounds of battle are growing louder.\n\nA man runs toward her, sword drawn.  He's bloody, but it's not his own.  He smells of death.\n\nHe raises his sword, and with a yell, charges.  Elesun doesn't bother to draw; she sees his attack coming and dodges it easily.\n\nThe soldier steps back and raises his blade again.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;combatexplanation&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="prol3" tags="save" created="201701070325" modifier="twee">//The game autosaves after every handful of scenes.//\n\n&lt;&lt;message&gt;&gt;&lt;&lt;display &quot;helpautosaves&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;message &quot;Help: Game Flow&quot;&gt;&gt;&lt;&lt;display &quot;helpgameflow&quot;&gt;&gt;&lt;&lt;/message&gt;&gt;\n\n&lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; steps out into the bailey.\n\nShe can hear screams and shouts.  The battle isn’t going well in the south.\n\nFortunately, &lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt;’s chambers are to the north.\n&lt;&lt;set $ripFight to 0&gt;&gt;\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0bailey&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="prol4" tags="save" created="201701110821" modifier="twee">&lt;&lt;set $gamestart to 1&gt;&gt;&lt;&lt;set $helpServants to 0&gt;&gt;&lt;&lt;set $choice2 to 0&gt;&gt;&lt;&lt;set $song to -1&gt;&gt;&lt;&lt;if visited() is 1&gt;&gt;&lt;&lt;masteraudio stop&gt;&gt;&lt;&lt;audio &quot;herat7&quot; loop play&gt;&gt;&lt;&lt;endif&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; takes Elesun by the hand and leads her through the antechamber to a door, and the two go through it and out onto the wall.  When they step out, Ripley can see the village burning down below, firelight staining the gray-dusk sky.\n\n&quot;Oh no,&quot; she says, stepping to the edge.  &quot;Oh no.&quot;\n\n&lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; puts her hand on Ripley’s shoulder.  Ripley stands there quietly, taking it in.  In the silence, Elesun begins to hear the screams rising in the distance, just barely audible over Ripley’s staggered breathing and her own soft heartbeat.\n\n&quot;We've got to go,&quot; Elesun says.  She pulls Ripley's shoulder gently.  Ripley doesn’t move.\n\nElesun steps to her side.  She's not crying, but her eyes are wide.\n\n&quot;We've got to go, girl.&quot;\n\nRipley looks Elesun dead in the eyes.  She’s standing up as straight as she can--shoulders squared, chin up--and forcing her face to be neutral and her eyes to stay dry.  The way she looks chills Elesun to the bone.\n\n&quot;Lead the way,&quot; she says.\n\n&lt;&lt;ctrlClick &quot;Lead the way.&quot; &quot;0wall&quot;&gt;&gt;\n\n\n\n\n\n\n</div><div tiddler="prol5" tags="save" created="201701140721" modifier="twee">&lt;&lt;set $process to 0&gt;&gt;&lt;&lt;set $gamestart to 1&gt;&gt;&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;\n\nFinally, &lt;&lt;journallink &quot;Elesun&quot; &quot;codex_Elesun&quot;&gt;&gt; and &lt;&lt;journallink &quot;Ripley&quot; &quot;codex_Ripley&quot;&gt;&gt; find themselves in the main hall.  The throne room is just ahead.\n\n&quot;I don't hear anything,&quot; Ripley says.\n\n&quot;Stay focused.&quot;\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0mainhall1&quot;&gt;&gt;\n&lt;&lt;notifyJournal&gt;&gt;</div><div tiddler="prol6" tags="save" created="201701140728" modifier="twee">&lt;&lt;image &quot;KingSm&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;How is she?&quot; the king asks.\n\n&quot;Awful.&quot;\n\n&quot;I see.&quot;\n\n&quot;A lot of people died.  I bet she knew every one of their names.&quot;\n\n&quot;She's always made friends easily,&quot; the king says.\n\n&quot;You put her through this.  You put everyone through this.&quot;\n\n&quot;And there it is.  Anyone else and I'd swear it was treachery.  You're fortunate I know how loyal you are.&quot;\n\n&quot;You don't have anything else to say?&quot; Elesun asks.\n\n&quot;No.  I don't have to explain myself to you.&quot;\n\n&quot;No, you don't.  But do it anyway.  Was all this just so you could be near her again?&quot;\n\n&quot;If I miss my child,&quot; the king says, &quot;I'll go and see her.&quot;\n\nElesun falls silent.\n\nThe king stands and takes off his crown and holds it out toward Elesun.  &quot;This crown bears the weight of death.  Every time I move, look, speak, do, remain still--thousands die.&quot;  He puts it back on his head.  &quot;I live with the weight, and neither you nor Ripley will ever strip it from me.  Do what you can to protect those who break beneath me when I move, and leave the weight to me.&quot;\n\n&lt;&lt;ctrlClick &quot;Elesun bows and takes her leave.&quot; &quot;toch1&quot;&gt;&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</div><div tiddler="ultimateDespAudio" tags="nobr" created="201707262131" modifier="twee">&lt;&lt;set _despSel to either(1, 2, 3)&gt;&gt;\n&lt;&lt;switch _despSel&gt;&gt;\n&lt;&lt;case 1&gt;&gt;\n\t&lt;&lt;audio 'rage' play&gt;&gt;\n&lt;&lt;case 2&gt;&gt;\n\t&lt;&lt;audio 'rage6' play&gt;&gt;\n&lt;&lt;case 3&gt;&gt;\n\t&lt;&lt;audio 'rage7' play&gt;&gt;\n&lt;&lt;default&gt;&gt;\n\t&lt;&lt;audio 'rage6' play&gt;&gt;\n&lt;&lt;/switch&gt;&gt;</div><div tiddler="armorswap" tags="menu char" created="201612131459" modifier="twee">Current Armor: &lt;&lt;print $armorname&gt;&gt;\n\nSelect a set of armor:\n[[No Armor]]\n&lt;&lt;if $clothhave is 1&gt;&gt;&lt;&lt;if $clothplus is 1&gt;&gt;[[Cloth Armor+|Cloth Armor]]&lt;&lt;else&gt;&gt;[[Cloth Armor]]&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $leatherhave is 1&gt;&gt;&lt;&lt;if $leatherplus is 1&gt;&gt;[[Leather Armor+|Leather Armor]]&lt;&lt;else&gt;&gt;[[Leather Armor]]&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $chainhave is 1&gt;&gt;&lt;&lt;if $chainplus is 1&gt;&gt;[[Chain Armor+|Chain Armor]]&lt;&lt;else&gt;&gt;[[Chain Armor]]&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n&lt;&lt;if $platehave is 1&gt;&gt;&lt;&lt;if $plateplus is 1&gt;&gt;[[Plate Armor+|Plate Armor]]&lt;&lt;else&gt;&gt;[[Plate Armor]]&lt;&lt;endif&gt;&gt;&lt;&lt;endif&gt;&gt;\n\n[[Back|equipmenu]]\n\n&lt;span id =&quot;return&quot;&gt;[[Return to game.|$return][$gamestart to 1]]&lt;/span&gt;</div><div tiddler="titles_onCrit_VampireTouched" tags="hook title" created="201707101741" modifier="twee">&lt;&lt;if $titles.has('Vampire Touched')&gt;&gt;\n\t&lt;&lt;if $health lt $maxhealth&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 30&gt;&gt;\n\t\t\t&lt;&lt;set $health++&gt;&gt;\n\t\t\t&lt;&lt;if $health gte $maxhealth&gt;&gt;\n\t\t\t\t&lt;&lt;set $health to $maxhealth&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="StoryCaption" tags="" created="201702100448" modifier="twee" twine-position="1130,10">&lt;span id=&quot;mutebutton&quot;&gt;&lt;&lt;display &quot;audiomute&quot;&gt;&gt;&lt;/span&gt;\n&lt;span id=&quot;fscreenbutton&quot;&gt;&lt;&lt;display &quot;fullscreen_toggler&quot;&gt;&gt;&lt;/span&gt;</div><div tiddler="changearmor" tags="menu" created="201612131637" modifier="twee">&lt;&lt;audio &quot;equip&quot; play&gt;&gt;Equipment changed!\n\n[[Okay.|equipmenu]]\n\n&lt;&lt;if $change eq &quot;cloth&quot;&gt;&gt;\n\t&lt;&lt;display &quot;clotharmor&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;leath&quot;&gt;&gt;\n\t&lt;&lt;display &quot;leatherarmor&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;chain&quot;&gt;&gt;\n\t&lt;&lt;display &quot;chainarmor&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;plate&quot;&gt;&gt;\n\t&lt;&lt;display &quot;platearmor&quot;&gt;&gt;\n&lt;&lt;elseif $change eq &quot;no&quot;&gt;&gt;\n\t&lt;&lt;display &quot;noarmor&quot;&gt;&gt;\n&lt;&lt;endif&gt;&gt;\n&lt;&lt;stats&gt;&gt;</div><div tiddler="0choice2thoughtful" tags="scene" created="201701242354" modifier="twee">&lt;&lt;image &quot;RipSmKid&quot;&gt;&gt;&lt;&lt;thumb&gt;&gt;&quot;Listen to me,&quot; Elesun says, resting a hand on Ripley's shoulder.  &quot;We're going to make it through this, and we're going to find a way to make this right.&quot;\n\n&quot;We can't make it right, not this much wrong,&quot; Ripley says.  Her voice sounds flat, dead.  &quot;We can't.&quot;\n\n&quot;I need you to be strong.&quot;\n\n&quot;I'm trying,&quot; Ripley whispers.\n\n&quot;I know.  And it's not fair for me to ask for more.  But we need to keep going.&quot;\n\nRipley dries her eyes and Elesun helps her to her feet.\n\n&lt;&lt;ctrlClick &quot;Continue.&quot; &quot;0wall3&quot;&gt;&gt;</div><div tiddler="sidesword" tags="nobr" created="201612131446" modifier="twee">&lt;&lt;set $weaponname to &quot;Side Sword&quot;&gt;&gt;\n&lt;&lt;set $weapon_ui to &quot;sswd_ui&quot;&gt;&gt;\n\n&lt;&lt;set $watk to 0.8&gt;&gt;\n&lt;&lt;set $wdef to 0.9&gt;&gt;\n&lt;&lt;set $wmov to 1.5&gt;&gt;\n&lt;&lt;set $critrange to 90&gt;&gt;\n\n&lt;&lt;set $wStaUse to 3&gt;&gt;\n\n&lt;&lt;if $sideswordtraining is 1&gt;&gt;\n\t&lt;&lt;set $watk to 0.9&gt;&gt;\n&lt;&lt;elseif $sideswordtraining is 2&gt;&gt;\n\t&lt;&lt;set $watk to 0.9&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n&lt;&lt;elseif $sideswordtraining is 3&gt;&gt;\n\t&lt;&lt;set $watk to 0.9&gt;&gt;\n\t&lt;&lt;set $wdef to 1.0&gt;&gt;\n\t&lt;&lt;set $critrange to 88&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div><div tiddler="fullscreen_toggler" tags="" created="201701230903" modifier="twee">&lt;&lt;if $webversion is 1&gt;&gt;&lt;&lt;button &quot;Fullscreen mode.&quot;&gt;&gt;&lt;&lt;fullscreen&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;button &quot;Toggle Fullscreen Mode.&quot;&gt;&gt;&lt;&lt;fullscreenNW&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;endif&gt;&gt;</div><div tiddler="lena_stats" tags="nobr" created="201612132343" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="matheld_stats" tags="nobr" created="201612132347" modifier="twee">&lt;&lt;set $allyname to &quot;&quot;&gt;&gt;\n&lt;&lt;set $allynumber to 0&gt;&gt;\n\n&lt;&lt;set $allylvl to 0&gt;&gt;\n&lt;&lt;set $allymaxhealth to 0&gt;&gt;\n&lt;&lt;set $allymaxgrit to 0&gt;&gt;\n&lt;&lt;set $allyatk to 0&gt;&gt;\n&lt;&lt;set $allydef to 0&gt;&gt;\n&lt;&lt;set $allymov to 0&gt;&gt;\n&lt;&lt;set $allymagic to 0&gt;&gt;/%used to cast%/\n\n&lt;&lt;set $allyspecial to &quot;watchback&quot;&gt;&gt;\n&lt;&lt;set $specialname &quot;Watch my back!&quot;&gt;&gt;\n&lt;&lt;set $allyspec to 0&gt;&gt;\n&lt;&lt;set $allyneutral to 0&gt;&gt;\n&lt;&lt;set $allynatural to 0&gt;&gt;\n&lt;&lt;set $allylight to 0&gt;&gt;\n&lt;&lt;set $allydark to 0&gt;&gt;\n&lt;&lt;set $allyhellish to 0&gt;&gt;\n\n&lt;&lt;set $allyAIbase to 0&gt;&gt;\n&lt;&lt;set $allymovest to 0&gt;&gt;</div><div tiddler="0mainhall1lastmo" tags="dock" created="201701252352" modifier="twee">It was crazy, the process of moving a king.  Harlan did provide some tactical benefits for the campaign against Akatosh, and moving here was maybe, on paper--very shitty paper--more sensible than moving Ripley.  Still, Elesun wished then--and still does now--that someone had consulted her beforehand.  This whole thing was avoidable.</div><div tiddler="1FolsomNVM" tags="dock" created="201707110118" modifier="twee">Stay safe, Elesun.\n\n&lt;&lt;ctrlClick '&quot;You too.&quot;' '1mainhall'&gt;&gt;</div><div tiddler="diff_expl" tags="dock" created="201702190809" modifier="twee">Normal Mode is recommended for most players.\n\nIn Easy Mode, &lt;&lt;name&gt;&gt;'s attacks deal more damage and enemy attacks deal less compared to Normal Mode.  Additionally:\n*Enemy spell damage is severely reduced.\n*Enemy grit is reduced.\n*&lt;&lt;name&gt;&gt;'s grit is increased.\n*Desperation attack damage is dramatically increased.\n*Enemies are less agressive.\n\nIn Intense Mode, &lt;&lt;name&gt;&gt; gains a few bonuses, including some additional gear, a large amount of training points to spend, and increased experience rewards, but combat is faster-paced and more deadly:\n*&lt;&lt;name&gt;&gt; and her opponents both have less grit.\n*Critical hits are more frequent for all combatants, but their damage is reduced.\n*Desperation attacks deal far less damage than normal.\n*Some secret mechanic you'll unlock later is less effective and harder to use.\n*Enemies hit harder and are more agressive.\n\nWith combat turned off, &lt;&lt;name&gt;&gt; automatically wins most fights, though some fights with important consequences will be simulated based on your character's stats and loadout.  Regardless, &lt;&lt;name&gt;&gt; cannot die in this mode.</div><div tiddler="ShowImage" tags="" created="201701050454" modifier="twee" twine-position="570,850">&lt;span id=&quot;subj&quot;&gt;[img[$subj]]&lt;/span&gt;/%top%/</div><div tiddler="helpsidequests" tags="help" created="201701281951" modifier="twee">blah</div><div tiddler="combat_report" tags="" created="201612160717" modifier="twee">&lt;&lt;if $playerturn is 1&gt;&gt;Nothing to report.&lt;&lt;elseif $playerturn is 2&gt;&gt;''&lt;&lt;print $enemyreport&gt;&gt;''&lt;&lt;endif&gt;&gt;</div><div tiddler="title_onDispel_TreasureHunter" tags="hook title" created="201707101758" modifier="twee">&lt;&lt;if $titles.has('Treasure Hunter')&gt;&gt;\n\t&lt;&lt;if $health lt $maxhealth&gt;&gt;\n\t\t&lt;&lt;set _odds to random(1, 100)&gt;&gt;\n\t\t&lt;&lt;if _odds lt 25&gt;&gt;\n\t\t\t&lt;&lt;set $health++&gt;&gt;\n\t\t\t&lt;&lt;if $health gte $maxhealth&gt;&gt;\n\t\t\t\t&lt;&lt;set $health to $maxhealth&gt;&gt;\n\t\t\t&lt;&lt;endif&gt;&gt;\n\t\t&lt;&lt;endif&gt;&gt;\n\t&lt;&lt;endif&gt;&gt;\n&lt;&lt;endif&gt;&gt;</div></div>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){!function(window,document,jQuery,undefined){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_slicedToArray=function(){function e(e,t){var r=[],a=!0,n=!1,i=undefined;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?error:\s+)+/i,Alert=function(){function e(e,t,r,a){var n="fatal"===e,i="Apologies! "+(n?"A fatal":"An")+" error has occurred.";i+=n?" Aborting.":" You may be able to continue, but some parts may not work properly.",null==t&&null==r||(i+="\n\nError",null!=t&&(i+=" ["+t+"]"),i+=null!=r?": "+r.replace(errorPrologRegExp,"")+".":": unknown error."),"object"===(void 0===a?"undefined":_typeof(a))&&a.stack&&(i+="\n\nStack Trace:\n"+a.stack),window.alert(i)}function t(t,r,a){e(null,t,r,a)}function r(t,r,a){e("fatal",t,r,a)}return function(e){window.onerror=function(a,n,i,o,s){"complete"===document.readyState?t(null,a,s):(r(null,a,s),window.onerror=e,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))}}(window.onerror),Object.freeze(Object.defineProperties({},{error:{value:t},fatal:{value:r}}))}(),Patterns=function(){var e=function(){var e=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),t=/\s/,r="";return e.forEach(function(e,a){t.test(a)||(r+=e)}),r?"[\\s"+r+"]":"\\s"}(),t="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",r=t.replace("\\-",""),a="("+t+"+)\\(([^\\)\\|\\n]+)\\):",n="("+t+"+):([^;\\|\\n]+);",i="((?:\\."+t+"+)+);",o="((?:#"+t+"+)+);",s=a+"|"+n+"|"+i+"|"+o;return Object.freeze({space:e,spaceNoTerminator:"[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",lineTerminator:"[\\n\\r\\u2028\\u2029]",anyLetter:t,anyLetterStrict:r,identifierFirstChar:"[$A-Z_a-z]",identifier:"[$A-Z_a-z][$0-9A-Z_a-z]*",variableSigil:"[$_]",variable:"[$_][$A-Z_a-z][$0-9A-Z_a-z]*",macroName:"[A-Za-z][\\w-]*|[=-]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:s,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})}();!function(){function e(e,t){var n=String(e);switch(t){case"start":return n&&r.test(n)?n.replace(r,""):n;case"end":return n&&a.test(n)?n.replace(a,""):n;default:throw new Error('_trimFrom called with incorrect where parameter value: "'+t+'"')}}function t(e,t){var r=Number.parseInt(e,10)||0;if(r<1)return"";var a=void 0===t?"":String(t);for(""===a&&(a=" ");a.length<r;){var n=a.length,i=r-n;a+=n>i?a.slice(0,i):a}return a.length>r&&(a=a.slice(0,r)),a}var r=/^[\s\u00A0\uFEFF][\s\u00A0\uFEFF]*/,a=/[\s\u00A0\uFEFF][\s\u00A0\uFEFF]*$/;Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var e=this.length>>>0;if(0===e)return!1;var t=arguments[0],r=Number(arguments[1])||0;for(r<0&&(r=Math.max(0,e+r));r<e;++r){var a=this[r];if(t===a||t!==t&&a!==a)return!0}return!1}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(e,r){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var a=String(this),n=a.length,i=Number.parseInt(e,10);return i<=n?a:t(i-n,r)+a}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(e,r){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var a=String(this),n=a.length,i=Number.parseInt(e,10);return i<=n?a:a+t(i-n,r)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return e(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return e(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return e(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return e(this,"end")}})}(),function(){function _random(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:e=0,t=arguments[0];break;default:e=arguments[0],t=arguments[1]}if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.floor(_nativeMathRandom()*(t-e+1))+e}function _randomIndex(e,t){var r=void 0,a=void 0;switch(t.length){case 1:r=0,a=e-1;break;case 2:r=0,a=Math.trunc(t[1]);break;default:r=Math.trunc(t[1]),a=Math.trunc(t[2])}return Number.isNaN(r)?r=0:!Number.isFinite(r)||r>=e?r=e-1:r<0&&(r=e+r)<0&&(r=0),Number.isNaN(a)?a=0:!Number.isFinite(a)||a>=e?a=e-1:a<0&&(a=e+a)<0&&(a=e-1),_random(r,a)}function _getCodePointStartAndEnd(e,t){var r=e.charCodeAt(t);if(Number.isNaN(r))return{char:"",start:-1,end:-1};if(r<55296||r>57343)return{char:e.charAt(t),start:t,end:t};if(r>=55296&&r<=56319){var a=t+1;if(a>=e.length)throw new Error("high surrogate without trailing low surrogate");var n=e.charCodeAt(a);if(n<56320||n>57343)throw new Error("high surrogate without trailing low surrogate");return{char:e.charAt(t)+e.charAt(a),start:t,end:a}}if(0===t)throw new Error("low surrogate without leading high surrogate");var i=t-1,o=e.charCodeAt(i);if(o<55296||o>56319)throw new Error("low surrogate without leading high surrogate");return{char:e.charAt(i)+e.charAt(t),start:i,end:t}}var _nativeMathRandom=Math.random;Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(e){if(null==e||"object"!==(void 0===e?"undefined":_typeof(e))||!Object.prototype.hasOwnProperty.call(e,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var t=e.length>>>0;if(0!==t){return e[0===arguments.length?_random(0,t-1):_randomIndex(t,Array.prototype.slice.call(arguments,1))]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var e=Array.from(this);if(0===arguments.length)return e;var t=Array.prototype.reduce.call(arguments,function(e,t){return e.concat(t)},[]),r=t.length;if(0===r)return e;for(var a=Array.prototype.indexOf,n=Array.prototype.push,i=0;i<r;++i){var o=t[i];-1===a.call(e,o)&&n.call(e,o)}return e}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var e=Array.prototype.indexOf,t=arguments[0],r=Number(arguments[1])||0,a=0;-1!==(r=e.call(this,t,r));)++a,++r;return a}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];if(0==this.length>>>0)return[];for(var e=Array.prototype.indexOf,t=Array.prototype.push,r=Array.prototype.splice,a=Array.prototype.concat.apply([],arguments),n=[],i=0,o=a.length;i<o;++i)for(var s=a[i],u=0;-1!==(u=e.call(this,s,u));)t.apply(n,r.call(this,u,1));return n}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var e=this.length>>>0;if(0===e)return[];for(var t=Array.prototype.splice,r=[].concat(_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map(function(t){return t<0?Math.max(0,e+t):t})).values())),a=[].concat(_toConsumableArray(r)).sort(function(e,t){return t-e}),n=[],i=0,o=r.length;i<o;++i)n[i]=this[r[i]];for(var s=0,u=a.length;s<u;++s)t.call(this,a[s],1);return n}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.reduce.call(this,function(e,t){return e.concat(Array.isArray(t)?t.flatten():t)},[])}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var e=0,t=arguments.length;e<t;++e)if(!Array.prototype.some.call(this,function(e){return e===this.val||e!==e&&this.val!==this.val},{val:arguments[e]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var e=0,t=arguments.length;e<t;++e)if(Array.prototype.some.call(this,function(e){return e===this.val||e!==e&&this.val!==this.val},{val:arguments[e]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var e=this.length>>>0;if(0!==e){var t=0===arguments.length?_random(0,e-1):_randomIndex(e,[].concat(Array.prototype.slice.call(arguments)));return Array.prototype.splice.call(this,t,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var t=this.length>>>0;if(0===t)return[];var r=Math.trunc(e);if(!Number.isInteger(r))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(r<1)return[];r>t&&(r=t);var a=Array.prototype.splice,n=[],i=t-1;do{n.push(a.call(this,_random(0,i--),1)[0])}while(n.length<r);return n}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var e=arguments.length;if(0===e)return this.length>>>0;for(var t=Array.prototype.indexOf,r=Array.prototype.push,a=0;a<e;++a){var n=arguments[a];-1===t.call(this,n)&&r.call(this,n)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var e=this.length>>>0;if(0!==e){return this[0===arguments.length?_random(0,e-1):_randomIndex(e,[].concat(Array.prototype.slice.call(arguments)))]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var t=this.length>>>0;if(0===t)return[];var r=Math.trunc(e);if(!Number.isInteger(r))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(r<1)return[];r>t&&(r=t);var a=new Map,n=[],i=t-1;do{var o=void 0;do{o=_random(0,i)}while(a.has(o));a.set(o,!0),n.push(this[o])}while(n.length<r);return n}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var e=this.length>>>0;if(0===e)return this;for(var t=e-1;t>0;--t){var r=Math.floor(_nativeMathRandom()*(t+1));if(t!==r){var a=this[t];this[t]=this[r],this[r]=a}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var e=arguments.length;if(0===e)return this.length>>>0;for(var t=Array.prototype.indexOf,r=Array.prototype.unshift,a=0;a<e;++a){var n=arguments[a];-1===t.call(this,n)&&r.call(this,n)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var e=Array.prototype.slice,t=this,r=e.call(arguments,0);return function(){for(var a=[],n=0,i=0;i<r.length;++i)a.push(r[i]===undefined?arguments[n++]:r[i]);return t.apply(this,a.concat(e.call(arguments,n)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(e,t,r){var a=Number(e);return Number.isNaN(a)?NaN:a.clamp(t,r)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(e){return 1-(Math.cos(Number(e)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var e=Number(arguments[0]),t=Number(arguments[1]);if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.min(Math.max(this,e),t)}}),RegExp.escape||function(){var e=/[\\^$*+?.()|[\]{}]/g,t=new RegExp(e.source);Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(r){var a=String(r);return a&&t.test(a)?a.replace(e,"\\$&"):a}})}(),function(){var e=/{(\d+)(?:,([+-]?\d+))?}/g,t=new RegExp(e.source);Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(r){function a(e,t,r){if(!t)return e;var a=Math.abs(t)-e.length;if(a<1)return e;var n=String(r).repeat(a);return t<0?e+n:n+e}if(arguments.length<2)return 0===arguments.length?"":r;var n=2===arguments.length&&Array.isArray(arguments[1])?[].concat(_toConsumableArray(arguments[1])):Array.prototype.slice.call(arguments,1);return 0===n.length?r:t.test(r)?(e.lastIndex=0,r.replace(e,function(e,t,r){var i=n[t];if(null==i)return"";for(;"function"==typeof i;)i=i();switch(void 0===i?"undefined":_typeof(i)){case"string":break;case"object":i=JSON.stringify(i);break;default:i=String(i)}return a(i,r?Number.parseInt(r,10):0," ")})):r}})}(),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var e=String(arguments[0]||"");if(""===e)return 0;for(var t=String.prototype.indexOf,r=e.length,a=Number(arguments[1])||0,n=0;-1!==(a=t.call(this,e,a));)++n,a+=r;return n}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(e,t,r){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var a=this.length>>>0;if(0===a)return"";var n=Number(e);Number.isSafeInteger(n)?n<0&&(n+=a)<0&&(n=0):n=0,n>a&&(n=a);var i=Number(t);(!Number.isSafeInteger(i)||i<0)&&(i=0);var o=this.slice(0,n);return void 0!==r&&(o+=r),n+i<a&&(o+=this.slice(n+i)),o}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var e=String(this),t=_getCodePointStartAndEnd(e,0),r=t.char,a=t.end;return-1===a?"":r.toLocaleUpperCase()+e.slice(a+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var e=String(this),t=_getCodePointStartAndEnd(e,0),r=t.char,a=t.end;return-1===a?"":r.toUpperCase()+e.slice(a+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","("+this.toString()+")"]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",[].concat(_toConsumableArray(this))]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",[].concat(_toConsumableArray(this))]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(e,t){if("string"!=typeof e)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[e,t]]}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(e){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(e){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(e){}return value})}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var e=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),t=[],r=void 0;null!==(r=e.exec(this));)r[1]?t.push(r[1]):r[2]&&t.push(r[2]);return t}})}();var Browser=function(){var e=navigator.userAgent.toLowerCase(),t=e.includes("windows phone"),r=Object.freeze({Android:!t&&e.includes("android"),BlackBerry:/blackberry|bb10/.test(e),iOS:!t&&/ip(?:hone|ad|od)/.test(e),Windows:t||e.includes("iemobile"),any:function(){return r.Android||r.BlackBerry||r.iOS||r.Windows}}),a=!r.Windows&&!/khtml|trident|edge/.test(e)&&e.includes("gecko"),n=!e.includes("opera")&&/msie|trident/.test(e),i=n?function(){var t=/(?:msie\s+|rv:)(\d+\.\d)/.exec(e);return t?Number(t[1]):0}():null,o=e.includes("opera")||e.includes(" opr/"),s=o?function(){var t=new RegExp((/khtml|chrome/.test(e)?"opr":"version")+"\\/(\\d+\\.\\d+)"),r=t.exec(e);return r?Number(r[1]):0}():null;return Object.freeze({userAgent:e,isMobile:r,isGecko:a,isIE:n,ieVersion:i,isOpera:o,operaVersion:s})}(),Has=function(){var e=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(e){}return!1}(),t=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&!Browser.isMobile.any()&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(e){}return!1}(),r=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(e){}return!1}(),a=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(e){}return!1}(),n=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(e){}return!1}();return Object.freeze({audio:e,fileAPI:t,geolocation:r,mutationObserver:a,performance:n})}(),_ref3=function(){function e(t){if("object"!==(void 0===t?"undefined":_typeof(t))||null===t)return t;if(t instanceof String)return String(t);if(t instanceof Number)return Number(t);if(t instanceof Boolean)return Boolean(t);if("function"==typeof t.clone)return t.clone(!0);if(t.nodeType&&"function"==typeof t.cloneNode)return t.cloneNode(!0);var r=void 0;return t instanceof Array?r=new Array(t.length):t instanceof Date?r=new Date(t.getTime()):t instanceof Map?(r=new Map,t.forEach(function(t,a){return r.set(a,e(t))})):t instanceof RegExp?r=new RegExp(t):t instanceof Set?(r=new Set,t.forEach(function(t){return r.add(e(t))})):r=Object.create(Object.getPrototypeOf(t)),Object.keys(t).forEach(function(a){return r[a]=e(t[a])}),r}function t(e){for(var t=document.createDocumentFragment(),r=document.createElement("p"),a=void 0;null!==(a=e.firstChild);){if(a.nodeType===Node.ELEMENT_NODE){switch(a.nodeName.toUpperCase()){case"BR":if(null!==a.nextSibling&&a.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===a.nextSibling.nodeName.toUpperCase()){e.removeChild(a.nextSibling),e.removeChild(a),t.appendChild(r),r=document.createElement("p");continue}if(!r.hasChildNodes()){e.removeChild(a);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":r.hasChildNodes()&&(t.appendChild(r),r=document.createElement("p")),t.appendChild(a);continue}}r.appendChild(a)}r.hasChildNodes()&&t.appendChild(r),e.appendChild(t)}function r(){try{return document.activeElement||null}catch(e){return null}}function a(e,t,r){var a="object"===(void 0===e?"undefined":_typeof(e))?e:document.getElementById(e);if(null==a)return null;var n=Array.isArray(t)?t:[t];jQuery(a).empty();for(var i=0,o=n.length;i<o;++i)if(Story.has(n[i]))return new Wikifier(a,Story.get(n[i]).processText().trim()),a;if(null!=r){var s=String(r).trim();""!==s&&new Wikifier(a,s)}return a}function n(e,t,r){var a=jQuery(document.createElement("div")),n=jQuery(document.createElement("button")),i=jQuery(document.createElement("pre")),o=L10n.get("errorTitle")+": "+(t||"unknown error");return n.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},function(){n.hasClass("enabled")?(n.removeClass("enabled"),i.attr({"aria-hidden":!0,hidden:"hidden"})):(n.addClass("enabled"),i.removeAttr("aria-hidden hidden"))}).appendTo(a),jQuery(document.createElement("span")).addClass("error").text(o).appendTo(a),jQuery(document.createElement("code")).text(r).appendTo(i),i.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo(a),a.addClass("error-view").appendTo(e),console.warn(o+"\n\t"+r.replace(/\n/g,"\n\t")),!1}function i(e,t){var r=i;switch(void 0===e?"undefined":_typeof(e)){case"number":if(Number.isNaN(e))return t;break;case"object":if(null===e)return t;if(Array.isArray(e))return e.map(function(e){return r(e,t)}).join(", ");if(e instanceof Set)return[].concat(_toConsumableArray(e)).map(function(e){return r(e,t)}).join(", ");if(e instanceof Map){return"{ "+[].concat(_toConsumableArray(e)).map(function(e){var a=_slicedToArray(e,2),n=a[0],i=a[1];return r(n,t)+" → "+r(i,t)}).join(", ")+" }"}return e instanceof Date?e.toLocaleString():"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);case"function":case"undefined":return t}return String(e)}return Object.freeze(Object.defineProperties({},{clone:{value:e},convertBreaks:{value:t},safeActiveElement:{value:r},setPageElement:{value:a},throwError:{value:n},toStringOrDefault:{value:i}}))}(),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,toStringOrDefault=_ref3.toStringOrDefault;!function(){function e(e){13!==e.which&&32!==e.which||(e.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function t(e){return function(){var t=jQuery(this);t.is("[aria-pressed]")&&t.attr("aria-pressed","true"===t.attr("aria-pressed")?"false":"true"),e.apply(this,arguments)}}function r(e){return t(function(){jQuery(this).off(".aria-clickable").removeAttr("tabindex aria-controls aria-pressed").not("a,button").removeAttr("role").end().filter("button").prop("disabled",!0),e.apply(this,arguments)})}jQuery.fn.extend({ariaClick:function(a,n){if(0===this.length||0===arguments.length)return this;var i=a,o=n;return null==o&&(o=i,i=undefined),i=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,controls:undefined,pressed:undefined,label:undefined},i),"string"!=typeof i.namespace?i.namespace="":"."!==i.namespace[0]&&(i.namespace="."+i.namespace),"boolean"==typeof i.pressed&&(i.pressed=i.pressed?"true":"false"),this.filter("button").prop("type","button"),this.not("a,button").attr("role","button"),this.attr("tabindex",0),null!=i.controls&&this.attr("aria-controls",i.controls),null!=i.pressed&&this.attr("aria-pressed",i.pressed),null!=i.label&&this.attr({"aria-label":i.label,title:i.label}),this.not("button").on("keypress.aria-clickable"+i.namespace,i.selector,e),this.on("click.aria-clickable"+i.namespace,i.selector,i.data,i.one?r(o):t(o)),this}})}(),function(){jQuery.extend({wikiWithOptions:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(0!==r.length){var n=document.createDocumentFragment();r.forEach(function(t){return new Wikifier(n,t,e)});var i=[].concat(_toConsumableArray(n.querySelectorAll(".error"))).map(function(e){return e.textContent.replace(errorPrologRegExp,"")});if(i.length>0)throw new Error(i.join("; "))}},wiki:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.wikiWithOptions.apply(this,[undefined].concat(t))}}),jQuery.fn.extend({wikiWithOptions:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(0===this.length||0===r.length)return this;var n=document.createDocumentFragment();return r.forEach(function(t){return new Wikifier(n,t,e)}),this.append(n),this},wiki:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.wikiWithOptions.apply(this,[undefined].concat(t))}})}();var Util=function(){function e(e){return Object.freeze(Object.assign(Object.create(null),e))}function t(e){return Object.prototype.toString.call(e).slice(8,-1)}function r(e){var t=void 0;switch(void 0===e?"undefined":_typeof(e)){case"number":t=e;break;case"string":t=Number(e);break;default:return!1}return!Number.isNaN(t)&&Number.isFinite(t)}function a(e){return"boolean"==typeof e||"string"==typeof e&&("true"===e||"false"===e)}function n(e){return String(e).trim().replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase()}function i(e){if(null==e)return"";var t=String(e);return t&&p.test(t)?t.replace(f,function(e){return g[e]}):t}function o(e){if(null==e)return"";var t=String(e);return t&&v.test(t)?t.replace(m,function(e){return y[e.toLowerCase()]}):t}function s(e,t){var r=String(e),a=Math.trunc(t),n=r.charCodeAt(a);if(Number.isNaN(n))return{char:"",start:-1,end:-1};var i={char:r.charAt(a),start:a,end:a};if(n<55296||n>57343)return i;if(n>=55296&&n<=56319){var o=a+1;if(o>=r.length)return i;var s=r.charCodeAt(o);return s<56320||s>57343?i:(i.char=i.char+r.charAt(o),i.end=o,i)}if(0===a)return i;var u=a-1,l=r.charCodeAt(u);return l<55296||l>56319?i:(i.char=r.charAt(u)+i.char,i.start=u,i)}function u(){return b.now()}function l(e){var t=w.exec(String(e));if(null===t)throw new SyntaxError('invalid time value syntax: "'+e+'"');var r=Number(t[1]);if(1===t[2].length&&(r*=1e3),Number.isNaN(r)||!Number.isFinite(r))throw new RangeError('invalid time value: "'+e+'"');return r}function c(e){if("number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)){var r=void 0;switch(void 0===e?"undefined":_typeof(e)){case"string":r='"'+e+'"';break;case"number":r=String(e);break;default:r=t(e)}throw new Error("invalid milliseconds: "+r)}return e+"ms"}function d(e){if(!e.includes("-"))switch(e){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return e}return("-ms-"===e.slice(0,4)?e.slice(1):e).split("-").map(function(e,t){return 0===t?e:e.toUpperFirst()}).join("")}function h(e){var t=document.createElement("a"),r=Object.create(null);t.href=e,t.search&&t.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach(function(e){var t=e.split("="),a=_slicedToArray(t,2),n=a[0],i=a[1];r[n]=i});var a=t.host&&"/"!==t.pathname[0]?"/"+t.pathname:t.pathname;return{href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,path:""+a+t.search,pathname:a,query:t.search,search:t.search,queries:r,searches:r,hash:t.hash}}var f=/[&<>"'`]/g,p=new RegExp(f.source),g=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"}),m=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,v=new RegExp(m.source,"i"),y=Object.freeze({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"}),b=Has.performance?performance:Date,w=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;return Object.freeze(Object.defineProperties({},{toEnum:{value:e},toStringTag:{value:t},isNumeric:{value:r},isBoolean:{value:a},slugify:{value:n},escape:{value:i},unescape:{value:o},charAndPosAt:{value:s},fromCssTime:{value:l},toCssTime:{value:c},fromCssProperty:{value:d},parseUrl:{value:h},now:{value:u},random:{value:Math.random},entityEncode:{value:i},entityDecode:{value:o},
evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleAudio=function(){function e(){return g}function t(e){g=!!e,l("mute",g)}function r(){return f}function a(e){f=Math.clamp(e,.2,5),l("rate",f)}function n(){return p}function i(e){p=Math.clamp(e,0,1),l("volume",p)}function o(){l("stop")}function s(e,t){if("function"!=typeof t)throw new Error("callback parameter must be a function");h.set(e,t)}function u(e){h.delete(e)}function l(e,t){h.forEach(function(r){return r(e,t)})}function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(m,[null].concat(t)))}function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(v,[null].concat(t)))}var h=new Map,f=1,p=1,g=!1,m=function(){function e(t){if(_classCallCheck(this,e),Array.isArray(t))this._create(t);else{if(!(t instanceof e))throw new Error("sources parameter must be an array of either URLs or source objects");this._copy(t)}}return _createClass(e,[{key:"_create",value:function(t){if(!Array.isArray(t)||0===t.length)throw new Error("sources parameter must be an array of either URLs or source objects");var r=/^data:\s*audio\/([^;,]+)\s*[;,]/i,a=/\.([^.\/\\]+)$/,n=e.getType,i=[],o=document.createElement("audio");if(t.forEach(function(e){var t=null;switch(void 0===e?"undefined":_typeof(e)){case"string":var s=void 0;if("data:"===e.slice(0,5)){if(null===(s=r.exec(e)))throw new Error("source data URI missing media type")}else if(null===(s=a.exec(Util.parseUrl(e).pathname)))throw new Error("source URL missing file extension");var u=n(s[1]);null!==u&&(t={src:e,type:u});break;case"object":if(null===e)throw new Error("source object cannot be null");if(!e.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!e.hasOwnProperty("format"))throw new Error('source object missing required "format" property');var l=n(e.format);null!==l&&(t={src:e.src,type:l});break;default:throw new Error("invalid source value (type: "+(void 0===e?"undefined":_typeof(e))+")")}if(null!==t){var c=document.createElement("source");c.src=t.src,c.type=Browser.isOpera?t.type.replace(/;.*$/,""):t.type,o.appendChild(c),i.push(t)}}),!o.hasChildNodes())if(Browser.isIE)o.src=undefined;else{var s=document.createElement("source");s.src=undefined,s.type=undefined,o.appendChild(s)}this._finalize(o,i,clone(t))}},{key:"_copy",value:function(t){if(!(t instanceof e))throw new Error("original parameter must be an instance of AudioWrapper");this._finalize(t.audio.cloneNode(!0),clone(t.sources),clone(t.originalSources))}},{key:"_finalize",value:function(e,t,r){var a=this;Object.defineProperties(this,{audio:{configurable:!0,value:e},sources:{configurable:!0,value:Object.freeze(t)},originalSources:{configurable:!0,value:Object.freeze(r)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart",function(){return a._error=!1}).on("error",function(){return a._error=!0}).find("source:last-of-type").on("error",function(){return a._trigger("error")}),SimpleAudio.subscribe(this,function(e){if(!a.audio)return void SimpleAudio.unsubscribe(a);switch(e){case"mute":a._updateAudioMute();break;case"rate":a._updateAudioRate();break;case"stop":a.stop();break;case"volume":a._updateAudioVolume()}}),this.load()}},{key:"_trigger",value:function(e){jQuery(this.audio).triggerHandler(e)}},{key:"clone",value:function(){return new e(this)}},{key:"destroy",value:function(){SimpleAudio.unsubscribe(this);var e=this.audio;if(e){for(this.fadeStop(),this.stop(),jQuery(e).off();e.hasChildNodes();)e.removeChild(e.firstChild);e.load(),this._error=!0,delete this.audio,delete this.sources,delete this.originalSources}}},{key:"_updateAudioMute",value:function(){this.audio&&(this.audio.muted=this._mute||SimpleAudio.mute)}},{key:"_updateAudioRate",value:function(){this.audio&&(this.audio.playbackRate=this._rate*SimpleAudio.rate)}},{key:"_updateAudioVolume",value:function(){this.audio&&(this.audio.volume=this._volume*SimpleAudio.volume)}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return!this.audio||this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return!!this.audio&&this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return!!this.audio&&this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return!!this.audio&&this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return!!this.audio&&this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isPlaying",value:function(){return!!this.audio&&!(this.audio.ended||this.audio.paused||!this.hasSomeData())}},{key:"isPaused",value:function(){return!!this.audio&&(this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended)}},{key:"isEnded",value:function(){return!this.audio||this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isMuted",value:function(){return this._mute}},{key:"isLooped",value:function(){return!!this.audio&&this.audio.loop}},{key:"load",value:function(){this.audio&&("auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load())}},{key:"play",value:function(){this.audio&&this.audio.play()}},{key:"pause",value:function(){this.audio&&this.audio.pause()}},{key:"stop",value:function(){this.audio&&(this.pause(),this.time=0,this._trigger(":stop"))}},{key:"fadeWithDuration",value:function(e,t,r){var a=this;if(this.audio){this.fadeStop();var n=Math.clamp(null==r?this.volume:r,0,1),i=Math.clamp(t,0,1);n!==i&&(this.volume=n,jQuery(this.audio).off("timeupdate.AudioWrapper:fadeWithDuration").one("timeupdate.AudioWrapper:fadeWithDuration",function(){var t=void 0,r=void 0;n<i?(t=n,r=i):(t=i,r=n);var o=Number(e);o<1&&(o=1);var s=(i-n)/(o/.025);a._faderId=setInterval(function(){if(!a.isPlaying())return void a.fadeStop();a.volume=Math.clamp(a.volume+s,t,r),0===a.volume&&a.pause(),a.volume===i&&(a.fadeStop(),a._trigger(":fade"))},25)}),this.play())}}},{key:"fade",value:function(e,t){this.fadeWithDuration(5,e,t)}},{key:"fadeIn",value:function(){this.fade(1)}},{key:"fadeOut",value:function(){this.fade(0)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"on",value:function(t,r){if(this.audio){if("function"!=typeof r)throw new Error("listener parameter must be a function");var a=e._events,n=t.trim().splitOrEmpty(/\s+/).map(function(e){var t=e.split(".",1)[0];if(!a.hasOwnProperty(t))throw new Error('unknown event "'+t+'"; valid: '+Object.keys(a).join(", "));return e.replace(t,a[t])+".AudioWrapperEvent"}).join(" ");if(""===n)throw new Error('invalid eventNames parameter "'+t+'"');return jQuery(this.audio).on(n,r),this}}},{key:"one",value:function(t,r){if(this.audio){if("function"!=typeof r)throw new Error("listener parameter must be a function");var a=e._events,n=t.trim().splitOrEmpty(/\s+/).map(function(e){var t=e.split(".",1)[0];if(!a.hasOwnProperty(t))throw new Error('unknown event "'+t+'"; valid: '+Object.keys(a).join(", "));return e.replace(t,a[t])+".AudioWrapperEvent"}).join(" ");if(""===n)throw new Error('invalid eventNames parameter "'+t+'"');return jQuery(this.audio).one(n,r),this}}},{key:"off",value:function(t,r){if(this.audio){if(r&&"function"!=typeof r)throw new Error("listener parameter must be a function");if(!t)return jQuery(this.audio).off(".AudioWrapperEvent",r);var a=e._events,n=t.trim().splitOrEmpty(/\s+/).map(function(e){var t=e.split(".",1)[0];if(t){if(!a.hasOwnProperty(t))throw new Error('unknown event "'+t+'"; valid: '+Object.keys(a).join(", "));return e.replace(t,a[t])+".AudioWrapperEvent"}return e+".AudioWrapperEvent"}).join(" ");if(""===n)throw new Error('invalid eventNames parameter "'+t+'"');return jQuery(this.audio).off(n,r),this}}},{key:"duration",get:function(){return this.audio?this.audio.duration:NaN}},{key:"ended",get:function(){return!this.audio||this.audio.ended}},{key:"loop",get:function(){return!!this.audio&&this.audio.loop},set:function(e){this.audio&&(this.audio.loop=!!e)}},{key:"mute",get:function(){return this._mute},set:function(e){this._mute=!!e,this._updateAudioMute()}},{key:"paused",get:function(){return!!this.audio&&this.audio.paused}},{key:"rate",get:function(){return this._rate},set:function(e){this._rate=Math.clamp(e,.2,5),this._updateAudioRate()}},{key:"remaining",get:function(){return this.audio?this.audio.duration-this.audio.currentTime:NaN}},{key:"time",get:function(){return this.audio?this.audio.currentTime:NaN},set:function(e){var t=this;if(this.audio)try{this.audio.currentTime=e}catch(r){jQuery(this.audio).off("loadedmetadata.AudioWrapper:time").one("loadedmetadata.AudioWrapper:time",function(){return t.audio.currentTime=e})}}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=Math.clamp(e,0,1),this._updateAudioVolume()}}],[{key:"_verifyType",value:function(t){if(!t||!Has.audio)return null;var r=e._types;if(!r.hasOwnProperty(t)){var a=document.createElement("audio");r[t]=""!==a.canPlayType(t).replace(/^no$/i,"")}return r[t]?t:null}},{key:"getType",value:function(t){if(!t||!Has.audio)return null;var r=e.formats,a=t.toLowerCase(),n=r.hasOwnProperty(a)?r[a]:"audio/"+a;return e._verifyType(n)}},{key:"canPlayFormat",value:function(t){return null!==e.getType(t)}},{key:"canPlayType",value:function(t){return null!==e._verifyType(t)}}]),e}();Object.defineProperties(m,{formats:{value:{aac:"audio/aac",caf:"audio/x-caf","x-caf":"audio/x-caf",mp3:'audio/mpeg; codecs="mp3"',mpeg:'audio/mpeg; codecs="mp3"',m4a:"audio/mp4",mp4:"audio/mp4","x-m4a":"audio/mp4","x-mp4":"audio/mp4",oga:"audio/ogg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus"',wav:"audio/wav",wave:"audio/wav",weba:"audio/webm",webm:"audio/webm"}},_types:{value:{}},_events:{value:Object.freeze({canplay:"canplaythrough",end:"ended",error:"error",fade:":fade",pause:"pause",play:"playing",rate:"ratechange",seek:"seeked",stop:":stop",volume:"volumechange"})}});var v=function(){function e(t){var r=this;_classCallCheck(this,e),Object.defineProperties(this,{tracks:{configurable:!0,value:[]},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}}),Array.isArray(t)?t.forEach(function(e){return r.add(e)}):t instanceof e&&t.tracks.forEach(function(e){return r.add(e)})}return _createClass(e,[{key:"add",value:function(e){var t=this;if(null==e||"object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("track parameter must be an object");var r=void 0,a=void 0,n=void 0,i=void 0;if(e instanceof m)r=!0,a=e.clone(),n=e.volume,i=e.rate;else{if(!e.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(e.track instanceof m))throw new Error('track object\'s "track" property must be an AudioWrapper object');r=e.hasOwnProperty("copy")&&e.copy,a=r?e.track.clone():e.track,n=e.hasOwnProperty("volume")?e.volume:e.track.volume,i=e.hasOwnProperty("rate")?e.rate:e.track.rate}a.stop(),a.loop=!1,a.mute=!1,a.volume=n,a.rate=i,a.on("end.AudioListEvent",function(){return t._onEnd()}),this.tracks.push({copy:r,track:a,volume:n,rate:i})}},{key:"destroy",value:function(){this.stop(),this.tracks.filter(function(e){return e.copy}).forEach(function(e){return e.track.destroy()}),delete this.tracks,delete this.queue}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isMuted",value:function(){return this._mute}},{key:"isLooped",value:function(){return this._loop}},{key:"isShuffled",value:function(){return this._shuffle}},{key:"play",value:function(){(null!==this.current&&!this.current.track.isEnded()||(0===this.queue.length&&this._buildList(),this._next()))&&this.current.track.play()}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this.queue.splice(0)}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fadeWithDuration",value:function(e,t,r){if(0===this.queue.length&&this._buildList(),null!==this.current&&!this.current.track.isEnded()||this._next()){var a=Math.clamp(t,0,1)*this.current.volume,n=void 0;null!=r&&(n=Math.clamp(r,0,1)*this.current.volume),this.current.track.fadeWithDuration(e,a,n),this._volume=t}}},{key:"fade",value:function(e,t){this.fadeWithDuration(5,e,t)}},{key:"fadeIn",value:function(){this.fade(1)}},{key:"fadeOut",value:function(){this.fade(0)}},{key:"_next",value:function(){return null!==this.current&&this.current.track.stop(),0===this.queue.length?(this.current=null,!1):(this.current=this.queue.shift(),!this.current.track.hasSource()||this.current.track.isFailed()?this._next():(this.current.track.mute=this._mute,this.current.track.rate=this.rate*this.current.rate,this.current.track.volume=this.volume*this.current.volume,!0))}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._buildList()}this._next()&&this.current.track.play()}},{key:"_buildList",value:function(){var e;this.queue.splice(0),(e=this.queue).push.apply(e,_toConsumableArray(this.tracks)),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}},{key:"duration",get:function(){return this.tracks.map(function(e){return e.track.duration}).reduce(function(e,t){return e+t},0)}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=!!e}},{key:"mute",get:function(){return this._mute},set:function(e){this._mute=!!e,null!==this.current&&(this.current.track.mute=this._mute)}},{key:"rate",get:function(){return this._rate},set:function(e){this._rate=Math.clamp(e,.2,5),null!==this.current&&(this.current.track.rate=this.rate*this.current.rate)}},{key:"remaining",get:function(){var e=this.queue.map(function(e){return e.track.duration}).reduce(function(e,t){return e+t},0);return null!==this.current&&(e+=this.current.track.remaining),e}},{key:"shuffle",get:function(){return this._shuffle},set:function(e){this._shuffle=!!e}},{key:"time",get:function(){return this.duration-this.remaining}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=Math.clamp(e,0,1),null!==this.current&&(this.current.track.volume=this.volume*this.current.volume)}}]),e}();return Object.freeze(Object.defineProperties({},{mute:{get:e,set:t},rate:{get:r,set:a},volume:{get:n,set:i},stop:{value:o},subscribe:{value:s},unsubscribe:{value:u},publish:{value:l},create:{value:c},createList:{value:d}}))}(),SimpleStore=function(){function e(e,a){if(r)return r.create(e,a);for(var n=0;n<t.length;++n)if(t[n].init(e,a))return r=t[n],r.create(e,a);throw new Error("no valid storage adapters found")}var t=[],r=null;return Object.freeze(Object.defineProperties({},{adapters:{value:t},create:{value:e}}))}();SimpleStore.adapters.push(function(){function e(){function e(e){try{var t=window[e],r="_sc_"+String(Date.now());t.setItem(r,r);var a=t.getItem(r)===r;return t.removeItem(r),a}catch(e){}return!1}return r=e("localStorage")&&e("sessionStorage")}function t(e,t){if(!r)throw new Error("adapter not initialized");return new a(e,t)}var r=!1,a=function(){function e(t,r){_classCallCheck(this,e);var a=t+".",n=null,i=null;r?(n=window.localStorage,i="localStorage"):(n=window.sessionStorage,i="sessionStorage"),Object.defineProperties(this,{_engine:{value:n},_prefix:{value:a},_prefixRe:{value:new RegExp("^"+RegExp.escape(a))},name:{value:i},id:{value:t},persistent:{value:!!r}})}return _createClass(e,[{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var e=[],t=0;t<this._engine.length;++t){var r=this._engine.key(t);this._prefixRe.test(r)&&e.push(r.replace(this._prefixRe,""))}return e}},{key:"has",value:function(e){return!("string"!=typeof e||!e)&&this._engine.hasOwnProperty(this._prefix+e)}},{key:"get",value:function(t){if("string"!=typeof t||!t)return null;var r=this._engine.getItem(this._prefix+t);return null==r?null:e._deserialize(r)}},{key:"set",value:function(t,r){if("string"!=typeof t||!t)return!1;try{this._engine.setItem(this._prefix+t,e._serialize(r))}catch(e){throw/quota[_\s]?(?:exceeded|reached)/i.test(e.name)&&(e.message=this.name+" quota exceeded"),e}return!0}},{key:"delete",value:function(e){return!("string"!=typeof e||!e)&&(this._engine.removeItem(this._prefix+e),!0)}},{key:"clear",value:function(){for(var e=this.keys(),t=0,r=e.length;t<r;++t)this.delete(e[t]);return!0}},{key:"length",get:function(){return this.keys().length}}],[{key:"_serialize",value:function(e){return LZString.compressToUTF16(JSON.stringify(e))}},{key:"_deserialize",value:function(e){return JSON.parse(LZString.decompressFromUTF16(e))}}]),e}();return Object.freeze(Object.defineProperties({},{init:{value:e},create:{value:t}}))}()),SimpleStore.adapters.push(function(){function e(e){try{var t="_sc_"+String(Date.now());o._setCookie(t,o._serialize(t),undefined),i=o._deserialize(o._getCookie(t))===t,o._setCookie(t,undefined,n)}catch(e){i=!1}return i&&r(e),i}function t(e,t){if(!i)throw new Error("adapter not initialized");return new o(e,t)}function r(e){if(""!==document.cookie)for(var t=e+".",r=new RegExp("^"+RegExp.escape(t)),i=e+"!.",s=e+"*.",u=/\.(?:state|rcWarn)$/,l=document.cookie.split(/;\s*/),c=0;c<l.length;++c){var d=l[c].split("="),h=decodeURIComponent(d[0]);if(r.test(h)){var f=decodeURIComponent(d[1]);""!==f&&function(){var e=!u.test(h);o._setCookie(h,undefined,n),o._setCookie(h.replace(r,function(){return e?i:s}),f,e?a:undefined)}()}}}var a="Tue, 19 Jan 2038 03:14:07 GMT",n="Thu, 01 Jan 1970 00:00:00 GMT",i=!1,o=function(){function e(t,r){_classCallCheck(this,e);var a=t+(r?"!":"*")+".";Object.defineProperties(this,{_prefix:{value:a},_prefixRe:{value:new RegExp("^"+RegExp.escape(a))},name:{value:"cookie"},id:{value:t},persistent:{value:!!r}})}return _createClass(e,[{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var e=document.cookie.split(/;\s*/),t=[],r=0;r<e.length;++r){var a=e[r].split("="),n=decodeURIComponent(a[0]);if(this._prefixRe.test(n)){""!==decodeURIComponent(a[1])&&t.push(n.replace(this._prefixRe,""))}}return t}},{key:"has",value:function(t){return!("string"!=typeof t||!t)&&null!==e._getCookie(this._prefix+t)}},{key:"get",value:function(t){if("string"!=typeof t||!t)return null;var r=e._getCookie(this._prefix+t);return null===r?null:e._deserialize(r)}},{key:"set",value:function(t,r){if("string"!=typeof t||!t)return!1;try{if(e._setCookie(this._prefix+t,e._serialize(r),this.persistent?a:undefined),!this.has(t))throw new Error("unknown validation error during set")}catch(e){throw e.message="cookie error: "+e.message,e}return!0}},{key:"delete",value:function(t){if("string"!=typeof t||!t||!this.has(t))return!1;try{if(e._setCookie(this._prefix+t,undefined,n),this.has(t))throw new Error("unknown validation error during delete")}catch(e){throw e.message="cookie error: "+e.message,e}return!0}},{key:"clear",value:function(){for(var e=this.keys(),t=0,r=e.length;t<r;++t)this.delete(e[t]);return!0}},{key:"length",get:function(){return this.keys().length}}],[{key:"_getCookie",value:function(e){if(!e||""===document.cookie)return null;for(var t=document.cookie.split(/;\s*/),r=0;r<t.length;++r){var a=t[r].split("=");if(e===decodeURIComponent(a[0])){return decodeURIComponent(a[1])||null}}return null}},{key:"_setCookie",value:function(e,t,r){if(e){var a=encodeURIComponent(e)+"=";null!=t&&(a+=encodeURIComponent(t)),null!=r&&(a+="; expires="+r),a+="; path=/",document.cookie=a}}},{key:"_serialize",value:function(e){return LZString.compressToBase64(JSON.stringify(e))}},{key:"_deserialize",value:function(e){return JSON.parse(LZString.decompressFromBase64(e))}}]),e}();return Object.freeze(Object.defineProperties({},{init:{value:e},create:{value:t}}))}());var DebugView=function(){return function(){function e(t,r,a,n){_classCallCheck(this,e),Object.defineProperties(this,{parent:{value:t},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:n,"aria-label":n,"data-type":null!=r?r:"","data-name":null!=a?a:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(e,[{key:"append",value:function(e){return jQuery(this.view).append(e),this}},{key:"modes",value:function(e){if(null==e){var t={};return this.view.className.splitOrEmpty(/\s+/).forEach(function(e){"debug"!==e&&(t[e]=!0)}),t}if("object"===(void 0===e?"undefined":_typeof(e)))return Object.keys(e).forEach(function(t){this[e[t]?"addClass":"removeClass"](t)},jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var e=jQuery(this.view);this.view.hasChildNodes()&&e.contents().appendTo(this.parent),e.remove(),jQuery(this.break).remove()}},{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(e){this.view.setAttribute("data-type",null!=e?e:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(e){this.view.setAttribute("data-name",null!=e?e:"")}},{key:"title",get:function(){return this.view.title},set:function(e){this.view.title=e}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?e.disable():e.enable()}}]),e}()}(),PRNGWrapper=function(){return function(){function e(t,r){_classCallCheck(this,e),Object.defineProperties(this,new Math.seedrandom(t,r,function(e,t){return{_prng:{value:e},seed:{writable:!0,value:t},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}}))}return _createClass(e,null,[{key:"marshal",value:function(e){if(!e||!e.hasOwnProperty("seed")||!e.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:e.seed,pull:e.pull}}},{key:"unmarshal",value:function(t){if(!t||!t.hasOwnProperty("seed")||!t.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var r=new e(t.seed,!1),a=t.pull;a>0;--a)r.random();return r}}]),e}()}(),StyleWrapper=function(){var e=new RegExp(Patterns.cssImage,"g"),t=new RegExp(Patterns.cssImage);return function(){function r(e){if(_classCallCheck(this,r),null==e)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:e}})}return _createClass(r,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(e){this.clear(),this.add(e)}},{key:"add",value:function(r){var a=r;t.test(a)&&(e.lastIndex=0,a=a.replace(e,function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup({source:e,matchStart:0});if(t.hasOwnProperty("error")||t.pos<e.length)return e;var r=t.source;if("data:"!==r.slice(0,5)&&Story.has(r)){var a=Story.get(r);a.tags.includes("Twine.image")&&(r=a.text)}return'url("'+r.replace(/"/g,"%22")+'")'})),this.style.styleSheet?this.style.styleSheet.cssText+=a:this.style.appendChild(document.createTextNode(a))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),r}()}(),Diff=function(){function e(t,a){for(var n=Object.prototype.toString,i=t instanceof Array,o=[].concat(Object.keys(t),Object.keys(a)).sort().filter(function(e,t,r){return 0===t||r[t-1]!==e}),s={},u=void 0,l=function(e){return e===u},c=0,d=o.length;c<d;++c){var h=o[c],f=t[h],p=a[h];if(t.hasOwnProperty(h))if(a.hasOwnProperty(h)){if(f===p)continue;if((void 0===f?"undefined":_typeof(f))===(void 0===p?"undefined":_typeof(p)))if("function"==typeof f)f.toString()!==p.toString()&&(s[h]=[r.Copy,p]);else if("object"!==(void 0===f?"undefined":_typeof(f))||null===f)s[h]=[r.Copy,p];else{var g=n.call(f),m=n.call(p);if(g===m)if(f instanceof Date)Number(f)!==Number(p)&&(s[h]=[r.Copy,clone(p)]);else if(f instanceof Map)s[h]=[r.Copy,clone(p)];else if(f instanceof RegExp)f.toString()!==p.toString()&&(s[h]=[r.Copy,clone(p)]);else if(f instanceof Set)s[h]=[r.Copy,clone(p)];else if("[object Object]"!==g)s[h]=[r.Copy,clone(p)];else{var v=e(f,p);null!==v&&(s[h]=v)}else s[h]=[r.Copy,clone(p)]}else s[h]=[r.Copy,"object"!==(void 0===p?"undefined":_typeof(p))||null===p?p:clone(p)]}else if(i&&Util.isNumeric(h)){var y=Number(h);if(!u){u="";do{u+="~"}while(o.some(l));s[u]=[r.SpliceArray,y,y]}y<s[u][1]&&(s[u][1]=y),y>s[u][2]&&(s[u][2]=y)}else s[h]=r.Delete;else s[h]=[r.Copy,"object"!==(void 0===p?"undefined":_typeof(p))||null===p?p:clone(p)]}return Object.keys(s).length>0?s:null}function t(e,a){for(var n=Object.keys(a||{}),i=clone(e),o=0,s=n.length;o<s;++o){var u=n[o],l=a[u];if(l===r.Delete)delete i[u];else if(l instanceof Array)switch(l[0]){case r.SpliceArray:i.splice(l[1],l[2]-l[1]+1);break;case r.Copy:i[u]=clone(l[1]);break;case r.CopyDate:i[u]=new Date(l[1])}else i[u]=t(i[u],l)}return i}var r=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3});return Object.freeze(Object.defineProperties({},{Op:{value:r},diff:{value:e},patch:{value:t}}))}(),L10n=function(){function e(){r()}function t(e,t){if(!e)return"";var r=function(e){var t=void 0;return e.some(function(e){return!!l10nStrings.hasOwnProperty(e)&&(t=e,!0)}),t}(Array.isArray(e)?e:[e]);if(!r)return"";for(var i=l10nStrings[r],o=0;n.test(i);){if(++o>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");a.lastIndex=0,i=i.replace(a,function(e){var r=e.slice(1,-1);return t&&t.hasOwnProperty(r)?t[r]:l10nStrings.hasOwnProperty(r)?l10nStrings[r]:void 0})}return i}function r(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach(function(e){try{var t=void 0;switch(e){case"identity":t=strings.identity;break;case"aborting":t=strings.aborting;break;case"cancel":t=strings.cancel;break;case"close":t=strings.close;break;case"ok":t=strings.ok;break;case"errorTitle":t=strings.errors.title;break;case"errorNonexistentPassage":t=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":t=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":t=strings.errors.saveIdMismatch;break;case"warningDegraded":t=strings.warnings.degraded;break;case"debugViewTitle":t=strings.debugView.title;break;case"debugViewToggle":t=strings.debugView.toggle;break;case"uiBarToggle":t=strings.uiBar.toggle;break;case"uiBarBackward":t=strings.uiBar.backward;break;case"uiBarForward":t=strings.uiBar.forward;break;case"uiBarJumpto":t=strings.uiBar.jumpto;break;case"jumptoTitle":t=strings.jumpto.title;break;case"jumptoTurn":t=strings.jumpto.turn;break;case"jumptoUnavailable":t=strings.jumpto.unavailable;break;case"savesTitle":t=strings.saves.title;break;case"savesDisallowed":t=strings.saves.disallowed;break;case"savesEmptySlot":t=strings.saves.emptySlot;break;case"savesIncapable":t=strings.saves.incapable;break;case"savesLabelAuto":t=strings.saves.labelAuto;break;case"savesLabelDelete":t=strings.saves.labelDelete;break;case"savesLabelExport":t=strings.saves.labelExport;break;case"savesLabelImport":t=strings.saves.labelImport;break;case"savesLabelLoad":t=strings.saves.labelLoad;break;case"savesLabelClear":t=strings.saves.labelClear;break;case"savesLabelSave":t=strings.saves.labelSave;break;case"savesLabelSlot":t=strings.saves.labelSlot;break;case"savesSavedOn":t=strings.saves.savedOn;break;case"savesUnavailable":t=strings.saves.unavailable;break;case"savesUnknownDate":t=strings.saves.unknownDate;break;case"settingsTitle":t=strings.settings.title;break;case"settingsOff":t=strings.settings.off;break;case"settingsOn":t=strings.settings.on;break;case"settingsReset":t=strings.settings.reset;break;case"restartTitle":t=strings.restart.title;break;case"restartPrompt":t=strings.restart.prompt;break;case"shareTitle":t=strings.share.title;break;case"autoloadTitle":t=strings.autoload.title;break;case"autoloadCancel":t=strings.autoload.cancel;break;case"autoloadOk":t=strings.autoload.ok;break;case"autoloadPrompt":t=strings.autoload.prompt;break;case"macroBackText":t=strings.macros.back.text;break;case"macroReturnText":t=strings.macros.return.text}t&&(l10nStrings[e]=t.replace(/%\w+%/g,function(e){return"{"+e.slice(1,-1)+"}"}))}catch(e){}})}var a=/\{\w+\}/g,n=new RegExp(a.source);return Object.freeze(Object.defineProperties({},{init:{value:e},get:{value:t}}))}(),strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesEmptySlot:"— slot empty —",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesSavedOn:"Saved on",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",autoloadTitle:"Autoload",
autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=function(){function e(){throw new Error("Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code")}function t(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}return Object.seal({debug:!1,addVisitedLinkClass:!1,cleanupWikifierOutput:!1,loadDelay:0,history:Object.seal({controls:!0,maxStates:100,get mode(){e()},set mode(t){e()},get tracking(){t()},set tracking(e){t()}}),macros:Object.seal({ifAssignmentError:!0,maxLoopIterations:1e3}),navigation:Object.seal({override:undefined}),passages:Object.seal({descriptions:undefined,displayTitles:!1,nobr:!1,start:undefined,transitionOut:undefined}),saves:Object.seal({autoload:undefined,autosave:undefined,id:"untitled-story",isAllowed:undefined,onLoad:undefined,onSave:undefined,slots:8,version:undefined}),ui:Object.seal({stowBarInitially:800,updateStoryElements:!0}),transitionEndEventName:function(){for(var e=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),t=[].concat(_toConsumableArray(e.keys())),r=document.createElement("div"),a=0;a<t.length;++a)if(r.style[t[a]]!==undefined)return e.get(t[a]);return""}()})}(),State=function(){function e(){session.delete("state"),W=[],R=c(),F=-1,B=[],V=null===V?null:new PRNGWrapper(V.seed,!1)}function t(){if(session.has("state")){var e=session.get("state");return null!=e&&(a(e),!0)}return!1}function r(e){var t={index:F};return e?t.history=clone(W):t.delta=A(W),B.length>0&&(t.expired=[].concat(_toConsumableArray(B))),null!==V&&(t.seed=V.seed),t}function a(e,t){if(null==e)throw new Error("state object is null or undefined");if(!e.hasOwnProperty(t?"history":"delta")||0===e[t?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!e.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==V&&!e.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===V&&e.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");W=t?clone(e.history):P(e.delta),F=e.index,B=e.hasOwnProperty("expired")?[].concat(_toConsumableArray(e.expired)):[],e.hasOwnProperty("seed")&&(V.seed=e.seed),g(F)}function n(){return r(!0)}function i(e){return a(e,!0)}function o(){return B}function s(){return B.length+v()}function u(){return B.concat(W.slice(0,v()).map(function(e){return e.title}))}function l(e){return null!=e&&""!==e&&(!!B.includes(e)||!!W.slice(0,v()).some(function(t){return t.title===e}))}function c(e,t){return{title:null==e?"":String(e),variables:null==t?{}:clone(t)}}function d(){return R}function h(){return F}function f(){return R.title}function p(){return R.variables}function g(e){if(null==e)throw new Error("moment activation attempted with null or undefined");switch(void 0===e?"undefined":_typeof(e)){case"object":R=clone(e);break;case"number":if(b())throw new Error("moment activation attempted with index on empty history");if(e<0||e>=y())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, "+(y()-1)+"], got "+e);R=clone(W[e]);break;default:throw new TypeError('moment activation attempted with a "'+(void 0===e?"undefined":_typeof(e))+'"; must be an object or valid history stack index')}return null!==V&&(V=PRNGWrapper.unmarshal({seed:V.seed,pull:R.pull})),session.set("state",r()),jQuery.event.trigger(":historyupdate"),R}function m(){return W}function v(){return F+1}function y(){return W.length}function b(){return 0===W.length}function w(){return W.length>0?W[F]:null}function k(){return W.length>0?W[W.length-1]:null}function S(){return W.length>0?W[0]:null}function E(e){return b()||e<0||e>F?null:W[e]}function x(e){if(b())return null;var t=1+(e?Math.abs(e):0);return t>v()?null:W[v()-t]}function j(e){if(b()||null==e||""===e)return!1;for(var t=F;t>=0;--t)if(W[t].title===e)return!0;return!1}function C(e){if(v()<y()&&W.splice(v(),y()-v()),W.push(c(e,R.variables)),V&&(k().pull=V.pull),Config.history.maxStates>0)for(;y()>Config.history.maxStates;)B.push(W.shift().title);return F=y()-1,g(F),v()}function O(e){return!(null==e||e<0||e>=y()||e===F)&&(F=e,g(F),!0)}function T(e){return null!=e&&0!==e&&O(F+e)}function A(e){if(!Array.isArray(e))return null;if(0===e.length)return[];for(var t=[clone(e[0])],r=1,a=e.length;r<a;++r)t.push(Diff.diff(e[r-1],e[r]));return t}function P(e){if(!Array.isArray(e))return null;if(0===e.length)return[];for(var t=[clone(e[0])],r=1,a=e.length;r<a;++r)t.push(Diff.patch(t[r-1],e[r]));return t}function _(e,t){if(!b()){var r=void 0;throw r="a script-tagged passage",new Error("State.initPRNG must be called during initialization, within either "+r+" or the StoryInit special passage")}V=new PRNGWrapper(e,t),R.pull=V.pull}function N(){return V?V.random():Math.random()}function D(){U={},TempVariables=U}function M(){return U}function L(e){var t=Q(e);if(null!==t){for(var r=t.names,a=t.store,n=0,i=r.length;n<i;++n){if(void 0===a[r[n]])return;a=a[r[n]]}return a}}function I(e,t){var r=Q(e);if(null===r)return!1;for(var a=r.names,n=a.pop(),i=r.store,o=0,s=a.length;o<s;++o){if(void 0===i[a[o]])return!1;i=i[a[o]]}return i[n]=t,!0}function Q(e){for(var t={store:"$"===e[0]?State.variables:State.temporary,names:[]},r=e,a=void 0;null!==(a=z.exec(r));)r=r.slice(a[0].length),a[1]?t.names.push(a[1]):a[2]?t.names.push(a[2]):a[3]?t.names.push(a[3]):a[4]?t.names.push(a[4]):a[5]?t.names.push(L(a[5])):a[6]&&t.names.push(Number(a[6]));return""===r?t:null}var W=[],R=c(),F=-1,B=[],V=null,U={},z=new RegExp("^(?:"+Patterns.variableSigil+"("+Patterns.identifier+")|\\.("+Patterns.identifier+")|\\[(?:(?:\"((?:\\\\.|[^\"\\\\])+)\")|(?:'((?:\\\\.|[^'\\\\])+)')|("+Patterns.variableSigil+Patterns.identifierFirstChar+".*)|(\\d+))\\])");return Object.freeze(Object.defineProperties({},{reset:{value:e},restore:{value:t},marshalForSave:{value:n},unmarshalForSave:{value:i},expired:{get:o},turns:{get:s},passages:{get:u},hasPlayed:{value:l},active:{get:d},activeIndex:{get:h},passage:{get:f},variables:{get:p},history:{get:m},length:{get:v},size:{get:y},isEmpty:{value:b},current:{get:w},top:{get:k},bottom:{get:S},index:{value:E},peek:{value:x},has:{value:j},create:{value:C},goTo:{value:O},go:{value:T},deltaEncode:{value:A},deltaDecode:{value:P},initPRNG:{value:_},random:{value:N},clearTemporary:{value:D},temporary:{get:M},getVar:{value:L},setVar:{value:I},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(e,t,r,a,n){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var i=void 0,o=void 0;if("function"==typeof t?(i=t,o={namespace:a,one:!!r}):(i=r,o={namespace:n,one:!!a,selector:t}),"function"!=typeof i)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(e).ariaClick(o,i)}function insertElement(e,t,r,a,n,i){var o=jQuery(document.createElement(t));return r&&o.attr("id",r),a&&o.addClass(a),i&&o.attr("title",i),n&&o.text(n),e&&o.appendTo(e),o[0]}function insertText(e,t){jQuery(e).append(document.createTextNode(t))}function removeChildren(e){jQuery(e).empty()}function removeElement(e){jQuery(e).remove()}function fade(e,t){function r(){i+=.05*n,a(o,Math.easeInOut(i)),(1===n&&i>=1||-1===n&&i<=0)&&(e.style.visibility="in"===t.fade?"visible":"hidden",o.parentNode.replaceChild(e,o),o=null,window.clearInterval(s),t.onComplete&&t.onComplete())}function a(e,t){e.style.zoom=1,e.style.filter="alpha(opacity="+Math.floor(100*t)+")",e.style.opacity=t}var n="in"===t.fade?1:-1,i=void 0,o=e.cloneNode(!0),s=void 0;e.parentNode.replaceChild(o,e),"in"===t.fade?(i=0,o.style.visibility="visible"):i=1,a(o,i),s=window.setInterval(r,25)}function scrollWindowTo(e,t){function r(){l+=n,window.scroll(0,i+u*(s*Math.easeInOut(l))),l>=1&&window.clearInterval(c)}function a(e){for(var t=0;e.offsetParent;)t+=e.offsetTop,e=e.offsetParent;return t}var n=null!=t?Number(t):.1;Number.isNaN(n)||!Number.isFinite(n)||n<0?n=.1:n>1&&(n=1);var i=window.scrollY?window.scrollY:document.body.scrollTop,o=function(e){var t=a(e),r=t+e.offsetHeight,n=window.scrollY?window.scrollY:document.body.scrollTop,i=window.innerHeight?window.innerHeight:document.body.clientHeight,o=n+i;return t>=n&&r>o&&e.offsetHeight<i?t-(i-e.offsetHeight)+20:t}(e),s=Math.abs(i-o),u=i>o?-1:1,l=0,c=void 0;c=window.setInterval(r,25)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var e=Array.prototype.concat.apply([],arguments),t=State.passages,r=0,a=e.length;r<a;++r)if(!t.includes(e[r]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var e=Array.prototype.concat.apply([],arguments),t=State.passages,r=t.length-1,a=State.turns,n=0,i=e.length;n<i&&a>-1;++n){var o=t.lastIndexOf(e[n]);a=Math.min(a,-1===o?-1:r-o)}return a}function passage(){return State.passage}function previous(){var e=State.passages;if(arguments.length>0){var t=Number(arguments[0]);if(!Number.isSafeInteger(t)||t<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return e.length>t?e[e.length-1-t]:""}for(var r=e.length-2;r>=0;--r)if(e[r]!==State.passage)return e[r];return""}function random(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:e=0,t=Math.trunc(arguments[0]);break;default:e=Math.trunc(arguments[0]),t=Math.trunc(arguments[1])}if(!Number.isInteger(e))throw new Error("random min parameter must be an integer");if(!Number.isInteger(t))throw new Error("random max parameter must be an integer");if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.floor(State.random()*(t-e+1))+e}function randomFloat(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:e=0,t=Number(arguments[0]);break;default:e=Number(arguments[0]),t=Number(arguments[1])}if(Number.isNaN(e)||!Number.isFinite(e))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(t)||!Number.isFinite(t))throw new Error("randomFloat max parameter must be a number");if(e>t){var r=[t,e];e=r[0],t=r[1]}return State.random()*(t-e)+e}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var e=Array.prototype.concat.apply([],arguments),t=[],r=0,a=e.length;r<a;++r)t=t.concat(Story.get(e[r]).tags);return t}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var e=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),t=State.passages,r=State.turns,a=0,n=e.length;a<n&&r>0;++a)r=Math.min(r,t.count(e[a]));return r}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var e=Array.prototype.concat.apply([],arguments),t=e.length,r=State.passages,a=new Map,n=0,i=0,o=r.length;i<o;++i){var s=r[i];if(a.has(s))a.get(s)&&++n;else{var u=Story.get(s).tags;if(u.length>0){for(var l=0,c=0;c<t;++c)u.includes(e[c])&&++l;l===t?(++n,a.set(s,!0)):a.set(s,!1)}}}return n}function evalJavaScript(code,output){return function(code,output){return eval(code)}.call(output?{output:output}:null,String(code),output)}function evalTwineScript(code,output){return function(code,output){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output)}var _ref8=function(){function e(e){return e.reduce(function(e,t){return e=e.then(t)},Promise.resolve())}function t(e){return Util.parseUrl(e).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function r(){function r(e){return new Promise(function(r,a){jQuery(document.createElement("script")).one("load abort error",function(e){jQuery(e.target).off(),"load"===e.type?r(e.target):a(e.target)}).appendTo(document.head).attr({id:"script-imported-"+t(e),type:"text/javascript",src:e})})}for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return Promise.all(n.map(function(t){return Array.isArray(t)?e(t.map(function(e){return function(){return r(e)}})):r(t)}))}function a(){function r(e){return new Promise(function(r,a){jQuery(document.createElement("link")).one("load abort error",function(e){jQuery(e.target).off(),"load"===e.type?r(e.target):a(e.target)}).appendTo(document.head).attr({id:"style-imported-"+t(e),rel:"stylesheet",href:e})})}for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return Promise.all(n.map(function(t){return Array.isArray(t)?e(t.map(function(e){return function(){return r(e)}})):r(t)}))}return{importScripts:r,importStyles:a}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){function e(e){if(0!==r.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var n=e,i=void 0;null!==(i=r.exec(n));)if(i[5]){var o=i[5];if("$"===o||"_"===o)continue;if(a.test(o))o=o[0];else if("is"===o){var s=r.lastIndex,u=n.slice(s);/^\s+not\b/.test(u)&&(n=n.splice(s,u.search(/\S/)),o="isnot")}t.hasOwnProperty(o)&&(n=n.splice(i.index,o.length,t[o]),r.lastIndex+=t[o].length-o.length)}return n}var t=Object.freeze({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),r=new RegExp(["(\"\"|'')",'("(?:\\\\.|[^"\\\\])+")',"('(?:\\\\.|[^'\\\\])+')","([=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),a=new RegExp("^"+Patterns.variable);return e}();return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),Wikifier=function(){var e=0,t=function(){function t(r,a,n){_classCallCheck(this,t),t.Parser.Profile.isEmpty()&&t.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(a)},options:{writable:!0,value:Object.assign({profile:"all"},n)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==r?this.output=document.createDocumentFragment():r.jquery?this.output=r[0]:this.output=r;try{++e,this.subWikify(this.output),1===e&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--e}}return _createClass(t,[{key:"subWikify",value:function(e,r,a){var n=this.output,i=void 0;this.output=e,null!=a&&"object"===(void 0===a?"undefined":_typeof(a))&&(i=this.options,this.options=Object.assign({},this.options,a));var o=t.Parser.Profile.get(this.options.profile),s=r?new RegExp("(?:"+r+")",this.options.ignoreTerminatorCase?"gim":"gm"):null,u=void 0,l=void 0;do{if(o.parserRegExp.lastIndex=this.nextMatch,s&&(s.lastIndex=this.nextMatch),l=o.parserRegExp.exec(this.source),(u=s?s.exec(this.source):null)&&(!l||u.index<=l.index))return u.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,u.index),this.matchStart=u.index,this.matchLength=u[0].length,this.matchText=u[0],this.nextMatch=s.lastIndex,this.output=n,void(i&&(this.options=i));if(l){l.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,l.index),this.matchStart=l.index,this.matchLength=l[0].length,this.matchText=l[0],this.nextMatch=o.parserRegExp.lastIndex;for(var c=void 0,d=1,h=l.length;d<h;++d)if(l[d]){c=d-1;break}if(o.parsers[c].handler(this),null!=TempState.break)break}}while(u||l);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=n,i&&(this.options=i)}},{key:"outputText",value:function(e,t,r){jQuery(e).append(document.createTextNode(this.source.substring(t,r)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(e){var r=document.createDocumentFragment();new t(r,e);var a=r.querySelector(".error");if(null!==a)throw new Error(a.textContent.replace(errorPrologRegExp,""));return r}},{key:"createInternalLink",value:function(e,t,r,a){var n=jQuery(document.createElement("a"));return null!=t&&(n.attr("data-passage",t),Story.has(t)?(n.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(t)&&n.addClass("link-visited")):n.addClass("link-broken"),n.ariaClick({one:!0},function(){"function"==typeof a&&a(),Engine.play(t)})),r&&n.append(document.createTextNode(r)),e&&n.appendTo(e),n[0]}},{key:"createExternalLink",value:function(e,t,r){var a=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(r).appendTo(e);return null!=t&&a.attr({href:t,tabindex:0}),a[0]}},{key:"isExternalLink",value:function(e){return!Story.has(e)&&(new RegExp("^"+Patterns.url,"gim").test(e)||/[\/.?#]/.test(e))}}]),t}();return Object.defineProperty(t,"Parser",{value:function(){function e(){return d}function t(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!e.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof e.name)throw new Error('parser object "name" property must be a string');if(!e.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof e.match)throw new Error('parser object "match" property must be a string');if(!e.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof e.handler)throw new Error('parser object "handler" property must be a function');if(e.hasOwnProperty("profiles")&&!Array.isArray(e.profiles))throw new Error('parser object "profiles" property must be an array');if(n(e.name))throw new Error('cannot clobber existing parser "'+e.name+'"');d.push(e)}function r(e){var t=d.find(function(t){return t.name===e});t&&d.delete(t)}function a(){return 0===d.length}function n(e){return!!d.find(function(t){return t.name===e})}function i(e){return d.find(function(t){return t.name===e})||null}function o(){return h}function s(){var e=d,t=e.filter(function(e){return!Array.isArray(e.profiles)||e.profiles.includes("core")});return h=Object.freeze({all:{parsers:e,parserRegExp:new RegExp(e.map(function(e){return"("+e.match+")"}).join("|"),"gm")},core:{parsers:t,parserRegExp:new RegExp(t.map(function(e){return"("+e.match+")"}).join("|"),"gm")}})}function u(){return"object"!==(void 0===h?"undefined":_typeof(h))||0===Object.keys(h).length}function l(e){if("object"!==(void 0===h?"undefined":_typeof(h))||!h.hasOwnProperty(e))throw new Error('nonexistent parser profile "'+e+'"');return h[e]}function c(e){return"object"===(void 0===h?"undefined":_typeof(h))&&h.hasOwnProperty(e)}var d=[],h=void 0;return Object.freeze(Object.defineProperties({},{parsers:{get:e},add:{value:t},delete:{value:r},isEmpty:{value:a},has:{value:n},get:{value:i},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:o},compile:{value:s},isEmpty:{value:u},has:{value:c},get:{value:l}}))}}))}()}),Object.defineProperties(t,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(t.helpers,{inlineCss:{value:function(){function e(e){var r={classes:[],id:"",styles:{}},a=void 0;do{t.lastIndex=e.nextMatch;var n=t.exec(e.source);a=n&&n.index===e.nextMatch,a&&(n[1]?r.styles[Util.fromCssProperty(n[1])]=n[2].trim():n[3]?r.styles[Util.fromCssProperty(n[3])]=n[4].trim():n[5]?r.classes=r.classes.concat(n[5].slice(1).split(/\./)):n[6]&&(r.id=n[6].slice(1).split(/#/).pop()),e.nextMatch=t.lastIndex)}while(a);return r}var t=new RegExp(Patterns.inlineCss,"gm");return e}()},evalText:{value:function(e){var t=void 0;try{t=Scripting.evalTwineScript(e),null==t||"function"==typeof t?t=e:(t=String(t),/\[(?:object(?:\s+[^\]]+)?|native\s+code)\]/.test(t)&&(t=e))}catch(r){t=e}return t}},evalPassageId:{value:function(e){return null==e||Story.has(e)?e:t.helpers.evalText(e)}},hasBlockContext:{value:function(e){for(var t="function"==typeof window.getComputedStyle,r=e.length-1;r>=0;--r){var a=e[r];switch(a.nodeType){case Node.ELEMENT_NODE:var n=a.nodeName.toUpperCase();if("BR"===n)return!0;var i=t?window.getComputedStyle(a,null):a.currentStyle;if(i&&i.display){if("none"===i.display)continue;return"block"===i.display}switch(n){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){function e(){if(!n&&!(n=t.Parser.get("macro")))throw new Error('cannot find "macro" parser');return n}function r(){for(var t=n||e(),r=new Set,a=t.context;null!==a;a=a.parent)a._shadows&&a._shadows.forEach(function(e){return r.add(e)});return[].concat(_toConsumableArray(r))}function a(e){var t={};return r().forEach(function(e){var r=e.slice(1),a="$"===e[0]?State.variables:State.temporary;t[e]=a[r]}),function(){var r=Object.keys(t),a=r.length>0?{}:null;try{return r.forEach(function(e){var r=e.slice(1),n="$"===e[0]?State.variables:State.temporary;n.hasOwnProperty(r)&&(a[r]=n[r]),n[r]=t[e]}),Scripting.evalJavaScript(e)}finally{r.forEach(function(e){var r=e.slice(1),n="$"===e[0]?State.variables:State.temporary;t[e]=n[r],a.hasOwnProperty(r)?n[r]=a[r]:delete n[r]})}}}var n=null;return a}()},parseSquareBracketedMarkup:{value:function(e){function t(){return c>=e.source.length?s:e.source[c]}function r(t){return t<1||c+t>=e.source.length?s:e.source[c+t]}function a(){return{error:String.format.apply(String,arguments),pos:c}}function n(){l=c}function i(t){var r=e.source.slice(l,c).trim();if(""===r)throw new Error("malformed wiki "+(f?"link":"image")+", empty "+t+" component");"link"===t&&"~"===r[0]?(u.forceInternal=!0,u.link=r.slice(1)):u[t]=r,l=c}function o(e){++c;e:for(;;){switch(t()){case"\\":++c;var r=t();if(r!==s&&"\n"!==r)break;case s:case"\n":return s;case e:break e}++c}return c}var s=-1,u={},l=e.matchStart,c=l+1,d=void 0,h=void 0,f=void 0,p=void 0;if("["===(p=t()))f=u.isLink=!0;else{switch(f=!1,p){case"<":u.align="left",++c;break;case">":u.align="right",++c}if(!/^[Ii][Mm][Gg]$/.test(e.source.slice(c,c+3)))return a("malformed square-bracketed wiki markup");c+=3,u.isImage=!0}if("["!==function(){return c>=e.source.length?s:e.source[c++]}())return a("malformed wiki {0}",f?"link":"image");d=1,h=0,n();try{e:for(;;){switch(p=t()){case s:case"\n":return a("unterminated wiki {0}",f?"link":"image");case'"':if(o(p)===s)return a("unterminated double quoted string in wiki {0}",f?"link":"image");break;case"'":if((4===h||3===h&&f)&&o(p)===s)return a("unterminated single quoted string in wiki {0}",f?"link":"image");break;case"|":0===h&&(i(f?"text":"title"),++l,h=1);break;case"-":0===h&&">"===r(1)&&(i(f?"text":"title"),++c,l+=2,h=1);break;case"<":0===h&&"-"===r(1)&&(i(f?"link":"source"),++c,l+=2,h=2);break;case"[":if(-1===h)return a("unexpected left square bracket '['");++d,1===d&&(n(),++l);break;case"]":if(0===--d){switch(h){case 0:case 1:i(f?"link":"source"),h=3;break;case 2:i(f?"text":"title"),h=3;break;case 3:f?(i("setter"),h=-1):(i("link"),h=4);break;case 4:i("setter"),h=-1}if(++c,"]"===t()){++c;break e}--c}}++c}}catch(e){return a(e.message)}return u.pos=c,u}}}),t}();!function(){function e(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(t[1]).appendTo(e.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.subWikify(jQuery(document.createElement("blockquote")).appendTo(e.output).get(0),this.terminator)}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));var t=[e.output],r=0,a=e.matchLength,n=void 0,i=void 0;do{if(a>r)for(i=r;i<a;++i)t.push(jQuery(document.createElement("blockquote")).appendTo(t[t.length-1]).get(0));else if(a<r)for(i=r;i>a;--i)t.pop();r=a,e.subWikify(t[t.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(t[t.length-1]),this.lookahead.lastIndex=e.nextMatch;var o=this.lookahead.exec(e.source);n=o&&o.index===e.nextMatch,n&&(a=o[0].length,e.nextMatch+=o[0].length)}while(n)}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?"+Patterns.macroName+")(?:\\s*)((?:(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>","gm"),argsPattern:["(``)","`((?:\\\\.|[^`\\\\])+)`","(\"\"|'')",'("(?:\\\\.|[^"\\\\])+")',"('(?:\\\\.|[^'\\\\])+')","(\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)","([^`\"'\\s]+)","(`|\"|')"].join("|"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(e){var t=this.lookahead.lastIndex=e.matchStart;if(this.parseTag(e)){var r=e.nextMatch,a=this.working.source,n=this.working.name,i=this.working.arguments,o=void 0;try{if(!(o=Macro.get(n))){if(Macro.tags.has(n)){var s=Macro.tags.get(n);return throwError(e.output,"child tag <<"+n+">> was found outside of a call to its parent macro"+(1===s.length?"":"s")+" <<"+s.join(">>, <<")+">>",e.source.slice(t,e.nextMatch))}return throwError(e.output,"macro <<"+n+">> does not exist",e.source.slice(t,e.nextMatch))}var u=null;if(o.hasOwnProperty("tags")&&!(u=this.parseBody(e,o)))return e.nextMatch=r,throwError(e.output,"cannot find a closing tag for macro <<"+n+">>",e.source.slice(t,e.nextMatch)+"…");if("function"!=typeof o.handler)return throwError(e.output,"macro <<"+n+">> handler function "+(o.hasOwnProperty("handler")?"is not a function":"does not exist"),e.source.slice(t,e.nextMatch));var l=u?u[0].args:this.createArgs(i,o.hasOwnProperty("skipArgs")&&!!o.skipArgs||o.hasOwnProperty("skipArg0")&&!!o.skipArg0);if(o.hasOwnProperty("_MACRO_API")){this.context=new MacroContext({macro:o,name:n,args:l,payload:u,source:a,parent:this.context,parser:e});try{o.handler.call(this.context)}finally{this.context=this.context.parent}}else{var c=e._rawArgs;e._rawArgs=i;try{o.handler(e.output,n,l,e,u)}finally{e._rawArgs=c}}}catch(r){return throwError(e.output,"cannot execute "+(o&&o.isWidget?"widget":"macro")+" <<"+n+">>: "+r.message,e.source.slice(t,e.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else e.outputText(e.output,e.matchStart,e.nextMatch)},parseTag:function(e){var t=this.lookahead.exec(e.source);return!(!t||t.index!==e.matchStart||!t[1])&&(e.nextMatch=this.lookahead.lastIndex,this.working.source=e.source.slice(t.index,this.lookahead.lastIndex),this.working.name=t[1],this.working.arguments=t[2],this.working.index=t.index,!0)},parseBody:function(e,t){for(var r=this.working.name,a="/"+r,n="end"+r,i=!!Array.isArray(t.tags)&&t.tags,o=[],s=t.hasOwnProperty("skipArgs")&&t.skipArgs,u=t.hasOwnProperty("skipArg0")&&t.skipArg0,l=-1,c=1,d=this.working.source,h=this.working.name,f=this.working.arguments,p=e.nextMatch;-1!==(e.matchStart=e.source.indexOf(this.match,e.nextMatch));)if(this.parseTag(e)){var g=this.working.source,m=this.working.name,v=this.working.arguments,y=this.working.index,b=e.nextMatch;switch(m){case r:++c;break;case n:case a:--c;break;default:if(1===c&&i)for(var w=0,k=i.length;w<k;++w)m===i[w]&&(o.push({source:d,name:h,arguments:f,args:this.createArgs(f,s||0===o.length&&u),contents:e.source.slice(p,y)}),d=g,h=m,f=v,p=b)}if(0===c){o.push({source:d,name:h,arguments:f,args:this.createArgs(f,s||0===o.length&&u),contents:e.source.slice(p,y)}),l=b;break}}else this.lookahead.lastIndex=e.nextMatch=e.matchStart+this.match.length;return-1!==l?(e.nextMatch=l,o):null},createArgs:function(e,t){var r=t?[]:this.parseArgs(e);return Object.defineProperties(r,{raw:{value:e},full:{value:Scripting.parse(e)}}),r},parseArgs:function(e){for(var t=new RegExp(this.argsPattern,"gm"),r=[],a=new RegExp("^"+Patterns.variable),n=void 0;null!==(n=t.exec(e));){var i=void 0;if(n[1])i=undefined;else if(n[2]){i=n[2];try{i=Scripting.evalTwineScript(i)}catch(e){throw new Error('unable to parse macro argument "'+i+'": '+e.message)}}else if(n[3])i="";else if(n[4]){i=n[4];try{i=Scripting.evalJavaScript(i)}catch(e){throw new Error("unable to parse macro argument '"+i+"': "+e.message)}}else if(n[5]){i=n[5];try{i=Scripting.evalJavaScript(i)}catch(e){throw new Error('unable to parse macro argument "'+i+'": '+e.message)}}else if(n[6]){i=n[6];var o=Wikifier.helpers.parseSquareBracketedMarkup({source:i,matchStart:0});if(o.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'+i+'": '+o.error);if(o.pos<i.length)throw new Error('unable to parse macro argument "'+i+'": unexpected character(s) "'+i.slice(o.pos)+'" (pos: '+o.pos+")");o.isLink?(i={isLink:!0},i.count=o.hasOwnProperty("text")?2:1,i.link=Wikifier.helpers.evalPassageId(o.link),i.text=o.hasOwnProperty("text")?Wikifier.helpers.evalText(o.text):i.link,i.external=!o.forceInternal&&Wikifier.isExternalLink(i.link),i.setFn=o.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(o.setter)):null):o.isImage&&(i=function(e){var t={source:e,isImage:!0};if("data:"!==e.slice(0,5)&&Story.has(e)){var r=Story.get(e);r.tags.includes("Twine.image")&&(t.source=r.text,t.passage=r.title)}return t}(Wikifier.helpers.evalPassageId(o.source)),o.hasOwnProperty("align")&&(i.align=o.align),o.hasOwnProperty("title")&&(i.title=Wikifier.helpers.evalText(o.title)),o.hasOwnProperty("link")&&(i.link=Wikifier.helpers.evalPassageId(o.link),i.external=!o.forceInternal&&Wikifier.isExternalLink(i.link)),i.setFn=o.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(o.setter)):null)}else if(n[7])if(i=n[7],a.test(i))i=State.getVar(i);else if(/^(?:settings|setup)[.[]/.test(i))try{i=Scripting.evalTwineScript(i)}catch(e){throw new Error('unable to parse macro argument "'+i+'": '+e.message)}else if("null"===i)i=null;else if("undefined"===i)i=undefined;else if("true"===i)i=!0;else if("false"===i)i=!1;else{var s=Number(i);Number.isNaN(s)||(i=s)}else if(n[8]){var u=void 0;switch(n[8]){case"`":u="backquote expression";break;case'"':u="double quoted string";break;case"'":u="single quoted string"}
throw new Error("unterminated "+u+" in macro argument string")}r.push(i)}return r}}),Wikifier.Parser.add({name:"prettyLink",profiles:["core"],match:"\\[\\[[^[]",handler:function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup(e);if(t.hasOwnProperty("error"))return void e.outputText(e.output,e.matchStart,e.nextMatch);e.nextMatch=t.pos;var r=Wikifier.helpers.evalPassageId(t.link),a=t.hasOwnProperty("text")?Wikifier.helpers.evalText(t.text):r,n=t.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(t.setter)):null,i=(Config.debug?new DebugView(e.output,"wiki-link","[[link]]",e.source.slice(e.matchStart,e.nextMatch)):e).output;t.forceInternal||!Wikifier.isExternalLink(r)?Wikifier.createInternalLink(i,r,a,n):Wikifier.createExternalLink(i,r,a)}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(e){e.outputText(Wikifier.createExternalLink(e.output,e.matchText),e.matchStart,e.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup(e);if(t.hasOwnProperty("error"))return void e.outputText(e.output,e.matchStart,e.nextMatch);e.nextMatch=t.pos;var r=void 0;Config.debug&&(r=new DebugView(e.output,"wiki-image",t.hasOwnProperty("link")?"[img[][link]]":"[img[]]",e.source.slice(e.matchStart,e.nextMatch)),r.modes({block:!0}));var a=t.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(t.setter)):null,n=(Config.debug?r:e).output,i=void 0;if(t.hasOwnProperty("link")){var o=Wikifier.helpers.evalPassageId(t.link);n=t.forceInternal||!Wikifier.isExternalLink(o)?Wikifier.createInternalLink(n,o,null,a):Wikifier.createExternalLink(n,o),n.classList.add("link-image")}if(n=jQuery(document.createElement("img")).appendTo(n).get(0),i=Wikifier.helpers.evalPassageId(t.source),"data:"!==i.slice(0,5)&&Story.has(i)){var s=Story.get(i);s.tags.includes("Twine.image")&&(n.setAttribute("data-passage",s.title),i=s.text)}n.src=i,t.hasOwnProperty("title")&&(n.title=Wikifier.helpers.evalText(t.title)),t.hasOwnProperty("align")&&(n.align=t.align)}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);if(t&&t.index===e.matchStart){var r=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(t[1]).appendTo(r),r.appendTo(e.output),e.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(e){switch(e.matchText){case"''":e.subWikify(jQuery(document.createElement("strong")).appendTo(e.output).get(0),"''");break;case"//":e.subWikify(jQuery(document.createElement("em")).appendTo(e.output).get(0),"//");break;case"__":e.subWikify(jQuery(document.createElement("u")).appendTo(e.output).get(0),"__");break;case"^^":e.subWikify(jQuery(document.createElement("sup")).appendTo(e.output).get(0),"\\^\\^");break;case"~~":e.subWikify(jQuery(document.createElement("sub")).appendTo(e.output).get(0),"~~");break;case"==":e.subWikify(jQuery(document.createElement("s")).appendTo(e.output).get(0),"==");break;case"{{{":var t=/\{\{\{((?:.|\n)*?)\}\}\}/gm;t.lastIndex=e.matchStart;var r=t.exec(e.source);r&&r.index===e.matchStart&&(jQuery(document.createElement("code")).text(r[1]).appendTo(e.output),e.nextMatch=t.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRegExp:/\s*\n/gm,handler:function(e){var t=Wikifier.helpers.inlineCss(e);this.blockRegExp.lastIndex=e.nextMatch;var r=this.blockRegExp.exec(e.source),a=r&&r.index===e.nextMatch,n=jQuery(document.createElement(a?"div":"span")).appendTo(e.output);0===t.classes.length&&""===t.id&&0===Object.keys(t.styles).length?n.addClass("marked"):(t.classes.forEach(function(e){return n.addClass(e)}),""!==t.id&&n.attr("id",t.id),n.css(t.styles)),a?(e.nextMatch+=r[0].length,e.subWikify(n[0],"\\n?"+this.terminator)):e.subWikify(n[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(t[1]||t[2]).appendTo(e.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(e){jQuery(document.createElement("hr")).appendTo(e.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(e){jQuery(document.createTextNode("—")).appendTo(e.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(e){jQuery(document.createTextNode("$")).appendTo(e.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:Patterns.variable+"(?:(?:\\."+Patterns.identifier+")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\["+Patterns.variable+"\\]))*",handler:function(e){var t=toStringOrDefault(State.getVar(e.matchText),null);null===t?jQuery(document.createTextNode(e.matchText)).appendTo(e.output):new Wikifier((Config.debug?new DebugView(e.output,"variable",e.matchText,e.matchText):e).output,t)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.subWikify(jQuery(document.createElement("h"+e.matchLength)).appendTo(e.output).get(0),this.terminator)}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));var t=jQuery(document.createElement("table")).appendTo(e.output).get(0),r=[],a=null,n=null,i=0,o=void 0;e.nextMatch=e.matchStart;do{this.lookahead.lastIndex=e.nextMatch;var s=this.lookahead.exec(e.source);if(o=s&&s.index===e.nextMatch){var u=s[2];"k"===u?(t.className=s[1],e.nextMatch+=s[0].length+1):(u!==a&&(a=u,n=jQuery(document.createElement(this.rowTypes[u])).appendTo(t)),"c"===a?(n.css("caption-side",0===i?"top":"bottom"),e.nextMatch+=1,e.subWikify(n[0],this.rowTerminator)):this.rowHandler(e,jQuery(document.createElement("tr")).appendTo(n).get(0),r),++i)}}while(o)},rowHandler:function(e,t,r){var a=this,n=new RegExp(this.cellPattern,"gm"),i=0,o=1,s=void 0;do{n.lastIndex=e.nextMatch;var u=n.exec(e.source);if(s=u&&u.index===e.nextMatch){if("~"===u[1]){var l=r[i];l&&(++l.rowCount,l.$element.attr("rowspan",l.rowCount).css("vertical-align","middle")),e.nextMatch=u.index+u[0].length-1}else if(">"===u[1])++o,e.nextMatch=u.index+u[0].length-1;else{if(u[2]){e.nextMatch=u.index+u[0].length;break}!function(){++e.nextMatch;for(var n=Wikifier.helpers.inlineCss(e),s=!1,u=!1,l=void 0;" "===e.source.substr(e.nextMatch,1);)s=!0,++e.nextMatch;"!"===e.source.substr(e.nextMatch,1)?(l=jQuery(document.createElement("th")).appendTo(t),++e.nextMatch):l=jQuery(document.createElement("td")).appendTo(t),r[i]={rowCount:1,$element:l},o>1&&(l.attr("colspan",o),o=1),e.subWikify(l[0],a.cellTerminator)," "===e.matchText.substr(e.matchText.length-2,1)&&(u=!0),n.classes.forEach(function(e){return l.addClass(e)}),""!==n.id&&l.attr("id",n.id),s&&u?n.styles["text-align"]="center":s?n.styles["text-align"]="right":u&&(n.styles["text-align"]="left"),l.css(n.styles),e.nextMatch=e.nextMatch-1}()}++i}}while(s)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.nextMatch=e.matchStart;var t=[e.output],r=null,a=0,n=void 0,i=void 0;do{this.lookahead.lastIndex=e.nextMatch;var o=this.lookahead.exec(e.source);if(n=o&&o.index===e.nextMatch){var s=o[2]?"ol":"ul",u=o[0].length;if(e.nextMatch+=o[0].length,u>a)for(i=a;i<u;++i)t.push(jQuery(document.createElement(s)).appendTo(t[t.length-1]).get(0));else if(u<a)for(i=a;i>u;--i)t.pop();else u===a&&s!==r&&(t.pop(),t.push(jQuery(document.createElement(s)).appendTo(t[t.length-1]).get(0)));a=u,r=s,e.subWikify(jQuery(document.createElement("li")).appendTo(t[t.length-1]).get(0),this.terminator)}}while(n)}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\"+Patterns.spaceNoTerminator+"*(?:\\n|$)|(?:^|\\n)"+Patterns.spaceNoTerminator+"*\\\\",handler:function(e){e.nextMatch=e.matchStart+e.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(e){e.options.nobr||jQuery(document.createElement("br")).appendTo(e.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(e){jQuery(document.createDocumentFragment()).append(e.matchText).appendTo(e.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(e){e.nextMatch=e.matchStart+e.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:e}),Wikifier.Parser.add({name:"verbatimSvgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/(<[Ss][Vv][Gg][^>]*>(?:.|\n)*?<\/[Ss][Vv][Gg]>)/gm,handler:e}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:e}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);if(t&&t.index===e.matchStart){e.nextMatch=this.lookahead.lastIndex;var r=t[2];this.hasImageMarkup.test(r)&&(this.imageMarkup.lastIndex=0,r=r.replace(this.imageMarkup,function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup({source:e,matchStart:0});if(t.hasOwnProperty("error")||t.pos<e.length)return e;var r=t.source;if("data:"!==r.slice(0,5)&&Story.has(r)){var a=Story.get(r);a.tags.includes("Twine.image")&&(r=a.text)}return'url("'+r.replace(/"/g,"%22")+'")'})),jQuery(document.createDocumentFragment()).append(t[1]+r+t[3]).appendTo(e.output)}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<\\w+(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>",tagPattern:"<(\\w+)",mediaElements:["audio","img","source","track","video"],nobrElements:["audio","colgroup","datalist","dl","figure","ol","optgroup","picture","select","table","tbody","tfoot","thead","tr","ul","video"],voidElements:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(e){var t=new RegExp(this.tagPattern).exec(e.matchText),r=t&&t[1],a=r&&r.toLowerCase();if(a){var n=this.voidElements.includes(a)||e.matchText.endsWith("/>"),i=this.nobrElements.includes(a),o=void 0,s=void 0;if(!n){o="<\\/"+a+"\\s*>";var u=new RegExp(o,"gim");u.lastIndex=e.matchStart,s=u.exec(e.source)}if(!n&&!s)return throwError(e.output,"cannot find a closing tag for HTML <"+r+">",e.matchText+"…");var l=e.output,c=document.createElement(e.output.tagName),d=void 0;for(c.innerHTML=e.matchText;c.firstChild;)c=c.firstChild;try{this.processAttributeDirectives(c)}catch(t){return throwError(e.output,"<"+a+">: "+t.message,e.matchText+"…")}c.hasAttribute("data-passage")&&(this.processDataAttributes(c,a),Config.debug&&(d=new DebugView(e.output,"html-"+a,a,e.matchText),d.modes({block:"img"===a,nonvoid:s}),l=d.output)),s&&(e.subWikify(c,o,{ignoreTerminatorCase:!0,nobr:i}),d&&jQuery(c).find(".debug.block").length>0&&d.modes({block:!0})),l.appendChild("track"===a?c.cloneNode(!0):c)}},processAttributeDirectives:function(e){[].concat(_toConsumableArray(e.attributes)).forEach(function(t){var r=t.name,a=t.value,n="@"===r[0];if(n||r.startsWith("sc-eval:")){var i=r.slice(n?1:8),o=void 0;try{o=Scripting.evalTwineScript(a)}catch(e){throw new Error('bad evaluation from attribute directive "'+r+'": '+e.message)}try{e.setAttribute(i,o),e.removeAttribute(r)}catch(e){throw new Error('cannot transform attribute directive "'+r+'" into attribute "'+i+'"')}}})},processDataAttributes:function(e,t){var r=e.getAttribute("data-passage");if(null!=r){var a=Wikifier.helpers.evalPassageId(r);if(a!==r&&(r=a,e.setAttribute("data-passage",a)),""!==r)if(this.mediaElements.includes(t)){if("data:"!==r.slice(0,5)&&Story.has(r)){r=Story.get(r);var n=void 0,i=void 0;switch(t){case"audio":case"video":i="Twine."+t;break;case"img":i="Twine.image";break;case"track":i="Twine.vtt";break;case"source":var o=$(e).closest("audio,picture,video");o.length&&(n=o.get(0).tagName.toLowerCase(),i="Twine."+("picture"===n?"image":n))}r.tags.includes(i)&&(e["picture"===n?"srcset":"src"]=r.text.trim())}}else{var s=e.getAttribute("data-setter"),u=void 0;null!=s&&""!==(s=String(s).trim())&&(u=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(s))),Story.has(r)?(e.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(r)&&e.classList.add("link-visited")):e.classList.add("link-broken"),jQuery(e).ariaClick({one:!0},function(){"function"==typeof u&&u.call(this),Engine.play(r)})}}}})}();var Macro=function(){function e(t,r,n){if(Array.isArray(t))return void t.forEach(function(t){return e(t,r,n)});if(!h.test(t))throw new Error('invalid macro name "'+t+'"');if(a(t))throw new Error("cannot clobber existing macro <<"+t+">>");if(u(t))throw new Error("cannot clobber child tag <<"+t+">> of parent macro"+(1===d[t].length?"":"s")+" <<"+d[t].join(">>, <<")+">>");try{if("object"===(void 0===r?"undefined":_typeof(r)))c[t]=n?clone(r):r;else{if(!a(r))throw new Error("cannot create alias of nonexistent macro <<"+r+">>");c[t]=n?clone(c[r]):c[r]}Object.defineProperty(c,t,{writable:!1}),c[t]._MACRO_API=!0}catch(e){throw"TypeError"===e.name?new Error("cannot clobber protected macro <<"+t+">>"):new Error("unknown error when attempting to add macro <<"+t+">>: ["+e.name+"] "+e.message)}if(c[t].hasOwnProperty("tags"))if(null==c[t].tags)o(t);else{if(!Array.isArray(c[t].tags))throw new Error('bad value for "tags" property of macro <<'+t+">>");o(t,c[t].tags)}}function t(e){if(Array.isArray(e))return void e.forEach(function(e){return t(e)});if(a(e)){c[e].hasOwnProperty("tags")&&s(e);try{Object.defineProperty(c,e,{writable:!0}),delete c[e]}catch(t){throw new Error("unknown error removing macro <<"+e+">>: "+t.message)}}else if(u(e))throw new Error("cannot remove child tag <<"+e+">> of parent macro <<"+d[e]+">>")}function r(){return 0===Object.keys(c).length}function a(e){return c.hasOwnProperty(e)}function n(e){var t=null;return a(e)&&"function"==typeof c[e].handler?t=c[e]:macros.hasOwnProperty(e)&&"function"==typeof macros[e].handler&&(t=macros[e]),t}function i(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(c).forEach(function(t){"function"==typeof c[t][e]&&c[t][e](t)}),Object.keys(macros).forEach(function(t){"function"==typeof macros[t][e]&&macros[t][e](t)})}function o(e,t){if(!e)throw new Error("no parent specified");for(var r=["/"+e,"end"+e],n=[].concat(r,Array.isArray(t)?t:[]),i=0;i<n.length;++i){var o=n[i];if(a(o))throw new Error("cannot register tag for an existing macro");u(o)?d[o].includes(e)||(d[o].push(e),d[o].sort()):d[o]=[e]}}function s(e){if(!e)throw new Error("no parent specified");Object.keys(d).forEach(function(t){var r=d[t].indexOf(e);-1!==r&&(1===d[t].length?delete d[t]:d[t].splice(r,1))})}function u(e){return d.hasOwnProperty(e)}function l(e){return u(e)?d[e]:null}var c={},d={},h=new RegExp("^(?:"+Patterns.macroName+")$");return Object.freeze(Object.defineProperties({},{add:{value:e},delete:{value:t},isEmpty:{value:r},has:{value:a},get:{value:n},init:{value:i},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:o},unregister:{value:s},has:{value:u},get:{value:l}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){return function(){function e(t){_classCallCheck(this,e);var r=Object.assign({parent:null,macro:null,name:"",args:null,payload:null,parser:null,source:""},t);if(null===r.macro||""===r.name||null===r.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:r.macro},name:{value:r.name},args:{value:r.args},payload:{value:r.payload},source:{value:r.source},parent:{value:r.parent},parser:{value:r.parser},_output:{value:r.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(e,[{key:"contextHas",value:function(e){for(var t=this;null!==(t=t.parent);)if(e(t))return!0;return!1}},{key:"contextSelect",value:function(e){for(var t=this;null!==(t=t.parent);)if(e(t))return t;return null}},{key:"contextSelectAll",value:function(e){for(var t=[],r=this;null!==(r=r.parent);)e(r)&&t.push(r);return t}},{key:"addShadow",value:function(){var e=this;this._shadows||(this._shadows=new Set);for(var t=new RegExp("^"+Patterns.variable+"$"),r=arguments.length,a=Array(r),n=0;n<r;n++)a[n]=arguments[n];a.flatten().forEach(function(r){if("string"!=typeof r)throw new TypeError("variable name must be a string; type: "+(void 0===r?"undefined":_typeof(r)));if(!t.test(r))throw new Error('invalid variable name "'+r+'"');e._shadows.add(r)})}},{key:"createShadowWrapper",value:function(e,t,r){var a=this,n=void 0;return"function"==typeof e&&(n={},this.shadowView.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;n[e]=r[t]})),function(){for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];if("function"==typeof r&&r.apply(this,o),"function"==typeof e){var u=Object.keys(n),l=u.length>0?{}:null,c=Wikifier.Parser.get("macro"),d=void 0;try{u.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;r.hasOwnProperty(t)&&(l[t]=r[t]),r[t]=n[e]}),d=c.context,c.context=a,e.apply(this,o)}finally{d!==undefined&&(c.context=d),u.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;n[e]=r[t],l.hasOwnProperty(t)?r[t]=l[t]:delete r[t]})}}"function"==typeof t&&t.apply(this,o)}}},{key:"createDebugView",value:function(e,t){return this._debugView=new DebugView(this._output,"macro",e||this.name,t||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(e,t){return throwError(this._output,"<<"+this.name+">>: "+e,t||this.source)}},{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return[].concat(_toConsumableArray(this._shadows))}},{key:"shadowView",get:function(){var e=new Set;return this.contextSelectAll(function(e){return e._shadows}).forEach(function(t){return t._shadows.forEach(function(t){return e.add(t)})}),[].concat(_toConsumableArray(e))}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}}]),e}()}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var e={};try{for(var t=new RegExp("("+Patterns.variable+")","g"),r=void 0;null!==(r=t.exec(this.args.raw));){var a=r[1],n=a.slice(1),i="$"===a[0]?State.variables:State.temporary;i.hasOwnProperty(n)&&(e[n]=i[n]),this.addShadow(a)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach(function(t){var r=t.slice(1),a="$"===t[0]?State.variables:State.temporary;e.hasOwnProperty(r)?a[r]=e[r]:delete a[r]})}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var e=new RegExp("State\\.(variables|temporary)\\.("+Patterns.identifier+")","g"),t=void 0;null!==(t=e.exec(this.args.full));){var r=State[t[1]],a=t[2];r.hasOwnProperty(a)&&delete r[a]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}for(var e=storage.get("remember")||{},t=new RegExp("State\\.variables\\.("+Patterns.identifier+")","g"),r=void 0;null!==(r=t.exec(this.args.full));){var a=r[1];e[a]=State.variables[a]}if(!storage.set("remember",e))return this.error("unknown error, cannot remember: "+this.args.raw);Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var e=storage.get("remember");e&&Object.keys(e).forEach(function(t){return State.variables[t]=e[t]})}}),Macro.add("forget",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var e=storage.get("remember"),t=new RegExp("State\\.variables\\.("+Patterns.identifier+")","g"),r=void 0,a=!1;null!==(r=t.exec(this.args.full));){var n=r[1];State.variables.hasOwnProperty(n)&&delete State.variables[n],e&&e.hasOwnProperty(n)&&(a=!0,delete e[n])}if(a&&!storage.set("remember",e))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var e=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,e),Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>")}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e),this.source+this.payload[0].contents+"<</"+this.name+">>")}e.hasChildNodes()&&this.output.appendChild(e)}}),Macro.add("include",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=void 0;if(e="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],!Story.has(e))return this.error('passage "'+e+'" does not exist');Config.debug&&this.debugView.modes({block:!0}),e=Story.get(e);var t=void 0;t=this.args[1]?jQuery(document.createElement(this.args[1])).addClass(e.domId+" macro-"+this.name).attr("data-passage",e.title).appendTo(this.output):jQuery(this.output),t.wiki(e.processText())}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var e=toStringOrDefault(Scripting.evalJavaScript(this.args.full),null);null!==e&&new Wikifier(this.output,"-"===this.name?Util.escape(e):e)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var e=document.createDocumentFragment();if(new Wikifier(e,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({hidden:!0}),this.output.appendChild(e);else{var t=[].concat(_toConsumableArray(e.querySelectorAll(".error"))).map(function(e){return e.textContent});if(t.length>0)return this.error("error"+(1===t.length?"":"s")+" within contents ("+t.join("; ")+")",this.source+this.payload[0].contents+"<</"+this.name+">>")}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],handler:function(){var e=void 0;try{var t=this.payload.length;for(e=0;e<t;++e)switch(this.payload[e].name){case"else":if(this.payload[e].args.raw.length>0)return/^\s*if\b/i.test(this.payload[e].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'+(e>0?" (#"+e+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: "+this.payload[e].args.raw);if(e+1!==t)return this.error("<<else>> must be the final clause");break;default:if(0===this.payload[e].args.full.length)return this.error("no conditional expression specified for <<"+this.payload[e].name+">> clause"+(e>0?" (#"+e+")":""));if(Config.macros.ifAssignmentError&&/[^!=&^|<>*\/%+-]=[^=]/.test(this.payload[e].args.full))return this.error("assignment operator found within <<"+this.payload[e].name+">> clause"+(e>0?" (#"+e+")":"")+" (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: "+this.payload[e].args.raw)}var r=Scripting.evalJavaScript,a=!1;for(e=0;e<t;++e){if(Config.debug&&this.createDebugView(this.payload[e].name,this.payload[e].source).modes({nonvoid:!1}),"else"===this.payload[e].name||r(this.payload[e].args.full)){a=!0,new Wikifier(this.output,this.payload[e].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++e;e<t;++e)this.createDebugView(this.payload[e].name,this.payload[e].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!a,invalid:!a})}}catch(t){return this.error("bad conditional expression in <<"+(0===e?"if":"elseif")+">> clause"+(e>0?" (#"+e+")":"")+": "+("object"===(void 0===t?"undefined":_typeof(t))?t.message:t))}}}),Macro.add("switch",{skipArg0:!0,tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var e=this.payload.length;if(1===e)return this.error("no cases specified");var t=void 0;for(t=1;t<e;++t)switch(this.payload[t].name){case"default":if(this.payload[t].args.length>0)return this.error("<<default>> does not accept values, invalid: "+this.payload[t].args.raw);if(t+1!==e)return this.error("<<default>> must be the final case");break;default:if(0===this.payload[t].args.length)return this.error("no value(s) specified for <<"+this.payload[t].name+">> (#"+t+")")}var r=void 0;try{r=Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}var a=this.debugView,n=!1;for(Config.debug&&a.modes({nonvoid:!1,hidden:!0}),t=1;t<e;++t){if(Config.debug&&this.createDebugView(this.payload[t].name,this.payload[t].source).modes({nonvoid:!1}),"default"===this.payload[t].name||this.payload[t].args.some(function(e){return e===r})){n=!0,new Wikifier(this.output,this.payload[t].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++t;t<e;++t)this.createDebugView(this.payload[t].name,this.payload[t].source).modes({nonvoid:!1,hidden:!0,invalid:!0});a.modes({nonvoid:!1,hidden:!0,invalid:!n}),this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0,invalid:!n})}}}),Macro.add("for",{skipArgs:!0,tags:null,_hasRangeRe:new RegExp("^\\S.*?\\s+range\\s+\\S.*?$"),_rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.("+Patterns.identifier+")\\s*,\\s*)?State\\.(variables|temporary)\\.("+Patterns.identifier+")\\s+range\\s+(\\S.*?)$"),_3PartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,handler:function(){var e=this.args.full.trim(),t=this.payload[0].contents.replace(/\n$/,"");if(0===e.length)this.self._handleFor.call(this,t,null,!0,null);else if(this.self._hasRangeRe.test(e)){var r=e.match(this.self._rangeRe);if(null===r)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self._handleForRange.call(this,t,{type:r[1],name:r[2]},{type:r[3],name:r[4]},r[5])}else{var a=void 0,n=void 0,i=void 0;if(-1===e.indexOf(";")){if(/^\S+\s+in\s+\S+/i.test(e))return this.error("invalid syntax, for…in is not supported; see: for…range");if(/^\S+\s+of\s+\S+/i.test(e))return this.error("invalid syntax, for…of is not supported; see: for…range");n=e}else{var o=e.match(this.self._3PartRe);if(null===o)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");a=o[1],n=o[2].trim(),i=o[3],0===n.length&&(n=!0)}this.self._handleFor.call(this,t,a,n,i)}},_handleFor:function(e,t,r,a){var n=Scripting.evalJavaScript,i=!0,o=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,t)try{n(t)}catch(e){return this.error("bad init expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}for(;n(r);){if(--o<0)return this.error("exceeded configured maximum loop iterations ("+Config.macros.maxLoopIterations+")");if(new Wikifier(this.output,i?e.replace(/^\n/,""):e),i&&(i=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(a)try{n(a)}catch(e){return this.error("bad post expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}}}catch(e){return this.error("bad conditional expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}finally{TempState.break=null}},_handleForRange:function(e,t,r,a){var n=!0,i=void 0;try{i=this.self._toRangeList(a)}catch(e){return this.error(e.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var o=0;o<i.length;++o)if(t.name&&(State[t.type][t.name]=i[o][0]),State[r.type][r.name]=i[o][1],new Wikifier(this.output,n?e.replace(/^\n/,""):e),n&&(n=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(e){return this.error("object"===(void 0===e?"undefined":_typeof(e))?e.message:e)}finally{TempState.break=null}},_toRangeList:function(e){var t=Scripting.evalJavaScript,r=void 0;try{r=t("{"===e[0]?"("+e+")":e)}catch(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("bad range expression: "+e);throw e.message="bad range expression: "+e.message,e}var a=void 0;switch(void 0===r?"undefined":_typeof(r)){case"string":a=[];for(var n=0;n<r.length;){var i=Util.charAndPosAt(r,n);a.push([n,i.char]),n=1+i.end}break;case"object":
if(Array.isArray(r))a=r.map(function(e,t){return[t,e]});else if(r instanceof Set)a=[].concat(_toConsumableArray(r)).map(function(e,t){return[t,e]});else if(r instanceof Map)a=[].concat(_toConsumableArray(r.entries()));else{if("Object"!==Util.toStringTag(r))throw new Error("unsupported range expression type: "+Util.toStringTag(r));a=Object.keys(r).map(function(e){return[e,r[e]]})}break;default:throw new Error("unsupported range expression type: "+(void 0===r?"undefined":_typeof(r)))}return a}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas(function(e){return"for"===e.name}))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no "+("button"===this.name?"button":"link")+" text specified");Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>");var t=jQuery(document.createElement("button"===this.name?"button":"a")),r=void 0;if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var a=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo(t);this.args[0].hasOwnProperty("passage")&&a.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&a.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&a.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(r=this.args[0].link),r=this.args[0].link}else t.append(document.createTextNode(this.args[0].text)),r=this.args[0].link;else t.wikiWithOptions({profile:"core"},this.args[0]),r=this.args.length>1?this.args[1]:undefined;null!=r?(t.attr("data-passage",r),Story.has(r)?(t.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(r)&&t.addClass("link-visited")):t.addClass("link-broken")):t.addClass("link-internal"),t.addClass("macro-"+this.name).ariaClick({namespace:".macros",one:null!=r},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(e.payload[0].contents.trim())}:null,null!=r?function(){return Engine.play(r)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{handler:function(){if(this.args.length<3){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("unchecked value"),this.args.length<3&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),a=this.args[1],n=this.args[2],i=document.createElement("input");jQuery(i).attr({id:this.name+"-"+r,name:this.name+"-"+r,type:"checkbox",tabindex:0}).addClass("macro-"+this.name).on("change",function(){State.setVar(t,this.checked?n:a)}).appendTo(this.output),this.args.length>3&&"checked"===this.args[3]?(i.checked=!0,State.setVar(t,n)):State.setVar(t,a)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no link text specified");Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>");var t=jQuery(document.createElement("a")),r=jQuery(document.createElement("span")),a=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]);t.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-"+this.name).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper(function(){if("linkreplace"===e.name?t.remove():t.wrap('<span class="macro-'+e.name+'"></span>').replaceWith(function(){return t.html()}),""!==e.payload[0].contents){var n=document.createDocumentFragment();new Wikifier(n,e.payload[0].contents),r.append(n)}a&&setTimeout(function(){return r.removeClass("macro-"+e.name+"-in")},Engine.minDomActionDelay)})).appendTo(this.output),r.addClass("macro-"+this.name+"-insert"),a&&r.addClass("macro-"+this.name+"-in"),"linkprepend"===this.name?r.insertBefore(t):r.insertAfter(t)}}),Macro.add("radiobutton",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),a=this.args[1],n=document.createElement("input");TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(r)||(TempState[this.name][r]=0),jQuery(n).attr({id:this.name+"-"+r+"-"+TempState[this.name][r]++,name:this.name+"-"+r,type:"radio",tabindex:0}).addClass("macro-"+this.name).on("change",function(){this.checked&&State.setVar(t,a)}).appendTo(this.output),this.args.length>2&&"checked"===this.args[2]&&(n.checked=!0,State.setVar(t,a))}}),Macro.add("textarea",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Config.debug&&this.debugView.modes({block:!0});var r=Util.slugify(t),a=this.args[1],n="autofocus"===this.args[2],i=document.createElement("textarea");jQuery(i).attr({id:this.name+"-"+r,name:this.name+"-"+r,rows:4,tabindex:0}).addClass("macro-"+this.name).on("change",function(){State.setVar(t,this.value)}).appendTo(this.output),State.setVar(t,a),i.textContent=a,n&&(i.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:"+i.id]=function(e){delete postdisplay[e],setTimeout(function(){return i.focus()},Engine.minDomActionDelay)})}}),Macro.add("textbox",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Config.debug&&this.debugView.modes({block:!0});var r=Util.slugify(t),a=this.args[1],n=document.createElement("input"),i=!1,o=void 0;this.args.length>3?(o=this.args[2],i="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?i=!0:o=this.args[2]),"object"===(void 0===o?"undefined":_typeof(o))&&(o=o.link),jQuery(n).attr({id:this.name+"-"+r,name:this.name+"-"+r,type:"text",tabindex:0}).addClass("macro-"+this.name).on("change",function(){State.setVar(t,this.value)}).on("keypress",function(e){13===e.which&&(e.preventDefault(),State.setVar(t,this.value),null!=o&&Engine.play(o))}).appendTo(this.output),State.setVar(t,a),n.value=a,i&&(n.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:"+n.id]=function(e){delete postdisplay[e],setTimeout(function(){return n.focus()},Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var e=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),t=0;t<this.args.length;++t){var r=void 0,a=void 0,n=void 0,i=void 0;"object"===_typeof(this.args[t])?this.args[t].isImage?(n=jQuery(document.createElement("img")).attr("src",this.args[t].source),this.args[t].hasOwnProperty("passage")&&n.attr("data-passage",this.args[t].passage),this.args[t].hasOwnProperty("title")&&n.attr("title",this.args[t].title),this.args[t].hasOwnProperty("align")&&n.attr("align",this.args[t].align),r=this.args[t].link,i=this.args[t].setFn):(a=this.args[t].text,r=this.args[t].link,i=this.args[t].setFn):a=r=this.args[t],State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(r)&&State.variables["#actions"][r]||jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo(e),r,null,function(e,t){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][e]=!0,"function"==typeof t&&t()}}(r,i))).addClass("macro-"+this.name).append(n||document.createTextNode(a))}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var e=-1,t=void 0,r=void 0,a=void 0;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?(a=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&a.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&a.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&a.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(t=this.args[0].link)):1===this.args[0].count?t=this.args[0].link:(r=this.args[0].text,t=this.args[0].link):1===this.args.length&&(r=this.args[0])),null==t){for(var n=State.length-2;n>=0;--n)if(State.history[n].title!==State.passage){e=n,t=State.history[n].title;break}if(null==t&&"return"===this.name)for(var i=State.expired.length-1;i>=0;--i)if(State.expired[i]!==State.passage){t=State.expired[i];break}}else{if(!Story.has(t))return this.error('passage "'+t+'" does not exist');if("back"===this.name){for(var o=State.length-2;o>=0;--o)if(State.history[o].title===t){e=o;break}if(-1===e)return this.error('cannot find passage "'+t+'" in the current story history')}}if(null==t)return this.error("cannot find passage");var s=void 0;s="back"!==this.name||-1!==e?jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(t)}:function(){return Engine.goTo(e)}):jQuery(document.createElement("span")).addClass("link-disabled"),s.addClass("macro-"+this.name).append(a||document.createTextNode(r||L10n.get("macro"+this.name.toUpperFirst()+"Text"))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=State.passage,t=void 0,r=void 0,a=void 0,n=void 0;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?(a=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&a.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&a.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&a.attr("align",this.args[0].align),t=this.args[0].link,n=this.args[0].setFn):(r=this.args[0].text,t=this.args[0].link,n=this.args[0].setFn):r=t=this.args[0]:(t=this.args[0],r=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(e)&&State.variables["#choice"][e])return void jQuery(document.createElement("span")).addClass("link-disabled macro-"+this.name).attr("tabindex",-1).append(a||document.createTextNode(r)).appendTo(this.output);jQuery(Wikifier.createInternalLink(this.output,t,null,function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][e]=!0,"function"==typeof n&&n()})).addClass("macro-"+this.name).append(a||document.createTextNode(r))}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("selector"),this.args.length<2&&e.push("class names"),this.error("no "+e.join(" or ")+" specified")}var t=jQuery(this.args[0]);if(0===t.length)return this.error('no elements matched the selector "'+this.args[0]+'"');switch(this.name){case"addclass":t.addClass(this.args[1].trim());break;case"toggleclass":t.toggleClass(this.args[1].trim())}}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');this.args.length>1?e.removeClass(this.args[1].trim()):e.removeClass()}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');jQuery(this.output).append(e.html())}}),Macro.add(["append","prepend","replace"],{tags:null,handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');if(""!==this.payload[0].contents){var t=document.createDocumentFragment();switch(new Wikifier(t,this.payload[0].contents),this.name){case"replace":e.empty();case"append":e.append(t);break;case"prepend":e.prepend(t)}}else"replace"===this.name&&e.empty()}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');e.remove()}}),Has.audio){var e=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]);Macro.add("audio",{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("track or group IDs"),this.args.length<2&&e.push("actions"),this.error("no "+e.join(" or ")+" specified")}var t=Macro.get("cacheaudio").tracks,r=[];try{var a=function e(r){var a=r.id,o=void 0;switch(a){case":all":o=n;break;case":looped":o=n.filter(function(e){return t[e].isLooped()});break;case":muted":o=n.filter(function(e){return t[e].isMuted()});break;case":paused":o=n.filter(function(e){return t[e].isPaused()});break;case":playing":o=n.filter(function(e){return t[e].isPlaying()});break;default:o=":"===a[0]?i[a]:[a]}if(r.hasOwnProperty("not")){var s=r.not.map(function(t){return e(t)}).flatten();o=o.filter(function(e){return!s.includes(e)})}return o},n=Object.freeze(Object.keys(t)),i=Macro.get("cacheaudio").groups;this.self.parseIds(String(this.args[0]).trim()).forEach(function(e){r.push.apply(r,_toConsumableArray(a(e)))}),r.forEach(function(e){if(!t.hasOwnProperty(e))throw new Error('track "'+e+'" does not exist')})}catch(e){return this.error(e.message)}for(var o=this.args.slice(1),s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,h=void 0,f=5,p=void 0,g=void 0;o.length>0;){var m=o.shift();switch(m){case"play":case"pause":case"stop":s=m;break;case"fadein":s="fade",h=1;break;case"fadeout":s="fade",h=0;break;case"fadeto":if(0===o.length)return this.error("fadeto missing required level value");if(s="fade",g=o.shift(),h=Number.parseFloat(g),Number.isNaN(h)||!Number.isFinite(h))return this.error("cannot parse fadeto: "+g);break;case"fadeoverto":if(o.length<2){var v=[];return o.length<1&&v.push("seconds"),o.length<2&&v.push("level"),this.error("fadeoverto missing required "+v.join(" and ")+" value"+(v.length>1?"s":""))}if(s="fade",g=o.shift(),f=Number.parseFloat(g),Number.isNaN(f)||!Number.isFinite(f))return this.error("cannot parse fadeoverto: "+g);if(g=o.shift(),h=Number.parseFloat(g),Number.isNaN(h)||!Number.isFinite(h))return this.error("cannot parse fadeoverto: "+g);break;case"volume":if(0===o.length)return this.error("volume missing required level value");if(g=o.shift(),u=Number.parseFloat(g),Number.isNaN(u)||!Number.isFinite(u))return this.error("cannot parse volume: "+g);break;case"mute":case"unmute":l="mute"===m;break;case"time":if(0===o.length)return this.error("time missing required seconds value");if(g=o.shift(),c=Number.parseFloat(g),Number.isNaN(c)||!Number.isFinite(c))return this.error("cannot parse time: "+g);break;case"loop":case"unloop":d="loop"===m;break;case"goto":if(0===o.length)return this.error("goto missing required passage title");if(g=o.shift(),p="object"===(void 0===g?"undefined":_typeof(g))?g.link:g,!Story.has(p))return this.error('passage "'+p+'" does not exist');break;default:return this.error("unknown action: "+m)}}try{r.forEach(function(e){var r=t[e];switch(null!=u&&(r.volume=u),null!=c&&(r.time=c),null!=l&&(r.mute=l),null!=d&&(r.loop=d),null!=p&&r.one("end",function(){return Engine.play(p)}),s){case"play":r.play();break;case"pause":r.pause();break;case"stop":r.stop();break;case"fade":r.fadeWithDuration(f,h)}}),Config.debug&&this.createDebugView()}catch(e){return this.error("error executing audio action: "+e.message)}},parseIds:function(e){for(var t=[],r=/:?[^\s:()]+/g,a=void 0;null!==(a=r.exec(e));){var n=a[0];if(":not"===n){if(0===t.length)throw new Error('invalid negation: no group ID preceded ":not()"');var i=t[t.length-1];if(":"!==i.id[0])throw new Error('invalid negation of track "'+i.id+'": only groups may be negated with ":not()"');var o=function(e,t){var r=/\S/g,a=/[()]/g,n=void 0;if(r.lastIndex=t,null===(n=r.exec(e))||"("!==n[0])throw new Error('invalid ":not()" syntax: missing parentheticals');a.lastIndex=r.lastIndex;for(var i=r.lastIndex,o={str:"",nextMatch:-1},s=1;null!==(n=a.exec(e));)if("("===n[0]?++s:--s,s<1){o.nextMatch=a.lastIndex,o.str=e.slice(i,o.nextMatch-1);break}return o}(e,r.lastIndex);if(-1===o.nextMatch)throw new Error('unknown error parsing ":not()"');r.lastIndex=o.nextMatch,i.not=this.parseIds(o.str)}else t.push({id:n})}return t}}),Macro.add("cacheaudio",{tracks:{},groups:{},handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("track ID"),this.args.length<2&&e.push("sources"),this.error("no "+e.join(" or ")+" specified")}var t=String(this.args[0]).trim();if(/^:|\s/.test(t))return this.error('invalid track ID "'+t+'": track IDs may not start with a colon or contain whitespace');var r=/^format:\s*([\w-]+)\s*;\s*(\S.*)$/i,a=void 0;try{a=SimpleAudio.create(this.args.slice(1).map(function(e){if("data:"!==e.slice(0,5)&&Story.has(e)){var t=Story.get(e);if(t.tags.includes("Twine.audio"))return t.text.trim()}var a=r.exec(e);return null===a?e:{format:a[1],src:a[2]}}))}catch(e){return this.error('error during track initialization for "'+t+'": '+e.message)}if(Config.debug&&!a.hasSource())return this.error('no supported audio sources found for "'+t+'"');var n=this.self.tracks;n.hasOwnProperty(t)&&n[t].destroy(),n[t]=a,Config.debug&&this.createDebugView()}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");var t=String(this.args[0]).trim();if(/^[^:]|\s/.test(t))return this.error('invalid group ID "'+t+'": group IDs must start with a colon and may not contain whitespace');if(e.includes(t))return this.error('cannot clobber special group ID "'+t+'"');if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var r=Macro.get("cacheaudio").tracks,a=[],n=1,i=this.payload.length;n<i;++n){if(this.payload[n].args.length<1)return this.error("no track ID specified");var o=String(this.payload[n].args[0]).trim();if(!r.hasOwnProperty(o))return this.error('track "'+o+'" does not exist');a.push(o),Config.debug&&this.createDebugView(this.payload[n].name,this.payload[n].source).modes({nonvoid:!1,hidden:!0})}var s=Macro.get("cacheaudio").groups;s.hasOwnProperty(t)&&delete s[t],s[t]=a,this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],lists:{},handler:function(){if(0===this.args.length)return this.error("no list ID specified");var e=Macro.get("playlist");if(null!==e.from&&"createplaylist"!==e.from)return this.error("a playlist has already been defined with <<setplaylist>>");var t=Macro.get("cacheaudio").tracks,r=String(this.args[0]).trim();if(/^:|\s/.test(r))return this.error('invalid list ID "'+r+'": list IDs may not start with a colon or contain whitespace');if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var a=SimpleAudio.createList(),n=1,i=this.payload.length;n<i;++n){if(this.payload[n].args.length<2){var o=[];return this.payload[n].args.length<1&&o.push("track ID"),this.payload[n].args.length<2&&o.push("actions"),this.error("no "+o.join(" or ")+" specified")}var s=String(this.payload[n].args[0]).trim();if(!t.hasOwnProperty(s))return this.error('track "'+s+'" does not exist');for(var u=this.payload[n].args.slice(1),l=!1,c=void 0;u.length>0;){var d=u.shift(),h=void 0;switch(d){case"copy":l=!0;break;case"rate":u.length>0&&u.shift();break;case"volume":if(0===u.length)return this.error("volume missing required level value");if(h=u.shift(),c=Number.parseFloat(h),Number.isNaN(c)||!Number.isFinite(c))return this.error("cannot parse volume: "+h);break;default:return this.error("unknown action: "+d)}}var f=t[s];a.add({copy:l,track:f,volume:null!=c?c:f.volume}),Config.debug&&this.createDebugView(this.payload[n].name,this.payload[n].source).modes({nonvoid:!1,hidden:!0})}var p=this.self.lists;p.hasOwnProperty(r)&&p[r].destroy(),p[r]=a,null===e.from&&(e.from="createplaylist"),this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var e=this.args.slice(0),t=!1,r=void 0,a=void 0;e.length>0;){var n=e.shift(),i=void 0;switch(n){case"stop":t=!0;break;case"mute":case"unmute":r="mute"===n;break;case"volume":if(0===e.length)return this.error("volume missing required level value");if(i=e.shift(),a=Number.parseFloat(i),Number.isNaN(a)||!Number.isFinite(a))return this.error("cannot parse volume: "+i);break;default:return this.error("unknown action: "+n)}}try{null!=r&&(SimpleAudio.mute=r),null!=a&&(SimpleAudio.volume=a),t&&SimpleAudio.stop(),Config.debug&&this.createDebugView()}catch(e){return this.error("error executing master audio action: "+e.message)}}}),Macro.add("playlist",{from:null,handler:function(){var e=this.self.from;if(null===e)return this.error("no playlists have been created");var t=void 0,r=void 0;if("createplaylist"===e){if(this.args.length<2){var a=[];return this.args.length<1&&a.push("list ID"),this.args.length<2&&a.push("actions"),this.error("no "+a.join(" or ")+" specified")}var n=Macro.get("createplaylist").lists,i=String(this.args[0]).trim();if(!n.hasOwnProperty(i))return this.error('playlist "'+i+'" does not exist');t=n[i],r=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");t=Macro.get("setplaylist").list,r=this.args.slice(0)}for(var o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,h=5,f=void 0;r.length>0;){var p=r.shift();switch(p){case"play":case"pause":case"stop":case"skip":o=p;break;case"fadein":o="fade",d=1;break;case"fadeout":o="fade",d=0;break;case"fadeto":if(0===r.length)return this.error("fadeto missing required level value");if(o="fade",f=r.shift(),d=Number.parseFloat(f),Number.isNaN(d)||!Number.isFinite(d))return this.error("cannot parse fadeto: "+f);break;case"fadeoverto":if(r.length<2){var g=[];return r.length<1&&g.push("seconds"),r.length<2&&g.push("level"),this.error("fadeoverto missing required "+g.join(" and ")+" value"+(g.length>1?"s":""))}if(o="fade",f=r.shift(),h=Number.parseFloat(f),Number.isNaN(h)||!Number.isFinite(h))return this.error("cannot parse fadeoverto: "+f);if(f=r.shift(),d=Number.parseFloat(f),Number.isNaN(d)||!Number.isFinite(d))return this.error("cannot parse fadeoverto: "+f);break;case"volume":if(0===r.length)return this.error("volume missing required level value");if(f=r.shift(),s=Number.parseFloat(f),Number.isNaN(s)||!Number.isFinite(s))return this.error("cannot parse volume: "+f);break;case"mute":case"unmute":u="mute"===p;break;case"loop":case"unloop":l="loop"===p;break;case"shuffle":case"unshuffle":c="shuffle"===p;break;default:return this.error("unknown action: "+p)}}try{switch(null!=s&&(t.volume=s),null!=u&&(t.mute=u),null!=l&&(t.loop=l),null!=c&&(t.shuffle=c),o){case"play":t.play();break;case"pause":t.pause();break;case"stop":t.stop();break;case"skip":t.skip();break;case"fade":t.fadeWithDuration(h,d)}Config.debug&&this.createDebugView()}catch(e){return this.error("error playing audio: "+e.message)}}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var e=Macro.get("createplaylist").lists,t=String(this.args[0]).trim();if(!e.hasOwnProperty(t))return this.error('playlist "'+t+'" does not exist');e[t].destroy(),delete e[t],Config.debug&&this.createDebugView()}}),Macro.add("waitforaudio",{skipArgs:!0,queue:[],handler:function(){function e(){if(0===t.length)return LoadScreen.unlock(r);var a=t.shift();if(a.hasData())return e();a.one("canplay.waitforaudio error.waitforaudio",function(){jQuery(this).off(".waitforaudio"),e()}).load()}var t=this.self.queue,r=void 0;t.length>0||(this.self.fillQueue(t),t.length>0&&(r=LoadScreen.lock(),e()))},fillQueue:function(e){var t=Macro.get("cacheaudio").tracks;Object.keys(t).forEach(function(r){return e.push(t[r])});var r=Macro.get("createplaylist").lists;if(Object.keys(r).map(function(e){return r[e].tracks}).flatten().filter(function(e){return e.copy}).forEach(function(t){return e.push(t.track)}),Macro.has("setplaylist")){var a=Macro.get("setplaylist").list;null!==a&&a.tracks.forEach(function(t){return e.push(t.track)})}}}),Macro.add("setplaylist",{list:null,handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var e=Macro.get("playlist");if(null!==e.from&&"setplaylist"!==e.from)return this.error("playlists have already been defined with <<createplaylist>>");var t=this.self,r=Macro.get("cacheaudio").tracks;null!==t.list&&t.list.destroy(),t.list=SimpleAudio.createList();for(var a=0;a<this.args.length;++a){var n=this.args[a];if(!r.hasOwnProperty(n))return this.error('track "'+n+'" does not exist');t.list.add(r[n])}null===e.from&&(e.from="setplaylist"),Config.debug&&this.createDebugView()}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){var e=Macro.get("cacheaudio").tracks;Object.keys(e).forEach(function(t){return e[t].stop()}),Config.debug&&this.createDebugView()}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){}});Macro.add("goto",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=void 0;if(e="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],!Story.has(e))return this.error('passage "'+e+'" does not exist');setTimeout(function(){return Engine.play(e)},Engine.minDomActionDelay)}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,handler:function(){var e=this;if(0===this.args.length)return this.error("no time value specified");var t=void 0;try{t=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(e){return this.error(e.message)}Config.debug&&this.debugView.modes({block:!0});var r=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),a=jQuery(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper(function(){var t=document.createDocumentFragment();new Wikifier(t,e.payload[0].contents);var n=a;r&&(n=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo(n)),n.append(t),r&&setTimeout(function(){return n.removeClass("macro-repeat-in")},Engine.minDomActionDelay)}),t)},registerInterval:function(e,t){var r=this;if("function"!=typeof e)throw new TypeError("callback parameter must be a function");var a=State.turns,n=this.timers,i=null;i=setInterval(function(){if(a!==State.turns)return clearInterval(i),void n.delete(i);var t=void 0;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(t=TempState.repeatTimerId),TempState.repeatTimerId=i,e.call(r)}finally{void 0!==t?TempState.repeatTimerId=t:delete TempState.repeatTimerId,TempState.break=null}},t),n.add(i),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(e){delete prehistory[e],n.forEach(function(e){return clearInterval(e)}),n.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var e=Macro.get("repeat").timers,t=TempState.repeatTimerId;clearInterval(t),e.delete(t),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var e=[];try{e.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(e){return this.error(e.message+" in <<timed>>")}if(this.payload.length>1){var t=void 0;try{var r=void 0;for(t=1,r=this.payload.length;t<r;++t)e.push({name:this.payload[t].name,source:this.payload[t].source,delay:0===this.payload[t].args.length?e[e.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[t].args[0])),content:this.payload[t].contents})}catch(e){return this.error(e.message+" in <<next>> (#"+t+")")}}Config.debug&&this.debugView.modes({block:!0});var a=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),n=jQuery(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper(function(e){var t=document.createDocumentFragment();new Wikifier(t,e.content);var r=n;Config.debug&&"next"===e.name&&(r=jQuery(new DebugView(r[0],"macro",e.name,e.source).output)),a&&(r=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo(r)),r.append(t),a&&setTimeout(function(){return r.removeClass("macro-timed-in")},Engine.minDomActionDelay)}),e)},registerTimeout:function(e,t){if("function"!=typeof e)throw new TypeError("callback parameter must be a function");var r=State.turns,a=this.timers,n=null,i=t.shift(),o=function o(){if(a.delete(n),r===State.turns){var s=i;null!=(i=t.shift())&&(n=setTimeout(o,i.delay),a.add(n)),e.call(this,s)}};n=setTimeout(o,i.delay),a.add(n),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(e){delete prehistory[e],a.forEach(function(e){return clearTimeout(e)}),a.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var e=this.args[0];if(Macro.has(e)){if(!Macro.get(e).isWidget)return this.error('cannot clobber existing macro "'+e+'"');Macro.delete(e)}try{Macro.add(e,{isWidget:!0,handler:function(e){return function(){var t=void 0;try{State.variables.hasOwnProperty("args")&&(t=State.variables.args),State.variables.args=[].concat(_toConsumableArray(this.args)),State.variables.args.raw=this.args.raw,State.variables.args.full=this.args.full,this.addShadow("$args");var r=document.createDocumentFragment(),a=[];if(new Wikifier(r,e),Array.from(r.querySelectorAll(".error")).forEach(function(e){a.push(e.textContent)}),0!==a.length)return this.error("error"+(a.length>1?"s":"")+" within widget contents ("+a.join("; ")+")");this.output.appendChild(r)}catch(e){return this.error("cannot execute widget: "+e.message)}finally{void 0!==t?State.variables.args=t:delete State.variables.args}}}(this.payload[0].contents)}),Config.debug&&this.createDebugView(this.name,this.source+this.payload[0].contents+"<</"+this.name+">>")}catch(t){return this.error('cannot create widget macro "'+e+'": '+t.message)}}})}();var Dialog=function(){function e(){m=function(){var e=void 0;try{
var t=document.createElement("p"),r=document.createElement("div");t.style.width="100%",t.style.height="200px",r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.width="100px",r.style.height="100px",r.style.visibility="hidden",r.style.overflow="hidden",r.appendChild(t),document.body.appendChild(r);var a=t.offsetWidth;r.style.overflow="auto";var n=t.offsetWidth;a===n&&(n=r.clientWidth),document.body.removeChild(r),e=a-n}catch(e){}return e||17}();var e=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1><button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'+L10n.get("close")+'"></button></div><div id="ui-dialog-body"></div></div>');d=jQuery(e.find("#ui-overlay").get(0)),h=jQuery(e.find("#ui-dialog").get(0)),f=jQuery(e.find("#ui-dialog-title").get(0)),p=jQuery(e.find("#ui-dialog-body").get(0)),e.insertBefore("#store-area")}function t(e){return h.hasClass("open")&&(!e||e.splitOrEmpty(/\s+/).every(function(e){return p.hasClass(e)}))}function r(e,t){return p.empty().removeClass(),null!=t&&p.addClass(t),f.empty().append((null!=e?String(e):"")||" "),p.get(0)}function a(){return p.get(0)}function n(){var e;return(e=p).append.apply(e,arguments),Dialog}function i(){var e;return(e=p).wiki.apply(e,arguments),Dialog}function o(e,t,r,a,n){return jQuery(e).ariaClick(function(e){e.preventDefault(),"function"==typeof r&&r(e),s(t,n),"function"==typeof a&&a(e)})}function s(e,r){var a=jQuery.extend({top:50},e),n=a.top;t()||(g=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),d.addClass("open"),null!==p[0].querySelector("img")&&p.imagesLoaded().always(function(){return l({data:{top:n}})}),jQuery("body>:not(script,#store-area,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0);var i=c(n);return h.css(i).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:n},jQuery.throttle(40,l)),Has.mutationObserver?(v=new MutationObserver(function(e){for(var t=0;t<e.length;++t)if("childList"===e[t].type){l({data:{top:n}});break}}),v.observe(p[0],{childList:!0,subtree:!0})):p.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:n},jQuery.throttle(40,l)),jQuery(document).on("click.dialog-close",".ui-close",{closeFn:r},u).on("keypress.dialog-close",".ui-close",function(e){13!==e.which&&32!==e.which||jQuery(this).trigger("click")}),setTimeout(function(){return jQuery.event.trigger(":dialogopen")},Engine.minDomActionDelay),Dialog}function u(e){return jQuery(document).off(".dialog-close"),v?(v.disconnect(),v=null):p.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),h.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),f.empty(),p.empty().removeClass(),d.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),null!==g&&(jQuery(g).focus(),g=null),e&&e.data&&"function"==typeof e.data.closeFn&&e.data.closeFn(e),setTimeout(function(){return jQuery.event.trigger(":dialogclose")},Engine.minDomActionDelay),Dialog}function l(e){var t=e&&e.data&&void 0!==e.data.top?e.data.top:50;"block"===h.css("display")&&(h.css({display:"none"}),h.css(jQuery.extend({display:""},c(t))))}function c(e){var t=null!=e?e:50,r=jQuery(window),a={left:"",right:"",top:"",bottom:""};h.css(a);var n=r.width()-h.outerWidth(!0)-1,i=r.height()-h.outerHeight(!0)-1;return n<=32+m&&(i-=m),i<=32+m&&(n-=m),a.left=a.right=n<=32?16:n/2>>0,a.top=i<=32?a.bottom=16:i/2>t?t:a.bottom=i/2>>0,Object.keys(a).forEach(function(e){""!==a[e]&&(a[e]+="px")}),a}var d=null,h=null,f=null,p=null,g=null,m=0,v=null;return Object.freeze(Object.defineProperties({},{init:{value:e},isOpen:{value:t},setup:{value:r},body:{value:a},append:{value:n},wiki:{value:i},addClickHandler:{value:o},open:{value:s},close:{value:u},resize:{value:function(e){return l("object"===(void 0===e?"undefined":_typeof(e))?{data:e}:undefined)}}}))}(),Engine=function(){function e(){jQuery("#init-no-js,#init-lacking").remove(),function(){var e=jQuery(document.createDocumentFragment()),t=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(t){if(UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),e.append(t),0===e.find("#passages").length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage')}else e.append('<div id="story" role="main"><div id="passages"></div></div>');e.insertBefore("#store-area")}(),S=new StyleWrapper(function(){return jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)}()),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",function(e){return"keydown"===e.type?m():g()})}function t(){if(Story.has("StoryInit"))try{var e=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var t=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");t.modes({hidden:!0}),t.append(e),k=t.output}}catch(e){console.error(e),Alert.error("StoryInit",e.message)}if(Config.history.maxStates=Math.max(0,Config.history.maxStates),Number.isSafeInteger(Config.history.maxStates)||(Config.history.maxStates=100),1===Config.history.maxStates&&(Config.history.controls=!1),null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'+Config.passages.start+'") not found');if(jQuery(document.documentElement).focus(),State.restore())h();else{var r=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(r=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(r=!1,UI.buildDialogAutoload(),UI.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(r=!Save.autosave.load())}r&&f(Config.passages.start)}}function r(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}function a(){return b}function n(){return b===v.Idle}function i(){return b!==v.Idle}function o(){return b===v.Rendering}function s(){return w}function u(e){var t=State.goTo(e);return t&&h(),t}function l(e){var t=State.go(e);return t&&h(),t}function c(){return l(-1)}function d(){return l(1)}function h(){return f(State.passage,!0)}function f(e,t){var r=e;b=v.Playing,TempState={},State.clearTemporary();var a=void 0,n=void 0;if("function"==typeof Config.navigation.override)try{var i=Config.navigation.override(r);i&&(r=i)}catch(e){}var o=Story.get(r);if(jQuery.event.trigger({type:":passageinit",passage:o}),Object.keys(prehistory).forEach(function(e){"function"==typeof prehistory[e]&&prehistory[e].call(this,e)},o),t||State.create(o.title),w=Util.now(),document.body.className&&(document.body.className=""),Object.keys(predisplay).forEach(function(e){"function"==typeof predisplay[e]&&predisplay[e].call(this,e)},o),Story.has("PassageReady"))try{a=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(e){console.error(e),Alert.error("PassageReady",e.message)}b=v.Rendering;var s=jQuery(o.render()),u=document.getElementById("passages");if(u.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&""!==Config.transitionEndEventName?[].concat(_toConsumableArray(u.childNodes)).forEach(function(e){var t=jQuery(e);if(e.nodeType===Node.ELEMENT_NODE&&t.hasClass("passage")){if(t.hasClass("passage-out"))return;t.attr("id","out-"+t.attr("id")).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?t.on(Config.transitionEndEventName,function(e){e.originalEvent.propertyName===Config.passages.transitionOut&&t.remove()}):setTimeout(function(){return t.remove()},Math.max(y,Config.passages.transitionOut))}else t.remove()}):jQuery(u).empty()),s.addClass("passage-in").appendTo(u),setTimeout(function(){return s.removeClass("passage-in")},y),Config.passages.displayTitles&&o.title!==Config.passages.start&&(document.title=o.title+" | "+Story.title),window.scroll(0,0),b=v.Playing,Story.has("PassageDone"))try{n=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(e){console.error(e),Alert.error("PassageDone",e.message)}if(jQuery.event.trigger({type:":passagedisplay",passage:o}),Object.keys(postdisplay).forEach(function(e){"function"==typeof postdisplay[e]&&postdisplay[e].call(this,e)},o),Config.ui.updateStoryElements&&UIBar.setStoryElements(),Config.debug){var l=void 0;null!=a&&(l=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady"),l.modes({hidden:!0}),l.append(a),s.prepend(l.output)),null!=n&&(l=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone"),l.modes({hidden:!0}),l.append(n),s.append(l.output)),1===State.turns&&null!=k&&s.prepend(k)}switch(g(),jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"string":o.tags.includes(Config.saves.autosave)&&Save.autosave.save();break;case"object":Array.isArray(Config.saves.autosave)&&o.tags.some(function(e){return Config.saves.autosave.includes(e)})&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",passage:o}),b=v.Idle,w=Util.now(),s[0]}function p(e,t,r){var a=!1;switch(r){case undefined:break;case"replace":case"back":a=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'+r+'"; please notify the developer')}f(e,a)}function g(){S.set("*:focus{outline:none}")}function m(){S.clear()}var v=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),y=40,b=v.Idle,w=null,k=null,S=null;return Object.freeze(Object.defineProperties({},{States:{value:v},minDomActionDelay:{value:y},init:{value:e},start:{value:t},restart:{value:r},state:{get:a},isIdle:{value:n},isPlaying:{value:i},isRendering:{value:o},lastPlay:{get:s},goTo:{value:u},go:{value:l},backward:{value:c},forward:{value:d},show:{value:h},play:{value:f},display:{value:p}}))}(),Passage=function(){var e=void 0,t=void 0;e=/^(?:debug|nobr|passage|script|stylesheet|widget|twine\..*)$/i;var r=/(?:\\n|\\t|\\s|\\|\r)/g,a=new RegExp(r.source),n=Object.freeze({"\\n":"\n","\\t":"\t","\\s":"\\","\\":"\\","\r":""});return t=function(e){if(null==e)return"";var t=String(e);return t&&a.test(t)?t.replace(r,function(e){return n[e]}):t},function(){function r(t,a){var n=this;_classCallCheck(this,r),Object.defineProperties(this,{title:{value:Util.unescape(t)},element:{value:a||null},tags:{value:Object.freeze(a&&a.hasAttribute("tags")?a.getAttribute("tags").trim().splitOrEmpty(/\s+/).sort().filter(function(e,t,r){return 0===t||r[t-1]!==e}):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-"+Util.slugify(this.title)},classes:{value:Object.freeze(0===this.tags.length?[]:function(){return n.tags.filter(function(t){return!e.test(t)}).map(function(e){return Util.slugify(e)})}())}})}return _createClass(r,[{key:"description",value:function(){var e=Config.passages.descriptions;if(null!=e)switch(void 0===e?"undefined":_typeof(e)){case"boolean":if(e)return this.title;break;case"object":if(e instanceof Map&&e.has(this.title))return e.get(this.title);if(e.hasOwnProperty(this.title))return e[this.title];break;case"function":var t=e.call(this);if(t)return t;break;default:throw new TypeError("Config.passages.descriptions must be a boolean, object, or function")}return null===this._excerpt&&(this._excerpt=r.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){var e=this.text;return this.tags.includes("Twine.image")?e="[img["+e+"]]":(Config.passages.nobr||this.tags.includes("nobr"))&&(e=e.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),e}},{key:"render",value:function(){var e=this,t=this.tags.length>0?this.tags.join(" "):null,a=document.createElement("div");return jQuery(a).attr({id:this.domId,"data-passage":this.title,"data-tags":t}).addClass("passage "+this.className),jQuery(document.body).attr("data-tags",t).addClass(this.className),jQuery(document.documentElement).attr("data-tags",t),jQuery.event.trigger({type:":passagestart",content:a,passage:this}),Object.keys(prerender).forEach(function(t){"function"==typeof prerender[t]&&prerender[t].call(e,a,t)}),Story.has("PassageHeader")&&new Wikifier(a,Story.get("PassageHeader").processText()),new Wikifier(a,this.processText()),Story.has("PassageFooter")&&new Wikifier(a,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:a,passage:this}),Object.keys(postrender).forEach(function(t){"function"==typeof postrender[t]&&postrender[t].call(e,a,t)}),this._excerpt=r.getExcerptFromNode(a),a}},{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var e=Util.escape(this.title);return'<span class="error" title="'+e+'">'+L10n.get("errorTitle")+": "+L10n.get("errorNonexistentPassage",{passage:e})+"</span>"}return t(this.element.textContent)}}],[{key:"getExcerptFromNode",value:function(e,t){if(!e.hasChildNodes())return"";var r=e.textContent.trim();if(""!==r){var a=new RegExp("(\\S+(?:\\s+\\S+){0,"+(t>0?t-1:7)+"})");r=r.replace(/\s+/g," ").match(a)}return r?r[1]+"…":"…"}},{key:"getExcerptFromText",value:function(e,t){if(""===e)return"";var r=new RegExp("(\\S+(?:\\s+\\S+){0,"+(t>0?t-1:7)+"})"),a=e.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*)(?:|[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(r);return a?a[1]+"…":"…"}}]),r}()}(),Save=function(){function e(){if("cookie"===storage.name)return a(),Config.saves.autosave=undefined,Config.saves.slots=0,!1;Config.saves.slots=Math.max(0,Config.saves.slots),Number.isSafeInteger(Config.saves.slots)||(Config.saves.slots=8);var e=r(),t=!1;Array.isArray(e)&&(e={autosave:null,slots:e},t=!0),Config.saves.slots!==e.slots.length&&(Config.saves.slots<e.slots.length?(e.slots.reverse(),e.slots=e.slots.filter(function(e){return!(null===e&&this.count>0)||(--this.count,!1)},{count:e.slots.length-Config.saves.slots}),e.slots.reverse()):Config.saves.slots>e.slots.length&&x(e.slots,Config.saves.slots-e.slots.length),t=!0),O(e.autosave)&&(t=!0);for(var n=0;n<e.slots.length;++n)O(e.slots[n])&&(t=!0);return j(e)&&(storage.delete("saves"),t=!1),t&&C(e),P=e.slots.length-1,!0}function t(){return{autosave:null,slots:x([],Config.saves.slots)}}function r(){var e=storage.get("saves");return null===e?t():e}function a(){return storage.delete("saves"),!0}function n(){return i()||d()}function i(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function o(){return null!==r().autosave}function s(){return r().autosave}function u(){var e=r();return null!==e.autosave&&A(e.autosave)}function l(e,t){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var a=r(),n={title:e||Story.get(State.passage).description(),date:Date.now()};return null!=t&&(n.metadata=t),a.autosave=T(n),C(a)}function c(){var e=r();return e.autosave=null,C(e)}function d(){return"cookie"!==storage.name&&-1!==P}function h(){return P+1}function f(){if(!d())return 0;for(var e=r(),t=0,a=0,n=e.slots.length;a<n;++a)null!==e.slots[a]&&++t;return t}function p(){return 0===f()}function g(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length||null===t.slots[e])}function m(e){if(e<0||e>P)return null;var t=r();return e>=t.slots.length?null:t.slots[e]}function v(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length||null===t.slots[e])&&A(t.slots[e])}function y(e,t,a){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return UI.alert(L10n.get("savesDisallowed")),!1;if(e<0||e>P)return!1;var n=r();if(e>=n.slots.length)return!1;var i={title:t||Story.get(State.passage).description(),date:Date.now()};return null!=a&&(i.metadata=a),n.slots[e]=T(i),C(n)}function b(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length)&&(t.slots[e]=null,C(t))}function w(e,t){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return void UI.alert(L10n.get("savesDisallowed"));var r=null==e?Story.domId:Util.slugify(e),a=r+"-"+function(){var e=new Date,t=e.getMonth()+1,r=e.getDate(),a=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return t<10&&(t="0"+t),r<10&&(r="0"+r),a<10&&(a="0"+a),n<10&&(n="0"+n),i<10&&(i="0"+i),""+e.getFullYear()+t+r+"-"+a+n+i}()+".save",n=null==t?{}:{metadata:t},i=LZString.compressToBase64(JSON.stringify(T(n)));saveAs(new Blob([i],{type:"text/plain;charset=UTF-8"}),a)}function k(e){var t=e.target.files[0],r=new FileReader;jQuery(r).on("load",function(e){var r=e.currentTarget;if(r.result){var a=void 0;try{a=JSON.parse(/\.json$/i.test(t.name)||/^\{/.test(r.result)?r.result:LZString.decompressFromBase64(r.result))}catch(e){}A(a)}}),r.readAsText(t)}function S(e){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return UI.alert(L10n.get("savesDisallowed")),null;var t=null==e?{}:{metadata:e};return LZString.compressToBase64(JSON.stringify(T(t)))}function E(e){var t=void 0;try{t=JSON.parse(LZString.decompressFromBase64(e))}catch(e){}return A(t)?t.metadata:null}function x(e,t){for(var r=0;r<t;++r)e.push(null);return e}function j(e){for(var t=e.slots,r=!0,a=0,n=t.length;a<n;++a)if(null!==t[a]){r=!1;break}return null===e.autosave&&r}function C(e){return j(e)?(storage.delete("saves"),!0):storage.set("saves",e)}function O(e){if(null==e||"object"!==(void 0===e?"undefined":_typeof(e)))return!1;var t=!1;return e.hasOwnProperty("state")&&e.state.hasOwnProperty("delta")&&e.state.hasOwnProperty("index")||(e.hasOwnProperty("data")?(delete e.mode,e.state={delta:State.deltaEncode(e.data)},delete e.data):e.state.hasOwnProperty("delta")?e.state.hasOwnProperty("index")||delete e.state.mode:(delete e.state.mode,e.state.delta=State.deltaEncode(e.state.history),delete e.state.history),e.state.index=e.state.delta.length-1,t=!0),e.state.hasOwnProperty("rseed")&&(e.state.seed=e.state.rseed,delete e.state.rseed,e.state.delta.forEach(function(e,t,r){r[t].hasOwnProperty("rcount")&&(r[t].pull=r[t].rcount,delete r[t].rcount)}),t=!0),(e.state.hasOwnProperty("expired")&&"number"==typeof e.state.expired||e.state.hasOwnProperty("unique")||e.state.hasOwnProperty("last"))&&(e.state.hasOwnProperty("expired")&&"number"==typeof e.state.expired&&delete e.state.expired,(e.state.hasOwnProperty("unique")||e.state.hasOwnProperty("last"))&&(e.state.expired=[],e.state.hasOwnProperty("unique")&&(e.state.expired.push(e.state.unique),delete e.state.unique),e.state.hasOwnProperty("last")&&(e.state.expired.push(e.state.last),delete e.state.last)),t=!0),t}function T(e){if(null!=e&&"object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("supplemental parameter must be an object");var t=Object.assign({},e,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(t.version=Config.saves.version),"function"==typeof Config.saves.onSave&&Config.saves.onSave(t),t.state.delta=State.deltaEncode(t.state.history),delete t.state.history,t}function A(e){try{if(O(e),!e||!e.hasOwnProperty("id")||!e.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(e.state.history=State.deltaDecode(e.state.delta),delete e.state.delta,"function"==typeof Config.saves.onLoad&&Config.saves.onLoad(e),e.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(e.state),Engine.show()}catch(e){return UI.alert(e.message.toUpperFirst()+".</p><p>"+L10n.get("aborting")+"."),!1}return!0}var P=-1;return Object.freeze(Object.defineProperties({},{init:{value:e},get:{value:r},clear:{value:a},ok:{value:n},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:i},has:{value:o},get:{value:s},load:{value:u},save:{value:l},delete:{value:c}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:d},length:{get:h},isEmpty:{value:p},count:{value:f},has:{value:g},get:{value:m},load:{value:v},save:{value:y},delete:{value:b}}))},export:{value:w},import:{value:k},serialize:{value:S},deserialize:{value:E}}))}(),Setting=function(){function e(){if(storage.has("options")){var e=storage.get("options");null!==e&&(window.SugarCube.settings=settings=Object.assign(t(),e)),r(),storage.delete("options")}a(),g.forEach(function(e){if(e.hasOwnProperty("onInit")){var t={name:e.name,value:settings[e.name],default:e.default};e.hasOwnProperty("list")&&(t.list=e.list),e.onInit.call(t)}})}function t(){return Object.create(null)}function r(){var e=t();return Object.keys(settings).length>0&&g.filter(function(e){return e.type!==m.Header&&settings[e.name]!==e.default}).forEach(function(t){return e[t.name]=settings[t.name]}),0===Object.keys(e).length?(storage.delete("settings"),!0):storage.set("settings",e)}function a(){var e=t(),r=storage.get("settings")||t();g.filter(function(e){return e.type!==m.Header}).forEach(function(t){return e[t.name]=t.default}),window.SugarCube.settings=settings=Object.assign(e,r)}function n(){return window.SugarCube.settings=settings=t(),storage.delete("settings"),!0}function i(e){if(0===arguments.length)n(),a();else{if(null==e||!h(e))throw new Error('nonexistent setting "'+e+'"');var t=f(e);t.type!==m.Header&&(settings[e]=t.default)}return r()}function o(e,t){g.forEach(e,t)}function s(e,t,r){if(arguments.length<3){var a=[];throw arguments.length<1&&a.push("type"),arguments.length<2&&a.push("name"),arguments.length<3&&a.push("definition"),new Error("missing parameters, no "+a.join(" or ")+" specified")}if("object"!==(void 0===r?"undefined":_typeof(r)))throw new TypeError("definition parameter must be an object");if(h(t))throw new Error('cannot clobber existing setting "'+t+'"');var n={type:e,name:t,label:null==r.label?"":String(r.label).trim()};switch(e){case m.Header:break;case m.Toggle:n.default=!!r.default;break;case m.List:if(!r.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(r.list))throw new TypeError("list must be an array");if(0===r.list.length)throw new Error("list must not be empty");if(n.list=Object.freeze(r.list),null==r.default)n.default=r.list[0];else{var i=r.list.indexOf(r.default);if(-1===i)throw new Error("list does not contain default");n.default=r.list[i]}break;default:throw new Error("unknown Setting type: "+e)}"function"==typeof r.onInit&&(n.onInit=Object.freeze(r.onInit)),"function"==typeof r.onChange&&(n.onChange=Object.freeze(r.onChange)),g.push(Object.freeze(n))}function u(e,t){s(m.Header,e,{label:t})}function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[m.Toggle].concat(t))}function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[m.List].concat(t))}function d(){return 0===g.length}function h(e){return g.some(function(t){return t.name===e})}function f(e){return g.find(function(t){return t.name===e})}function p(e){h(e)&&delete settings[e];for(var t=0;t<g.length;++t)if(g[t].name===e){g.splice(t,1),p(e);break}}var g=[],m=Util.toEnum({Header:0,Toggle:1,List:2});return Object.freeze(Object.defineProperties({},{Types:{value:m},init:{value:e},create:{value:t},save:{value:r},load:{value:a},clear:{value:n},reset:{value:i},forEach:{value:o},add:{value:s},addHeader:{value:u},addToggle:{value:l},addList:{value:c},isEmpty:{value:d},has:{value:h},get:{value:f},delete:{value:p}}))}(),Story=function(){function e(){function e(e){if(e.tags.includesAny(a))throw new Error('starting passage "'+e.title+'" contains illegal tags; invalid: "'+e.tags.filter(function(e){return a.includes(e)}).sort().join('", "')+'"')}function t(e){if(n.includes(e.title)&&e.tags.includesAny(a))throw new Error('special passage "'+e.title+'" contains illegal tags; invalid: "'+e.tags.filter(function(e){return a.includes(e)}).sort().join('", "')+'"')}var a=["widget"],n=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"],i=function(e){var t=[].concat(a),r=[];if(e.tags.forEach(function(e){t.includes(e)&&r.push.apply(r,_toConsumableArray(t.delete(e)))}),r.length>1)throw new Error('code passage "'+e.title+'" contains multiple code tags; invalid: "'+r.sort().join('", "')+'"')};if(a.unshift("script","stylesheet"),n.push("StoryTitle"),Config.passages.start=function(){var e=String("");return""!==e?(Config.debug=!0,e):"Start"}(),jQuery("#store-area").children(':not([tags~="Twine.private"],[tags~="annotation"])').each(function(){var r=jQuery(this),a=new Passage(r.attr("tiddler"),this);a.title===Config.passages.start?(e(a),c[a.title]=a):a.tags.includes("stylesheet")?(i(a),d.push(a)):a.tags.includes("script")?(i(a),h.push(a)):a.tags.includes("widget")?(i(a),f.push(a)):(t(a),c[a.title]=a)}),!c.hasOwnProperty("StoryTitle"))throw new Error('cannot find the "StoryTitle" special passage');var o=document.createDocumentFragment();new Wikifier(o,c.StoryTitle.processText().trim()),r(o.textContent.trim()),Config.saves.id=Story.domId}function t(){!function(){var e=document.createElement("style");new StyleWrapper(e).add(d.map(function(e){return e.text.trim()}).join("\n")),jQuery(e).appendTo(document.head).attr({id:"style-story",type:"text/css"})}();for(var e=0;e<h.length;++e)try{Scripting.evalJavaScript(h[e].text)}catch(t){console.error(t),Alert.error(h[e].title,"object"===(void 0===t?"undefined":_typeof(t))?t.message:t)}for(var t=0;t<f.length;++t)try{Wikifier.wikifyEval(f[t].processText())}catch(e){console.error(e),Alert.error(f[t].title,"object"===(void 0===e?"undefined":_typeof(e))?e.message:e)}}function r(e){if(null==e||""===e)throw new Error("story title cannot be null or empty");document.title=p=Util.unescape(e),m=Util.slugify(p)}function a(){return p}function n(){return m}function i(){return g}function o(e){var t=void 0===e?"undefined":_typeof(e);switch(t){case"number":case"string":return c.hasOwnProperty(String(e));case"boolean":case"function":t="a "+t;break;case"undefined":break;default:t=null===e?"null":"an "+t}throw new TypeError("Story.has title parameter cannot be "+t)}function s(e){var t=void 0===e?"undefined":_typeof(e);switch(t){case"number":case"string":var r=String(e);return c.hasOwnProperty(r)?c[r]:new Passage(r||"(unknown)");case"boolean":case"function":t="a "+t;break;case"undefined":break;default:t=null===e?"null":"an "+t}throw new TypeError("Story.get title parameter cannot be "+t)}function u(e,t){for(var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",a=Object.keys(c),n=[],i=0;i<a.length;++i){var o=c[a[i]];if(o.hasOwnProperty(e))switch(_typeof(o[e])){case"undefined":break;case"object":o[e]instanceof Array&&o[e].some(function(e){return e==t})&&n.push(o);break;default:o[e]==t&&n.push(o)}}return n.sort(function(e,t){return e[r]==t[r]?0:e[r]<t[r]?-1:1}),n}function l(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof e)throw new Error("Story.lookupWith filter parameter must be a function");for(var r=Object.keys(c),a=[],n=0;n<r.length;++n){var i=c[r[n]];e(i)&&a.push(i)}return a.sort(function(e,r){return e[t]==r[t]?0:e[t]<r[t]?-1:1}),a}var c={},d=[],h=[],f=[],p="",g="",m="";return Object.freeze(Object.defineProperties({},{passages:{value:c},styles:{value:d},scripts:{value:h},widgets:{value:f},load:{value:e},init:{value:t},title:{get:a},domId:{get:n},ifId:{get:i},has:{value:o},get:{value:s},lookup:{value:u},lookupWith:{value:l}}))}(),UI=function(){function e(e,t){var r=t,a=Config.debug,n=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==r&&(r=document.createElement("ul"));var i=document.createDocumentFragment();new Wikifier(i,Story.get(e).processText().trim());var o=[].concat(_toConsumableArray(i.querySelectorAll(".error"))).map(function(e){return e.textContent.replace(errorPrologRegExp,"")});if(o.length>0)throw new Error(o.join("; "));for(;i.hasChildNodes();){var s=i.firstChild;if(s.nodeType===Node.ELEMENT_NODE&&"A"===s.nodeName.toUpperCase()){var u=document.createElement("li");r.appendChild(u),u.appendChild(s)}else i.removeChild(s)}}finally{Config.cleanupWikifierOutput=n,Config.debug=a}return r}function t(e){jQuery(Dialog.setup("Alert","alert")).append("<p>"+e+'</p><ul class="buttons"><li><button id="alert-ok" class="ui-close">'+L10n.get(["alertOk","ok"])+"</button></li></ul>");for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];Dialog.open.apply(Dialog,r)}function r(){u(),Dialog.open.apply(Dialog,arguments)}function a(){l(),Dialog.open.apply(Dialog,arguments)}function n(){c(),Dialog.open.apply(Dialog,arguments)}function i(){d(),Dialog.open.apply(Dialog,arguments)}function o(){h(),Dialog.open.apply(Dialog,arguments)}function s(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>"+L10n.get("autoloadPrompt")+'</p><ul class="buttons"><li><button id="autoload-ok" class="ui-close">'+L10n.get(["autoloadOk","ok"])+'</button></li><li><button id="autoload-cancel" class="ui-close">'+L10n.get(["autoloadCancel","cancel"])+"</button></li></ul>"),jQuery(document).one("click.autoload",".ui-close",function(e){var t="autoload-ok"===e.target.id;jQuery(document).one(":dialogclose",function(){t&&Save.autosave.load()||Engine.play(Config.passages.start)})}),!0}function u(){var e=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(e);for(var t=State.expired.length,r=State.size-1;r>=0;--r)if(r!==State.activeIndex){var a=Story.get(State.history[r].title);a&&a.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(e){return function(){return jQuery(document).one(":dialogclose",function(){return Engine.goTo(e)})}}(r)).addClass("ui-close").text(L10n.get("jumptoTurn")+" "+(t+r+1)+": "+a.description())).appendTo(e)}e.hasChildNodes()||jQuery(e).append("<li><a><em>"+L10n.get("jumptoUnavailable")+"</em></a></li>")}function l(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>"+L10n.get("restartPrompt")+'</p><ul class="buttons"><li><button id="restart-ok">'+L10n.get(["restartOk","ok"])+'</button></li><li><button id="restart-cancel" class="ui-close">'+L10n.get(["restartCancel","cancel"])+"</button></li></ul>").find("#restart-ok").ariaClick({one:!0},function(){jQuery(document).one(":dialogclose",function(){return Engine.restart()}),Dialog.close()}),!0}function c(){function e(e,t,r,a){var n=jQuery(document.createElement("button")).attr("id","saves-"+e).html(r);return t&&n.addClass(t),a?n.ariaClick(a):n.prop("disabled",!0),jQuery(document.createElement("li")).append(n)}var r=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),a=Save.ok();if(a&&r.append(function(){function e(e,t,r,a,n){var i=jQuery(document.createElement("button")).attr("id","saves-"+e+"-"+a).addClass(e).html(r);return t&&i.addClass(t),n?"auto"===a?i.ariaClick({label:r+" "+L10n.get("savesLabelAuto")},function(){return n()}):i.ariaClick({label:r+" "+L10n.get("savesLabelSlot")+" "+(a+1)},function(){return n(a)}):i.prop("disabled",!0),i}var t=Save.get(),r=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var a=jQuery(document.createElement("td")),n=jQuery(document.createElement("td")),i=jQuery(document.createElement("td")),o=jQuery(document.createElement("td"))
;jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo(a),t.autosave?(n.append(e("load","ui-close",L10n.get("savesLabelLoad"),"auto",function(){jQuery(document).one(":dialogclose",function(){return Save.autosave.load()})})),jQuery(document.createElement("div")).text(t.autosave.title).appendTo(i),jQuery(document.createElement("div")).addClass("datestamp").html(t.autosave.date?L10n.get("savesSavedOn")+" "+new Date(t.autosave.date).toLocaleString():L10n.get("savesSavedOn")+" <em>"+L10n.get("savesUnknownDate")+"</em>").appendTo(i),o.append(e("delete",null,L10n.get("savesLabelDelete"),"auto",function(){Save.autosave.delete(),c()}))):(n.append(e("load",null,L10n.get("savesLabelLoad"),"auto")),jQuery(document.createElement("em")).text(L10n.get("savesEmptySlot")).appendTo(i),i.addClass("empty"),o.append(e("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append(a).append(n).append(i).append(o).appendTo(r)}for(var s=0,u=t.slots.length;s<u;++s){var l=jQuery(document.createElement("td")),d=jQuery(document.createElement("td")),h=jQuery(document.createElement("td")),f=jQuery(document.createElement("td"));l.append(document.createTextNode(s+1)),t.slots[s]?(d.append(e("load","ui-close",L10n.get("savesLabelLoad"),s,function(e){jQuery(document).one(":dialogclose",function(){return Save.slots.load(e)})})),jQuery(document.createElement("div")).text(t.slots[s].title).appendTo(h),jQuery(document.createElement("div")).addClass("datestamp").html(t.slots[s].date?L10n.get("savesSavedOn")+" "+new Date(t.slots[s].date).toLocaleString():L10n.get("savesSavedOn")+" <em>"+L10n.get("savesUnknownDate")+"</em>").appendTo(h),f.append(e("delete",null,L10n.get("savesLabelDelete"),s,function(e){Save.slots.delete(e),c()}))):(d.append(e("save","ui-close",L10n.get("savesLabelSave"),s,Save.slots.save)),jQuery(document.createElement("em")).text(L10n.get("savesEmptySlot")).appendTo(h),h.addClass("empty"),f.append(e("delete",null,L10n.get("savesLabelDelete"),s))),jQuery(document.createElement("tr")).append(l).append(d).append(h).append(f).appendTo(r)}return jQuery(document.createElement("table")).attr("id","saves-list").append(r)}()),a||Has.fileAPI){var n=jQuery(document.createElement("ul")).addClass("buttons").appendTo(r);return Has.fileAPI&&(n.append(e("export","ui-close",L10n.get("savesLabelExport"),function(){return Save.export()})),n.append(e("import",null,L10n.get("savesLabelImport"),function(){return r.find("#saves-import-file").trigger("click")})),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",function(e){jQuery(document).one(":dialogclose",function(){return Save.import(e)}),Dialog.close()}).appendTo(r)),a&&n.append(e("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),c()}:null)),!0}return t(L10n.get("savesIncapable")),!1}function d(){var e=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach(function(t){if(t.type===Setting.Types.Header){var r=t.name,a=Util.slugify(r),n=jQuery(document.createElement("div")),i=jQuery(document.createElement("h2")),o=jQuery(document.createElement("p"));return n.attr("id","header-body-"+a).append(i).append(o).appendTo(e),i.attr("id","header-heading-"+a).wiki(r),void o.attr("id","header-label-"+a).wiki(t.label)}var s=t.name,u=Util.slugify(s),l=jQuery(document.createElement("div")),c=jQuery(document.createElement("label")),d=jQuery(document.createElement("div")),h=void 0;switch(l.attr("id","setting-body-"+u).append(c).append(d).appendTo(e),c.attr({id:"setting-label-"+u,for:"setting-control-"+u}).wiki(t.label),null==settings[s]&&(settings[s]=t.default),t.type){case Setting.Types.Toggle:h=jQuery(document.createElement("button")),settings[s]?h.addClass("enabled").text(L10n.get("settingsOn")):h.text(L10n.get("settingsOff")),h.ariaClick(function(){settings[s]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[s]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[s]=!0),Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:s,value:settings[s],default:t.default})});break;case Setting.Types.List:h=jQuery(document.createElement("select"));for(var f=0,p=t.list.length;f<p;++f)jQuery(document.createElement("option")).val(f).text(t.list[f]).appendTo(h);h.val(t.list.indexOf(settings[s])).attr("tabindex",0).on("change",function(){settings[s]=t.list[Number(this.value)],Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:s,value:settings[s],default:t.default,list:t.list})})}h.attr("id","setting-control-"+u).appendTo(d)}),e.append('<ul class="buttons"><li><button id="settings-ok" class="ui-close">'+L10n.get(["settingsOk","ok"])+'</button></li><li><button id="settings-reset">'+L10n.get("settingsReset")+"</button></li></ul>").find("#settings-reset").ariaClick({one:!0},function(){jQuery(document).one(":dialogclose",function(){Setting.reset(),window.location.reload()}),Dialog.close()}),!0}function h(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(e("StoryShare"))}catch(e){return console.error(e),Alert.error("StoryShare",e.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:e},alert:{value:t},jumpto:{value:r},restart:{value:a},saves:{value:n},settings:{value:i},share:{value:o},buildAutoload:{value:s},buildJumpto:{value:u},buildRestart:{value:l},buildSaves:{value:c},buildSettings:{value:d},buildShare:{value:h},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.setStoryElements()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:s},buildDialogJumpto:{value:u},buildDialogRestart:{value:l},buildDialogSaves:{value:c},buildDialogSettings:{value:d},buildDialogShare:{value:h},buildLinkListFromPassage:{value:e}}))}(),UIBar=function(){function e(){o||document.getElementById("ui-bar")||(!function(){var e=L10n.get("uiBarToggle"),t=L10n.get("uiBarBackward"),r=L10n.get("uiBarJumpto"),a=L10n.get("uiBarForward");jQuery(document.createDocumentFragment()).append('<div id="ui-bar"><div id="ui-bar-tray"><button id="ui-bar-toggle" tabindex="0" title="'+e+'" aria-label="'+e+'"></button><div id="ui-bar-history"><button id="history-backward" tabindex="0" title="'+t+'" aria-label="'+t+'"></button><button id="history-jumpto" tabindex="0" title="'+r+'" aria-label="'+r+'"></button><button id="history-forward" tabindex="0" title="'+a+'" aria-label="'+a+'"></button></div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core"><li id="menu-item-saves"><a tabindex="0">'+L10n.get("savesTitle")+'</a></li><li id="menu-item-settings"><a tabindex="0">'+L10n.get("settingsTitle")+'</a></li><li id="menu-item-restart"><a tabindex="0">'+L10n.get("restartTitle")+'</a></li><li id="menu-item-share"><a tabindex="0">'+L10n.get("shareTitle")+"</a></li></ul></nav></div></div>").insertBefore("#store-area")}(),jQuery(document).on(":historyupdate.ui-bar",function(e,t){return function(){e.prop("disabled",State.length<2),t.prop("disabled",State.length===State.size)}}(jQuery("#history-backward"),jQuery("#history-forward"))))}function t(){if(!o){var e=jQuery("#ui-bar");("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&function(){var t=jQuery(e).add("#story");t.addClass("no-transition"),e.addClass("stowed"),setTimeout(function(){return t.removeClass("no-transition")},Engine.minDomActionDelay)}(),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},function(){return e.toggleClass("stowed")}),Config.history.controls?(jQuery("#history-backward").prop("disabled",State.length<2).ariaClick({label:L10n.get("uiBarBackward")},function(){return Engine.backward()}),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},function(){return UI.jumpto()}):jQuery("#history-jumpto").remove(),jQuery("#history-forward").prop("disabled",State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},function(){return Engine.forward()})):jQuery("#ui-bar-history").remove(),setPageElement("story-title","StoryTitle",Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||i(),Dialog.addClickHandler("#menu-item-saves a",null,UI.buildSaves).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():Dialog.addClickHandler("#menu-item-settings a",null,UI.buildSettings).text(L10n.get("settingsTitle")),Dialog.addClickHandler("#menu-item-restart a",null,UI.buildRestart).text(L10n.get("restartTitle")),Story.has("StoryShare")?Dialog.addClickHandler("#menu-item-share a",null,UI.buildShare).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove()}}function r(){o||(jQuery(document).off(".ui-bar"),jQuery("#ui-bar").remove(),jQuery(document.head).find("#style-ui-bar").remove(),Config.ui.updateStoryElements=!1,o=!0)}function a(e){if(!o){var t=jQuery("#ui-bar");e&&t.addClass("no-transition"),t.addClass("stowed"),e&&setTimeout(function(){return t.removeClass("no-transition")},Engine.minDomActionDelay)}}function n(e){if(!o){var t=jQuery("#ui-bar");e&&t.addClass("no-transition"),t.removeClass("stowed"),e&&setTimeout(function(){return t.removeClass("no-transition")},Engine.minDomActionDelay)}}function i(){if(!o){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var e=document.getElementById("menu-story");if(null!==e&&(jQuery(e).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",e)}catch(e){console.error(e),Alert.error("StoryMenu",e.message)}}}var o=!1;return Object.freeze(Object.defineProperties({},{init:{value:e},start:{value:t},destroy:{value:r},stow:{value:a},unstow:{value:n},setStoryElements:{value:i}}))}(),DebugBar=function(){function e(){var e=L10n.get("debugBarAddWatch"),t=L10n.get("debugBarWatchAll"),n=L10n.get("debugBarWatchNone"),o=L10n.get("debugBarWatchToggle"),d=L10n.get("debugBarViewsToggle"),h=jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch" aria-hidden="true" hidden="hidden"><div>'+L10n.get("debugBarNoWatches")+'</div>></div><div><button id="debug-bar-watch-toggle" tabindex="0" title="'+o+'" aria-label="'+o+'">'+L10n.get("debugBarLabelWatch")+'</button><label id="debug-bar-watch-label" for="debug-bar-watch-input">'+L10n.get("debugBarLabelAdd")+'</label><input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist><button id="debug-bar-watch-add" tabindex="0" title="'+e+'" aria-label="'+e+'"></button><button id="debug-bar-watch-all" tabindex="0" title="'+t+'" aria-label="'+t+'"></button><button id="debug-bar-watch-none" tabindex="0" title="'+n+'" aria-label="'+n+'"></button></div><div><button id="debug-bar-views-toggle" tabindex="0" title="'+d+'" aria-label="'+d+'">'+L10n.get("debugBarLabelViews")+'</button><label id="debug-bar-turn-label" for="debug-bar-turn-select">'+L10n.get("debugBarLabelTurn")+'</label><select id="debug-bar-turn-select" tabindex="0"></select></div></div>');g=jQuery(h.find("#debug-bar-watch").get(0)),m=jQuery(h.find("#debug-bar-watch-list").get(0)),v=jQuery(h.find("#debug-bar-turn-select").get(0));var f=jQuery(h.find("#debug-bar-watch-toggle").get(0)),p=jQuery(h.find("#debug-bar-watch-input").get(0)),y=jQuery(h.find("#debug-bar-watch-add").get(0)),b=jQuery(h.find("#debug-bar-watch-all").get(0)),w=jQuery(h.find("#debug-bar-watch-none").get(0)),k=jQuery(h.find("#debug-bar-views-toggle").get(0));h.appendTo("body"),f.ariaClick(function(){g.attr("hidden")?g.removeAttr("aria-hidden hidden"):g.attr({"aria-hidden":!0,hidden:"hidden"}),s()}),p.on(":addwatch",function(){r(this.value.trim()),this.value=""}).on("keypress",function(e){13===e.which&&(e.preventDefault(),p.trigger(":addwatch"))}),y.ariaClick(function(){return p.trigger(":addwatch")}),b.ariaClick(a),w.ariaClick(i),v.on("change",function(){Engine.goTo(Number(this.value))}),k.ariaClick(function(){DebugView.toggle(),s()}),jQuery(document).on(":historyupdate.debug-bar",c).on(":passageend.debug-bar",function(){u(),l()}).on(":enginerestart.debug-bar",function(){session.delete("debugState")})}function t(){o(),c(),u(),l()}function r(e){h.test(e)&&(p.pushUnique(e),p.sort(),u(),l(),s())}function a(){Object.keys(State.variables).map(function(e){return p.pushUnique("$"+e)}),Object.keys(State.temporary).map(function(e){return p.pushUnique("_"+e)}),p.sort(),u(),l(),s()}function n(e){p.delete(e),u(),l(),s()}function i(){for(var e=p.length-1;e>=0;--e)p.pop();u(),l(),s()}function o(){if(session.has("debugState")){var e=session.get("debugState");p.push.apply(p,_toConsumableArray(e.watchList)),e.watchEnabled?g.removeAttr("aria-hidden hidden"):g.attr({"aria-hidden":!0,hidden:"hidden"}),e.viewsEnabled?DebugView.enable():DebugView.disable()}}function s(){session.set("debugState",{watchList:p,watchEnabled:!g.attr("hidden"),viewsEnabled:DebugView.isEnabled()})}function u(){if(0===p.length)return void g.empty().append("<div>"+L10n.get("debugBarNoWatches")+"</div>");for(var e=L10n.get("debugBarDeleteWatch"),t=jQuery(document.createElement("table")),r=jQuery(document.createElement("tbody")),a=0,i=p.length;a<i;++a)!function(t,a){var i=p[t],o=i.slice(1),s="$"===i[0]?State.variables:State.temporary,u=jQuery(document.createElement("tr")),l=jQuery(document.createElement("button")),c=jQuery(document.createElement("code"));l.addClass("watch-delete").attr("data-name",i).ariaClick({one:!0,label:e},function(){return n(i)}),c.text(d(s[o])),jQuery(document.createElement("td")).append(l).appendTo(u),jQuery(document.createElement("td")).text(i).appendTo(u),jQuery(document.createElement("td")).append(c).appendTo(u),u.appendTo(r)}(a);t.append(r),g.empty().append(t)}function l(){var e=Object.keys(State.variables),t=Object.keys(State.temporary);if(0===e.length&&0===t.length)return void m.empty();var r=[].concat(_toConsumableArray(e.map(function(e){return"$"+e})),_toConsumableArray(t.map(function(e){return"_"+e}))).sort(),a=document.createDocumentFragment();r.delete(p);for(var n=0,i=r.length;n<i;++n)jQuery(document.createElement("option")).val(r[n]).appendTo(a);m.empty().append(a)}function c(){for(var e=State.size,t=State.expired.length,r=document.createDocumentFragment(),a=0;a<e;++a)jQuery(document.createElement("option")).val(a).text(t+a+1+". "+Util.escape(State.history[a].title)).appendTo(r);v.empty().prop("disabled",e<2).append(r).val(State.activeIndex)}function d(e){if(null===e)return"null";switch(void 0===e?"undefined":_typeof(e)){case"number":if(Number.isNaN(e))return"NaN";if(!Number.isFinite(e))return"Infinity";case"boolean":case"symbol":case"undefined":return String(e);case"string":return JSON.stringify(e);case"function":return"Function"}var t=Util.toStringTag(e);if("Date"===t)return"Date {"+e.toLocaleString()+"}";if("RegExp"===t)return"RegExp "+e.toString();var r=[];if(e instanceof Array||e instanceof Set){for(var a=e instanceof Array?e:Array.from(e),n=0,i=a.length;n<i;++n)r.push(a.hasOwnProperty(n)?d(a[n]):"<empty>");return Object.keys(a).filter(function(e){return!f.test(e)}).forEach(function(e){return r.push(d(e)+": "+d(a[e]))}),t+"("+a.length+") ["+r.join(", ")+"]"}return e instanceof Map?(e.forEach(function(e,t){return r.push(d(t)+" → "+d(e))}),t+"("+e.size+") {"+r.join(", ")+"}"):(Object.keys(e).forEach(function(t){return r.push(d(t)+": "+d(e[t]))}),t+" {"+r.join(", ")+"}")}var h=new RegExp("^"+Patterns.variable+"$"),f=/^\d+$/,p=[],g=null,m=null,v=null;return Object.freeze(Object.defineProperties({},{init:{value:e},start:{value:t},watch:{value:r},watchAll:{value:a},unwatch:{value:n},unwatchAll:{value:i}}))}(),LoadScreen=function(){function e(){jQuery(document).on("readystatechange.SugarCube",function(){o.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout(function(){0===o.size&&r()},Math.max(Engine.minDomActionDelay,Config.loadDelay)):r()):a())})}function t(){jQuery(document).off("readystatechange.SugarCube"),o.clear(),r()}function r(){jQuery(document.documentElement).removeAttr("data-init")}function a(){jQuery(document.documentElement).attr("data-init","loading")}function n(){return++s,o.add(s),a(),s}function i(e){if(null==e)throw new Error("LoadScreen.unlock called with a null or undefined ID");o.has(e)&&o.delete(e),0===o.size&&jQuery(document).trigger("readystatechange")}var o=new Set,s=0;return Object.freeze(Object.defineProperties({},{init:{value:e},clear:{value:t},hide:{value:r},show:{value:a},lock:{value:n},unlock:{value:i}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:24,patch:0,prerelease:null,build:8517,date:new Date("2018-03-09T13:45:21.930Z"),extensions:{},toString:function(){var e=this.prerelease?"-"+this.prerelease:"";return this.major+"."+this.minor+"."+this.patch+e+"+"+this.build},short:function(){var e=this.prerelease?"-"+this.prerelease:"";return this.title+" (v"+this.major+"."+this.minor+"."+this.patch+e+")"},long:function(){return this.title+" v"+this.toString()+" ("+this.date.toUTCString()+")"}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery(function(){try{var e=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),UIBar.start(),Config.debug&&(DebugBar.init(),DebugBar.start()),window.SugarCube={Browser:Browser,Config:Config,Dialog:Dialog,DebugView:DebugView,Engine:Engine,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Wikifier:Wikifier,macros:macros,session:session,settings:settings,setup:setup,storage:storage,version:version},LoadScreen.unlock(e)}catch(e){return console.error(e),LoadScreen.clear(),Alert.fatal(null,e.message,e)}})}(window,window.document,jQuery);}
	</script>
</body>
</html>
